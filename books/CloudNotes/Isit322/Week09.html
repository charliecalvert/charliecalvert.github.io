<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Week09</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/libs/scripts/jquery.min.js"></script><script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/index.html" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/contents.html">About</a></li><li class="dropdown"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>Week09</h1><p>Welcomes to Week09</p><Creating>a Domain Name</Creating><h1 id="indexeddb">IndexedDb</h1>
<p>This database is built into most modern browsers. We can access it from Git.</p>
<h2 id="open-the-database">Open the Database</h2>
<p>If the browser supports it, and modern browsers do, then <strong>indexedDB</strong> will be a property of the global <strong>window</strong> object.</p>
<pre><code>var request = window.indexedDB.open(dbName, versionNumber);
</code></pre><ul>
<li>set up these events:<ul>
<li>onerror</li>
<li>onsuccess</li>
<li>onupgradeneeded</li>
</ul>
</li>
</ul>
<h2 id="sample-program">Sample Program</h2>
<ul>
<li><a href="">FilePicks</a></li>
</ul>
<p>Much to be done, but a starter on it:</p>
<pre><code>elf.IndexDbWrapper = (function() {

    var db;
    var request;
    var dbName;
    var dataStoreName = &quot;customers&quot;;


    function IndexDbWrapper(dbNameInit, reportInit) {
        dbName = dbNameInit;
        report = reportInit || report;
    }

    function report(success, title, message) {
        console.log(title, message);
    }


    var onerror = function(event) {
        console.log(JSON.stringify(event, null, 4));
        report(false, &quot;Database Failure&quot;, event.target.errorCode);
    };

    /**
     * Delete all data in a data store
     * @param callback
     */
    IndexDbWrapper.prototype.clearDataStore = function(callback) {
        var transaction = db.transaction([dataStoreName], &#39;readwrite&#39;);
        var customerStore = transaction.objectStore(dataStoreName);

        // onsuccess doesn&#39;t means its done. oncomplete means its done.
        transaction.oncomplete = function(event) {
            console.log(&quot;object store cleared, operation finished.&quot;);
            callback();
        };

        customerStore.clear().onsuccess = function(event) {
            console.log(&quot;object store cleared but operation not finished&quot;);
        };
    };

    IndexDbWrapper.prototype.close = function() {
        if (db) {
            db.close();
        }
    };

    IndexDbWrapper.prototype.deleteDatabase = function(callback) {
        if (db) {
            db.close();
        }
        var deleteDbRequest = window.indexedDB.deleteDatabase(dbName);
        deleteDbRequest.onsuccess = function (event) {
            callback(event);
        };
        deleteDbRequest.onerror = function (e) {
            console.log(&quot;Database error: &quot; + e.target.errorCode);
        };
    };

    IndexDbWrapper.prototype.getAllItemsFromDataStore = function(callback, closeOnDone) {
        console.log(&quot;getAllItemsFromDataStore called&quot;);
        var transaction = db.transaction([dataStoreName]);
        var customerStore = transaction.objectStore(dataStoreName);

        var items = [];
        var cursorRequest = customerStore.openCursor();

        transaction.oncomplete = function(evt) {
            callback(items);
            if (closeOnDone) {
                db.close();
            }
        };

        cursorRequest.onerror = function(event) {
            report(false, &quot;Database Failure&quot;, event.target.errorCode);
        };

        cursorRequest.onsuccess = function(event) {
            console.log(&quot;cursor request on success called&quot;);

            report(true, &quot;Success&quot;, &quot;DataStore for SSN 444-44-4444 is &quot; + event.target.source.name);

            var cursor = event.target.result;
            if (cursor) {
                console.log(&quot;found Item: &quot;, cursor.value);
                items.push(cursor.value);
                cursor.continue(); // I think this causes onsuccess to be called again
            }

            console.log(&quot;Number of items found&quot;, items.length);
        };
    };

    IndexDbWrapper.prototype.getDbName = function() {
        return db.name;
    };

    var onOpenDbSuccess = function(event) {
        db = event.target.result;
        console.log(&quot;OnGetDbSuccess called&quot;);
        report(true, &quot;OnGetDbSuccess&quot;,  &quot;Report: Opened Database&quot;);
    };

    IndexDbWrapper.prototype.openDb = function(versionNumber, successFunc) {
        try {
            request = window.indexedDB.open(dbName, versionNumber);
            request.onerror = onerror;
            request.onupgradeneeded = onupgradeneeded;
            request.onsuccess = successFunc || onOpenDbSuccess;
            return request;
        } catch(e) {
           throw e.message;
        }
    };

    IndexDbWrapper.prototype.openAndGetData = function(versionNumber, callback) {
        var that = this;
        that.openDb(versionNumber, function(event) {
            db = event.target.result;
            that.getAllItemsFromDataStore(callback);
        });
    };

    IndexDbWrapper.prototype.insertArray = function(dataArray, callback) {
        var transaction = db.transaction([dataStoreName], &quot;readwrite&quot;);

        // Do something when all the data is added to the database.
        transaction.oncomplete = function(event) {
            // $(&quot;#alerts&quot;).bootstrap_alert(&#39;alert-success&#39;, &quot;Success&quot;, &quot;Added Data.&quot;);
            if (typeof callback !== &#39;undefined&#39;) {
                callback()
            }
        };

        transaction.onerror = onerror;

        var objectStore = transaction.objectStore(dataStoreName);
        for (var i in dataArray) {
            var request = objectStore.add(dataArray[i]);
            request.onsuccess = function(event) {
                console.log(event);
                // event.target.result == customerData[i].ssn;
            };
        }
    };

    // This event is only implemented in recent browsers
    var onupgradeneeded = function(event) {
        // TODO: Pass this in
        const customerData = [
            {ssn: &quot;444-44-4444&quot;, name: &quot;Bill&quot;, age: 35, email: &quot;bill@company.com&quot;},
            {ssn: &quot;555-55-5555&quot;, name: &quot;Donna&quot;, age: 32, email: &quot;donna@home.org&quot;},
            {ssn: &quot;666-66-6666&quot;, name: &quot;Lisa&quot;, age: 52, email: &quot;lisa@home.org&quot;}
        ];
        console.log(&#39;onUpGradeNeeded called&#39;);
        var db = event.target.result;
        report(true, &quot;OnUpGradeNeeded database.&quot;);

        // Create an objectStore to hold information about our customers. We&#39;re
        // going to use &quot;ssn&quot; as our key path because it&#39;s guaranteed to be
        // unique - or at least that&#39;s what I was told during the kickoff meeting.
        var objectStore = db.createObjectStore(dataStoreName, { keyPath: &quot;ssn&quot; });

        // Create an index to search customers by name. We may have duplicates
        // so we can&#39;t use a unique index.
        objectStore.createIndex(&quot;name&quot;, &quot;name&quot;, { unique: false });

        // Create an index to search customers by email. We want to ensure that
        // no two customers have the same email, so use a unique index.
        objectStore.createIndex(&quot;email&quot;, &quot;email&quot;, { unique: true });

        // Use transaction oncomplete to make sure the objectStore creation is
        // finished before adding data into it.
        objectStore.transaction.oncomplete = function(event) {
            // Store values in the newly created objectStore.
            var customerTransaction = db.transaction(dataStoreName, &quot;readwrite&quot;);
            var customerObjectStore = customerTransaction.objectStore(dataStoreName);

            customerTransaction.oncomplete = function(event) {
                console.log(&quot;On upgrade complete&quot;);
            };

            for (var i in customerData) {
                customerObjectStore.add(customerData[i]);
            }
        }
    };



    return IndexDbWrapper;

})();
</code></pre><p>These two tests should give you at least some idea of how to use it.</p>
<pre><code>            it(&quot;shows we can open a db&quot;, function(done) {
                var index =  new elf.IndexDbWrapper(dbName);
                var request = index.openDb(1, function(event) {
                    var db = event.target.result;
                    expect(db).to.be.ok;
                    expect(db.name).to.equal(dbName);
                    db.close();
                    done();
                });
            });

            it(&quot;shows we can get data (broken in Chromium only?)&quot;, function(done) {
                var index =  new elf.IndexDbWrapper(dbName);
                var request = index.openAndGetData(1, function(items) {
                    expect(items.length).to.equal(3);
                    expect(items[0].name).to.equal(&#39;Bill&#39;);
                    expect(items[1].name).to.equal(&#39;Donna&#39;);
                    expect(items[2].name).to.equal(&#39;Lisa&#39;);
                    done();
                });
            });
</code></pre><p>Remember, this code is likely to change!</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Using_IndexedDB">MDN</a></li>
<li><a href="http://www.ibm.com/developerworks/library/wa-indexeddb">IBM</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore">IDBobjectStore</a> </li>
<li><a href="href=&quot;http://www.dexie.org">Dexie Simple Wrapper</a></li>
</ul>
<h1 id="jade-and-markdown">Jade and Markdown</h1>
<p>Goals:</p>
<ul>
<li>We often need to create text that will be reused in multiple locations.</li>
<li>When we make a change to that file in one place, we want the changes to appear everywhere.</li>
<li>We want to be able to combine this text with other text in a simple way, and to do so often as we want.</li>
<li>We want to use markdown to compose text, but have the full power of HTML when we render that text.</li>
</ul>
<p>The ElfSite example express example.</p>
<p>Integration with Bootstrap.</p>
<p>Here is a simple example of using both the <strong>extends</strong> and <strong>include</strong> syntax:</p>
<pre><code>extends ../index.jade
block append content
    .container
        +logo
        h1= title
        p Welcomes to #{title}
        include:md JadeMarkdownExpress.md
        include:md JadeMarkdownExpress-Project.md
</code></pre><p>Notice also the <strong>mixin</strong>: +logo.</p>
<p>And the use of <strong>block append</strong>.</p>
<h2 id="jade">Jade</h2>
<p>Jade and Mixins: <a href="http://bit.ly/jade-mixins">http://bit.ly/jade-mixins</a></p>
<p>Install Jade globally:</p>
<ul>
<li>npm install -g jade</li>
</ul>
<p>Here is most or perhaps all of a <strong>Render.js</strong> script to process a jade file and copy it to your github.io folder:</p>
<pre><code>var jade = require(&#39;jade&#39;);
var fs = require(&#39;fs&#39;);

options = {
    &quot;filename&quot;: &quot;Render.js&quot;,
    &quot;title&quot;: &quot;My Title&quot;,
    &quot;basedir&quot;: &quot;/home/charlie&quot;
};

var files = [
    {
        &quot;in&quot;: &quot;views/css/ElvenSass.jade&quot;,
        &quot;out&quot;: &quot;/development/web/CssGuide/ElvenSass.html&quot;
    }, {
        &quot;in&quot;: &quot;views/web/index.jade&quot;,
        &quot;out&quot;: &quot;/development/web/index.html&quot;
    }
]

function writeFile(fileToProcess) {
    var html = jade.renderFile(fileToProcess.in, options);
    fs.writeFile(process.env.GIT_HUB_IO + fileToProcess.out, html, function (err) {
        if (err) {
            console.log(err);
        } else {
            console.log(&#39;wrote file&#39;);
        }
    });
}

for (var i = 0; i &lt; files.length; i++) {
    writeFile(files[i]);
}
</code></pre><p>Set up the <strong>GIT_HUB_IO</strong> environment variable in <strong>.bash_aliases</strong> so that it always present:</p>
<pre><code>export GIT_HUB_IO=$GIT_HOME/charliecalvert.github.io
alias gitio=&quot;cd $GIT_HUB_IO&quot;
</code></pre><p>The second one is just for convienance, so you can navigate to your folder quickly.</p>
<p>I am pushing to <strong>github.io</strong> frequently, so I have this <strong>go</strong> script in the root of that folder:</p>
<pre><code>#! /bin/bash

git add .
git commit -m &quot;These are auto changes. Use dollar sign 1 to pass parameter.&quot;
git push
</code></pre><p>I think this would allow you customize the commit message:</p>
<pre><code>git commit -m &#39;My Changes: &quot;$1&quot;.&#39;
</code></pre><p>Here is a fancier version called <strong>PushMe.sh</strong> that includes a date:</p>
<pre><code>#!/bin/sh

NOW=$(date +&quot;%m-%d-%Y&quot;)
PARAM=&quot;$1 $NOW&quot;

git add .
git commit -m &quot;$PARAM&quot;
git push
</code></pre><p>And here is one that could tie them both together so you can do everything with one command:</p>
<pre><code>#! /bin/bash

node Render.js &#39;ElvenSass.html&#39;
cd $GIT_HUB_IO 
./PushMe.sh &quot;$1&quot;
</code></pre><h2 id="setup-your-environment">Setup Your Environment</h2>
<p>Use aliases and scripts to automate the process.</p>
<p>Setup involves:</p>
<ul>
<li>github.io</li>
<li>.bash_alias aliases</li>
<li>npm install marked --save</li>
<li>npm install -g jade</li>
</ul>
<p>The <strong>Render.js</strong> script.
The <strong>Render</strong> script.</p>
<h2 id="tools">Tools</h2>
<p>Use <a href="http://sourceforge.net/projects/retext/">retext</a> to edit markdown. This can be installed from the Software Center on Lubuntu. </p>
</div></body></html<li><a href="#indexeddb">IndexedDb</a></li>
<li><a href="#open-the-database">Open the Database</a></li>
<li><a href="#sample-program">Sample Program</a></li>
<li><a href="#references">References</a></li>
<li><a href="#jade-and-markdown">Jade and Markdown</a></li>
<li><a href="#jade">Jade</a></li>
<li><a href="#setup-your-environment">Setup Your Environment</a></li>
<li><a href="#tools">Tools</a></li>>