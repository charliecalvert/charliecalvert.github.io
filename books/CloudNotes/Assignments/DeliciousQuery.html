<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>DeliciousQuery</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>DeliciousQuery</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#deliciousquery">DeliciousQuery</a></li>
<li><a href="#system-check">Step00: System Check</a></li>
<li><a href="#setup">Step01: Setup</a></li>
<li><a href="#step02-configure-test">Step02: Configure Test</a></li>
<li><a href="#core-tests">Step03: Core Tests</a></li>
<li><a href="#implementation">Step04: Implementation</a></li>
<li><a href="#create-array">Step 05: Create Array</a></li>
<li><a href="#create-map">Step 06: Create maps</a></li>
<li><a href="#filter">Step 07: Filtering</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#working-with-filters">Working with Filters</a></li><!--TOC_End--></ul><h1 id="deliciousquery">DeliciousQuery</h1>
<p>Learn more about testing.</p>
<h2 id="system-check">Step00: System Check</h2>
<p>If you have not done so already run <strong>git pull</strong> on JsObjects. Copy <strong>SystemCheck</strong> into your bin directory:</p>
<pre><code class="lang-bash">cp $JSOBJECTS/Utilities/SetupLinuxBox/SystemCheck ~/bin/.
</code></pre>
<p>Check you system:</p>
<pre><code>syscheck

=======================
Menu
=======================

b) Basic System Check
n) Node
c) Common
p) PhoneGap
x) Exit

Please make a selection: b
</code></pre><p>Make sure b and n are good.</p>
<h2 id="setup">Step01: Setup</h2>
<p>Get started as usual:</p>
<pre><code class="lang-bash">CreateExpressProject Week04-DeliciousQuery
cd Week04-DeliciousQuery/
TestReady
grunt test
</code></pre>
<p>Open the project in WebStorm.</p>
<h2 id="step02-configure-test">Step02: Configure Test</h2>
<p>There is a copy of the output from a typical call to Delicious in the <strong>JsObjects</strong> directory. In other words, I have saved the data you got when you typed in <strong>javascript</strong> in <strong>BootstrapDelicious</strong> and pressed the submit button. That data is in a file called <strong>delicious-links.js</strong>. You should copy it into your spec directory:</p>
<pre><code>cp $ELF_TEMPLATES/WebServices/delicious-javascript-links.js spec/.
</code></pre><p>In <strong>karma.conf.js</strong> load our <strong>delicious-javascript-links</strong>:</p>
<pre><code class="lang-javascript">files: [
            &#39;public/components/jquery/dist/jquery.min.js&#39;,
            &#39;public/javascripts/*.js&#39;,
            &#39;spec/test*.js&#39;,
            &#39;spec/delicious-javascript-links.js&#39;
        ],
</code></pre>
<h2 id="core-tests">Step03: Core Tests</h2>
<p>To help you get started, lets copy in a set of core tests:</p>
<pre><code class="lang-javascript">describe(&quot;Elvenware Simple Plain Suite&quot;, function() {  &#39;use strict&#39;;

    it(&quot;expects true to be true&quot;, function() {
        expect(true).toBe(true);
    });

});

describe(&quot;Test Delicious Links&quot;, function() {  &#39;use strict&#39;;

    beforeEach(function () {
        spyOn($, &#39;getJSON&#39;).and.callFake(function (url, success) {
            success(deliciousLinks);
            return {
                fail: function () {
                }
            };
        });
    });

    afterEach(function() {
       queryDelicious.deliciousLinks = null;
    });

    it(&quot;shows we can get our deliciousLink array&quot;, function() {
        queryDelicious.runQuery(&#39;javascript&#39;);
        var linkObject = queryDelicious.deliciousLinks;
        expect(linkObject).toBeTruthy();
    });

    it(&quot;show we can get a map&quot;, function() {
        queryDelicious.runQuery(&#39;javascript&#39;);
        var map = queryDelicious.getMap();

        expect(map[0].url).toContain(&#39;http&#39;);
        expect(map[0].url).toContain(&#39;web&#39;);
        expect(map[0].url).toContain(&#39;JavaScript&#39;);
    });
});
</code></pre>
<p>The <strong>beforeEach</strong> method is called once before each test. It&#39;s presence in this case ensures that we are spying on calls to <strong>getJSON</strong>. After each test we reset the key field of the <strong>queryDelicious</strong> object. This is a simple way of ensuring that we are starting from scratch when each test begins. The <strong>afterEach</strong> method is its counterpart, and is called after each test is run.</p>
<p><strong>NOTE</strong>: <em>For those who have worked with <strong>httpBackend</strong>, please note that these <strong>beforeEach</strong> and <strong>afterEach</strong> calls are quite different from those we used when testing angular with <em>*httpBackend</em></em>. All we are doing here is setting up our tests, we aren&#39;t doing book-keeping for our testing suite.</p>
<h2 id="implementation">Step04: Implementation</h2>
<p>In control.js we can put a few methods that will help you get started. The <strong>callDeliciousGetJson</strong> method is very similar to one you saw in <strong>BootstrapDelicious</strong>. The <strong>getMap</strong> method introduces the JavaScript <strong>map</strong> method, which is essential to this assignment, and in general an important part of JavaScript :</p>
<pre><code class="lang-javascript">
var queryDelicious = {
    &quot;url&quot;: &#39;http://feeds.delicious.com/v2/json/charliecalvert/&#39;,

    deliciousLinks: null,

    getUrl: function(subject) { &#39;use strict&#39;;
        return this.url + subject;
    },

    callDeliciousGetJson: function(subject) { &#39;use strict&#39;;
        var url = queryDelicious.getUrl(subject);
        $.getJSON(url, function(result) {
            queryDelicious.deliciousLinks = result;
        }).fail(function(jqXHR, textStatus) {
            console.log(jqXHR);
        });
    },

    getMap: function() { &#39;use strict&#39;;
        return this.deliciousLinks.map(function(link) {
            return { &#39;url&#39;: link.u };
        });
    }

};

queryDelicious.runQuery = function(subject) { &#39;use strict&#39;;
    this.callDeliciousGetJson(subject);
};
</code></pre>
<p>We create an object called queryDelicious with with four methods and two properties. Three of the methods are defined inside the object literal, the fourth, called <strong>runQuery</strong> is defined after the object literal is declared. Normally one would not mix the two styles like this, however, I do this only because we are in a teaching environment: I want to show you that you have a choice of two different styles when declaring JavaScript objects. It is up to you choose the one you prefer.</p>
<h2 id="create-array">Step 05: Create Array</h2>
<p>In <strong>test-basic.js</strong> add the following tests, and get them to pass:</p>
<p>A test that shows we can create an array containing all ten URLs from our delicious query:</p>
<pre><code>    it(&quot;get an array with only the url from the objects in mock delicious data&quot;, function() {
        queryDelicious.runQuery(&#39;javascript&#39;);
        var allUrls = queryDelicious.getAllUrls();
        expect(allUrls.length).toBe(10);
        expect(allUrls[1]).toBe(&quot;http://speakingjs.com/es5/index.html&quot;);
        expect(allUrls[2]).toBe(&quot;https://leanpub.com/understandinges6/read/&quot;);
        expect(allUrls[4]).toBe(&quot;https://twitter.com/nodejs&quot;);
    });
</code></pre><p>Here are some hints on how to <strong>get an array containing only the url from each item</strong>:</p>
<ul>
<li>Define a method in control.js called <strong>getAllUrls</strong>.</li>
<li>In that method, create an empty array.</li>
<li>Use <strong>$.each</strong> to iterate over the array of mock data from Delicious</li>
<li>Add the URL from each object in the mockdata to your array</li>
<li>After the loop, return the array you created.</li>
</ul>
<h2 id="create-map">Step 06: Create maps</h2>
<p>Recall the we create a simple map like this:</p>
<pre><code class="lang-javascript">    getMap: function() { &#39;use strict&#39;;
        return this.deliciousLinks.map(function(link) {
            return { &#39;url&#39;: link.u };
        });
    }
</code></pre>
<p>This function takes the data in our deliciousLinks array of objects and converts it into a much simpler array of objects. In particular, the first two objects in our delicious data look like this:</p>
<pre><code class="lang-javascript">var deliciousLinks = [
    {
        &quot;a&quot;: &quot;charliecalvert&quot;,
        &quot;d&quot;: &quot;Elvenware JavaScript Home Page&quot;,
        &quot;n&quot;: &quot;&quot;,
        &quot;u&quot;: &quot;http://www.elvenware.com/charlie/development/web/JavaScript/&quot;,
        &quot;t&quot;: [
            &quot;javascript&quot;,
            &quot;elvenware&quot;
        ],
        &quot;dt&quot;: &quot;2015-10-08T19:33:33Z&quot;
    },
    {
        &quot;a&quot;: &quot;charliecalvert&quot;,
        &quot;d&quot;: &quot;Speaking JavaScript&quot;,
        &quot;n&quot;: &quot;&quot;,
        &quot;u&quot;: &quot;http://speakingjs.com/es5/index.html&quot;,
        &quot;t&quot;: [
            &quot;javascript&quot;,
            &quot;books&quot;,
            &quot;ebook&quot;,
            &quot;learning&quot;
        ],
        &quot;dt&quot;: &quot;2015-10-04T04:16:39Z&quot;
    }, etc...
</code></pre>
<p>After our map function runs, we have create a simplified array of objects that look like this:</p>
<pre><code class="lang-javascript">[
    {
        &quot;url&quot;: &quot;http://www.elvenware.com/charlie/development/web/JavaScript/&quot;
    },
    {
        &quot;url&quot;: &quot;http://speakingjs.com/es5/index.html&quot;
    }, etc...
</code></pre>
<p>We have converted an array of complex objects with six properties into an array of simple objects with only one property called <strong>url</strong>.</p>
<p>In this section, I ask you to create more maps. For instance, here would be a method that maps both the <strong>u</strong> and the <strong>a</strong> properties of our original object in an object with two properties called <strong>url</strong> and <strong>ownerName</strong>:</p>
<pre><code class="lang-javascript">getOwnerNameMap: function() { &#39;use strict&#39;;
    return this.deliciousLinks.map(function(link) {
        return { &quot;url&quot;: link.u, &quot;ownerName&quot;: link.a };
    });
}
</code></pre>
<p><strong>NOTE</strong>: <em>You can include the above method in <strong>control.js</strong> if you want, but it is not a necessary part of the assignment.</em></p>
<p>The first two records in the array returned by the <strong>getOwnerNameMap</strong> function might look something like this:</p>
<pre><code class="lang-javascript">[
    {
        &quot;url&quot;: &quot;http://www.elvenware.com/charlie/development/web/JavaScript/&quot;,
        &quot;owner-name&quot;: &quot;charliecalvert&quot;
    },
    {
        &quot;url&quot;: &quot;http://speakingjs.com/es5/index.html&quot;,
        &quot;owner-name&quot;: &quot;charliecalvert&quot;
    }, etc...
</code></pre>
<p>Using this information on maps as background, I want you to create several more tests. To start, create a test that shows we can create a map that creates an array of object containg the following fields from our original query:</p>
<ul>
<li>Description (d)</li>
<li>URL (u)</li>
<li>Date (dt)</li>
<li>That&#39;s the d, u and dt fields from the object we get from Delicious</li>
</ul>
<p>The test should look exactly like this:</p>
<pre><code class="lang-javascript">    it(&quot;shows we can get a midsize map&quot;, function() {
        var index = 0;
        queryDelicious.runQuery(&#39;javascript&#39;);
        var map = queryDelicious.getMapMidSize();
        expect(map.length).toBe(10);
        expect(map[index].url).toBeTruthy();
        expect(map[index].description).toBeTruthy();
        expect(map[index].date).toBeTruthy();
        expect(map[index].description).toBe(&#39;Elvenware JavaScript Home Page&#39;);
    });
</code></pre>
<p>Create a method and a test for a map that contains these fields:</p>
<ul>
<li>url</li>
<li>description</li>
<li>date</li>
<li>tags</li>
</ul>
<p>The method should be called <strong>getMapBig</strong>. It should be declared outside the object literal, the way that <strong>runQuery</strong> is declared above. The test should start like this:</p>
<pre><code class="lang-javascript">    it(&quot;shows we can get a big map&quot;, function() {
        queryDelicious.runQuery(&#39;javascript&#39;);
        etc...
</code></pre>
<p>This time the index should be set to 1, and the following two tests should be included at the end of the test:</p>
<pre><code class="lang-javascript">    expect(map[index].description).toBe(&#39;Speaking JavaScript&#39;);
    expect(map[index].tags[2]).toBe(&#39;ebook&#39;);
</code></pre>
<p>These tests should appear exactly as shown.</p>
<h2 id="filter">Step 07: Filtering</h2>
<p>Create one more map called <strong>getDescriptionTag</strong> with these three fields:</p>
<ul>
<li>Description</li>
<li>URL</li>
<li>Tags</li>
</ul>
<p>This time, after you do the map, filter the results so we see only those that contain a tag for <strong>nodejs</strong>. The Javascript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">filter</a> method looks like this:</p>
<pre><code class="lang-javascript">queryDelicious.filter = function(map, filter) { &#39;use strict&#39;;
    return map.filter(function (link) {
        return ... // PUT YOUR FILTER HERE BY RETURNING EITHER TRUE OR FALSE.
    });
};
</code></pre>
<p>How is how to detect if something is an element in an array:</p>
<pre><code class="lang-javascript">return link.tags.indexOf(filter) &gt; -1;
</code></pre>
<p>The following is more intuitive, but is not supported by all browsers at this time:</p>
<pre><code class="lang-javascript">return link.tags.includes(filter) === true; // Don&#39;t use this in 2015-2016?
</code></pre>
<p><strong>NOTE</strong>: The <strong>includes</strong> function is for EcmaScript 6. I believe it works in FireFox, but not in Chrome. So we will use <strong>indexOf</strong> instead.</p>
<h2 id="turn-it-in">Turn it in</h2>
<p>Be sure your work is in a folder of your repository with the name specified in <strong>Step01</strong>. When you submit the assignment, include the URL of your repostory and/or the name of the folder where your program resides. When I run <strong>grunt test</strong>, I&#39;m expecting to see output like this:</p>
<pre><code>  Elvenware Simple Plain Suite
    ✓ expects true to be true

  Test Delicious Links
    ✓ shows we can get our deliciousLink array
    ✓ get an array with only the url from the objects in mock delicious data
    ✓ show we can get a map
    ✓ shows we can get a midsize map
    ✓ shows we can get a big map
    ✓ shows we can map on description tag
    ✓ shows we can filter a description tag
    ✓ shows that deliciousLink was set to null by afterEach
</code></pre><p>When writing the last test, you can use a Jasmine operator called <strong>toBeFalsy.</strong> This operator tests whether a variable or result is set to <strong>undefined</strong>, <strong>false</strong> or some other value considered to be similar to false. For instance, the following tests all pass:</p>
<pre><code class="lang-javascript">    it(&quot;shows how toBeFalsy works&quot;, function() {
        expect(false).toBeFalsy();
        expect(undefined).toBeFalsy();
        expect(0).toBeFalsy();
        expect(-1).not.toBeFalsy();
        expect(true).not.toBeFalsy();
    });
</code></pre>
<p>Please include a screenshot attached to your submission showing the output you get when you run your tests.</p>
<h2 id="working-with-filters">Working with Filters</h2>
<p>Here is filter that returns only odd numbers from an array of numbers:</p>
<pre><code class="lang-javascript">function removeEvens(numbers) {
    return numbers.filter(function(number) {
       return number % 2 !== 0;
    });
}
</code></pre>
<p>Here is a test that provies it works:</p>
<pre><code class="lang-javascript">    it(&quot;shows how to create a simple filter and proves it works&quot;, function() {
        function removeEvens(numbers) {
            return numbers.filter(function(number) {
               return number % 2 !== 0;
            });
        }

        var numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
        var odds = removeEvens(numbers);
        expect(odds).not.toContain(0);
        expect(odds).not.toContain(2);
        expect(odds).not.toContain(4);
        expect(odds).toContain(3);
        expect(odds).toContain(5);
        expect(odds).toContain(7);
        var expected = [1, 3, 5, 7, 9, 11];
        var result = arraysAreEqual(expected, odds);
        expect(result).toBeTruthy();
    })
</code></pre>
<p>And here is the arraysAreEqual function:</p>
<pre><code class="lang-javascript">// Similar to here: http://stackoverflow.com/a/14853974
var arraysAreEqual = function (array1, array2) { &#39;use strict&#39;;

    // if the other array is a falsy value, return
    if (!array1 || !array2)
        return false;

    // compare lengths - can save a lot of time
    if (array1.length != array2.length)
        return false;

    for (var i = 0, l = array1.length; i &lt; l; i++) {
        // Check if we have nested arrays
        if (array1[i] instanceof Array &amp;&amp; array2[i] instanceof Array) {
            // recurse into the nested arrays
            if (!arraysAreEqual(array1[i], array2[i]))
                return false;
        }
        else if (array1[i] != array2[i]) {
            // Warning - two different object instances will never be equal: {x:20} != {x:20}
            return false;
        }
    }
    return true;
};
</code></pre>
<p>See this sample program for more details on comparing arrays:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/Syntax/ArraysEqual">JsObjects</a></li>
</ul>
</div></body></html>