<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>GruntCheck</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>GruntCheck</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#grunt-check">Grunt Check</a></li>
<li><a href="#setup">Setup</a></li>
<li><a href="#clean-code">Clean Code</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul><h1 id="grunt-check">Grunt Check</h1>
<p>Learn how to use <a href="http://jshint.com/docs/">jshint</a>, <a href="https://github.com/jscs-dev/node-jscs">jscs</a> and <a href="https://github.com/beautify-web/js-beautify">jsbeautifier</a>. These utilities help you format your code and run basic sanity checks on it. The goal of this assignment is to be able to run the following commands and have them come back clean:</p>
<pre><code>grunt check
grunt test
</code></pre><p>The emphasis here is onlearning to format your code correctly. In particular, see the <a href="https://google.github.io/styleguide/javascriptguide.xml">Google style guide</a>. The JSCS tests in this project follow the Google style guides, except that our indent is four spaces rather than two.</p>
<p>This assignment turned out to be more difficult than I thought it would be at first. The main problem came when shortening lines longer than 120 characters. Yet, these style guidelines are reasonable, and we should follow them. Furthermore, it has proved nearly impossible to get either me or my students to properly format their code without some kind of hard metric, and this provides one for us.</p>
<p><strong>NOTE</strong>: <em>When viewing the Google style guide, you may find it easiest to select the <strong>Toggle All Summaries</strong> option at the top of the file.</em></p>
<p>See also:</p>
<ul>
<li><a href="http://jsbeautifier.org/">jsbeautifier.org</a></li>
</ul>
<h2 id="setup">Setup</h2>
<p>You need to create two files:</p>
<ul>
<li><strong>.jscsrc</strong>: Configure JSCS</li>
<li><strong>Gruntfile.js</strong>: Configure Grunt</li>
</ul>
<p>One is used to configure <strong>grunt</strong>, the other to configure <strong>jscs</strong>. Another configuration file that we have dealt with regularly is <strong>.bowerrc</strong>. It is used, of course, to configure <strong>bower</strong>. I mention it only because it is similar to <strong>.jscsrc</strong>.</p>
<p>Here is the <strong>.jscsrc</strong> config file:</p>
<pre><code class="lang-javascript">{
    &quot;preset&quot;: &quot;google&quot;,
    &quot;validateIndentation&quot;: 4,
    &quot;excludeFiles&quot;: [&quot;**/node_modules/**&quot;, &quot;**/components/**&quot;]
}
</code></pre>
<p>Here is <strong>Gruntfile.js</strong>:</p>
<pre><code class="lang-javascript">module.exports = function(grunt) {
    &#39;use strict&#39;;

    grunt.initConfig({

        pkg: &#39;&lt;json:package.json&gt;&#39;,

        jshint: {
            files: [&#39;**/*.js&#39;],

            options: {
                ignores: [
                    &#39;**/node_modules/**&#39;, &#39;**/components/**&#39;
                ],
                reporter: require(&#39;jshint-stylish&#39;),
                strict: true,
                jasmine: true
            }
        },

        clean: {
            yourTarget: {
                src: [&#39;**/node_modules/**&#39;, &#39;**/components/**&#39;]
            }
        },

        jscs: {
            src: &#39;**/*.js&#39;,
            options: {
                config: &#39;.jscsrc&#39;
            }
        },

        &#39;jsbeautifier&#39;: {
            files: [&#39;**/*.js&#39;, &#39;!**/node_modules/**&#39;, &#39;!**/components/**&#39;],
            options: {
                &#39;indentSize&#39;: 4
            }
        },

        karma: {
            karma: {
                configFile: &#39;karma.conf.js&#39;
            }
        }

    });

    grunt.loadNpmTasks(&#39;grunt-contrib-clean&#39;);
    grunt.loadNpmTasks(&#39;grunt-contrib-jshint&#39;);
    grunt.loadNpmTasks(&#39;grunt-jscs&#39;);
    grunt.loadNpmTasks(&#39;grunt-jsbeautifier&#39;);
    grunt.loadNpmTasks(&#39;grunt-karma&#39;);
    grunt.registerTask(&#39;beautify&#39;, [&#39;jsbeautifier&#39;]);
    grunt.registerTask(&#39;check&#39;, [&#39;beautify&#39;, &#39;jscs&#39;, &#39;jshint&#39;]);
    grunt.registerTask(&#39;test&#39;, [&#39;jshint&#39;, &#39;karma&#39;]);
};
</code></pre>
<p>In <strong>jscs</strong>, you can skip checking <strong>bitly-links.js</strong>:</p>
<pre><code>jscs: {
    src: [&#39;**/*.js&#39;, &#39;!spec/bitly-links.js&#39;],
    options: {
        config: &#39;.jscsrc&#39;
    }
},
</code></pre><p>In the code above, note how we use the bang operator to tell <strong>jscs</strong> to skip a file: <strong>!spec/bitly-linksjs</strong>.</p>
<p>We also need to turn off checking for <a href="http://jscs.info/rule/requireCamelCaseOrUpperCaseIdentifiers">CamelCase violations</a>. While we are at it, let&#39;s set the max line length to 120, which is more reasonable for modern editors. This means our <strong>.jscsrc</strong> file for <strong>BitlyInteractive</strong> and <strong>BitlyRefine</strong> should look like this:</p>
<pre><code class="lang-json">{
    &quot;preset&quot;: &quot;google&quot;,
    &quot;validateIndentation&quot;: 4,
    &quot;excludeFiles&quot;: [&quot;**/node_modules/**&quot;, &quot;**/components/**&quot;],
    &quot;requireCamelCaseOrUpperCaseIdentifiers&quot;: false,
    &quot;maximumLineLength&quot;: 120
}
</code></pre>
<p>Note the two new lines at the end of the file. The camel case problem is in our tests, where we have lines like this:</p>
<pre><code class="lang-javascript">var firstLink = bitlyUrlParser.bitlyLinks.data.link_history[0];
</code></pre>
<p>At some later point, we can use maps to transform <strong>link_history</strong> to <strong>linkHistory</strong>, but for now let&#39;s just turn off the warning.</p>
<p>If a line is too long, try to find a way to break it up. The following method had a line that was over 120 characters, but here I break it up to fit the formatting rules:</p>
<pre><code class="lang-javascript">    getUrl: function(accessToken) {
        &#39;use strict&#39;;

        var baseUrl = &#39;https://api-ssl.bitly.com/v3/user/link_history&#39;;
        var params = &#39;?access_token=&#39;;

        if (accessToken === -1) {
            return &#39;data/bitly-links.json&#39;;
        } else {
            var url = baseUrl + params;
            return url += accessToken;
        }
    },
</code></pre>
<p>Let&#39;s make a breaking change that will allows us to shorten some other lines:</p>
<pre><code class="lang-javascript">    getLinkHistoryArray: function() {
        &#39;use strict&#39;;
        return bitlyUrlParser.bitlyLinks.data.link_history;
    },

    getLinkHistoryItem: function(index) {
        &#39;use strict&#39;;
        return bitlyUrlParser.bitlyLinks.data.link_history[index];
    },

    getMap: function() {
        &#39;use strict&#39;;
        return bitlyUrlParser.getLinkHistoryArray().map(function(history) {
            var myDate = new Date(history.created_at * 1000);
            return {
                title: history.title,
                link: history.link,
                created_at: myDate.toLocaleString()
            };
        });
    },
</code></pre>
<p>Notice that we now call <strong>getLinkHistoryArray</strong> in the <strong>getMap</strong> function.</p>
<p>And let&#39;s clean up the way we report errors in the <strong>fail</strong> handler:</p>
<pre><code class="lang-javascript">    getBitlyLinks: function(accessToken) {
        &#39;use strict&#39;;
        var url = bitlyUrlParser.getUrl(accessToken);

        $.getJSON(url, function(result) {
            bitlyUrlParser.bitlyLinks = result;
            bitlyUrlParser.display();
            $(&#39;#displayLinks&#39;).html(JSON.stringify(result, null, 4));
        }).fail(function(jqxhr, textStatus, error) {
            var err = textStatus + &#39;, &#39; + error;
            console.log(&#39;Request Failed: &#39; + err);
            console.log(&#39;url:&#39;, url);
        });
    },
</code></pre>
<p>This change will break some of our tests, since <strong>getLinkHistory</strong> has been renamed to <strong>getLinkHistoryItem</strong>.</p>
<p>The <strong>package.json</strong> file for this code might look like this:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;week07-gruntcheck&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;\&quot;Learn about jscs and grunt\&quot;&quot;,
  &quot;main&quot;: &quot;work.js&quot;,
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;nodemon work.js&quot;,
    &quot;test&quot;: &quot;grunt test&quot;
  },
  &quot;keywords&quot;: [
    &quot;JavaScript&quot;,
    &quot;format&quot;
  ],
  &quot;author&quot;: &quot;Charlie Calvert&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: {
    &quot;grunt&quot;: &quot;^0.4.5&quot;,
    &quot;grunt-contrib-clean&quot;: &quot;^0.6.0&quot;,
    &quot;grunt-contrib-jshint&quot;: &quot;^0.11.3&quot;,
    &quot;grunt-jsbeautifier&quot;: &quot;^0.2.10&quot;,
    &quot;grunt-jscs&quot;: &quot;^2.3.0&quot;,
    &quot;grunt-karma&quot;: &quot;^0.12.1&quot;,
    &quot;jasmine-core&quot;: &quot;^2.3.4&quot;,
    &quot;jshint-stylish&quot;: &quot;^2.0.1&quot;,
    &quot;karma&quot;: &quot;^0.13.14&quot;,
    &quot;karma-jasmine&quot;: &quot;^0.3.6&quot;,
    &quot;karma-phantomjs-launcher&quot;: &quot;^0.2.1&quot;,
    &quot;karma-spec-reporter&quot;: &quot;0.0.22&quot;,
    &quot;phantomjs&quot;: &quot;^1.9.18&quot;
  }
}
</code></pre>
<p>This assignment does not actually use Karma, but I include the code for configuring karma in case you want to use this assignment as a template for that task.</p>
<h2 id="clean-code">Clean Code</h2>
<p>I want to be sure that the following projects, and all future projects, pass the tests set up in this project:</p>
<ul>
<li>Week04-JavaScriptObjects</li>
<li>Week06-BitlyInteractive</li>
<li>Week07-BitlyRefine</li>
</ul>
<p>Start with <strong>Week04-JavaScriptObjects</strong> as it is a very simple project. By the time you get it to pass, you should know enough to be able to test the code in the other two projects.</p>
<p>The <a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/Syntax/PrimitiveTypes">PrimitiveTypes</a> project in <strong>JsObjects</strong> provides an example of what I would, at minimum, like to see. Note that both <strong>grunt check</strong> and <strong>grunt test</strong> pass without errors. (The test is not very interesting, but it does work. That would be fine for <strong>Week04-JavaScriptObjects</strong>, but I want, of course, better tests in the other two projects.)</p>
<p>Remember, you should not need to modify the files included in this assignment. It is your JavaScript files that may need to change as a result of the tests shown here.</p>
<h2 id="turn-it-in">Turn it in</h2>
<p>When turn, I should be able to see updated files in the projects mentioned above. In particular, I should be able to go to any of those three projects, run <strong>grunt check</strong>, and see results like this:</p>
<pre><code>$ grunt check
Running &quot;jsbeautifier:files&quot; (jsbeautifier) task
Beautified 5 files, changed 0 files...OK

Running &quot;jscs:src&quot; (jscs) task
&gt;&gt; 5 files without code style errors.

Running &quot;jshint:files&quot; (jshint) task

✔ No problems


Done, without errors
</code></pre><p>The number of files may differ, but the general format should be the same. Be sure all the JavaScript code in <strong>public/javascripts/</strong> and <strong>routes/</strong> passes these tests.</p>
</div></body></html>