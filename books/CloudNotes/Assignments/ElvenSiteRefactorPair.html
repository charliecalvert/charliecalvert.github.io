<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ElvenSiteRefactorPair</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>ElvenSiteRefactorPair</h1><p>Welcome to ElvenSiteRefactorPair</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#refactoring-overview">Refactoring Overview</a></li>
<li><a href="#the-elf-class">The elf Class</a></li>
<li><a href="#create-display-class">Create Display Class</a></li>
<li><a href="#create-walking-class">Create Walking Class</a></li>
<li><a href="#set-up-jasmine">Set up Jasmine</a></li>
<li><a href="#details">Details</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>The ElvenSiteRefactorPair assignment gives you a chance to refactor your code into logical classes. This should be a step toward providing your code with an architecture that is easy to understand, and easy to test.</p>
<p>Do your work in the midterm branch. Please specify which one you use.</p>
<p>The following diagram is for use with the command line version of our program, which is called <strong>MakeHtml</strong>. However, the <strong>MakeHtml</strong> program does the same thing as <strong>ElvenSite</strong>. Just substitute the word <strong>ElvenSite</strong> (your midterm) every place you see <strong>MakeHtml</strong></p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/make-html-work-flow.png" alt="MakeHtmlWorkFlow"></p>
<a class="anchor" id="refactoring-overview"></a>
<h2>Refactoring Overview</h2>
<p>My code ended up refactored into the following classes:</p>
<ul>
<li>elf</li>
<li>elf.SiteConfig</li>
<li>elf.ImagePicker // To be added later</li>
<li>elf.Walking</li>
<li>elf.utilities</li>
<li>elf.display</li>
</ul>
<p>Set up is done in <strong>SiteConfig</strong>. For instance, I call <strong>loadConfig</strong> in this file, and I set up the button click handlers for the buttons in <strong>views/index.jade</strong>:</p>
<pre>function SiteConfig() {
    $('#pageOne').click(pageOne);
    $('#pageTwo').click(pageTwo);
}
</pre>
<p>Don&#39;t set up button handlers here for buttons on HTML pages that have not been loaded yet.</p>
<p>The <strong>Walking</strong> class handles calling the server side route that calls the <strong>elven-site-tools</strong> code for iterating through the markdown that is kept in directories like <strong>AllTest</strong>. Th <strong>getJSON</strong> call that calls the <strong>/walking</strong> route is found in this class:</p>
<pre>function callServer(requestQuery, requestIndex, callback) {
    $.getJSON('/walk', requestQuery, function (result) {
    // Code omitted here
    });
}
</pre>
<p><strong>ImagePicker</strong> is for calling the <strong>elven-site-tools</strong> code for iterating over a batch of images and creating a markdown file. The <strong>elven-site-tools</strong> code also creates a smaller version of the main image. This code will be discussed in another assignment.</p>
<p>The <strong>display</strong> class contains all the code that displays information on an HTML page.</p>
<a class="anchor" id="the-elf-class"></a>
<h2>The elf Class</h2>
<p>This object can create the constructor objects such as <strong>SiteConfig</strong>, <strong>Walking</strong> and <strong>ImagePicker</strong>:</p>
<pre>var elf = {
    init: function() {
        'use strict';
        elf.siteConfig = new elf.SiteConfig();
        elf.walking = new elf.Walking();
        elf.imagePicker = new elf.ImagePicker();
    }
};
</pre>
<p>The class is also used for global abatement. That is, it is used to limit the number of variables put in the global name space. Our program, should, in fact, put only the <strong>elf</strong> class in the global name space.</p>
<a class="anchor" id="create-display-class"></a>
<h2>Create Display Class</h2>
<p>The display class is created to be sure there is a separation of concerns. All code that has to do with displaying objects and their data goes in this class. We could refactor into multiple display classes, one for each object, if our program became more complicated.</p>
<pre>elf.display = {

    clear:function() {
        $('#displayArea').empty();
        $('#displayList').empty();
    },

    clearConfig: function() {
        $('#dirsToWalk').empty();
        $('#destinationDirs').empty();
    },

    fillDisplayArea: function(stringToDisplay) {
        $('#displayArea').html(stringToDisplay);
    },

    showApacheFiles: function(files, destinationDir) {
        files.forEach(function(file) {
            var base = "/var/www/html/";
            var extra = destinationDir.slice(base.length, destinationDir.length);
            var url = 'http://localhost/' + extra + file.slice(destinationDir.length, file.length);
            $('#displayList').append('<li><a href=\"' + url + '\" target=\"_blank\">' + url + '</a></li>');
        });
    },

    showHtmlFiles: function(files, destinationDir) {
        files.forEach(function(file) {
            // var index = file.lastIndexOf('/');
            var url = 'http://localhost/' + file.slice(destinationDir.length, file.length);
            $('#displayList').append('<li><a href=\"' + url + '\" target=\"_blank\">' + url + '</a></li>');
        });
    },

    showDebug: function(value) {
        $('#debug').append('<li>' + value + '</li>');
    }

};
</pre>
<a class="anchor" id="create-walking-class"></a>
<h2>Create Walking Class</h2>
<pre>elf.Walking = (function() {

    function Walking() {

    }

    // CODE OMITTED HERE

    return Walking
})();
</pre>
<a class="anchor" id="set-up-jasmine"></a>
<h2>Set up Jasmine</h2>
<p>To unit test the code on the server side, we want to set up jasmine. The first step is to create a <strong>jasmine.json</strong> file in a folder called <strong>spec/support</strong>. We are meeting a requirement developed by the authors of Jasmine. In particular, Jasmine expects to find this file in this location.</p>
<p>The <strong>/spec/support/jasmine.json</strong> file looks like this:</p>
<pre>{
  "spec_dir": "spec",
  "spec_files": [
    "**/test*.js"
  ]
}
</pre>
<p>The file says two things:</p>
<ul>
<li>Our tests are in a directory called <strong>spec</strong>.</li>
<li>Each of our test suites is stored in a file that begins with the word <strong>test</strong>. For instance: <strong>test-basics.js</strong>.</li>
</ul>
<a class="anchor" id="details"></a>
<h2>Details</h2>
<p>You should modify <strong>layout.jade</strong>. Be sure to include:</p>
<pre>meta(charset='UTF-8')
meta(name='viewport', content='width=device-width')
title= title
</pre>
<p>My <strong>control.js</strong> file now mostly contains <strong>elf.SiteContig</strong> with a constructor and <strong>loadConfig</strong>. Should we refactor into another class?</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Push your branch.</p>
</div></body></html>