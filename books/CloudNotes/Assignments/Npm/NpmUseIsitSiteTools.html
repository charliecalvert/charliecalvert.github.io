<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>NpmUseIsitSiteTools</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>NpmUseIsitSiteTools</h1><p>Welcome to NpmUseIsitSiteTools</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#note-on-names">Note on Names</a></li>
<li><a href="#create-projects">Create Projects</a></li>
<li><a href="#set-up">Set up</a></li>
<li><a href="#set-ports">Set Ports</a></li>
<li><a href="#link-package">Link Package to the Server</a></li>
<li><a href="#isit-site-tools-npm-update">Update <strong>isit-site-tools</strong> in the NPM Repository</a></li>
<li><a href="#get-information-from-the-package">Get Information from the Package</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>In this assignment we will:</p>
<ul>
<li>Link in <strong>isit-code</strong> to <strong>isit-site-tools</strong></li>
<li>Call from <strong>isit-site-tools</strong> to <strong>isit-code</strong></li>
<li>Write a two project, react and express based web application that displays the result of the call in the browser.</li>
</ul>
<p>Be sure <a href="https://www.ccalvert.net/books/CloudNotes/Assignments/WebCrafts/WebCraftsReactStarter.html#lamp">lamp is installed</a>.</p>
<div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://www.youtube.com/embed/wg-0wif-VyE?ecver=2" width="640" height="360" frameborder="0" gesture="media" style="position:absolute;width:100%;height:100%;left:0" allowfullscreen></iframe></div>  

<a class="anchor" id="note-on-names"></a>
<h2>Note on Names</h2>
<p>To save keystrokes when typing, and cut down on noise when reading, I&#39;ll use some simple shortcuts. Unless I explicitly state otherwise, when I write <strong>isit-code</strong>, I&#39;m referencing your <strong>isit-code-lastname</strong> project.</p>
<ul>
<li>isit-code =&gt; isit-code-lastname</li>
</ul>
<a class="anchor" id="create-projects"></a>
<h2>Create Projects</h2>
<p>Create a folder called <strong>Week04-UseSiteTools</strong> in your repository. In it, we need two projects called <strong>client</strong> and <strong>server</strong>. You have done this kind of thing before, so the process should be simple:</p>
<pre><code><span class="hljs-string">mkdir </span><span class="hljs-string">Week04-UseSiteTools </span>&amp;&amp; <span class="hljs-string">cd </span><span class="hljs-string">Week04-UseSiteTools
</span><span class="hljs-built_in">create-react-app</span> <span class="hljs-string">client </span>&amp;&amp; <span class="hljs-string">CreateAllExpress </span><span class="hljs-string">server</span>
</code></pre><a class="anchor" id="set-up"></a>
<h2>Set up</h2>
<p>Open the root folder for this project (Week04-UseSiteTools) in WebStorm. You should now be able to work on both the <strong>client</strong> and <strong>server</strong> at the same time.</p>
<p>In the <strong>server</strong>, in <strong>bin/www</strong> set the port to <strong>30026</strong>. (More on ports below.)</p>
<p>Add the <a href="https://www.ccalvert.net/books/CloudNotes/Assignments/React/RestBasics.html#link-client-and-server">proxy statement</a> for port 30026 to <strong>client/package.json</strong>.</p>
<p>Install the <strong>isit-code</strong> and <strong>isit-site-tools</strong> packages in the <strong>server</strong> project. You should be able to do this without further instruction. If you are having trouble, consider the following questions:</p>
<ul>
<li>In Node applications, what tool do I use to install packages or libraries on which my project depends?</li>
<li>How do I use that tool to install a specific package?</li>
<li>What is the exact name of my <strong>isit-code</strong> package?</li>
</ul>
<p><strong>NOTE</strong>: <em>If you find it hard to answer these questions, or to install your package, you should either ask questions about this in the discussion area, or take steps to help yourself understand and remember this process. The act of installing and using a package has to become easy for you or else you will never succeed at this time of coding.</em></p>
<p><strong>NOTE</strong>: <em>It is not cheating to simply cut and paste questions that I ask in these assignment into Google. You might not know the answer, but it probably does. Sometimes you may have to tweak the question slightly, but that should not be hard. For instance, after you know the answer to the first question above, you can replace the words <strong>that tool</strong> with something when specific when querying Google.</em></p>
<p>Finally, use <strong>npm start</strong> to launch the <strong>client</strong> and <strong>server</strong> applications, each in their own terminal tab.</p>
<a class="anchor" id="set-ports"></a>
<h2>Set Ports</h2>
<p>If they are not set up already, set the PORT environment variable to 30025. At the bash prompt type the following:</p>
<pre><code><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PORT</span>=30025
<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">SERVER_PORT</span>=30026
</code></pre><p>In <strong>server/bin/www</strong>, around line 15, use <strong>SERVER_PORT</strong> rather than <strong>PORT</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-attribute">var port</span> = normalizePort(process.env.SERVER_PORT || <span class="hljs-string">'30026'</span>);
</code></pre>
<p>In the Bash shell where you run the server:</p>
<pre><code><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">DEBUG</span>=server.server
</code></pre><p>If you prefer to have <strong>create-react-app</strong> open in a Chrome rather than Firefox, then do this at the Bash prompt:</p>
<pre><code><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">BROWSER</span>=/usr/bin/google-chrome
</code></pre><a class="anchor" id="link-package"></a>
<h2>Link Package to the Server</h2>
<p>Open up <strong>routes/index.js</strong> and import <strong>isit-site-tools</strong>. Again, you may need to think to complete this task.</p>
<p>What is <strong>routes/index.js</strong>? Is it an ES6 file that needs to be transpiled? Is it a standard node file that may or may not have some ES6 in it? Is it an HTML page? Also consider:</p>
<ul>
<li>How do I import a JavaScript file in a client side HTML page?</li>
<li>How do I import a JavaScript file into an ES6 page?</li>
<li>How do I import another file in a node application?</li>
</ul>
<p>If you are still stuck. The answer is <a href="https://www.ccalvert.net/books/CloudNotes/Assignments/Npm/NpmUseIsitCode.html">here</a>, near the top of the assignment.</p>
<p>Now that you have imported the package, look at the command line where your <strong>server</strong> is running. You should see something like this:</p>
<pre><code><span class="hljs-class"><span class="hljs-keyword">module</span>.<span class="hljs-title">js</span>:529</span>
    throw err;
    ^

<span class="hljs-symbol">Error:</span> Cannot find <span class="hljs-class"><span class="hljs-keyword">module</span> '<span class="hljs-title">isit</span>-<span class="hljs-title">code</span>-<span class="hljs-title">calvert</span>'</span>
    at Function.Module._resolveFilename (<span class="hljs-class"><span class="hljs-keyword">module</span>.<span class="hljs-title">js</span>:527:15)</span>
    at Function.Module._load (<span class="hljs-class"><span class="hljs-keyword">module</span>.<span class="hljs-title">js</span>:476:23)</span>
    at Module.<span class="hljs-keyword">require</span> (<span class="hljs-class"><span class="hljs-keyword">module</span>.<span class="hljs-title">js</span>:568:17)</span>
    at <span class="hljs-keyword">require</span> (internal/<span class="hljs-class"><span class="hljs-keyword">module</span>.<span class="hljs-title">js</span>:11:18)</span>
</code></pre><p>The system is trying to tell you that it is having trouble loading the package called <strong>isit-code-calvert</strong>. This is one of my packages, not one of your packages. This means you have to find the place where the package is being loaded, and ask it to load your package, not mine. In particular, you want to change <strong>isit-code-calvert</strong> to <strong>isit-code-lastname</strong>, where last name is your last name.</p>
<p>The Linuix <strong>grep</strong> utitlity provides a simple way to find the places where <strong>isit-code-calvert</strong> is loaded in a project. In particular, run the following command from the base of your <strong>server</strong> project:</p>
<pre><code><span class="hljs-keyword">grep</span> -rwl <span class="hljs-string">"isit-code-calvert"</span>
</code></pre><p>The output is quite lengthy. The problem, of course, is that <strong>isit-site-tools</strong> uses <strong>isit-code</strong> in many different files. Trying to make the changes in each file is a daunting task and being good techies we are lazy by nature.</p>
<p>First, lets come up with a quick fix. We will use the Linux <strong>find</strong> and <strong>sed</strong> utilities to:</p>
<ul>
<li>find all the JavaScript files in <strong>isit-site-tools</strong></li>
<li>In those files, replace all instances of <strong>isit-code-calvert</strong> with <strong>isit-code-lastname</strong></li>
</ul>
<p>In particular, try something like this, where you will need to make two obvious changes:</p>
<pre><code>cd ~/node_modules/isit-site-tools-lastname
<span class="hljs-built_in">find</span> . -iname <span class="hljs-string">"*.js"</span> | xargs sed -i 's/isit-<span class="hljs-built_in">code</span>-calvert/isit-<span class="hljs-built_in">code</span>-lastname/g' *.js
</code></pre><p>After making this change, you should be able to start your <strong>server</strong> without error.</p>
<p>All that is good and well, but it is only a temporary fix. For a more long lasting solution, we need to change the code not to this version of <strong>isit-site-tools</strong>, but to the version in the NPM repository.</p>
<a class="anchor" id="isit-site-tools-npm-update"></a>
<h2>Update <strong>isit-site-tools</strong> in the NPM Repository</h2>
<p>Go to your <strong>isit-site-tools</strong> repository. This is your fork of my project. From the root of your project, run the <strong>find</strong> and <strong>sed</strong> command shown above, but this time, ask it to skip any files in the <strong>node_modules</strong> directory:</p>
<pre><code><span class="hljs-built_in">find</span> . -iname <span class="hljs-string">"*.js"</span> -<span class="hljs-built_in">not</span> -path <span class="hljs-string">"**/node_modules/**"</span> | xargs sed -i 's/isit-<span class="hljs-built_in">code</span>-calvert/isit-<span class="hljs-built_in">code</span>-lastname/g' *.js
</code></pre><p>You will have to make the same change to this line of code that we made when we ran <strong>find</strong> and <strong>sed</strong> in the <strong>node_modules</strong> directory of the <strong>server</strong> project.</p>
<p>I consider this a bug fix, not a new feature or a breaking code. Therefore, we increment the patch number in our semver for this project. After updating the version number, we publish our fix:</p>
<pre><code><span class="hljs-built_in">npm</span> patch
<span class="hljs-built_in">npm</span> publish
</code></pre><p>Now run <strong>npm outdated</strong> in your <strong>server</strong> project. You should see that <strong>isit-site-tools</strong> is outdated. There are several ways to solve this problem, one goes like this:</p>
<ul>
<li>Open up <strong>package.json</strong> and set the version number of <strong>isit-site-tools</strong> to the current version number for your package.</li>
<li>Then uninstall and reinstall and the package:</li>
</ul>
<a class="anchor" id="get-information-from-the-package"></a>
<h2>Get Information from the Package</h2>
<p>Now we want to get some information from our package. At this stage, we don&#39;t want to really give the package a workout, we just want want to prove to ourselves that we can load and use it.</p>
<p>When looking how to use a package, it often makes sense to begin by looking in the <strong>index.js</strong> file in the package route:</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">module</span>.exports.walker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./markdown-to-html/private/walker'</span>);
<span class="hljs-built_in">module</span>.exports.walkRunner = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./markdown-to-html/runners/sample-runner'</span>);
<span class="hljs-built_in">module</span>.exports.imageHelp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./image-help/index'</span>);
<span class="hljs-built_in">module</span>.exports.makeMarkdown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./image-help/index'</span>).makeMarkdown;
<span class="hljs-built_in">module</span>.exports.getNotUsed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./image-help/index'</span>).getNotUsed;
<span class="hljs-built_in">module</span>.exports.imagesTest = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./image-help/runners/ImagesTest'</span>);
</code></pre>
<p>As you can see, this file simply exports various objects implemented in this package. But looking through them, none of htem look particular useful to us right now.</p>
<p>Looking deeper, we see that many of these objects are imported from <strong>image-help/index.js</strong>. If you scroll through that file, you will see one item that might be helpful to us:</p>
<pre><code class="lang-javascript">module.exports.configSettings = {
    <span class="hljs-attribute">getSelectedElvenImage</span>: configSettings<span class="hljs-variable">.getSelectedElvenImage</span>,
    //loadConfigFile: configSettings<span class="hljs-variable">.loadConfigFile</span>,
    getElvenImages: configSettings<span class="hljs-variable">.getElvenImages</span>,
    getSelectedElvenImages: configSettings<span class="hljs-variable">.getSelectedElvenImages</span>,
    setSelectedElvenImages: configSettings<span class="hljs-variable">.setSelectedElvenImages</span>
};
</code></pre>
<p>Here is how we can get at that simple object. First, create a config file in a folder of your server root called <strong>config</strong>:</p>
<ul>
<li><a href="https://www.ccalvert.net/books/CloudNotes/Assignments/React/ElvenWebCraftsStarter.html#the-config-file">CreateConfig</a></li>
</ul>
<p>Then create a root like this:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/foo'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{ <span class="hljs-string">'use strict'</span>;
    <span class="hljs-keyword">const</span> foo = isitSiteTools.imageHelp.configSettings;
    <span class="hljs-built_in">console</span>.log(foo);
    res.send({<span class="hljs-attr">config</span>: foo.getElvenImages()});
});
</code></pre>
<p>Now call the root from the client using react and display it on the page.</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>First push and then turn in the assignment, specifying the branch and folder where I can find your work. It might look something like this:</p>
<ul>
<li>Branch: Week04</li>
<li>Folder: Week04-UseSiteTools</li>
<li>MainRepo: <a href="mailto:git@github.com">git@github.com</a>:my-name/my-repo.git</li>
<li>IsitSite Repo: <a href="mailto:git@github.com">git@github.com</a>:my-name/my-repo.git</li>
<li>IsitCode Repo: <a href="mailto:git@github.com">git@github.com</a>:my-name/my-repo.git</li>
</ul>
<p>Specifying the repos isn&#39;t absolutely necessary, but if you think there is any possibility that I might be confused about the repos you are using, then add them.</p>
</div></body></html>