<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>NpmUseIsitCode</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>NpmUseIsitCode</h1><p>Welcome to NpmUseIsitCode</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#note-on-names">Note on Names</a></li>
<li><a href="#create-projects">Create Projects</a></li>
<li><a href="#methods-to-call">Methods to call</a></li>
<li><a href="#client">Client</a></li>
<li><a href="#webpack">Webpack</a></li>
<li><a href="#getting-user-input">Getting User Input</a></li>
<li><a href="#passing-parameters-with-fetch-">Passing Parameters with <strong>fetch</strong></a></li>
<li><a href="#handle-code-on-server">Handle code on Server</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#cannot-read-property-of-undefined">Cannot read property of undefined</a></li>
<li><a href="#finding-code">Finding Code</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>This assignment demonstrates how to use your fork of my <a href="https://github.com/charliecalvert/isit-code">isit-code</a> package. We will also create an Express and React based project that calls some methods in your fork of <strong>isit-code</strong>.</p>
<a class="anchor" id="note-on-names"></a>
<h2>Note on Names</h2>
<p>To save keystrokes when typing, and cut down on noise when reading, I&#39;ll use some simple shortcuts. Unless I explicitly state otherwise, when I write <strong>isit-code</strong>, I&#39;m referencing your <strong>isit-code-lastname</strong> project.</p>
<ul>
<li>isit-code =&gt; isit-code-lastname</li>
</ul>
<a class="anchor" id="create-projects"></a>
<h2>Create Projects</h2>
<p>Use <strong>CreateExpressProject</strong> to populate a folder in your repository called <strong>Week04-UseIsitCode</strong>:</p>
<ul>
<li>CreateExpressProject Week04-UseIsitCode</li>
</ul>
<p>Use NPM to install your <strong>isit-code</strong> project and save a reference to it in your <strong>package.json</strong> file.</p>
<a class="anchor" id="methods-to-call"></a>
<h2>Methods to call</h2>
<p>In <strong>index.js</strong> use <strong>require</strong> to load your NPM package. The call might look something like this:</p>
<pre><code class="lang-javascript"><span class="hljs-attribute">const isitCode</span> = require(<span class="hljs-string">'isit-code-lastname'</span>);
</code></pre>
<p>Most of the time, however, you want to load a particule module from the library. Suppose you want the <strong>elf-utils</strong> module. Load it like this:</p>
<pre><code class="lang-javascript"><span class="hljs-attribute">const elfUtils</span> = require(<span class="hljs-string">'isit-code-lastname'</span>).elfUtils;
</code></pre>
<p>Now call two methods from your <strong>isit-code</strong> package.</p>
<ul>
<li>elfUtils.getHomeDir</li>
<li>elfUtils.getFirstWord</li>
</ul>
<p>Create two routes in <strong>index.js</strong>, one for calling each method. The routes should have these names:</p>
<ul>
<li>/home-directory</li>
<li>/first-word</li>
</ul>
<p>For instance:</p>
<pre><code>router.get(<span class="hljs-string">'/home-directory'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> </span>{ <span class="hljs-string">'use strict'</span>;
</code></pre><p>I&#39;ll leave it up to you to implement the method. the call to <strong>elfUtils.homeDir</strong> is very simple. Also, you can see an example of how to call it in <strong>isit-code/spec/test-elf-utils-files.js</strong>.</p>
<p><strong>NOTE</strong>: <em>This is one of the times when a set of unit tests can be used not just for running tests, but for documenting a library. In particular, the primary documentation for <strong>isit-code</strong> is in the spec directory of the <strong>isit-code</strong> package. Though it would be good to have better document, it is often the case the unit tests included with a package can help you understand a package.</em></p>
<a class="anchor" id="client"></a>
<h2>Client</h2>
<p>Create a file called <strong>CallIsitCode</strong> in a directory in the root of your project called <strong>Source</strong>. The file should contain ES6 and React code.</p>
<p><strong>THREE NOTES ON STYLE</strong>:</p>
<ul>
<li><em>The most widely used convention for React components, as far as I can see, is to put only one component in a file and to name the file with PascalCase. See the <a href="https://github.com/airbnb/javascript/tree/master/react">airbnb</a> guidelines.</em></li>
<li><em>The component and the file it is in should have the same name.</em></li>
<li><em>Be sure to name the method button click methods appropriately. No more on <strong>onClick</strong> methods named <strong>bar</strong>. I&#39;ll let you choose the appropriate name, but it should be descriptive.</em></li>
</ul>
<p>Create two buttons in your React component:</p>
<ul>
<li>Get Home Dir</li>
<li>Get First Word</li>
</ul>
<p>A click on the first button should call the appropriate method on the server. Click the second button -- and well -- you know what it should do. Use <strong>fetch</strong> from <strong>whatwg-fetch</strong> to make the calls from the client to the server.</p>
<a class="anchor" id="webpack"></a>
<h2>Webpack</h2>
<p>You are going to need to create a <strong>webpack.config.js</strong> file. I would suggest you copy the one from the webpack section of the <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/React/ReactBasics.html#transpiling-with-webpack">ReactBasics</a> assignment.</p>
<p>You will want to put the <strong>entry</strong> to <strong>CallIsitCode</strong>. The output might look something like this:</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">output</span>: {<span class="hljs-attribute">path</span>: __dirname, filename: <span class="hljs-string">'./public/javascripts/bundle.js'</span>},
</code></pre>
<a class="anchor" id="getting-user-input"></a>
<h2>Getting User Input</h2>
<p>Suppose you define an <strong>input</strong> control with JSX:</p>
<pre><code class="lang-html">&lt;input <span class="hljs-class"><span class="hljs-keyword">type</span></span>=<span class="hljs-string">"text"</span> onChange={<span class="hljs-keyword">this</span>.firstWordChange} placeholder=<span class="hljs-symbol">'Enter</span> multi-word sentence.' /&gt;
</code></pre>
<p>How do we get text from the input? Declare state for the input:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">super</span>();
    <span class="hljs-keyword">this</span>.state = {
        homeDirectory: <span class="hljs-string">'Unknown'</span>,
        firstWord: <span class="hljs-string">'Unknown'</span>,
        userInput: <span class="hljs-string">'Unknown'</span>   &lt;&lt; TRACK USER INPUT
    };
    <span class="hljs-keyword">this</span>.homeDirectory = <span class="hljs-keyword">this</span>.homeDirectory.bind(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.firstWordChange = <span class="hljs-keyword">this</span>.firstWordChange.bind(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>.firstWord = <span class="hljs-keyword">this</span>.firstWord.bind(<span class="hljs-keyword">this</span>);
}
</code></pre>
<p>Define the firstWordChange method. It gets called over and over as the user types in the input. It also continually updates the <strong>this.state.userInput</strong>:</p>
<pre><code class="lang-javascript">firstWordChange(<span class="hljs-keyword">event</span>) {
    console.log(<span class="hljs-string">'firstWord:'</span>, <span class="hljs-keyword">event</span>.target.<span class="hljs-keyword">value</span>);
    <span class="hljs-keyword">this</span>.setState({userInput: <span class="hljs-keyword">event</span>.target.<span class="hljs-keyword">value</span>})
}
</code></pre>
<a class="anchor" id="passing-parameters-with-fetch-"></a>
<h2>Passing Parameters with <strong>fetch</strong></h2>
<p>Now that we have the user input in <strong>this.state.userInput</strong>, how do we pass it to the server. Like this:</p>
<p>Our goal is to pass a URL to the server describing the sentence from which we want the first word:</p>
<pre><code>/<span class="hljs-keyword">first</span>-<span class="hljs-built_in">word</span>?
</code></pre><p>First we need to define a method to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent">URL encode</a> the <a href="https://stackoverflow.com/a/34209399/253576">parameters</a>:</p>
<pre><code class="lang-javascript">getQuery() {
        <span class="hljs-keyword">const</span> params = {sentence: <span class="hljs-keyword">this</span>.state.userInput};
        <span class="hljs-keyword">const</span> encodeUri = encodeURIComponent;
        let query = <span class="hljs-keyword">Object</span>.keys(params)
            .<span class="hljs-built_in">map</span>(<span class="hljs-built_in">key</span> =&gt; encodeUri(<span class="hljs-built_in">key</span>) + <span class="hljs-string">'='</span> + encodeUri(params[<span class="hljs-built_in">key</span>]))
            .<span class="hljs-built_in">join</span>(<span class="hljs-string">'&amp;'</span>);
        <span class="hljs-keyword">return</span> query;
    }
}
</code></pre>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join">join</a> statement turns the array produced by <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> into a string joined on ampersands.</p>
<p>Then we need to use it when we call fetch:</p>
<pre><code class="lang-javascript">firstWord() {
    <span class="hljs-keyword">const</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">const</span> query = <span class="hljs-string">'/first-word?'</span> + <span class="hljs-keyword">this</span>.getQuery();
    <span class="hljs-built_in">console</span>.log(query);
    fetch(query)
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
            <span class="hljs-keyword">return</span> response.json();
        })
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">json</span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parsed json'</span>, json);
            that.setState({ <span class="hljs-attr">firstWord</span>: json.firstWord });
        })
        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ex</span>) </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parsing failed'</span>, ex);
        });
}
</code></pre>
<a class="anchor" id="handle-code-on-server"></a>
<h2>Handle code on Server</h2>
<p>And here is the code for getting the query when it is passed to the server:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/first-word'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response, next</span>) </span>{ <span class="hljs-string">'use strict'</span>;
    <span class="hljs-built_in">console</span>.log(req.query);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// Now call elfUtils with the sentence passed in the query.</span>
      <span class="hljs-comment">// Use Response.send to return the result.</span>
      <span class="hljs-comment">// Here is one way to handle an error if it occurs:</span>
    } <span class="hljs-keyword">catch</span>(e) {
        <span class="hljs-built_in">console</span>.log(e);
        res.status(<span class="hljs-number">500</span>).send(e)
    }
});
</code></pre>
<a class="anchor" id="testing"></a>
<h2>Testing</h2>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Place your work in a branch called Week04. When turning in the assignment, include the following information:</p>
<ul>
<li>Branch: <NAME OF BRANCH></li>
<li>Directory: <NAME OF DIRECTORY></li>
</ul>
<p>To get full credit, the second button must retrieve a string from the user via a TextBox. The call should retrieve the first word the user enters.</p>
<a class="anchor" id="cannot-read-property-of-undefined"></a>
<h2>Cannot read property of undefined</h2>
<p>We often get errors like this:</p>
<ul>
<li>parsing failed TypeError: <strong>Cannot read property &#39;setState&#39; of undefined</strong></li>
</ul>
<p>We know that we are calling <strong>setState</strong> of <strong>this</strong> or <strong>that</strong>. So why is <strong>this</strong> undefined? There could be many reasons, by a likely culprit is that you forgot to bind a method:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">this</span>.someMethod = <span class="hljs-keyword">this</span>.someMethod.bind(<span class="hljs-keyword">this</span>);
</code></pre>
<a class="anchor" id="finding-code"></a>
<h2>Finding Code</h2>
<p>Read the <a href="http://www.ccalvert.net/books/CloudNotes/tips/ElvenLinks.html#references">References</a> section in <a href="http://www.ccalvert.net/books/CloudNotes/tips/ElvenLinks.html">ElvenLinks</a></p>
</div></body></html>