<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>MapExpress</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>MapExpress</h1><p>Welcome to MapExpress</p><ul><!--TOC_Start--><li><a href="#map-express">Map Express</a></li>
<li><a href="#the-html-and-css">The HTML and CSS</a></li>
<li><a href="#the-code">The Code</a></li>
<li><a href="#the-constructor">The Constructor</a></li>
<li><a href="#goto-location">Goto Location</a></li>
<li><a href="#turn-it-in">Turn It In</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="map-express"></a>
<h1>Map Express</h1>
<p>The goal of this application is to show the user&#39;s current position on a map.</p>
<a class="anchor" id="the-html-and-css"></a>
<h2>The HTML and CSS</h2>
<p>To get started, create an express application called <strong>Week11MapExpress</strong>. Set the port. In <strong>routes/index.js</strong>, set the application name.</p>
<p>In <strong>views/index.jade</strong>, you need a div in which you can put your map:</p>
<pre>div#map
</pre>
<p>We will also need to set up the CSS:</p>
<pre>body {  
  font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;
  height: 100%;
  margin: 0;
  padding: 0;

}

html {
  height: 100%;
}

#map {
    background-color: blue;
    height: 100%;
    width: 100%;
}
</pre>
<a class="anchor" id="the-code"></a>
<h2>The Code</h2>
<p>We need one variable in Control with object scope:</p>
<pre>var mapDiv;
</pre>
<p>There are a few more methods we need. Put in this case, things are very simple, all the code goes into Control.js. (For the final, you will arrange things differently, but for now, just put all the code in Control.js.) Here is an updated and simplified call to <strong>getCurrentPosition</strong>:</p>
<pre>function position() {

    var options = {
        enableHighAccuracy : true,
        timeout : 5000,
        maximumAge : 0
    };

    try {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(loadMap, showDebug, options);
        } else {
            showError("NOT-SUPPORTED");
        }
    } catch (evt) {
        alert(evt);
    }
}
</pre>
<p>Instead of just showing the user the position, we display the position on a map:</p>
<pre>function loadMap(position) {
    var latlng = new google.maps.LatLng(position.coords.latitude,
            position.coords.longitude);
    var mapOptions = {
        zoom : 8,
        center : latlng,
        mapTypeId : google.maps.MapTypeId.ROADMAP
    };
    var map = $("#map");
    mapDiv = new google.maps.Map(map[0], mapOptions);

    makeMarker('here', latlng.lat(), latlng.lng());
}
</pre>
<p>This function allows us to put a pin, or marker, on the map:</p>
<pre>function makeMarker(name, latitude, longitude) {
    var location = new google.maps.LatLng(latitude, longitude);

    var place = new google.maps.Marker({
        position : location,
        map : mapDiv,
        title : name
    });

    google.maps.event.addListener(place, 'click', function() {
        mapDiv.setCenter(location);
        mapDiv.setZoom(10);
    });
}
</pre>
<p>And here is ShowDebug:</p>
<pre>var showDebug = function(textToDisplay) {
    $("#debug").append('<li>' + textToDisplay + '</li>');
};
</pre>
<a class="anchor" id="the-constructor"></a>
<h2>The Constructor</h2>
<p>The tricky part of this program is loading the Google API. If you simply want to load it like any normal human being, you could do something like this:</p>
<pre><script src="http://maps.googleapis.com/maps/api/js?sensor=true" type="text/javascript"></script>
</pre>
<p>I&#39;m sure you can see that this is way to easy, as it even eliminates the need to call the navigator to the position. Pathetic really. Definitely for the simple minded.</p>
<p>To make it interesting, we will use require, loading it in <strong>layout.jade</strong>:</p>
<pre>doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    script(src="javascripts/require.js", data-main="javascripts/Main")
  body
    block content
</pre>
<p>The problem, of course, is that trying to load it in <strong>Main.js</strong> with require doesn&#39;t work, even if we try to shim it in:</p>
<pre>require.config({
    paths : {
        "jquery" : ["http://code.jquery.com/jquery-1.11.1"],
        "googleMap": ["http://maps.googleapis.com/maps/api/js?sensor=true"],
        "Control": "Control"
    },
    shim : {
        "googleMap": ["jquery"]
    }

});
</pre>
<p>Don&#39;t use the code above, as it does not work. Part of the problem here is that <strong>api/js</strong>, like <strong>bin/www</strong>, has no <strong>.js</strong> extension. As a result, require is not happy with it. There may be a simple solution to this problem, but I came up with this one, which is not simple, but nevertheless I find it interesting:</p>
<pre>var elf = {
    position : function() {
        this.control.position();
    }
}

define(function() {

    var Control = (function() {
        'use strict';
        var mapDiv;

        function Control() {
            loadScript();
        }

    function loadScript() {
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&callback=elf.position';
      document.body.appendChild(script);
    }

        Control.prototype.position = function() { ... }

        // Code ommitted here
  });
});
</pre>
<p>We are, in effect, creating a poor man&#39;s require. It appends the call to load the script to the HTML we are loading, thus ensure that that GoogleApi javascript file does get loaded. It is also passes in the name of a callback:</p>
<p>callback=elf.position</p>
<p>Here is elf:</p>
<pre>var elf = {
    position : function() {
        this.control.position();
    }
}
</pre>
<p>But how does elf know about Control? We set that up in <strong>Main.js</strong>:</p>
<pre>require.config({
    paths : {
        "jquery" : ["http://code.jquery.com/jquery-1.11.1"],
        "Control": "Control"
    }
});

require([ "jquery", "Control" ], function(jq, Control) {
    'use strict';
    console.log("Main called.");
    elf.control = new Control();
});
</pre>
<p>The important line is this one:</p>
<pre>elf.control = new Control();
</pre>
<p>This is too fancy by far, but it does seem to work. I provide it just so you can understand that we have options even when the normal require API appears, at least to me, to not provide a solution. Granted, however, there is much about <strong>require</strong> that I don&#39;t know, and perhaps there is a simpler solution.</p>
<a class="anchor" id="goto-location"></a>
<h2>Goto Location</h2>
<p>Here is a method that can take you to any latitude or longitude on the map:</p>
<pre>function gotoLocation(latitude, longitude, zoomLevel) {
    var location = new google.maps.LatLng(latitude, longitude);
    mapDiv.setCenter(location);
    mapDiv.setZoom(zoomLevel);
    return location;
}
</pre>
<p>You can now set up a button click handler that will allow you to travel to Darwin, Australia:</p>
<pre>function gotoDarwin() {

    var darwin = gotoLocation(-12.461334, 130.841904, 14);

    var marker = new google.maps.Marker({
        position : darwin,
        map : mapDiv,
        title : "Hello World!"
    });

    google.maps.event.addListener(marker, 'click', function() {
        mapDiv.setZoom(8);
    });
}
</pre>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn It In</h2>
<p>Place you code in your repository in a folder called <strong>MapExpress</strong>. Push. Submit the assignment.</p>
</div></body></html>