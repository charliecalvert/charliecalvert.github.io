<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>BitlyInteractive</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>BitlyInteractive</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#bitly-interactive">Bitly Interactive</a></li>
<li><a href="#get-started">Get Started</a></li>
<li><a href="#load-the-data">Load the data</a></li>
<li><a href="#get-a-bitly-access-token">Get a Bitly Access Token</a></li>
<li><a href="#get-new-mixins-">Get New Mixins++</a></li>
<li><a href="#the-interface">The interface</a></li>
<li><a href="#check-a-checkbox">Check a CheckBox</a></li>
<li><a href="#converting-dates">Converting Dates</a></li>
<li><a href="#multiple-modules">Multiple Modules</a></li>
<li><a href="#iterate">Iterate</a></li>
<li><a href="#load-json">Load JSON</a></li>
<li><a href="#display-with-jade">Display with Jade</a></li>
<li><a href="#the-downloads-module">The <strong>downloads</strong> module</a></li>
<li><a href="#grunt-issues">Grunt Issues</a></li>
<li><a href="#test-the-url">Test the URL</a></li><!--TOC_End--></ul><h1 id="bitly-interactive">Bitly Interactive</h1>
<p>The primary goal of this program is to create an interface for your Bitly data.</p>
<p>Other goals include:</p>
<ul>
<li>Learn about epoch time format and how to convert it to human readable dates</li>
<li>Work with different styles of labels and controls in a form</li>
<li>Use JavaScript to check a checkbox under certain conditions</li>
<li>Multiple Modules: One JavaScript Object per file</li>
<li>Function Objects</li>
<li>Creating an access token for bitly</li>
</ul>
<p><a href="https://s3.amazonaws.com/bucket01.elvenware.com/images/Bitly-Interactive01.png"><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/Bitly-Interactive01Small.png" alt="interface"></a></p>
<p><strong>Bitly Interactive</strong>: <em>Part of the interface. Click image to see larger version.</em></p>
<p>Bitly Api Official Docs:</p>
<ul>
<li><a href="http://dev.bitly.com/get_started.html">Getting Started</a></li>
<li><a href="http://dev.bitly.com/api.html">API Docs</a></li>
<li><a href="http://dev.bitly.com/user_info.html">User Info</a></li>
<li><a href="http://dev.bitly.com/best_practices.html">Best Practices</a></li>
</ul>
<h2 id="get-started">Get Started</h2>
<p>Rather than start from scratch, copy your <strong>BitlyQuery</strong> program into a new folder called <strong>Week06-BitlyInteractive</strong>. To perform this action, first navigate to the root of your repository. Then issue a command like this:</p>
<pre><code>cp -r Week06-BitlyQuery Week06-BitlyInteractive
</code></pre><p>You will have to make a few changes to the name of the application. In particular, look in these files:</p>
<ul>
<li>bin/www</li>
<li>routes/index.js</li>
<li>package.json</li>
</ul>
<p>Find instances of the string <strong>BitlyQuery</strong>, or something similar, in each file, and change them to <strong>BitlyInteractive</strong></p>
<h2 id="load-the-data">Load the data</h2>
<p>Your program should be able to load data either directly from the Bitly website, or from a JSON file stored in your public directory.</p>
<h2 id="get-a-bitly-access-token">Get a Bitly Access Token</h2>
<p>You will need a Bitly account, and you will need to create at least a few bitly links.</p>
<p>Once you have done that, go to the bitly API home page: <a href="http://dev.bitly.com/">http://dev.bitly.com/</a>. You should always be able to find a link to the API page under the <strong>more</strong> button at the bottom of the bitly home page, and at various other places, such as on the <strong>tools</strong> page.</p>
<p>On the right, at the bottom, choose <strong>Manage my apps</strong>. Generate a <strong>Generic Access Token</strong>.</p>
<h2 id="get-new-mixins-">Get New Mixins++</h2>
<p>Run <strong>git pull</strong> on JsObjects. Copy in the new mixins from $ELF_TEMPLATES/JadeMixins. There are several files there now:</p>
<pre><code class="lang-bash">cp $ELF_TEMPLATES/JadeMixins/mixin-inputs.jade views/.
cp $ELF_TEMPLATES/JadeMixins/mixin-radios.jade views/.
cp $ELF_TEMPLATES/JadeMixins/mixin-buttons.jade views/.
</code></pre>
<p>Check to see if there are more that might be helpful, and copy them over if they look useful:</p>
<pre><code>ls $ELF_TEMPLATES/JadeMixins/
</code></pre><p>Or compare the code in your project to the code in $ELF_TEMPLATES/JadeMixins/:</p>
<pre><code>meld views $ELF_TEMPLATES/JadeMixins/
</code></pre><p>At the top of <strong>index.jade</strong>, link in the mixins that you want to use:</p>
<pre><code>extends layout
include mixin-radios
include mixin-inputs
include mixin-buttons
</code></pre><h2 id="the-interface">The interface</h2>
<p>To get started, just boot up the program normally: <strong>npm start</strong>.</p>
<p>Copy the <strong>bitly-links.json</strong> file to a directory you create called <strong>public/data</strong>. Load it from document ready.</p>
<p>Using our mixins, create an editable interface that will show the following fields from a single object in bitlyLinks array. These fields should be in input controls:</p>
<ul>
<li>keyword_link</li>
<li>title</li>
<li>aggregate_link</li>
<li>long_url</li>
<li>client_id</li>
<li>link</li>
</ul>
<p>Also convert the timestamps, and display them in input fields, as described below:</p>
<ul>
<li>user_ts</li>
<li>created_at</li>
<li>modified_at</li>
</ul>
<p>We need checkboxes to display these fields</p>
<ul>
<li>archived: false</li>
<li>private: false</li>
</ul>
<p>These should appear as the program loads so the user sees them by default. In other words, call your method that contains your getJson method from your <strong>document ready</strong> function.</p>
<p>Be sure to go to JsObjects, run <strong>git pull</strong>, and then copy in the latest mixins:</p>
<pre><code>cp $ELF_TEMPLATES/JadeMixins/mixin-radios.jade views/.
cp $ELF_TEMPLATES/JadeMixins/mixins.jade views/.
</code></pre><h2 id="check-a-checkbox">Check a CheckBox</h2>
<p>Here is how to check a checkbox in JavaScript:</p>
<pre><code class="lang-javascript">// with jquery
if (bitlyLink.private) {
    $(&quot;#checkBoxPrivate&quot;).prop(&#39;checked&#39;, true);
}

// With the JavaScript DOM:
if (bitlyLink.archived) {
    document.getElementById(&quot;checkBoxArchived&quot;).checked = true;
}
</code></pre>
<h2 id="converting-dates">Converting Dates</h2>
<p>The time stamps in the bitly data consist of numbers called epochs:</p>
<pre><code class="lang-javascript">&quot;created_at&quot;: 1444163942
</code></pre>
<p>We typically convert them from epoch format to human readable format with code like this:</p>
<pre><code class="lang-javascript">new Date(bitlyLink.created_at * 1000)
</code></pre>
<p>Most of what you need to know is at the <a href="http://www.epochconverter.com">epochconverter.com</a> site and their <a href="http://www.epochconverter.com/programming/#javascript">javascript</a> page:</p>
<h2 id="multiple-modules">Multiple Modules</h2>
<p>There comes a point where you program begins to be too complicated to fit inside one object in file. In other words, our <strong>bitlyUrlParser</strong> is no longer adequate for our needs. The problem here is the same one you encounter when you are told that you should not put all your code for a C, Java or C# program in the <strong>main</strong> module.</p>
<p>We need to divide and conquor. We need to modularize our program. We need to create objects and methods that properly delineate the various parts of our program. </p>
<p>This step is essential. If you do not create small, easy to use objects, you code will quickly become a tangled mess of spaghetti that no one can understand.</p>
<p>To make your code maintainable, it should have several objects in it. In particular, you should have at least three files on the client side:</p>
<ul>
<li>javascripts/control.js</li>
<li>javascripts/downloads.js</li>
<li>javascripts/movement.js</li>
</ul>
<p>Each of these files are described in this document.</p>
<p>Don&#39;t forget to modify <strong>layout.jade</strong> to include links to these files. </p>
<p>While we are on the subject of <strong>layout.jade</strong>, be sure that you declaring the <strong>charset</strong> and configuring the viewport:</p>
<pre><code>doctype html
html
  head
    meta(charset=&#39;UTF-8&#39;)
    meta(name=&#39;viewport&#39;, content=&#39;width=device-width&#39;)
    title= title
    link(rel=&#39;stylesheet&#39;, href=&#39;/stylesheets/style.css&#39;)
    etc...
</code></pre><h2 id="iterate">Iterate</h2>
<p>Your program should be able to iterate over the bitly objects in our bitly array. At the top of the program are three buttons:</p>
<pre><code>+elfPanel(&quot;Iterate&quot;)
    button.btn.btn-success.btn-large(type=&#39;button&#39;, onclick=&quot;movement.left()&quot;)
        span.glyphicon.glyphicon-arrow-left
        | &amp;nbsp; Left

    button.btn.btn-success.btn-large(type=&#39;button&#39;, onclick=&quot;movement.right()&quot;)
        | Right &amp;nbsp;
        span.glyphicon.glyphicon-arrow-right

    span &amp;nbsp;&amp;nbsp;&amp;nbsp;

    button.btn.btn-default(type=&#39;button&#39;, onclick=&quot;downloads.getBitlyData()&quot;)
        | Get Bitly Data &amp;nbsp;&amp;nbsp;
        span.glyphicon.glyphicon-download
</code></pre><p>The first two buttons allow you to move back and forth from record 0, to record 1 and so on. The third button can be used to load the data either from the:</p>
<ul>
<li>local json file</li>
<li>Bitly web site</li>
</ul>
<p>When iterating over the records, you need first an object that will allow you to respond to button clicks:</p>
<pre><code class="lang-javascript">var movement = {
    left: function () {
        &#39;use strict&#39;;
        if (bitlyUrlParser.linkIndex &gt; 0) {
            bitlyUrlParser.linkIndex -= 1;
            bitlyUrlParser.display();
        }
    },

    right: function () {
        &#39;use strict&#39;;
        // YOUR CODE HERE
    }
};
</code></pre>
<p>The <strong>bitlyUrlParser.display</strong> method in <strong>control.js</strong> might look, in part, a bit like this:</p>
<pre><code class="lang-javascript">var bitlyUrlParser = {
    linkIndex: 0,

    bitlyLinks: null,

    display: function () {
        &#39;use strict&#39;;
        var index = bitlyUrlParser.linkIndex;
        var bitlyLink = bitlyUrlParser.bitlyLinks.data.link_history[index];
        bitlyUrlParser.showRecord(bitlyLink);
    },

    getUrl: function (accessToken) {
        &#39;use strict&#39;;

        if (accessToken === -1) {
            return &#39;data/bitly-links.json&#39;;
        } else {
            var url = &#39;https://api-ssl.bitly.com/v3/user/link_history?access_token=&#39;;
            return url += accessToken;
        }
    },

    getBitlyLinks: function (accessToken) {
        &#39;use strict&#39;;
        var url = bitlyUrlParser.getUrl(accessToken);

        $.getJSON(url, function (result) {
            bitlyUrlParser.bitlyLinks = result;
            bitlyUrlParser.display();
            $(&#39;#displayLinks&#39;).html(JSON.stringify(result, null, 4));
        }).fail(function () {
            console.log(&quot;Error&quot;);
        });
    },

   showRecord: function (bitlyLink) {
        &#39;use strict&#39;;
        if (bitlyLink.private) {
            $(&quot;#checkBoxPrivate&quot;).prop(&#39;checked&#39;, true);
        }

        if (bitlyLink.archived) {
            document.getElementById(&quot;checkBoxArchived&quot;).checked = true;
        }

        $(&#39;#keywordLink&#39;).val(bitlyLink.keyword_link);

        etc...

    }
</code></pre>
<p>Notice that the <strong>getUrl</strong> method returns different data depending on whether you pass in a Bitly access token or the number <strong>-1</strong>. This is how the program knows whether to get local data, or data from Bitly itself. This method has changed from the implementation in <strong>BitlyQuery</strong>. The <strong>getBitlyLinks</strong> method also has several changes, including the fact that the call to <strong>getUrl</strong> now takes a parameter (as indeed it should have from the start):</p>
<pre><code>var url = bitlyUrlParser.getUrl(accessToken);
</code></pre><h2 id="load-json">Load JSON</h2>
<p>You need to copy <strong>spec/bitly-links.js</strong> into <strong>public/data/bitly-links.json</strong>. There are three steps involved:</p>
<pre><code>    mkdir public/data
    cp spec/bitly-links.js public/data/bitly-links.json
</code></pre><p>Then you need to transform the JavaScript in bitly-links.json into real JSON. The simplest way to do this is to block copy the entire contents of the file. Then navigate to the <a href="http://jsonlint.com/">jsonlint.com</a>. Now best all the code from <strong>bitly-links.json</strong> into the text box on the jsonlint web site. Click the <strong>Validate</strong> button. Your JavaScript code will fail the test. That is because it is not pure JSON. In particular, there are three problems:</p>
<ul>
<li>We need to remove the comments at the top of the file</li>
<li>There is a variable declaration at the beginning of the object declaration that needs to be deleted.</li>
<li>And we also need to remove a semicolon at the end of the object</li>
</ul>
<p>Suppose this were the contents of the file:</p>
<pre><code class="lang-javascript">var bitlyLinks = {
    &quot;status_code&quot;: 200,
    &quot;data&quot;: {
    &quot;link_history&quot;: [
        {
            &quot;keyword_link&quot;: &quot;http://bit.ly/bootstrap-basics-01-sm&quot;,
            &quot;archived&quot;: false
        },
        {
            &quot;keyword_link&quot;: &quot;http://bit.ly/bootstrap-basics-02-sm&quot;,
            &quot;archived&quot;: false
        }
   ],
        &quot;result_count&quot;: 165
},
    &quot;status_txt&quot;: &quot;OK&quot;
};
</code></pre>
<p>To turn it into JSON, remove the variable declaration and the closing semicolon:</p>
<pre><code class="lang-javascript">{
    &quot;status_code&quot;: 200,
    &quot;data&quot;: {
        &quot;link_history&quot;: [
            {
                &quot;keyword_link&quot;: &quot;http://bit.ly/bootstrap-basics-01-sm&quot;,
                &quot;archived&quot;: false
            },
            {
                &quot;keyword_link&quot;: &quot;http://bit.ly/bootstrap-basics-02-sm&quot;,
                &quot;archived&quot;: false
            }
        ],
        &quot;result_count&quot;: 165
    },
    &quot;status_txt&quot;: &quot;OK&quot;
}
</code></pre>
<p>Don&#39;t stop working in <strong>jsonlint</strong> until your code passes their test. You must be working with valid JSON or you can&#39;t retrieve it with <strong>getJSON</strong>. When you are done, paste your cleaned up code back into your file. </p>
<p><strong>NOTE</strong>: <em>Don&#39;t attempt to make the changes by hand, instead delete the old contents and replace it with the new code that passed jsonlint. Experience has taught me that this is the only reasonably safe way to do this operation.</em></p>
<p>At this point, you should be able to load the JSON with this call in your document ready:</p>
<pre><code class="lang-javascript">$(document).ready(function() { &#39;use strict&#39;; 
    bitlyUrlParser.getBitlyLinks(-1);
});
</code></pre>
<p>Two things to check, to be sure it will work:</p>
<ul>
<li>Make sure your <strong>getUrl</strong> and <strong>getBitlyLinks</strong> methods are as shown in this document. They have been messaged slightly from the version in <strong>BitlyQuery</strong>.</li>
<li>Make sure your <strong>index.jade</strong> file has an a <strong>PRE</strong> tag that can be used to display your JSON:</li>
</ul>
<pre><code class="lang-jade">extends layout

block content
  h1= title
  p Welcome to #{title}

  div
    pre#displayLinks
</code></pre>
<h2 id="display-with-jade">Display with Jade</h2>
<p>The JADE for the location where you display the data from a single object might start like this:</p>
<pre><code>+elfFormPanel(&quot;Main Form&quot;)#target

    +elfPanel(&quot;Input&quot;)
        +elfInputB(&quot;Keyword Link&quot;, &quot;keywordLink&quot;, &quot;keywordLink&quot;)#keywordLink.form-control
        MORE CODE HERE
</code></pre><p>In the same part of the <strong>index.jade</strong>, you should display the <strong>private</strong> and <strong>archive</strong> bits:</p>
<pre><code>+elfPanel(&quot;CheckBoxes&quot;)
    +elfCheckBox(&quot;Private&quot;, &quot;checkBoxPrivate&quot;, &quot;checkBoxPrivate&quot;)#checkBoxPrivate
    +elfCheckBox(&quot;Archived&quot;, &quot;checkBoxArchived&quot;, &quot;checkBoxArchived&quot;)#checkBoxArchived
</code></pre><h2 id="the-downloads-module">The <strong>downloads</strong> module</h2>
<p>This is the first time we are going to use function objects rather than plain old JavaScript literal objects. A plain old JavaScript object is declared like this:</p>
<pre><code>var myObject = { ... // STUFF IN HERE };
</code></pre><p>A function object is declared like this:</p>
<pre><code>function myFunction() { ... // STUFF IN HERE }
</code></pre><p>Or like this:</p>
<pre><code>var myFunction = function() { ... // STUFF IN HERE }
</code></pre><p>In my opinion, at least, function objects are much more flexible and powerful than plain objects.</p>
<p>In the code below, the first line creates an JavaScript object. We then declare three properties and two methods of that object:</p>
<pre><code class="lang-javascript">var downloads = function () { &#39;use strict&#39;; };

downloads.accessToken = YOUR TOKEN HERE. AS A STRING...;

downloads.dataTypes = [&quot;dtLocal&quot;, &quot;dtCloud&quot;];

downloads.dataType = downloads.dataTypes[0];

downloads.dataTypeSelection = function () {
    &#39;use strict&#39;;
    if ($(&#39;#localData&#39;).is(&#39;:checked&#39;)) {
        $(&quot;#radioButtonDisplay01&quot;).html(&quot;You clicked localData &quot;);
        downloads.dataType = downloads.dataTypes[0];
    } else {
        YOUR CODE HERE. 
        YOU NEED TO DEFINE THE CODE for THE dtCloud OPTION.
        IT IS VERY SIMILAR TO THE OTHER HALF OF THIS IF STATEMENT
    }
};

downloads.getBitlyData = function () {
    &#39;use strict&#39;;
    if (this.dataType === this.dataTypes[0]) {
        console.log(&quot;getBitlyData called: &quot;, this.dataTypes[0]);
        bitlyUrlParser.getBitlyLinks(WHAT GOES HERE?);
    } else if (this.dataType === this.dataTypes[1]) {
        YOUR CODE FOR THE CLOUD OPTION HERE
    }
};
</code></pre>
<p>When we are done, we can do things like this:</p>
<pre><code>console.log(downloads.dataTypes[0]);
console.log(downloads.accessToken);
console.log(downloads.dataType);
</code></pre><p>Or we could call the methods of the object:</p>
<pre><code>downloads.getBitlyData(-1);
</code></pre><h2 id="grunt-issues">Grunt Issues</h2>
<p>In Gruntfile.js make this change:</p>
<pre><code>reporter : require(&#39;jshint-stylish&#39;),
// reporterOutput : &#39;result.xml&#39;,
</code></pre><p>At the command line, do this:</p>
<pre><code>npm install jshint-stylish --save-dev
</code></pre><h2 id="test-the-url">Test the URL</h2>
<p>I&#39;ve come up with some additional tests that were not part of the first 2015 version of <strong>BitlyQuery</strong>. Make sure these tests are included in the <strong>Test Bitly Suite</strong>:</p>
<pre><code>    it(&quot;tests the local url we pass to getBitlyLinks&quot;, function() {
        var finalUrl;

        spyOn($, &#39;getJSON&#39;).and.callFake(function(url, success) {
            finalUrl = url;
            success(bitlyLinks);
            return {
                fail: function() {}
            };
        });

        bitlyUrlParser.getBitlyLinks(-1);
        expect(finalUrl).toBe(&#39;data/bitly-links.json&#39;);
    });

    it(&quot;tests the acccess token url we pass to getBitlyLinks&quot;, function() {
        var finalUrl;

        spyOn($, &#39;getJSON&#39;).and.callFake(function(url, success) {
            finalUrl = url;
            success(bitlyLinks);
            return {
                fail: function() {}
            };
        });

        bitlyUrlParser.getBitlyLinks(accessToken);
        expect(finalUrl).toContain(accessToken);
        expect(finalUrl).toContain(&#39;https&#39;);
    });
</code></pre><p>These don&#39;t require any extra work on your part, they are just they to help you make sure that your implementations of getUrl and getBitlyLinks are correct. In particular, they check to ensure that you have test to distinguish requests for the local url (-1) from the url that contains an access token. Take a look at the updated <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/BitlyQuery.html#set-up-unit-tests">BitlyQuery</a> assignment, as these tests are now included in that assignment in their proper context.</p>
</div></body></html>