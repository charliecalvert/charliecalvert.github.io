<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ElfNpmUnitTest</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><!-- script(src="/libs/scripts/Control.js")--><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>ElfNpmUnitTest</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#jasmine">Jasmine</a></li>
<li><a href="#reporter">Reporter</a></li>
<li><a href="#some-more-utilities">Some more utilities</a></li>
<li><a href="#test">Test</a></li>
<li><a href="#custom-reporter">Custom reporter</a></li>
<li><a href="#elflog">ElfLog</a></li>
<li><a href="#update-your-package">Update your Package</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>The goal of Elf Npm Unit Test is to refine our <strong>Isit322-lastname</strong> packages with new code and unit tests.</p>
<p>Do you work on master or the branch of your choice. Your code will be in <strong>Week02-NpmPackage</strong>.</p>
<p>Add a tag to your repository right now, before you begin work, where you decide on the version number, but use the semver scheme:</p>
<pre><code> git <span class="hljs-keyword">tag</span> <span class="hljs-title">-a</span> v0.<span class="hljs-number">0.1</span> -m <span class="hljs-string">"Before elf npm unit test 0.0.1"</span>
 git push origin --tags
</code></pre><ul>
<li><a href="https://docs.npmjs.com/getting-started/semantic-versioning#semver-for-publishers">semver explained</a></li>
</ul>
<h2 id="jasmine">Jasmine</h2>
<p>Install jasmine globally:</p>
<pre><code class="lang-bash">npm <span class="hljs-keyword">install</span> -<span class="hljs-keyword">g</span> jasmine
</code></pre>
<p>Run <strong>TestReady</strong>. This is a bit of overkill in our case, but it helps set things up properly.</p>
<p>Create the <strong>/spec/support/jasmine.json</strong> file. It should contain something like this:</p>
<pre><code class="lang-javascript">{
  "<span class="hljs-attr">spec_dir</span>": <span class="hljs-string">"spec"</span>,
  "<span class="hljs-attr">spec_files</span>": [
    <span class="hljs-string">"**/test*.js"</span>
  ]
}
</code></pre>
<h2 id="reporter">Reporter</h2>
<p>This is jasmine for node, and you can run it like this:</p>
<pre><code>jasmine
</code></pre><p>However, it is nice to have a good reporter set up. So we should, one way or another, do the equivalent of:</p>
<pre><code><span class="hljs-title">npm</span> install jasmine-spec-reporter <span class="hljs-comment">--save</span>
</code></pre><p>Then create a file called <strong>jasmine-runner.js</strong> that looks like this:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> Jasmine = <span class="hljs-keyword">require</span>(<span class="hljs-string">'jasmine'</span>);
<span class="hljs-keyword">var</span> SpecReporter = <span class="hljs-keyword">require</span>(<span class="hljs-string">'jasmine-spec-reporter'</span>);
<span class="hljs-keyword">var</span> noop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{};

<span class="hljs-keyword">var</span> jrunner = <span class="hljs-keyword">new</span> Jasmine();
jrunner.configureDefaultReporter({
    <span class="hljs-keyword">print</span>: noop
}); <span class="hljs-comment">// remove default reporter logs</span>
jasmine.getEnv().addReporter(<span class="hljs-keyword">new</span> SpecReporter()); <span class="hljs-comment">// add jasmine-spec-reporter</span>
jrunner.loadConfigFile(); <span class="hljs-comment">// load jasmine.json configuration</span>
jrunner.execute();
</code></pre>
<p>Run it like this:</p>
<pre><code class="lang-bash"><span class="hljs-selector-tag">nodemon</span> <span class="hljs-selector-tag">jasmine-runner</span><span class="hljs-selector-class">.js</span>
</code></pre>
<p>You can put the command shown above, or some variant on it, in your <strong>package.json</strong> file:</p>
<pre><code class="lang-javascript"><span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"test"</span>: <span class="hljs-string">"node jasmine-runner.js"</span>
},
</code></pre>
<p>Now you can type <strong>npm test</strong> to run your tests.</p>
<h2 id="some-more-utilities">Some more utilities</h2>
<p>Add these to your utils file:</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExtension</span>(<span class="hljs-params">fileName</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    fileName = fileName.trim();
    <span class="hljs-keyword">var</span> array = fileName.split(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">if</span> (array.length === <span class="hljs-number">1</span> || (array[<span class="hljs-number">0</span>] === <span class="hljs-string">''</span> &amp;&amp; array.length === <span class="hljs-number">2</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
    <span class="hljs-keyword">return</span> array.pop().toLowerCase();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">swapExtension</span>(<span class="hljs-params">fileName, ext</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> fileName.substr(<span class="hljs-number">0</span>, fileName.lastIndexOf(<span class="hljs-string">'.'</span>)) + ext;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span>(<span class="hljs-params">itemToCheck</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(itemToCheck) === <span class="hljs-string">'[object Array]'</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHomeDir</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> homeDir = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (os.platform() === <span class="hljs-string">'linux'</span>) {
        homeDir = process.env.HOME;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (os.platform() === <span class="hljs-string">'win32'</span>) {
        homeDir = process.env.USERPROFILE;
    }
    <span class="hljs-keyword">return</span> homeDir;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertString</span>(<span class="hljs-params">fileName, itemToInsert, index</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> output = [fileName.slice(<span class="hljs-number">0</span>, index), itemToInsert, fileName.slice(index)].join(<span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span> output;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeFromEndAtCharacter</span>(<span class="hljs-params">value, char</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> value.substring(<span class="hljs-number">0</span>, value.lastIndexOf(char));
}
</code></pre>
<h2 id="test">Test</h2>
<p>Write tests for each of these methods.</p>
<p>Write tests that show you can use your log. Use this method in your tests:</p>
<pre><code class="lang-javascript">elfLog.setMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">level, message</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (level &gt;= <span class="hljs-keyword">this</span>.debugLevel) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>) {
            message = <span class="hljs-built_in">JSON</span>.stringify(message);
        }
        <span class="hljs-keyword">var</span> output = <span class="hljs-keyword">this</span>.getLevel(level) + <span class="hljs-string">': '</span> + message;
        <span class="hljs-keyword">return</span> output;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
};
</code></pre>
<p>Put elf-config in your packagen and write tests that show you can use it.</p>
<h2 id="custom-reporter">Custom reporter</h2>
<p>If you ever get a hankering to create your own custom reporter, here is a start:</p>
<pre><code class="lang-javascript">/**
 * <span class="hljs-type">Created</span> by charlie on <span class="hljs-number">3</span>/<span class="hljs-number">1</span>/<span class="hljs-number">16</span>.
 */

<span class="hljs-keyword">var</span> myReporter = {

    jasmineStarted: function(suiteInfo) {
        'use strict';
        console.log('<span class="hljs-type">Running</span> suite <span class="hljs-keyword">with</span> ' + suiteInfo.totalSpecsDefined);
    },

    // suiteStarted <span class="hljs-keyword">is</span> invoked <span class="hljs-keyword">when</span> a describe starts to run
    suiteStarted: function(<span class="hljs-literal">result</span>) {
        'use strict';
        console.log('<span class="hljs-type">Suite</span> started: ' + <span class="hljs-literal">result</span>.description + ' whose full description <span class="hljs-keyword">is</span>: ' + <span class="hljs-literal">result</span>.fullName);
    },

    // specStarted <span class="hljs-keyword">is</span> invoked <span class="hljs-keyword">when</span> an it starts to run (including associated beforeEach functions)
    specStarted: function(<span class="hljs-literal">result</span>) {
        'use strict';
        console.log('<span class="hljs-type">Spec</span> started: ' + <span class="hljs-literal">result</span>.description + ' whose full description <span class="hljs-keyword">is</span>: ' + <span class="hljs-literal">result</span>.fullName);
    },

    // specDone <span class="hljs-keyword">is</span> invoked <span class="hljs-keyword">when</span> an it <span class="hljs-keyword">and</span> its associated beforeEach <span class="hljs-keyword">and</span> afterEach functions have been run.
    // <span class="hljs-type">While</span> jasmine doesn’t require <span class="hljs-built_in">any</span> specific functions, <span class="hljs-keyword">not</span> defining a specDone will make it
    // impossible <span class="hljs-keyword">for</span> a reporter to know <span class="hljs-keyword">when</span> a spec has failed.
    specDone: function(<span class="hljs-literal">result</span>) {
        'use strict';
        console.log('<span class="hljs-type">Spec</span>: ' + <span class="hljs-literal">result</span>.description + ' was ' + <span class="hljs-literal">result</span>.status);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-literal">result</span>.failedExpectations.length; i++) {
            console.log('<span class="hljs-type">Failure</span>: ' + <span class="hljs-literal">result</span>.failedExpectations[i].message);
            console.log(<span class="hljs-literal">result</span>.failedExpectations[i].stack);
        }
        console.log(<span class="hljs-literal">result</span>.passedExpectations.length);
    },

    // suiteDone <span class="hljs-keyword">is</span> invoked <span class="hljs-keyword">when</span> all <span class="hljs-keyword">of</span> the child specs <span class="hljs-keyword">and</span> suites <span class="hljs-keyword">for</span> a given suite have been run
    // <span class="hljs-type">While</span> jasmine doesn’t require <span class="hljs-built_in">any</span> specific functions, <span class="hljs-keyword">not</span> defining a suiteDone will make it
    // impossible <span class="hljs-keyword">for</span> a reporter to know <span class="hljs-keyword">when</span> a suite has failures <span class="hljs-keyword">in</span> an afterAll.

    suiteDone: function(<span class="hljs-literal">result</span>) {
        'use strict';
        // <span class="hljs-type">The</span> <span class="hljs-literal">result</span> here <span class="hljs-keyword">is</span> the same <span class="hljs-keyword">object</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">in</span> suiteStarted but <span class="hljs-keyword">with</span> the addition <span class="hljs-keyword">of</span> a status <span class="hljs-keyword">and</span> a
        // list <span class="hljs-keyword">of</span> failedExpectations.

        console.log('<span class="hljs-type">Suite</span>: ' + <span class="hljs-literal">result</span>.description + ' was ' + <span class="hljs-literal">result</span>.status);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-literal">result</span>.failedExpectations.length; i++) {

            /*
                <span class="hljs-type">Any</span> failedExpectations on the suite itself are the <span class="hljs-literal">result</span> <span class="hljs-keyword">of</span> a failure <span class="hljs-keyword">in</span> an afterAll.
                <span class="hljs-type">Each</span> failedExpectation has a message that describes the failure <span class="hljs-keyword">and</span> a stack trace.
             */

            console.log('<span class="hljs-type">AfterAll</span> ' + <span class="hljs-literal">result</span>.failedExpectations[i].message);
            console.log(<span class="hljs-literal">result</span>.failedExpectations[i].stack);
        }
    },

    jasmineDone: function() {
        'use strict';
        console.log('<span class="hljs-type">Finished</span> suite');
    }
};

module.exports = myReporter;
</code></pre>
<p>And the code to run it looks like this:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 3/1/16.
 */</span>

var Jasmine = require(<span class="hljs-string">'jasmine'</span>)<span class="hljs-comment">;</span>
var customReporter = require(<span class="hljs-string">'./custom-reporter'</span>)<span class="hljs-comment">;</span>

var jasmineRep = new Jasmine()<span class="hljs-comment">;</span>

<span class="hljs-comment">//or wherever your config file is, you can use .loadConfig to pass in an object instead of a file</span>
jasmineRep.loadConfigFile(<span class="hljs-string">'spec/support/jasmine.json'</span>)<span class="hljs-comment">;</span>
<span class="hljs-comment">// add your custom reporter</span>
jasmineRep.addReporter(customReporter)<span class="hljs-comment">;</span>
<span class="hljs-comment">// adds the console reporter</span>
<span class="hljs-comment">// jasmine.configureDefaultReporter();</span>
jasmineRep.execute()<span class="hljs-comment">;</span>
</code></pre>
<p>This is mostly cut and paste, so go ahead and do it, just so you will know how to create started if you ever want to create a custom reporter. Not really likely, but it could be useful at some point.</p>
<h2 id="elflog">ElfLog</h2>
<p>A recent copy of elfLog for use on the server.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 11/30/15.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">elfLog</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
}

elfLog.logLevelMinorDetails = <span class="hljs-number">0</span>;
elfLog.logLevelDetails = <span class="hljs-number">1</span>;
elfLog.logLevelWarn = <span class="hljs-number">2</span>;
elfLog.logLevelError = <span class="hljs-number">3</span>;
elfLog.logLevelInfo = <span class="hljs-number">4</span>;
elfLog.logLevelSilent = <span class="hljs-number">5</span>;

elfLog.debugLevel = <span class="hljs-literal">undefined</span>;

elfLog.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">this</span>.debugLevel = <span class="hljs-keyword">this</span>.logLevelSilent;
};

elfLog.setLevel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">level</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">this</span>.debugLevel = level;
};

elfLog.getLevel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">level</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">switch</span> (level) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Minor-Details'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Details'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Warning'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Error'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Information'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Silent'</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Unknown level'</span>;
    }
};

elfLog.setMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">level, message</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (level &gt;= <span class="hljs-keyword">this</span>.debugLevel) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> message !== <span class="hljs-string">'string'</span>) {
            message = <span class="hljs-built_in">JSON</span>.stringify(message);
        }
        <span class="hljs-keyword">var</span> output = <span class="hljs-keyword">this</span>.getLevel(level) + <span class="hljs-string">': '</span> + message;
        <span class="hljs-keyword">return</span> output;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
};

elfLog.log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">level, message</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    message = <span class="hljs-keyword">this</span>.setMessage(level, message);
    <span class="hljs-keyword">if</span> (message.trim().length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">console</span>.log(message);
    }
};

elfLog.init();

<span class="hljs-built_in">module</span>.exports = elfLog;
</code></pre>
<h2 id="update-your-package">Update your Package</h2>
<p>You will need to update the package:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">npm</span> version minor
<span class="hljs-built_in">npm</span> publish
</code></pre>
<h2 id="turn-it-in">Turn it in</h2>
<p>Your code will be in <strong>Week02-NpmPackage</strong>. Push your repository then add a tag to your repository, where the minor version number is incremented:</p>
<pre><code> git <span class="hljs-keyword">tag</span> <span class="hljs-title">-a</span> v1.<span class="hljs-number">5.0</span> -m <span class="hljs-string">"After ElfNpmUnitTest class 1.5.0"</span>
 git push origin --tags
</code></pre></div></body></html>