<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>GruntCheck03</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>GruntCheck03</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#updates">Updates</a></li>
<li><a href="#grunt">Grunt</a></li>
<li><a href="#karma-changes">Karma Changes</a></li>
<li><a href="#writing-a-test">Writing a Test</a></li>
<li><a href="#sanity-check">Sanity Check</a></li>
<li><a href="#example-program">Example Program</a></li>
<li><a href="#other-jasmine-jquery">Another Way to Load Jamine-jquery</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>I&#39;m thinking mostly of BitlyRefine in this discussion. So do your work in that directory.</p>
<p>A tool called Jasmine JQuery will allow us to load arbitray HTML files (fixtures) into Jasmine so that we can run tests against them. Normally, we want to load only small chunks of HTML. However, at one point we might want to load the entire contents of the HTML code produced by <strong>vidws/index.jade</strong> into our tests and make sure it contains certain key elements.</p>
<p>We want to tests the contents of <strong>views/index.jade</strong> but not <strong>views/layout.jade</strong>. To do this, we need to remove the line that reads <strong>extend layout</strong> from <strong>views/index.jade</strong> and copy the results to another file called <strong>views/fixture.jade</strong>. When doing so, <strong>views/index.jade</strong> should not be changed. When we are done, <strong>views/fixture.jade</strong> should be very similar to <strong>views/index.jade</strong> but without the first line about extending <strong>layout.jade</strong>.</p>
<p>Here are the steps:</p>
<ul>
<li>Remove the <strong>extends layout</strong> line <strong>views/index.jade</strong></li>
<li>Put the results in <strong>views/fixture.jade</strong> without changine <strong>views/index.jade</strong>.</li>
<li>Convert <strong>views/fixture.jade</strong> into <strong>spec/fixtures/fixture.html</strong></li>
</ul>
<p>You can do all the manually, or run this command:</p>
<pre><code><span class="hljs-attribute">grunt</span> fixture
</code></pre><p>This produces <strong>spec/fixtures/fixture.html</strong>. This is the code we want to use in our tests.</p>
<p>The rest of this document is an explanation of how to proceed if you want to set up and run this kind of test.</p>
<h2 id="updates">Updates</h2>
<p>Copy over the new and updated unit tests from:</p>
<pre><code>cp $ELF_TEMPLATES/UnitTest/BitlyRefine/*.js spec/.
</code></pre><p>Then install some tools:</p>
<pre><code class="lang-bash">npm <span class="hljs-keyword">install</span> jasmine-jquery <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> grunt-exec <span class="hljs-comment">--save</span>
npm <span class="hljs-keyword">install</span> grunt-contrib-jade <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> grunt-contrib-clean <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> grunt-jscs <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> grunt-jsbeautifier <span class="hljs-comment">--save-dev</span>
</code></pre>
<p>No longer needed:</p>
<pre><code class="lang-bash">npm <span class="hljs-keyword">install </span>grunt-contrib-<span class="hljs-keyword">jasmine </span>--save-dev
</code></pre>
<h2 id="grunt">Grunt</h2>
<p>Add these tasks to your Gruntfile:</p>
<pre><code class="lang-javascript">jade: {
    compile: {
        options: {
            pretty: true,
            data: {
                debug: false
            }
        },
        files: {
            <span class="hljs-string">'spec/fixtures/fixture.html'</span>: [<span class="hljs-string">'views/fixture.jade'</span>, <span class="hljs-string">'$ELF_TEMPLATES/JadeMixins/*.jade'</span>]
        }
    }
},

exec: {

    stripExtends: {
        cmd: function() {
            return <span class="hljs-string">'sed "/extend/d" views/index.jade &gt; views/fixture.jade'</span>;
        }
    }
}
</code></pre>
<p>Then near the bottom load the tasks:</p>
<pre><code class="lang-javascript">    grunt.loadNpmTasks(<span class="hljs-string">'grunt-contrib-jade'</span>)<span class="hljs-comment">;</span>
    grunt.loadNpmTasks(<span class="hljs-string">'grunt-exec'</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>And finally, register a new task near the very bottom:</p>
<pre><code class="lang-javascript">    grunt.registerTask(<span class="hljs-string">'fixture'</span>, [<span class="hljs-string">'exec:stripExtends'</span>, <span class="hljs-string">'jade'</span>, <span class="hljs-string">'karma'</span>])<span class="hljs-comment">;</span>
</code></pre>
<h2 id="karma-changes">Karma Changes</h2>
<p>In karma.conf load <strong>jasmine-jquery</strong>. The following is a sample of what your <strong>files</strong> section might look like once it is done. The first and last lines are the ones you need to focus on. The rest are just boilerplate you have already seen:</p>
<pre><code class="lang-javascript">files: [
    <span class="hljs-symbol">'public</span>/components/jquery/dist/jquery.min.js',
    <span class="hljs-symbol">'node_modules</span>/jasmine-jquery/lib/jasmine-jquery.js',
    <span class="hljs-symbol">'public</span>/javascripts/*.js',
    <span class="hljs-symbol">'spec</span>/test*.js',
    <span class="hljs-symbol">'spec</span>/bitly-links.js',
    <span class="hljs-symbol">'spec</span>/**/*.html'
],
</code></pre>
<p>Please note that bitly-links and **/*.html are specific to our app. The other entries are generic, and will be used in most tests. The HTML line will be used in all tests that use jasmine-jquery, so it is frequently used. But bitly links is just for programs like BitlyRefine, and might not be used in other applications.</p>
<p>And put this in <strong>karma.conf.js</strong>:</p>
<pre><code class="lang-javascript">preprocessors: {
    '<span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>/<span class="hljs-keyword">*</span>.html': []
},
</code></pre>
<p>If you are using the <strong>spec</strong> reporter, and most of us are, then filter out tests that are being skipped:</p>
<pre><code class="lang-javascript"><span class="hljs-attribute">reporters</span>: ['spec'],

<span class="coffeescript">specReporter: {
    suppressSkipped: <span class="hljs-literal">true</span> <span class="hljs-regexp">//</span> <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">print</span> information about skipped tests
},</span>
</code></pre>
<h2 id="writing-a-test">Writing a Test</h2>
<p>And here is the test, which goes in <strong>spec/test-jasmine-jquery.js</strong></p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'Test Jade'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        jasmine.getFixtures().fixturesPath = <span class="hljs-string">'base/spec/fixtures/'</span>;
        loadFixtures(<span class="hljs-string">'fixture.html'</span>);
    });

    it(<span class="hljs-string">'shows we can get at least 1 &lt;P&gt; element'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> paragraphs = $(<span class="hljs-string">'p'</span>);
        expect(paragraphs.length).toBeGreaterThan(<span class="hljs-number">0</span>);
    });

});
</code></pre>
<p>We are simply asking jasmine to prove to us that our HTML has at least one paragraph tag in it.</p>
<h2 id="sanity-check">Sanity Check</h2>
<p>In JsObjects, there is a new script that does a rather shoddy job of looking through your <strong>karma-conf.js</strong> and <strong>Gruntfile.js</strong> files to be sure you have things set up correctly. You can copy the script to your <strong>~/bin</strong> directory and then run it in the root of the project you want to check.</p>
<pre><code class="lang-bash">cp $JSOBJECTS/Utilities/NodeInstall/check-karma-grunt-config ~/bin/.
</code></pre>
<p>Here is a sample run:</p>
<pre><code>$ ./check-karma-grunt-config

  - setup

js-beautify exists
beautified karma.conf.js - unchanged
beautified Gruntfile.js - unchanged

  - These tests are meant to help you find problems in
  - karma.conf<span class="hljs-built_in"> and </span>Gruntfile. They are<span class="hljs-built_in"> not </span>definitive

preprocessor mentioned
jasmine-jquery mentioned
exec task config mentioned
jade task config mentioned
grunt-contrib-clean loadNpmTask mentioned
grunt-contrib-jshint loadNpmTask mentioned
grunt-jscs loadNpmTask mentioned
grunt-jsbeautifier loadNpmTask mentioned
grunt-karma loadNpmTask mentioned
grunt-contrib-jade loadNpmTask mentioned
grunt-exec loadNpmTask mentioned
fixture registered task mentioned
beautify registered task mentioned<span class="hljs-built_in">
check </span>registered task mentioned
test registered task mentioned
</code></pre><p>This script doesn&#39;t really prove much of anything, but it may help us find errors. Here, for instance, is a run in a project that is not properly configured for our jasmine-jquery tests:</p>
<pre><code><span class="hljs-keyword">check</span>-karma-grunt-config 

*** setup ***

js-beautify <span class="hljs-keyword">exists</span>
beautified karma.conf.js
beautified Gruntfile.js

*** These tests <span class="hljs-keyword">are</span> meant <span class="hljs-keyword">to</span> <span class="hljs-keyword">help</span> you find problems <span class="hljs-keyword">in</span>
*** karma.conf <span class="hljs-keyword">and</span> Gruntfile. They <span class="hljs-keyword">are</span> <span class="hljs-keyword">not</span> definitive

preprocessor <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
jasmine-jquery <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
exec task config <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
jade task config <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
grunt-contrib-clean loadNpmTask <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
grunt-contrib-jshint loadNpmTask mentioned
grunt-jscs loadNpmTask <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span> 
grunt-jsbeautifier loadNpmTask <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
grunt-karma loadNpmTask mentioned
grunt-contrib-jade loadNpmTask <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
grunt-exec loadNpmTask <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
fixture registered task <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
beautify registered task <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
<span class="hljs-keyword">check</span> registered task <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span>
<span class="hljs-keyword">test</span> registered task mentioned
</code></pre><p>The output should be easier to read in the bash shell since it is colorized with missing code in red and found code in green.</p>
<h2 id="example-program">Example Program</h2>
<p>I have an example program in JsObjects called <a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/UnitTests/JasmineJQueryTest">JasmineJQueryTest</a>. To use it, do the following:</p>
<pre><code class="lang-bash">grunt fixture
grunt <span class="hljs-built_in">test</span>
</code></pre>
<p>It should produce the following output:</p>
<pre><code class="lang-bash">  Elvenware Simple Plain Suite
    ✓ expects <span class="hljs-literal">true</span> <span class="hljs-built_in">to</span> be <span class="hljs-literal">true</span>

  Test Jasmine-JQuery Suite
    ✓ shows we can <span class="hljs-built_in">get</span> <span class="hljs-keyword">at</span> least <span class="hljs-number">1</span> &lt;P&gt; <span class="hljs-keyword">element</span>
</code></pre>
<h2 id="other-jasmine-jquery">Another Way to Load Jamine-jquery</h2>
<p>For some reason, I don&#39;t really like this one:</p>
<p>First install karma-jasmine-jquery:</p>
<pre><code class="lang-bash">npm <span class="hljs-keyword">install</span> karma-jasmine-jquery
</code></pre>
<p>Then add it to the plugins section of <strong>karma-conf.js</strong>:</p>
<pre><code class="lang-javascripts">frameworks: [<span class="hljs-symbol">'jasmine</span>-jquery', <span class="hljs-symbol">'jasmine'</span>],

plugins: [<span class="hljs-symbol">'karma</span>-jasmine',
    <span class="hljs-symbol">'karma</span>-spec-reporter',
    <span class="hljs-symbol">'karma</span>-phantomjs-launcher',
    <span class="hljs-symbol">'karma</span>-chrome-launcher',
    <span class="hljs-symbol">'karma</span>-jasmine-jquery'
]
</code></pre>
<p>Do this in .jscsrc:</p>
<pre><code><span class="hljs-string">"excludeFiles"</span>: [<span class="hljs-string">"**/node_modules/**"</span>, <span class="hljs-string">"**/components/**"</span>, <span class="hljs-string">"spec/bitly-links.js"</span>]
</code></pre></div></body></html>