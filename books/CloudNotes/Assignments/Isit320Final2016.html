<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>Isit320Final2016</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>Isit320Final2016</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#basics">Basics</a></li>
<li><a href="#smoke-test">Smoke Test</a></li>
<li><a href="#login">Logging In</a></li>
<li><a href="#auth-callback">Auth Callback Urls</a></li>
<li><a href="#referer">Getting the Referer</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#merging-and-checkout">Merging and Checkout</a></li>
<li><a href="#hint">Hint</a></li>
<li><a href="#facebook-client-id">Facebook ID</a></li>
<li><a href="#setclientid">SetClientId</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>This document is a description of the final for Isit320, Fall, 2016.</p>
<h2 id="basics">Basics</h2>
<ul>
<li>Bring <strong>DataMaster</strong> to the furthest point you can without including known bugs.</li>
<li>Bring <strong>DataHunter</strong> (the game) to the furthest point you can without including known bugs</li>
<li>Run both programs on EC2 with <strong>systemd</strong> (or Upstart) so that they stay up after you close the SSH connection.<ul>
<li>Run <strong>DataMaster</strong> on port 30026</li>
<li>Run <strong>DataHunter</strong> on port 30025</li>
</ul>
</li>
</ul>
<p>Or vice-versa. The best plan is to submit the URL for both <strong>DataMaster</strong> and <strong>DataHunter</strong>.</p>
<h2 id="smoke-test">Smoke Test</h2>
<p>Here is the final smoketest:</p>
<pre><code class="lang-bash"><span class="hljs-comment">#! /bin/bash</span>

RED='\033[0;31m'
<span class="hljs-class">LIGHT_RED='\033[1;</span>31m'
<span class="hljs-class">LIGHT_GREEN='\033[1;</span>32m'
YE<span class="hljs-class">LLOW='\033[1;</span>33m'
B<span class="hljs-class">LUE='\033[1;</span>36m'
NC='\033[0m' <span class="hljs-comment"># No Color</span>

<span class="hljs-comment"># Use set -e to exit on error</span>
set -e

function check() {
 <span class="hljs-built_in"> if </span>[ -d $1 ]; then
    cd $1
  else
    echo <span class="hljs-string">"Directory $1 does not exist."</span>
    echo <span class="hljs-string">"Please fix the problem and try again."</span>
    exit
  fi

  pwd

 <span class="hljs-built_in"> if </span>[ ! -d node_modules ]; then
     <span class="hljs-comment"># npm install</span>
     ln -s ~/tmp/node_modules node_modules
  fi

  grunt<span class="hljs-built_in"> check
</span>
  cd ..
}

A1=Week02-BasicTypes
A2=Week02-BasicTypesExpress
BASIC_TYPES=<span class="hljs-string">"$A1 $A2"</span>
A_OK=false

function basicTypes() {
    for i in $BASIC_TYPES
    do
        <span class="hljs-built_in"> if </span>[ -d $i ]; then
            echo -e $LIGHT_GREEN<span class="hljs-string">"Directory $BLUE$i$LIGHT_GREEN exists$NC"</span>
            A_OK=true
           <span class="hljs-built_in"> check </span><span class="hljs-string">"$i"</span>
         else
            echo -e $LIGHT_RED<span class="hljs-string">"Directory $BLUE$i$LIGHT_RED does not exist$NC"</span>
         fi
    done
   <span class="hljs-built_in"> if </span>$A_OK ; then
        echo -e $LIGHT_GREEN<span class="hljs-string">"BasicTypes has at least one good directory.$NC"</span>
    else
        echo -e $LIGHT_RED<span class="hljs-string">"Basic Types is not good$NC"</span>
        exit 1
    fi
}

function fancy() {
   <span class="hljs-built_in"> if </span>[ -d $A1 ]; then
        echo <span class="hljs-string">"Directory $A1 exists"</span>
    else
       <span class="hljs-built_in"> if </span>[ -d $A2 ]; then
            echo <span class="hljs-string">"Directory $A2 exists"</span>
        else
            echo <span class="hljs-string">"Neither Directory $A1 or $A2 exists"</span>
        fi
    fi
}

function Weeks01To04() {
   <span class="hljs-built_in"> check </span>Week01-ExpressBasics/
    basicTypes
   <span class="hljs-built_in"> check </span>Week02-GetNumbers/
   <span class="hljs-built_in"> check </span>Week02-JavaScriptObjects/
   <span class="hljs-built_in"> check </span>Week02-ObjectBasicsJasmine/
   <span class="hljs-built_in"> check </span>Week03-CouchDbDemo/
   <span class="hljs-built_in"> check </span>Week03-CouchDbViews/
   <span class="hljs-built_in"> check </span>Week03-ExpressJQuery/
   <span class="hljs-built_in"> check </span>Week03-ExpressRoutes/
   <span class="hljs-built_in"> check </span>Week04-PointerLock/
   <span class="hljs-built_in"> check </span>Week04-ThreeFloor/
   <span class="hljs-built_in"> check </span>Week04-ThreeJsBasics/
}

function Weeks05To07 {
   <span class="hljs-built_in"> check </span>Week05-MazeBuilder/
   <span class="hljs-built_in"> check </span>Week06-MazeDataReader/
   <span class="hljs-built_in"> check </span>Week07-Midterm/
}

function Weeks08To09() {
   <span class="hljs-built_in"> check </span>Week08-Facebook/
    <span class="hljs-comment">#check Week08-Google/</span>
   <span class="hljs-built_in"> check </span>Week08-Passport/
   <span class="hljs-built_in"> check </span>Week09-SessionBasics/
   <span class="hljs-built_in"> check </span>Week09-SessionCouch/
}

function Weeks10ToFinal() {
   <span class="hljs-built_in"> check </span>Week10-JadeMixinBasics
   <span class="hljs-built_in"> check </span>Week10-SessionMaster
   <span class="hljs-built_in"> check </span>DataHunter
   <span class="hljs-built_in"> check </span>DataMaster
}

Weeks01To04
Weeks05To07
Weeks08To09
Weeks10ToFinal
</code></pre>
<p>I&#39;ve commented out Week08-Google as I can&#39;t remember whether or not that was ever included as a necessary part of our Passport assignments.</p>
<h2 id="login">Logging In</h2>
<p>I expect log in to work on EC2 for at least two our of three of these authorities:</p>
<ul>
<li>Google</li>
<li>Facebook</li>
<li>Twitter</li>
</ul>
<p>Provide some means of &quot;proving&quot; to me that you are logged in. For instance, at minimum, your app should provide a menu choice that shows me your session object, and you should ensure that the session object contains details of the currently logged in client. I should be able to log in, log out, and switch authorities (from say Google to Facebook) and see those actions reflected in the object you display:</p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/datamaster-session-login.png" alt="Screenshot of session object with information on logged in user clearly visible"></p>
<p>The part I&#39;m looking for begins with the word passport and contains my name, the auth provider (google), etc:</p>
<h2 id="auth-callback">Auth Callback Urls</h2>
<p>You are able to have more than one callback URL, at least in most cases. For instance, on Google, I have 5 redirect URLs and two authorized JavaScript origins. On the Facebook login settings page, you can also set multiple URIs. Apparently, Twitter does not support this. So, for now, I suggest we do this:</p>
<ul>
<li>Everyone should have sign in working on EC2 for at least two authorities, and I must be able to see that you are logged in or logged out by choosing some menu option that shows me at least some recognizable part of your session object.</li>
<li>For <strong>extra credit</strong>, see if you can find out the URL on the client side by looking at the Express <strong>request.header.referer</strong> property. This should be the URL seen in the address bar of the client who makes a request. Use this information to craft the appropriate callback URL for Google and Facebook. In other words, automagically use one callback URL when on EC2 and another callback URL when on localhost. Because twitter does not support multiple callback URLs, I don&#39;t think that will work for Twitter unless I started playing with my hosts file.</li>
</ul>
<p>So that I can easily grade your homework, please add these URIs:</p>
<ul>
<li><a href="http://localhost:30026/etc">http://localhost:30026/etc</a></li>
<li>For instance: <a href="http://localhost:30026/facebook/login/return">http://localhost:30026/facebook/login/return</a></li>
</ul>
<p>This screenshot might be helpful, but remember that your callback URLs might be slightly different, and you might need more than this to get your code working. The key point is that it provides callback URLs for both localhost on 30025 and on 30026.</p>
<p>![Google Redirects from the Developer Console Page]: <a href="https://s3.amazonaws.com/bucket01.elvenware.com/images/redirect-url-google.png">https://s3.amazonaws.com/bucket01.elvenware.com/images/redirect-url-google.png</a></p>
<p>When taking the above screen shot, I was in the Google Developer console, somewhere near here:</p>
<ul>
<li><a href="https://console.developers.google.com/apis/credentials/">https://console.developers.google.com/apis/credentials/</a></li>
</ul>
<h2 id="referer">Getting the Referer</h2>
<p>To get the server side code to get the host name (referer) for the client, that is the URL seen in the address bar of the browser when making a request, try looking at</p>
<p>  request.headers.referer</p>
<p>Here, for instance, is the <strong>request.headers</strong> object on my current machine:</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">headers</span>:
   { <span class="hljs-attribute">host</span>: <span class="hljs-string">'localhost:30026'</span>,
     <span class="hljs-attribute">connection</span>: <span class="hljs-string">'keep-alive'</span>,
     <span class="hljs-attribute">accept</span>: <span class="hljs-string">'application/json, text/javascript, */*; q=0.01'</span>,
     <span class="hljs-string">'if-none-match'</span>: <span class="hljs-string">'W/"1f4-dNg/QpSgqXCMzwXceYM7Ag"'</span>,
     <span class="hljs-string">'x-requested-with'</span>: <span class="hljs-string">'XMLHttpRequest'</span>,
     <span class="hljs-string">'user-agent'</span>: <span class="hljs-string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/53.0.2785.143 Chrome/53.0.2785.143 Safari/537.36'</span>,
     <span class="hljs-attribute">referer</span>: <span class="hljs-string">'http://localhost:30026/'</span>,
     <span class="hljs-string">'accept-encoding'</span>: <span class="hljs-string">'gzip, deflate, sdch'</span>,
     <span class="hljs-string">'accept-language'</span>: <span class="hljs-string">'en-US,en;q=0.8'</span>,
     <span class="hljs-attribute">cookie</span>: <span class="hljs-string">'connect.sid= SOME ENDLESS STRING'</span> },
</code></pre>
<p>Note the <strong>referer</strong> and <strong>host</strong> properties of this object. You might also want to look at <strong>request.originalUrl</strong>. Try mirroring these values back to you when you ask for hte session object.</p>
<h2 id="turn-it-in">Turn it in</h2>
<ul>
<li>About 70% percent of your grade will involve creating bug free programs at mid-term level or higher.</li>
<li>The remaining 30% of your grade involve implementing the features outlined in the FinalPrep assignments, and in other assignments we have done this quarter.</li>
</ul>
<p>In short, if you can turn in something that works, that includes what we covered through the midterm, then you will probably pass the course. To get a good grade, you need to complete all the features that we have outlined throughout the assignments in this course. I am particularly interested in seeing that you have followed the following programs:</p>
<ul>
<li>DRY: Don&#39;t repeat yourself</li>
<li>SRP: Single Responsibility Principle</li>
<li>Open/Closed Principle: Open to Extension, closed to modification</li>
</ul>
<p>I will grade on a curve that is based on the degree of experience that developers brought into the course. It will be easier for developers with less experience to do well in the course. A straight A, however, is reserved for those with experience who have mastered the topics in the course, and particularly the three principles outlined above.</p>
<p>I&#39;ll be expecting your final code to be in your repository, on the <strong>master</strong> branch, in two folders:</p>
<ul>
<li><strong>DataMaster</strong></li>
<li><strong>DataHunter</strong></li>
</ul>
<p>You can tell me about other versions of your code on other branches that may be more advanced, but buggier. Remember, however, when looking at your final code, I&#39;m looking for bug free programs. In this final, at least, fewer features and fewer bugs is better than more features and more bugs. But the more bug free features you can create the better.</p>
<p><strong>NOTE</strong>: <em>I&#39;m not looking for release quality software. I won&#39;t be trying to break your program. When I say bug free, I mean that I can choose a menu item or hyperlinker, be taken to a feature, and have it work correctly at least the first time I select it.</em></p>
<h2 id="merging-and-checkout">Merging and Checkout</h2>
<p>To get <strong>DataMaster</strong>, or changes to <strong>DataMaster</strong>, into the master branch, you should be able to just checkout the <strong>Week11/DataMaster</strong> code into master. Something like this:</p>
<pre><code class="lang-bash">git checkout <span class="hljs-keyword">master</span>
<span class="hljs-title">git</span> checkout Week11 -- DataMaster
</code></pre>
<p>This should put the DataMaster project from the Week11 branch in master. It does not, however, commit the changes, which means you have a chance to review everything and make sure it worked. After poking around for a bit, if all looks well, you can commit and push.</p>
<p>You can also view the difference between two commits like this:</p>
<p>  git difftool master Week11 -- DataMaster</p>
<p>The checkout will replace any existing files and will add new files, but it will not delete files that are no longer needed. The <strong>difftool</strong> command, however, will catch cases where a file was deleted from branch <strong>Week11</strong> and should therefore be deleted from <strong>master</strong>.</p>
<p>Note that this will compare only files that are committed, not the difference between files that have been modified or added. See also:</p>
<ul>
<li><a href="http://stackoverflow.com/a/1355990/253576">http://stackoverflow.com/a/1355990/253576</a></li>
</ul>
<h2 id="hint">Hint</h2>
<p>Set up CouchDb</p>
<p>Run the <strong>CouchDb</strong> script in <strong>~/Git/JsObjects/Utilities/NodeInstall</strong></p>
<p>Then edit the <strong>/etc/couchdb/local.ini</strong> file:</p>
<p>  sudo nano /etc/couchdb/local.ini</p>
<p>Set the <strong>bindaddress</strong> to <strong>0.0.0.0</strong>. In the <strong>local.ini</strong> file, a semi-colon is a comment, so you will need to delete the comment.</p>
<p>Be sure to see the details here which describe restarting couchdb:</p>
<ul>
<li><a href="http://www.elvenware.com/charlie/development/database/NoSql/CouchDb.html#couchdb-linux-install">CouchDb on Elvenware</a></li>
</ul>
<h2 id="facebook-client-id">Facebook ID</h2>
<p>We have to set up the Facebook ClientId as mentioned here:</p>
<ul>
<li><a href="http://www.ccalvert.net/books/CloudNotes/Assignments/ExpressSessionMaster.html#facebook-client-id">FaceBook ClientId</a></li>
</ul>
<p>In your <strong>data-master.service</strong> file, set environment variables in this line:</p>
<p>Environment=NODE_ENV=production FACEBOOK_CLIENT_ID=<YOUR_CLIENT_ID> FACEBOOK_CLIENT_SECRET=<YOUR_SECRET_KEY></p>
<p>So it looks something like this, but your folder, user name and group are different, and these are fake, and much too short, FACEBOOK IDs:</p>
<pre><code class="lang-bash"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">ExecStart</span>=/usr/bin/node /home/charlie/bin/data-master/bin/www
<span class="hljs-attr">Restart</span>=always
<span class="hljs-attr">StandardOutput</span>=syslog
<span class="hljs-attr">StandardError</span>=syslog
<span class="hljs-attr">SyslogIdentifier</span>=data-master
<span class="hljs-attr">User</span>=charlie
<span class="hljs-attr">Group</span>=charlie
<span class="hljs-attr">Environment</span>=NODE_ENV=production FACEBOOK_CLIENT_ID=<span class="hljs-number">11234</span> FACEBOOK_CLIENT_SECRET=abc123
<span class="hljs-section">
[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<h2 id="setclientid">SetClientId</h2>
<p>In your <strong>package.json</strong> file, this works:</p>
<pre><code class="lang-javascript">"<span class="hljs-keyword">start</span><span class="hljs-string">": "</span>. ../setClientId &amp;&amp; nodemon ./<span class="hljs-keyword">bin</span>/www<span class="hljs-string">",</span>
</code></pre>
<p>This way, when you type npm start, you <strong>source setClientId</strong> and then start your app. In particular, this code means <strong>source</strong> the <strong>setClientId</strong> file in the directory one level closer to the root from your current directory:</p>
<ul>
<li>. ../setClientId</li>
</ul>
<p>This means you want to add a second activity to the <strong>npm start</strong> property:</p>
<ul>
<li>&amp;&amp;</li>
</ul>
<p>And this, of course, is the code to start your application with nodemon:</p>
<ul>
<li>nodemon ./bin/www</li>
</ul>
</div></body></html>