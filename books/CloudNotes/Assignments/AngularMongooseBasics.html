<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularMongooseBasics</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>AngularMongooseBasics</h1><p>Welcome to AngularMongooseBasics</p><ul><!--TOC_Start--><li><a href="#description">Description</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#ignore-scientists">Ignore Scientists</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#the-mongoose-schema">The Mongoose Schema</a></li>
<li><a href="#step-5">Step 5</a></li>
<li><a href="#step-six">Step Six</a></li>
<li><a href="#step-seven">Step Seven</a></li>
<li><a href="#all-mongo">All Mongo</a></li>
<li><a href="#another-query">Another query</a></li>
<li><a href="#valid-scientists">Valid Scientists</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="description"></a>
<h2>Description</h2>
<p>Mongoose Basics is an ORM for MongoDB.</p>
<ul>
<li>Mongoose Slides: <a href="http://bit.ly/elf-mongoose">http://bit.ly/elf-mongoose</a></li>
<li><a href="http://www.ccalvert.net/books/CloudNotes/Prog219/Prog219-Resources.html">Prog219 Resources</a></li>
</ul>
<p><strong>NOTE</strong>: <em>There is both an angular and jquery version of this assignment. Make sure you are looking at the right one. This is the angular assignment, the other is called <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/MongooseBasics.html">MongooseBasics</a>.</em></p>
<a class="anchor" id="step-one"></a>
<h2>Step One</h2>
<pre><code>CreateAllExpress Week10-AngularMongooseBasics
<span class="hljs-built_in">cd</span> Week10-AngularMongooseBasics
npm install
</code></pre><p>Open the project in Web Storm.</p>
<a class="anchor" id="step-two"></a>
<h2>Step Two</h2>
<p>Set up bower</p>
<ul>
<li>bower install bootstrap angular angular-route --save</li>
</ul>
<p>Now might be a good time to start the project: <strong>npm start</strong></p>
<a class="anchor" id="ignore-scientists"></a>
<h2>Ignore Scientists</h2>
<p>Add a file called <strong>nodemon.json</strong> in the root of your project. Place the following content in it:</p>
<pre><code class="lang-javascript">{
  <span class="hljs-attr">"verbose"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"ignore"</span>: [<span class="hljs-string">"scientists.json"</span>, <span class="hljs-string">"**/components/**"</span>]
}
</code></pre>
<p>This project is going to create a file called <strong>scientists.json</strong> each time you insert data into the database. By default, this will cause <strong>nodemon</strong> to restart the project each time we write data to <strong>scientists.json</strong>. This can cause miscellaneous errors on the on the client side, such as a false report for failure for the <strong>insertValidCollection</strong>. The fix is to ask nodemon to ignore <strong>scientists.json</strong>. We should also ask it to ignore our components.folder.</p>
<p>For more on nodemon configuration, see here:</p>
<ul>
<li><a href="https://github.com/remy/nodemon">https://github.com/remy/nodemon</a></li>
<li><a href="https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md">https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md</a></li>
</ul>
<p>You should also create a <strong>.gitignore</strong> file for this project and put the single line <strong>scientists.json</strong> in it.</p>
<a class="anchor" id="step-three"></a>
<h2>Step Three</h2>
<p>Let&#39;s practice setting up the favicon. Because you used <strong>CreateAllExpress</strong>, you should already have a <strong>favicon.png</strong> file in <strong>public.</strong> But in case you have some reason to do it manually, here is how to get a default favicon on Linux (first example) or on Windows:</p>
<pre><code>cp <span class="hljs-formula">$JSOBJECTS/Data/MongoBootstrap/favicon.png public/.
copy %USERPROFILE%<span class="hljs-tag">\<span class="hljs-name">Git</span></span><span class="hljs-tag">\<span class="hljs-name">JsObjects</span></span><span class="hljs-tag">\<span class="hljs-name">Data</span></span><span class="hljs-tag">\<span class="hljs-name">MongoBootstrap</span></span><span class="hljs-tag">\<span class="hljs-name">favicon</span></span>.png public<span class="hljs-tag">\<span class="hljs-name">.</span></span></span>
</code></pre><p>The next step is not done for you automatically by <strong>CreateAllExpress</strong>, so do this by hand:</p>
<ul>
<li>In an editor, open up <strong>app.js</strong> from the root of your project. (Server side)</li>
<li>On line 18 uncomment: <strong>app.use(favicon(__dirname + &#39;/public/favicon.ico&#39;));</strong></li>
<li>Change <strong>favicon.ico</strong> to <strong>favicon.png</strong>.</li>
</ul>
<a class="anchor" id="step-four"></a>
<h2>Step Four</h2>
<p>Set up and learn a little about <a href="http://mongoosejs.com/">Mongoose</a>. Mongoose is by far the most popular way to access MongoDb from Node Js applications.</p>
<p>First install <strong>mongoose</strong>:</p>
<pre><code>npm <span class="hljs-keyword">install</span> mongoose <span class="hljs-comment">--save</span>
</code></pre><p>You may see messages about mongoose, C++ and bson. If you are concerned about them, see the Elvenware notes on <a href="http://elvenware.com/charlie/development/database/NoSql/MongoDb.html#mongoose-gyp-bson">this subject</a>.</p>
<p><strong>NOTE</strong>: <em>On Linux, you may need to install libkrb5-dev before you can install the Mongoose NPM package. This should not be an issue on Cloud 9.</em></p>
<pre><code>sudo apt-<span class="hljs-built_in">get</span> install libkrb5-<span class="hljs-built_in">dev</span>
</code></pre><a class="anchor" id="the-mongoose-schema"></a>
<h3>The Mongoose Schema</h3>
<p>Once Mongoose is installed, you should set up a schema:</p>
<ul>
<li>Create a folder called models at the root of your project</li>
<li>Put this code in a file called <strong>models/presidents.js</strong>:</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">var</span> presidentsSchema = mongoose.Schema({
    <span class="hljs-string">"firstName"</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-string">"lastName"</span>: <span class="hljs-built_in">String</span>,
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'presidents'</span>, presidentsSchema);
</code></pre>
<p>While we are at it, let&#39;s create a more complex schema which we can use once we learn the basics. Put the follow code in a file called <strong>models/scientists.js</strong>.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">var</span> scientistsSchema = mongoose.Schema({
    <span class="hljs-string">"firstName"</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-string">"lastName"</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-string">"subject"</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-string">"subjects"</span>: [<span class="hljs-built_in">String</span>],
    <span class="hljs-string">"comments"</span>: [{ <span class="hljs-attr">commentText</span>: <span class="hljs-built_in">String</span>, <span class="hljs-attr">date</span>: <span class="hljs-built_in">Date</span> }]
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'scientists'</span>, scientistsSchema);
</code></pre>
<p>In <strong>routes/index.js</strong> do these two things:</p>
<pre><code><span class="hljs-attribute">var scientists</span> = require(<span class="hljs-string">'../models/scientists'</span>);
<span class="hljs-attribute">var presidents</span> = require(<span class="hljs-string">'../models/presidents'</span>);
<span class="hljs-attribute">var mongoose</span> = require(<span class="hljs-string">'mongoose'</span>);
</code></pre><p>And then create methods to open your collection:</p>
<p>In <strong>index.js</strong>, make sure that this is the last line in the file:</p>
<pre><code><span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = router;
</code></pre><a class="anchor" id="step-5"></a>
<h2>Step 5</h2>
<p>Get the code in angular</p>
<p>This is <strong>control.js</strong> at this early stage:</p>
<pre><code>(<span class="hljs-name">function</span>() {

    var app = angular.module(<span class="hljs-name">'elfApp'</span>, [])<span class="hljs-comment">;</span>

    app.controller(<span class="hljs-name">'MongoController'</span>, function($http) {
        var mongoController = this;

        $http.get(<span class="hljs-name">'/all-data'</span>).success(<span class="hljs-name">function</span>(<span class="hljs-name">data</span>) {
            mongoController.allData = data;
        }).error(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>) {
            console.log(<span class="hljs-name">err</span>)<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

})()<span class="hljs-comment">;</span>
</code></pre><p>Here is index.jade:</p>
<pre>
extends layout

block content
  h1= title
  p Welcome to #{title}


  div(ng-controller="MongoController")
    button(ng-click="insertValidData()") Insert Valid Data
    button(ng-click="getAll()") Get All
    button(ng-click="emptyCollection()") EmptyCollection

    div
      pre {{allData}}

    p {{display}}
</pre>

<p>and layout.jade</p>
<pre>
doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    link(rel='stylesheet', href='/components/bootstrap/dist/css/bootstrap.css')
    script(src="components/jquery/dist/jquery.js")
    script(src="components/bootstrap/dist/js/bootstrap.js")
    script(src="components/angular/angular.js")
    script(src="javascripts/control.js")
  body(data-ng-app="elfApp")
    block content
</pre>

<a class="anchor" id="step-six"></a>
<h2>Step Six</h2>
<p>Here is <strong>public/javascripts/control.js</strong>:</p>
<pre><code class="lang-javascript">(<span class="hljs-name">function</span>() {

    var app = angular.module(<span class="hljs-name">'elfApp'</span>, [])<span class="hljs-comment">;</span>

    app.controller(<span class="hljs-name">'MongoController'</span>, function($scope, $http) {


        $scope.insertValidData = function() {
            $http.get(<span class="hljs-name">'/insertValidCollection'</span>).then(<span class="hljs-name">function</span>(<span class="hljs-name">data</span>) {
                $scope.display = data;
            }, function(<span class="hljs-name">err</span>) {
                console.log(<span class="hljs-name">err</span>)<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>

        $scope.emptyCollection = function() {
            $http.get(<span class="hljs-name">'/emptyCollection'</span>, {name: 'lincoln'}).then(<span class="hljs-name">function</span>(<span class="hljs-name">data</span>) {
                $scope.display = data;
            }, function(<span class="hljs-name">err</span>) {
                console.log(<span class="hljs-name">err</span>)<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>

        $scope.getAll = function() {
            $http.get(<span class="hljs-name">'/all-data'</span>).then(<span class="hljs-name">function</span>(<span class="hljs-name">data</span>) {
                $scope.allData = JSON.stringify(<span class="hljs-name">data</span>, null, <span class="hljs-number">4</span>)<span class="hljs-comment">;</span>
            }, function(<span class="hljs-name">err</span>) {
                console.log(<span class="hljs-name">err</span>)<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

})()<span class="hljs-comment">;</span>
</code></pre>
<a class="anchor" id="step-seven"></a>
<h2>Step Seven</h2>
<p>In <strong>routes/connect.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 6/11/2015.
 */</span>

<span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">var</span> connect = {

    <span class="hljs-attr">connected</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-attr">simpleConnect</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> url= <span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>;
        connect.connected = <span class="hljs-literal">true</span>;
        mongoose.connect(url);
        <span class="hljs-keyword">var</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-attr">mlabConnect</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        connect.connected = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> userName = <span class="hljs-string">'csc'</span>;
        <span class="hljs-keyword">var</span> password = <span class="hljs-string">'Re*lD*t*22#'</span>;
        <span class="hljs-keyword">var</span> siteAndPort = <span class="hljs-string">'ds049848.mongolab.com:49848'</span>;
        <span class="hljs-keyword">var</span> databaseName = <span class="hljs-string">'elvenlab01'</span>;
        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'mongodb://'</span> + userName + <span class="hljs-string">':'</span> + password + <span class="hljs-string">'@'</span> + siteAndPort + <span class="hljs-string">'/'</span> + databaseName;
        <span class="hljs-built_in">console</span>.log(url);
        mongoose.connect(url);

        <span class="hljs-comment">// This part is optional</span>
        <span class="hljs-keyword">var</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-attr">doConnection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">useSimple</span>) </span>{
        <span class="hljs-keyword">var</span> connectType = useSimple || <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (connectType) {
            connect.simpleConnect();
        } <span class="hljs-keyword">else</span> {
            connect.mlabConnect();
        }
    }

};

<span class="hljs-built_in">module</span>.exports = connect;
</code></pre>
<p>In <strong>routes/index.js</strong> append all of the following before the module statement:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> router = express.Router();
<span class="hljs-keyword">var</span> scientists = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/scientists'</span>);
<span class="hljs-keyword">var</span> allMongo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./all-mongo'</span>);
<span class="hljs-keyword">var</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);

<span class="hljs-comment">/* GET home page. */</span>
router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    res.render(<span class="hljs-string">'index'</span>, {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'Week09-MongooseBasics'</span>
    });
});

<span class="hljs-keyword">var</span> connected = <span class="hljs-literal">false</span>;

router.get(<span class="hljs-string">'/all-data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'AllData route invoked.'</span>);
    <span class="hljs-keyword">if</span> (!connect.connected) {
        connect.doConnection();
    }

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'About to find scientists.'</span>);
    scientists.find({}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, allData</span>) </span>{
        <span class="hljs-built_in">console</span>.log(allData.length);
        <span class="hljs-built_in">console</span>.log(allData[<span class="hljs-number">0</span>]);

        allMongo.writeData(<span class="hljs-string">'scientists.json'</span>, allData);

        response.send({
            <span class="hljs-attr">result</span>: <span class="hljs-string">'Success'</span>,
            <span class="hljs-attr">allData</span>: allData
        });
    });
});

router.get(<span class="hljs-string">'/emptyCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (!connect.connected) {
        connect.doConnection();
    }
    scientists.remove({}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            response.send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'err'</span>,
                <span class="hljs-attr">err</span>: err
            });
        } <span class="hljs-keyword">else</span> {
            response.send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'collection removed'</span>
            });
        }
    });
});

router.get(<span class="hljs-string">'/insertValidCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    allMongo.readDataAndInsert(response);
});

router.get(<span class="hljs-string">'/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    response.render(request.params.id, {});
});

<span class="hljs-built_in">module</span>.exports = router;
</code></pre>
<a class="anchor" id="all-mongo"></a>
<h2>All Mongo</h2>
<p>In <strong>routes/all-mongo.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 6/5/16.
 */</span>

<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);
<span class="hljs-keyword">var</span> Scientists = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/scientists'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> totalScientistsSaved = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allMongo</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
}

allMongo.numberOfScientists = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertScientist</span>(<span class="hljs-params">scientist, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (!connect.connected) {
        connect.doConnection();
    }
    <span class="hljs-keyword">var</span> newScientist = <span class="hljs-keyword">new</span> Scientists({
        <span class="hljs-string">'firstName'</span>: scientist.firstName,
        <span class="hljs-string">'lastName'</span>: scientist.lastName,
        <span class="hljs-string">'subject'</span>: scientist.subject,
        <span class="hljs-string">'subjects'</span>: scientist.subjects,
        <span class="hljs-string">'comments'</span>: scientist.comments
    });

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'inserting'</span>, newScientist.lastName);

    newScientist.save(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        totalScientistsSaved++;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'saved: '</span>, newScientist.lastName, allMongo.numberOfScientists, totalScientistsSaved);

        <span class="hljs-keyword">if</span> (totalScientistsSaved === allMongo.numberOfScientists) {
            response.send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'Success Saving Scientists'</span>,
                <span class="hljs-attr">totalSaved</span>: totalScientistsSaved
            });
        }
    });
}

allMongo.writeData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileName, data</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">var</span> dataAsString = <span class="hljs-built_in">JSON</span>.stringify(data, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>);
    fs.writeFile(fileName, dataAsString, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, result</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> (err);
        }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'success writing file'</span>);
    });
};

allMongo.readDataAndInsert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    fs.readFile(<span class="hljs-string">'ValidScientists.json'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, scientistsText</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> (err);
        }
        scientistsText = <span class="hljs-built_in">JSON</span>.parse(scientistsText);
        totalScientistsSaved = <span class="hljs-number">0</span>;
        allMongo.numberOfScientists = scientistsText.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; scientistsText.length; i++) {
            insertScientist(scientistsText[i], response);
        }
    });
};

<span class="hljs-built_in">module</span>.exports = allMongo;
</code></pre>
<a class="anchor" id="another-query"></a>
<h2>Another query</h2>
<p>Don&#39;t forget to open a terminal and type <strong>mongo</strong> to start the mongo shell. Then do something like this:</p>
<pre>
show dbs
use test
show collections
db.scientists.find()
db.scientists.find({} , {_id: 0, firstName: 1, lastName: 1})
</pre>

<a class="anchor" id="valid-scientists"></a>
<h2>Valid Scientists</h2>
<p>Save in the root of your project as ValidScientists.json</p>
<pre><code class="lang-javascript">[
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f82013611e"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Albert"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Einstein"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Physics"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Albert One"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5575a4be8ee728bc0da40c49"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-08T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Foobar"</span>,
            <span class="hljs-string">"Able"</span>,
            <span class="hljs-string">"Tuna"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f82013611f"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Rene"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Descartes"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Fred"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574be8c7c93a1180729f3b5"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Suzy"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bf42d525507c0ca48e21"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Lunches"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bfaed525507c0ca48e22"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Rene"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136121"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Niels"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Bohr"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Physics"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Niels One"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5575a4af8ee728bc0da40c48"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-08T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Math"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136124"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Thomas"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Edison"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Sam"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574b6dee5c7ed30124b0dca"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Fred"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574b6f3e5c7ed30124b0dcb"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"asf"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136126"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Johanes"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Kepler"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Astronomy"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Hello Johannes"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"55746faa82492e4815d893c4"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Foobar"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"557490926f35aa301a50422a"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"55749e924c3a43000acf589d"</span>,
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Fable"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Qux"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"55749ebd4c3a43000acf589f"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"55749f804c3a43000acf58a0"</span>,
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Fingers"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Sam"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574b5597d70f4e813d01ec4"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Johan"</span>,
            <span class="hljs-string">"Able"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136125"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Isaac"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Newton"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Astronomy"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Fig"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bdf631bd81a416bd855f"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Qux"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574be373956c08c12f1731c"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Bar"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136122"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Marie"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Curie"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"MarieOne"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574e4ff748448b40c26a324"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-08T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Foo"</span>,
            <span class="hljs-string">"Bar"</span>,
            <span class="hljs-string">"Qux"</span>,
            <span class="hljs-string">"Goober"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136123"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Maxi"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Planck"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Foo"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bd333a9db45405200d7b"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Bar"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bd3a3a9db45405200d7c"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Tom"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bd4f3a9db45405200d7d"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Sue"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574bd861cc805b81ab0427c"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"asdf"</span>,
            <span class="hljs-string">"Bar"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f82013611d"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Carl"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Sagan"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574a552583c8a0005366cd9"</span>,
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Carlbar"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-07T00:00:00.000Z"</span>
            },
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"Foo"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577cd7698d1b48420a76be0"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-10T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Astronomy"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5577c95032fa23f820136120"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Nikola"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Tesla"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Radioactivity"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [
            {
                <span class="hljs-attr">"commentText"</span>: <span class="hljs-string">"One"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"5574e4eb748448b40c26a323"</span>,
                <span class="hljs-attr">"date"</span>: <span class="hljs-string">"2015-06-08T00:00:00.000Z"</span>
            }
        ],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Serbia"</span>,
            <span class="hljs-string">"Electricity"</span>,
            <span class="hljs-string">"Physics"</span>,
            <span class="hljs-string">"Blink"</span>
        ]
    },
    {
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"55786da8c446f6fc4a5d423a"</span>,
        <span class="hljs-attr">"firstName"</span>: <span class="hljs-string">"Gregor"</span>,
        <span class="hljs-attr">"lastName"</span>: <span class="hljs-string">"Mendel"</span>,
        <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"Physics"</span>,
        <span class="hljs-attr">"__v"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"comments"</span>: [],
        <span class="hljs-attr">"subjects"</span>: [
            <span class="hljs-string">"Genetics"</span>,
            <span class="hljs-string">"Plants"</span>
        ]
    }
]
</code></pre>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Push you code to your repository, and when you turn it in tell me the branch and folder where it resides.</p>
</div></body></html>