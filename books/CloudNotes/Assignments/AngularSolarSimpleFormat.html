<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularSolarSimpleFormat</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>AngularSolarSimpleFormat</h1><p>Welcome to AngularSolarSimpleFormat</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#branches">Branches</a></li>
<li><a href="#testing-simple-format">Testing Simple Format</a></li>
<li><a href="#test-simple-format">Test Simple Format</a></li>
<li><a href="#simple-format-directive">Simple Format Directive</a></li>
<li><a href="#test-simple-format-backend">Test Simple Format Backend</a></li>
<li><a href="#simple-format-page">Simple Format Page</a></li>
<li><a href="#test-rewewable-by-year">Test Rewewable by Year</a></li>
<li><a href="#get-by-year-page">Get By Year Page</a></li>
<li><a href="#iterate-by-year">Iterate by Year</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#suite-titles">Suite Titles</a></li>
<li><a href="#hints">Hints</a></li>
<li><a href="#charlie-s-test-output">Charlie&#39;s Test Output</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>The goals:</p>
<ul>
<li>Write tests for a new directive called <strong>elfSimpleFormat</strong></li>
<li>Create the <strong>elfSimpleFormat</strong> directive.</li>
<li>Write tests for a front end for our new directive</li>
<li>Create a front end for the new directive on a new page</li>
</ul>
<a class="anchor" id="branches"></a>
<h2>Branches</h2>
<p>Before we get started, let&#39;s set up our branch for this week. We have at least three tasks:</p>
<ol>
<li>Create a new branch.</li>
<li>Check it out.</li>
<li>Rename <strong>Week05-SolarExplorer</strong> to <strong>Week07-SolarExplorer</strong>.</li>
</ol>
<p>Something like this:</p>
<pre>
git branch week07
git checkout week07
git mv Week05-SolarExplorer Week07-SolarExplorer
</pre>

<p>If you have not done so already, you should also merge your work from the week06 branch into master:</p>
<pre>
git checkout master
git merge week06
</pre>

<p>Now switch back to week07: <strong>git checkout week07</strong></p>
<a class="anchor" id="testing-simple-format"></a>
<h2>Testing Simple Format</h2>
<p>You know from the tests in our <a href="https://www.ccalvert.net/books/CloudNotes/Assignments/AngularSolarStarterTests.html#create-test-renewables">previous assignment</a> what an object based on our simple format looks like:</p>
<pre><code class="lang-javascript">it('proves we can transform our json into an array with three properties: geo, solar, and wind', function() {
  var simpleFormat = scope.renewableUtils.getSimpleFormat()<span class="hljs-comment">;</span>
  var keys = Object.keys(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
  keys.sort()<span class="hljs-comment">;</span>
  expect(<span class="hljs-name">keys</span>).toEqual(['geo', 'solar', 'wind'])<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>In particular, it looks something like this:</p>
<pre><code class="lang-javascript">var simpleFormat = {
<span class="hljs-symbol">  geo:</span> <span class="hljs-number">1</span>,
<span class="hljs-symbol">  solar:</span> <span class="hljs-number">2</span>,
<span class="hljs-symbol">  wind:</span> <span class="hljs-number">3</span>
}
</code></pre>
<p>The instance above has its property set to random data. When working with real data, the values are very unlikely ever to be 1, 2 and 3. But those values will work fine in our tests.</p>
<p>What we want to do is write tests proving that we can create some HTML that will hold objects of this type. The first step, then will be to creat a <strong>simple-format.jade</strong> file. As you know, we can use the jade program to convert it to HTML so it can be used as a fixture in our tests:</p>
<pre>
jade views/simple-format.jade --out='spec/fixtures/'
</pre>

<p>In <strong>.jscsrc</strong> exclude the <strong>data</strong> folder. In <strong>Gruntfile.js</strong> don&#39;t try to beautify the <strong>data</strong> folder.</p>
<p>Don&#39;t forget to run <strong>grunt check</strong> and clean up all errors such as missing use strict, invalid quote marks, etc.</p>
<p><strong>NOTE</strong>: <em>With JSCS, you can use single quotes for a string, and double quotes for embedded quotes inside a string: &#39;My &quot;embedded&quot; string&#39;.</em></p>
<p>With angular, you can usually delete an <strong>$(document).ready()</strong> statements as it takes care of this for you.</p>
<a class="anchor" id="test-simple-format"></a>
<h2>Test Simple Format</h2>
<p>We need to create <strong>spec/test-simple-format-fixture.js</strong>.</p>
<p><strong>NOTE</strong>: <em>In an early draft of this assignment I&#39;d called this file <strong>test-simple-format.js</strong>. If necessary, ask git to rename your test suite to <strong>test-simple-format-fixture.js</strong>. Otherwise create it from scratch. Note that the file, which is shown below, has been updated since that earlier draft.</em></p>
<p>Do this only if necessary, only if it makes sense in the context of the current state of your project:</p>
<pre>
cd spec
git mv test-simple-format.js test-simple-format-fixture.js
cd ..
</pre>

<p><strong>NOTE</strong>: <em>In the code above I include a command to navigate into the <strong>spec</strong> directory. I do this because I&#39;ve found that some students can&#39;t see the need to do that before asking git to rename our file. However, when I give instructions on this level of details, some students who know better start becoming automatons, and forget to navigate back to the project&#39;s root directory before issuing other commands. So I provide both navigation commands. We are nearing the point in this class, however, when it should no longer be necessary to provide this level of detail when giving instructions of this type. In fact, I should be able to simply ask you to rename the file without telling you how to do it. If you feel that you can&#39;t follow instructions of that type, you should do whatever is necessary to get to that level of proficiency. For instance, work through the <strong>Learn the Command Line</strong> lesson on Code Academy. You could also read the free online book called <a href="http://linuxcommand.org/tlcl.php">The Linux Command Line</a>.</em></p>
<p>Here are the tests themselves. Note that the last two have changed since their first appearance:</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'Simple Format Fixture Suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-string">'use strict'</span>;

    <span class="hljs-keyword">var</span> scope;
    <span class="hljs-keyword">var</span> element;
    <span class="hljs-keyword">var</span> mainController;
    <span class="hljs-keyword">var</span> $templateCache;
    <span class="hljs-keyword">var</span> $compile;

    beforeEach(module(<span class="hljs-string">'elfApp'</span>));

    <span class="hljs-comment">/*
     * instantiate the controller without the directive
     * Get the Angular compiler and templateCache for processing Angular templates
     */</span>
    beforeEach(inject(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_$compile_, _$rootScope_, _$templateCache_, _$controller_)</span> </span>{
        scope = _$rootScope_.$new();
        $compile = _$compile_;
        $templateCache = _$templateCache_;

        mainController = _$controller_(<span class="hljs-string">'MainController'</span>, {
            $scope: scope
        });
    }));

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        jasmine.getFixtures().fixturesPath = <span class="hljs-string">'base/spec/fixtures/'</span>;
        loadFixtures(<span class="hljs-string">'simple-format.html'</span>);
    });

    it(<span class="hljs-string">'expects true to be true'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        expect(<span class="hljs-keyword">true</span>).toBe(<span class="hljs-keyword">true</span>);
    });

    it(<span class="hljs-string">'should find the index'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        expect(scope.index).toBe(<span class="hljs-number">0</span>);
    });

    it(<span class="hljs-string">'should be possible to access the fixture'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> simpleFormatHtml = document.getElementById(<span class="hljs-string">'simpleFormat'</span>);
        console.log(simpleFormatHtml);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Solar:'</span>);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Geo:'</span>);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Wind:'</span>);
    });

    it(<span class="hljs-string">'should be possible to access the fixture and put real data in it.'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        scope.simpleFormat = [{
            geo: <span class="hljs-number">1</span>,
            solar: <span class="hljs-number">2</span>,
            wind: <span class="hljs-number">3</span>
        }];

        <span class="hljs-keyword">var</span> simpleFormatHtml = document.getElementById(<span class="hljs-string">'simpleFormat'</span>);
        $templateCache.put(<span class="hljs-string">'simple-format'</span>, simpleFormatHtml);
        <span class="hljs-keyword">var</span> element = $compile(<span class="hljs-string">'&lt;elf-simple-format&gt;&lt;/elf-simple-format&gt;'</span>)(scope);
        scope.$digest();

        console.log(simpleFormatHtml);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Solar: 2'</span>);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Geo: 1'</span>);
        expect(simpleFormatHtml.innerHTML).toContain(<span class="hljs-string">'Wind: 3'</span>);
    });

});
</code></pre>
<a class="anchor" id="simple-format-directive"></a>
<h2>Simple Format Directive</h2>
<p>Now lets create a new directive called <strong>elfSimpleFormat</strong>. Declare it just below the point in <strong>main.js</strong> where you declare the <strong>elfRenewable</strong> directive.</p>
<p>The HTML version of our new directive looks like this:</p>
<pre><code class="lang-javascript">elfApp.directive(<span class="hljs-string">'elfSimpleFormat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">controller</span>: <span class="hljs-string">'MainController'</span>,
      <span class="hljs-attr">template</span>: <span class="hljs-string">'Solar: {{simpleFormat[index].solar}}'</span> +
          <span class="hljs-string">'&lt;br&gt;Geo: {{simpleFormat[index].geo}}'</span> +
          <span class="hljs-string">'&lt;br&gt;Wind: {{simpleFormat[index].wind}}'</span>
  };
});
</code></pre>
<p>As you can see, this declaration uses <strong>template</strong> rather than <strong>templateUrl</strong>. You should:</p>
<ul>
<li>Convert this HTML to jade</li>
<li>Save it to a file called <strong>simple-format.jade</strong></li>
<li>Convert the directive to use <strong>templateUrl</strong> rather than <strong>template</strong>.</li>
</ul>
<p>It should, of course, look like this:</p>
<pre><code class="lang-javascript">elfApp.directive(<span class="hljs-string">'elfSimpleFormat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">controller</span>: <span class="hljs-string">'MainController'</span>,
        <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'simple-format'</span>
    };
});
</code></pre>
<p>If you have not done so already, you also need to update the <strong>MainController&#39;s</strong> method called <strong>getRenewable</strong> so that it has access to our simpleFormat object:</p>
<pre><code class="lang-javascript">$scope.getRenew<span class="hljs-type">able</span> = <span class="hljs-function"><span class="hljs-keyword">function</span></span>() {        
    $http.<span class="hljs-keyword">get</span>(<span class="hljs-string">'data/Renewable.json'</span>)
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span></span>(res) {
            renew<span class="hljs-type">ableUtils</span>.init(res.data);
            $scope.renew<span class="hljs-type">able</span> = res.data;
            $scope.renew<span class="hljs-type">ableUtils</span> = renew<span class="hljs-type">ableUtils</span>;
            $scope.simpleFormat = renew<span class="hljs-type">ableUtils</span>.getSimpleFormat();
        });
};
</code></pre>
<a class="anchor" id="test-simple-format-backend"></a>
<h2>Test Simple Format Backend</h2>
<p>We need to create a first take on our <strong>spec/test-simple-format-backend.js</strong>, which is our holy grail. This is what we have been building towards. Furthermore, we can flesh out these suite with additional tests to see if we can perform operations on our data. The first step, however, is simply to ensure that we can load our data and fill in the appropriate fields with &quot;mock&quot; data from our <strong>json-as-renewables.js</strong> file.</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'Simple Format HttpBackend Suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-string">'use strict'</span>;

    <span class="hljs-keyword">var</span> scope;
    <span class="hljs-keyword">var</span> $httpBackend;
    <span class="hljs-keyword">var</span> mainController;
    <span class="hljs-keyword">var</span> $templateCache;
    <span class="hljs-keyword">var</span> $compile;

    beforeEach(module(<span class="hljs-string">'elfApp'</span>));

    <span class="hljs-comment">/*
     * instantiate the controller without the directive
     * Get the Angular compiler and templateCache for processing Angular templates
     */</span>
    beforeEach(inject(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_$compile_, _$rootScope_, _$httpBackend_, _$templateCache_, _$controller_)</span> </span>{
        scope = _$rootScope_.$new();
        $compile = _$compile_;
        $templateCache = _$templateCache_;
        $httpBackend = _$httpBackend_;
        mainController = _$controller_(<span class="hljs-string">'MainController'</span>, {
            $scope: scope
        });
    }));

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        scope.index = <span class="hljs-number">5</span>;
        <span class="hljs-keyword">var</span> requestHandler = $httpBackend
            .when(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'data/Renewable.json'</span>)
            .respond(renewables);

        $httpBackend.expectGET(<span class="hljs-string">'data/Renewable.json'</span>);
        scope.getRenewable();
        $httpBackend.flush();
    });

    afterEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        $httpBackend.verifyNoOutstandingExpectation();
        $httpBackend.verifyNoOutstandingRequest();
    });

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        jasmine.getFixtures().fixturesPath = <span class="hljs-string">'base/spec/fixtures/'</span>;
        loadFixtures(<span class="hljs-string">'simple-format.html'</span>);
    });

    it(<span class="hljs-string">'expects true to be true'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        expect(<span class="hljs-keyword">true</span>).toBe(<span class="hljs-keyword">true</span>);
    });

    it(<span class="hljs-string">'tests simple-format directive loaded through fixture with httpBackend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">var</span> el = document.getElementById(<span class="hljs-string">'simpleFormat'</span>);

        $templateCache.put(<span class="hljs-string">'simple-format'</span>, el);
        <span class="hljs-keyword">var</span> element = $compile(<span class="hljs-string">'&lt;elf-simple-format&gt;&lt;/elf-simple-format&gt;'</span>)(scope);
        scope.$digest();

        console.log(JSON.stringify(scope.simpleFormat, <span class="hljs-keyword">null</span>, <span class="hljs-number">4</span>));
        <span class="hljs-comment">// Check that the compiled element contains the templated content</span>
        expect(element.text()).toContain(<span class="hljs-string">'804'</span>);
        expect(element.text()).toContain(<span class="hljs-string">'2.2'</span>);
    });

    it(<span class="hljs-string">'tests that we can index through simple-format directive to the fifth element'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">var</span> el = document.getElementById(<span class="hljs-string">'simpleFormat'</span>);
        <span class="hljs-comment">//console.log(el);</span>
        $templateCache.put(<span class="hljs-string">'simple-format'</span>, el);
        <span class="hljs-keyword">var</span> element = $compile(<span class="hljs-string">'&lt;elf-simple-format&gt;&lt;/elf-simple-format&gt;'</span>)(scope);
        scope.$digest();
        scope.index = <span class="hljs-number">5</span>;
        scope.$digest();
        expect(element.text()).toContain(<span class="hljs-string">'227'</span>);
        expect(element.text()).toContain(<span class="hljs-string">'1.339'</span>);
        <span class="hljs-comment">//console.log(element);</span>
    });

});
</code></pre>
<p>When looking at this code, a key section is the <strong>beforeEach</strong> call to <strong>getRenewables</strong>:</p>
<pre><code class="lang-javascript">beforeEach(<span class="hljs-name">function</span>() {
    scope.index = <span class="hljs-number">5</span><span class="hljs-comment">;</span>
    var requestHandler = $httpBackend
        .when('GET', 'data/Renewable.json')
        .respond(<span class="hljs-name">renewables</span>)<span class="hljs-comment">;</span>

    $httpBackend.expectGET('data/Renewable.json')<span class="hljs-comment">;</span>
    scope.getRenewable()<span class="hljs-comment">;</span>
    $httpBackend.flush()<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>This code calls the <strong>getRenewable</strong> method on our <strong>MainController&#39;s</strong> scope.</p>
<a class="anchor" id="simple-format-page"></a>
<h2>Simple Format Page</h2>
<p>We are going to add a new page to the application and use it to display the <strong>SimpleFormat</strong> directory. When we are done, our Single Page App (SPA) will have three &quot;pages&quot;:</p>
<ul>
<li>Home</li>
<li>Simple Format</li>
<li>About</li>
</ul>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/angular-solar-simple-01.png" alt="Home Page"></p>
<p><strong>Caption</strong>: <em>The Home page displays the elf renewable directive.</em></p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/angular-solar-simple-02.png" alt="Simple Format Page"></p>
<p><strong>Caption</strong>: <em>The Simple Format page displays the simple format directive.</em></p>
<p>In <strong>index.jade</strong>, between home and about, add the following menu item:</p>
<pre><code class="lang-javascript">li(<span class="hljs-attribute">ng-class</span>=<span class="hljs-string">"{ active: isActive('/simple-format')}"</span>)
  a(<span class="hljs-attribute">ng-href</span>=<span class="hljs-string">'#/simple-format'</span>)<span class="hljs-built_in"> Simple </span>Format
</code></pre>
<p>In <strong>public/javascript/app.js</strong>, between Home and About, add the following angular route:</p>
<pre><code class="lang-javascript"><span class="hljs-selector-class">.when</span>(<span class="hljs-string">'/simple-format'</span>, {
    <span class="hljs-attribute">templateUrl</span>: <span class="hljs-string">'simple-format-page'</span>,
    <span class="hljs-attribute">controller</span>: <span class="hljs-string">'SimpleFormatController'</span>
})
</code></pre>
<p>Make a copy of <strong>main.js</strong> and call it <strong>simple-format-page.js</strong>. We want to display the <strong>elfRenewable</strong> directive on the main page and the <strong>elfSimpleFormat</strong> directive on the <strong>simple-format-page</strong>. As a result, you should:</p>
<ul>
<li>remove the <strong>elfSimpleFormat</strong> directive from <strong>main.js</strong></li>
<li>remove the <strong>elfRenewable</strong> directive from <strong>simple-format-page.js</strong>.</li>
</ul>
<p>Copy <strong>main.jade</strong> to <strong>simple-format-page.jade</strong> and perform similar operations. For instance:</p>
<ul>
<li>remove the <strong>elfSimpleFormat</strong> tag from <strong>main.jade</strong></li>
<li>remove the <strong>elfRenewable</strong> tag from <strong>simple-format-page.jade</strong></li>
</ul>
<p>Change the name of the <strong>controller</strong> in <strong>simple-format-page.js</strong> from <strong>MainController</strong> to <strong>SimpleFormatController</strong>:</p>
<pre><code class="lang-javascript">elfApp.controller(<span class="hljs-string">'SimpleFormatController'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $http, renewableUtils)</span> </span>{
  etc...
});
</code></pre>
<p>Be sure to load <strong>simple-format-page.js</strong> in <strong>layout.jade</strong>.</p>
<a class="anchor" id="test-rewewable-by-year"></a>
<h2>Test Rewewable by Year</h2>
<p>Copy <strong>main.js</strong> to <strong>renewable-by-year.js</strong>. Set the controller name <strong>RenewableByYearController</strong>:</p>
<pre><code class="lang-javascript">elfApp.controller(<span class="hljs-string">'RenewableByYearController'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $http, renewableUtils)</span> </span>{
   <span class="hljs-comment">// We'll change this code later.</span>
});
</code></pre>
<p>Write a method on <strong>renewableUtils</strong> called <strong>getByYear(year)</strong>. Pass it a year, and it should return an object with</p>
<ul>
<li>An <strong>index</strong> property set to the index of the object with that year</li>
<li>The object at that index</li>
</ul>
<p>You should also write a method on the scope of your <strong>RenewableByYearController</strong> called <strong>getByYear</strong>. It should</p>
<ul>
<li>Call your new method: <strong>var yearData = renewableUtils.getByYear(year)</strong></li>
<li>Set the <strong>$scope.index</strong> to yearData.index.</li>
<li>Create a new property <strong>$scope.renewableBy</strong> and set it to yearData.renewable</li>
<li>Return <strong>renewableByYear</strong></li>
</ul>
<p>Like this:</p>
<pre><code class="lang-javascript">$scope.getByYear = <span class="hljs-function"><span class="hljs-keyword">function</span></span>(year) {
    <span class="hljs-keyword">var</span> renew<span class="hljs-type">ableData</span> = $scope.renew<span class="hljs-type">ableUtils</span>.getByYear(year);
    $scope.index = renew<span class="hljs-type">ableData</span>.index;
    $scope.renew<span class="hljs-type">ableByYear</span> = renew<span class="hljs-type">ableData</span>.renew<span class="hljs-type">able</span>;
    <span class="hljs-keyword">return</span> $scope.renew<span class="hljs-type">ableByYear</span>;
};
</code></pre>
<p>When implementing <strong>renewableUtils.getByYear(year)</strong> be sure you can handle the year in either string or numeric format. For instance, consider either:</p>
<ul>
<li>Doing a test to see the <strong>year</strong> parameter is a number and if so converting it to string.</li>
<li>Using <strong>==</strong> rather than <strong>===</strong> so that you can compare a string like <strong>&#39;2017&#39;</strong> to the number <strong>2017</strong> and get back true.</li>
</ul>
<p>Don&#39;t forget to run:</p>
<p>Create <strong>renewable-by-year.jade</strong> and base it on <strong>renewable.jade</strong> but set the ID to <strong>renewableByYear</strong>. And don&#39;t index into renewable. For instance, where you see this:</p>
<pre>
| First: {{renewable[index].Year}}
</pre>

<p>Do this instead:</p>
<pre>
| First: {{renewableByYear.Year}}
</pre>

<p>Convert it to a fixture:</p>
<pre>
jade views/renewable-by-year.jade --out spec/fixtures
</pre>

<p>Also rename the <strong>RenewableByYearController</strong> (in <strong>renewable-by-year.js</strong>) method called <strong>getRenewable</strong> to <strong>getRenewableByYear</strong>. Like this:</p>
<pre><code class="lang-javascript">$scope.getRenewableByYear = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ }
</code></pre>
<p>Your code should pass these tests which should be found in <strong>test-renewable-by-year.js</strong>:</p>
<pre><code class="lang-javascript">describe(<span class="hljs-string">'Renewable By Year Suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    <span class="hljs-string">'use strict'</span>;

    <span class="hljs-keyword">var</span> scope;
    <span class="hljs-keyword">var</span> $httpBackend;
    <span class="hljs-keyword">var</span> $templateCache;
    <span class="hljs-keyword">var</span> $compile;

    beforeEach(module(<span class="hljs-string">'elfApp'</span>));

    beforeEach(inject(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(_$compile_, _$rootScope_, _$templateCache_, _$httpBackend_, _$controller_)</span> </span>{
        scope = _$rootScope_.$new();
        $compile = _$compile_;
        $templateCache = _$templateCache_;
        $httpBackend = _$httpBackend_;
        _$controller_(<span class="hljs-string">'RenewableByYearController'</span>, {
            $scope: scope
        });
    }));

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        jasmine.getFixtures().fixturesPath = <span class="hljs-string">'base/spec/fixtures/'</span>;
        loadFixtures(<span class="hljs-string">'renewable-by-year.html'</span>);
    });

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> requestHandler = $httpBackend
            .when(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'data/Renewable.json'</span>)
            .respond(renewables);

        $httpBackend.expectGET(<span class="hljs-string">'data/Renewable.json'</span>);
        scope.getRenewableByYear();
        $httpBackend.flush();
    });

    it(<span class="hljs-string">'expects true to be true'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        expect(<span class="hljs-keyword">true</span>).toBe(<span class="hljs-keyword">true</span>);
    });

    it(<span class="hljs-string">'proves renewables.getByYear returns index &amp; expected object with string year'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> renewableByYear = {
            <span class="hljs-string">"Year"</span>: <span class="hljs-string">"2015"</span>,
            <span class="hljs-string">"Solar (quadrillion Btu)"</span>: <span class="hljs-string">"0.532293912"</span>,
            <span class="hljs-string">"Geothermal (quadrillion Btu)"</span>: <span class="hljs-string">"0.22367033"</span>,
            <span class="hljs-string">"Other biomass (quadrillion Btu)"</span>: <span class="hljs-string">"0.513842275"</span>,
            <span class="hljs-string">"Wind power (quadrillion Btu)"</span>: <span class="hljs-string">"1.8151574968"</span>,
            <span class="hljs-string">"Liquid biofuels (quadrillion Btu)"</span>: <span class="hljs-string">"1.2204771324"</span>,
            <span class="hljs-string">"Wood biomass (quadrillion Btu)"</span>: <span class="hljs-string">"2.059217456"</span>,
            <span class="hljs-string">"Hydropower (quadrillion Btu)"</span>: <span class="hljs-string">"2.388612049"</span>
        };

        <span class="hljs-keyword">var</span> result = scope.renewableUtils.getByYear(<span class="hljs-string">'2015'</span>);
        expect(result).toEqual({ index:<span class="hljs-number">2</span>, renewable: renewableByYear });
    });

    it(<span class="hljs-string">'proves renewables.getByYear returns index &amp; expected object with numeric year'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> renewableByYear = {
            <span class="hljs-string">"Year"</span>: <span class="hljs-string">"2012"</span>,
            <span class="hljs-string">"Solar (quadrillion Btu)"</span>: <span class="hljs-string">"0.227349746"</span>,
            <span class="hljs-string">"Geothermal (quadrillion Btu)"</span>: <span class="hljs-string">"0.211592042"</span>,
            <span class="hljs-string">"Other biomass (quadrillion Btu)"</span>: <span class="hljs-string">"0.466604262"</span>,
            <span class="hljs-string">"Wind power (quadrillion Btu)"</span>: <span class="hljs-string">"1.3393646844"</span>,
            <span class="hljs-string">"Liquid biofuels (quadrillion Btu)"</span>: <span class="hljs-string">"1.0906491156"</span>,
            <span class="hljs-string">"Wood biomass (quadrillion Btu)"</span>: <span class="hljs-string">"2.010265721"</span>,
            <span class="hljs-string">"Hydropower (quadrillion Btu)"</span>: <span class="hljs-string">"2.628701965"</span>
        };

        <span class="hljs-keyword">var</span> result = scope.renewableUtils.getByYear(<span class="hljs-number">2012</span>);
        expect(result).toEqual({ index:<span class="hljs-number">5</span>, renewable: renewableByYear });

    });

    it(<span class="hljs-string">'tests that we can get a renewable object by Year from our controller'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> renewableByYear = scope.getByYear(<span class="hljs-string">'2015'</span>);
        <span class="hljs-comment">//console.log(renewableByYear);</span>
        expect(JSON.stringify(renewableByYear)).toContain(<span class="hljs-string">'0.532293912'</span>);
    });

    it(<span class="hljs-string">'tests that we can get a renewable object by Year in our elfRenewableByYear directive'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> simpleFormatHtml = document.getElementById(<span class="hljs-string">'renewableByYear'</span>);
        $templateCache.put(<span class="hljs-string">'renewable-by-year'</span>, simpleFormatHtml);
        <span class="hljs-keyword">var</span> element = $compile(<span class="hljs-string">'&lt;elf-renewable-by-year&gt;&lt;/elf-renewable-by-year&gt;'</span>)(scope);
        scope.$digest();
        <span class="hljs-keyword">var</span> renewableByYear = scope.getByYear(<span class="hljs-string">'2015'</span>);
        <span class="hljs-comment">//console.log(renewableByYear);</span>
        scope.$digest();
        <span class="hljs-comment">//console.log(element.text());</span>
        expect(element.text()).toContain(<span class="hljs-string">'1.8151574968'</span>);
    });

});
</code></pre>
<a class="anchor" id="get-by-year-page"></a>
<h2>Get By Year Page</h2>
<p>Create a page called <strong>Renewable By Year</strong>. Allow the user to enter a year using an input control. Retrieve the user input, call your <strong>getByYear</strong> function, and display the year.</p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/angular-solar-simple-03.png" alt="By Year"></p>
<p><strong>Figure 03</strong>: <em>Enter a year, retrieve the data and call renewableUtils.byYear. Display the result in a directive.</em></p>
<p>Hear are some of the key steps shown in Figure 03:</p>
<ul>
<li>Menu Item Title seen at top of page: <strong>Renewable By Year</strong>,<ul>
<li>url associated with menu item: <strong>renewable-by-year</strong></li>
<li>Make corresponding changes in <strong>app.js</strong> and <strong>index.jade</strong>.</li>
</ul>
</li>
<li>Be sure that controller name is <strong>RenewableByYearController</strong> in <strong>renewable-by-year.js</strong><ul>
<li>The jade page associated with this controller should be called <strong>renewable-by-year-page.jade</strong></li>
</ul>
</li>
<li>In <strong>renewableByYear.js</strong> create a directive called <strong>renewable-by-year</strong>.<ul>
<li>Use it to display the results of your call to <strong>getByYear</strong></li>
<li>Jade Name for the directive <strong>templateUrl</strong>: <strong>renewable-by-year.jade</strong>.</li>
</ul>
</li>
</ul>
<p>This is a matter of taste. Nevertheless, when doing this kind of work, I find it helpful to keep my tests running and keep my app running in Chrome with the developers tools turned to the <strong>console</strong> page. I use the errors as I see as guides to help me see what needs to be done next, and what I have not yet done correctly.</p>
<p><strong>NOTE</strong>: <em>Watch the console and network pages in the Chrome developer tools carefully as you do this kind of work. Check, for instance, if you have remembered to load your new JavaScript page in <strong>layout.jade</strong>.</em></p>
<a class="anchor" id="iterate-by-year"></a>
<h2>Iterate by Year</h2>
<p>There are several ways to allow the user to iterate over the years in the renewables array of data. Here is one.</p>
<p>The input in <strong>renewable-by-year-page.jade</strong> could look like this:</p>
<pre>
input(type="number", data-ng-model="userYearInput" data-ng-change="yearChange()" min='2007' max='2017' placeholder='2013')

button.btn.btn-primary(ng-click="getRenewableByYear()") Get Renewable by Year

hr

elf-renewable-by-year

</pre>

<p>And handle it like this:</p>
<pre><code class="lang-javascript">$scope.userYearInput = <span class="hljs-number">2017</span>;

<span class="hljs-comment">// CODE NOT RELATED TO THIS ISSUE OMITTED HERE</span>

$scope.yearChange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $scope.getByYear($scope.userYearInput);
};
</code></pre>
<p>Rename <strong>getRenewable</strong> to <strong>getRenewableByYear</strong> and call $scope.getByYear in its last line.</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>The usual.</p>
<a class="anchor" id="suite-titles"></a>
<h2>Suite Titles</h2>
<p>Get the suite titles right for each test. They are</p>
<ul>
<li>Simple Format HttpBackend Suite</li>
<li>Simple Format Fixture Suite</li>
<li>Simple Format Exercises Suite</li>
</ul>
<a class="anchor" id="hints"></a>
<h2>Hints</h2>
<p>In <strong>karma.conf.js</strong> be sure you are loading <strong>angular</strong>, <strong>angular-mocks</strong> and <strong>angular-route</strong>:</p>
<pre><code class="lang-javascript">files: [
    <span class="hljs-symbol">'public</span>/components/jquery/dist/jquery.min.js',
    <span class="hljs-symbol">'public</span>/components/angular/angular.js',
    <span class="hljs-symbol">'public</span>/components/angular-mocks/angular-mocks.js',
    <span class="hljs-symbol">'public</span>/components/angular-route/angular-route.js',
    <span class="hljs-symbol">'node_modules</span>/jasmine-jquery/lib/*.js',  
    <span class="hljs-symbol">'public</span>/javascripts/app.js',
    <span class="hljs-symbol">'public</span>/javascripts/*.js',
    <span class="hljs-symbol">'spec</span>/**/*.html',
    <span class="hljs-symbol">'spec</span>/data/*.js',
    <span class="hljs-symbol">'spec</span>/test-*.js'
],
</code></pre>
<a class="anchor" id="charlie-s-test-output"></a>
<h2>Charlie&#39;s Test Output</h2>
<p>As an FYI:</p>
<pre>
Elvenware Fixture and Template Cache Suite
  ✓ expects true to be true
  ✓ should find the index
  ✓ should have a getRenewable method
  ✓ should be possible to access the fixture
  ✓ tests template loaded through simple raw text
  ✓ tests template loaded through more complex raw text
  ✓ tests scope variable access in template loaded through fixture

Elvenware Simple Mocks with HttpBackend Suite
  ✓ proves we can run tests
  ✓ should find the index
  ✓ should have a getRenewable method
  ✓ proves we can detect request

Renewables Suite
  ✓ proves we can run tests
  ✓ proves we can get renewableUtils name
  ✓ proves we can get renewableUtils method called getItemCount
  ✓ proves we can get from renewableUtils a particular renewable object by index
  ✓ proves we can transform our json into a new array consisting only of years
  ✓ proves we can get our wood map
  ✓ proves our array of years contains the expected data
  ✓ proves we can transform our json into an array with three properties: geo, solar, and wind
  ✓ proves that getSimpleStringFormat returns the expected string data
  ✓ proves that getSimpleFormat returns the expected numeric data

Simple Format HttpBackend Suite
  ✓ expects true to be true
  ✓ tests simple-format directive loaded through fixture with httpBackend
  ✓ tests that we can index to the fifth element

Simple Format Exercises Suite
  ✓ expects true to be true
  ✓ proves renewables.getByYear returns index & expected object
  ✓ tests that we can get an item in simpleFormat by Year
  ✓ tests that we can get an item in simpleFormat by Year

Simple Format Fixture Suite
  ✓ expects true to be true
  ✓ should find the index
  ✓ should be possible to access the fixture
  ✓ should be possible to access the fixture and put real data in it.

PhantomJS 2.1.1 (Linux 0.0.0): Executed 32 of 32 SUCCESS (0.108 secs / 0.258 secs)
TOTAL: 32 SUCCESS
</pre>
</div></body></html>