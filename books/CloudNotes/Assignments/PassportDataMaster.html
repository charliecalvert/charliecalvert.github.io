<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>PassportDataMaster</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>PassportDataMaster</h1><p>Welcome to PassportDataMaster</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#refactor">Refactor</a></li>
<li><a href="#passport">Passport</a></li>
<li><a href="#set-environment">Set Environment</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>Refactor <strong>DataMaster</strong> and implement Passport sign in for Facebook and Google.</p>
<a class="anchor" id="refactor"></a>
<h2>Refactor</h2>
<p>Create two folders and move the appropriate files into it:</p>
<p><pre></p>
<ul>
<li>controllers<ul>
<li>name-controller.js</li>
<li>query-controller.js</li>
<li>read-controller.js</li>
</ul>
</li>
<li>route-provider<ul>
<li>route.js</li>
<li>run-query.js</li>
</ul>
</li>
</ul>
<p>Make the appropriate changes to be sure these files are still being loaded. Check to make sure your application still works.</p>
<a class="anchor" id="passport"></a>
<h2>Passport</h2>
<p>Copy the <strong>google-auth.js</strong> and <strong>passport.js</strong> files to the <strong>DataMaster</strong> routes directory. More the Passport, Google and Facebook specific code from <strong>routes/index.js</strong> from the Passport program to <strong>DataMaster</strong>.</p>
<p>Use <em>meld</em> to help you merge in any changes to <strong>app.js</strong> that you will need to help you initialize passport and load <strong>google-auth.js</strong> and <strong>passport.js</strong>.</p>
<p>If you don&#39;t have it already, add in support for <em>bootstrap</em> in <strong>bower.json</strong> and <strong>main.js</strong>. Don&#39;t forget to load <strong>bootstrap.min.css</strong> in <strong>layout.jade</strong> and the corresponding JavaScript file in <strong>main.js</strong>.</p>
<p><strong>NOTE</strong>: <em>You&#39;ve probably noticed that I&#39;m becoming increasingly abstract when giving some of these instructions as the quarter roles on. When the class is over, you are going to have to do things like this without explicit directions. The implication, I suppose, is that you should be able to do these things without a reference, or you should be able to easily find the reference in your notes or in my previous assignments. One advantage to taking notes in markdown and saving them to disk is that you can easily grep across them to find keywords...</em></p>
<p>You will also need to use NPM to load a few packages. Here are two:</p>
<pre><code class="lang-bash">npm <span class="hljs-keyword">install</span> express-<span class="hljs-keyword">session</span> passport <span class="hljs-comment">--save</span>
</code></pre>
<p>What else needs to be installed? Look back at the previous assignment and find out what is missing, or else simply learn by trial and error.</p>
<a class="anchor" id="set-environment"></a>
<h2>Set Environment</h2>
<p>We could make a really long <strong>start</strong> property in package.json, but it is probably better to actually create a file called <strong>set-env</strong> and put our environment variables in it:</p>
<pre><code class="lang-text"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">DEBUG</span>=DataMaster
<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CLIENT_ID</span>=&lt;YOUR<span class="hljs-built_in"> CLIENT </span>ID&gt;
<span class="hljs-builtin-name">export</span> <span class="hljs-attribute">CLIENT_SECRET</span>=&lt;YOUR<span class="hljs-built_in"> CLIENT </span>SECRET&gt;
</code></pre>
<p>You should of, course, put your <strong>CLIENT_ID</strong> and your <strong>CLIENT_SECRET</strong> in place of the prompts shown above. Something like this:</p>
<p>  export CLIENT_ID=1234</p>
<p>When you are done, load the file: <strong>source set-env</strong>. Then check your work:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$CLIENT_ID</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$CLIENT_SECRET</span>
</code></pre>
<p>You should see your Client ID and your Client Secret. This is safe because the file is on the server and will not be seen by visitors to your site. You might, however, want to lock this file down with draconian permissions (chmod 400) to make sure that no one can edit it and only you can read it.</p>
<p>For now, I would like you to place the <strong>set-env</strong> file in your repository. Be sure, however, that you are using a private repository! If you decide, in the future, to make this a public repository, then be sure to change your Client Secret on the Facebook web site.</p>
</div></body></html>