<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ElvenWebCraftsStarter</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>ElvenWebCraftsStarter</h1><p>Welcome to ElvenWebCraftsStarter</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#get-started">Get Started</a></li>
<li><a href="#the-port">The Port</a></li>
<li><a href="#the-main-modules">The Main Modules</a></li>
<li><a href="#create-npm-packages">Create NPM Packages</a></li>
<li><a href="#the-login">The Login</a></li>
<li><a href="#fork-repos">Fork Repos</a></li>
<li><a href="#get-repos">Get Repos</a></li>
<li><a href="#customize-your-new-repo">Customize your New Repo</a></li>
<li><a href="#pull-changes-from-the-original-repository">Pull Changes from the Original Repository</a></li>
<li><a href="#the-config-file">The Config File</a></li>
<li><a href="#run">Run</a></li>
<li><a href="#the-packages-hint">The Packages Hint</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>For the next several weeks, we are going to work on a project that already exists. It is a tool for building web sites. Our goal is to take a project students built several years ago and update it. We will:</p>
<ul>
<li>Clean up the code</li>
<li>Improve and extend the tests</li>
<li>Refactor the code<ul>
<li>to have a cleaner architecture</li>
<li>to use React and Redux</li>
</ul>
</li>
</ul>
<p>This set of assignments is designed to mirror a scenario you are likely to encounter in the workplace. Employees are often handed a project that needs to be updated or that is not yet ready to be released. They are asked to polish and improve the code. Their job is to bring it to Version 1.0, a release build.</p>
<p>This is a very real world task. Many developers are handed partially broken code, or an existing project, and told to clean it up. This is particularly true for new hires.</p>
<p><strong>NOTE</strong>: <em>Use your common sense, but in general, throughout this document, if you see a file name, directory, or repository that has <strong>-lastname</strong> in its title, you should substitute your last name for the word <strong>lastname</strong>. For instance, in my case, <strong>isit-code-lastname</strong> should become <strong>isit-code-calvert</strong>.</em></p>
<a class="anchor" id="get-started"></a>
<h2>Get Started</h2>
<p>It might be helpful if you first <a href="https://youtu.be/cZ3DrcBS7cI">Watch the Video</a> to help get a feeling for what is going on.</p>
<p>We will be working with these projects:</p>
<ul>
<li><a href="https://github.com/charliecalvert/isit-code">https://github.com/charliecalvert/isit-code</a></li>
<li><a href="https://github.com/charliecalvert/isit-site-tools">https://github.com/charliecalvert/isit-site-tools</a></li>
<li><a href="https://github.com/charliecalvert/isit-web-crafts">https://github.com/charliecalvert/isit-web-crafts</a></li>
</ul>
<a class="anchor" id="the-port"></a>
<h2>The Port</h2>
<p>I have tended to run this program on port 30200. I do this because I leave it running much of the time, and want to leave ports 30025, 30026, 8080 and 3000 open for other node programs. We should, however, run the program on our familiar port 30025. Make the change in <strong>bin/www</strong></p>
<pre><code class="lang-javascript">
</code></pre>
<a class="anchor" id="the-main-modules"></a>
<h2>The Main Modules</h2>
<p>This project has been divided into a main program and two libraries. This is code left over from half completed projects worked on during previous quarters. They all need to be updated:</p>
<ul>
<li><strong>IsitWebCrafts</strong>: A GUI front end for building websites from markdown.  </li>
<li><strong>IsitCode</strong>: an NPM package written by students in another of my classes  </li>
<li><strong>IsitSiteTools</strong>: Another NPM package that contains various utilities</li>
</ul>
<p>Each student in this class will maintain their own copy of these projects.</p>
<a class="anchor" id="create-npm-packages"></a>
<h2>Create NPM Packages</h2>
<p>We will fork the projects I created. Based on your fork of my original project, you will create two NPM packages. For instance, you will create Git repositories based on the code in <strong>isit-code</strong> and <strong>isit-site-tools</strong>. Append your last name to your versions of these projects:</p>
<ul>
<li><strong>isit-code-lastname</strong></li>
<li><strong>isit-site-tools-lastname</strong></li>
</ul>
<p>In my case, the first NPM package would be called:</p>
<ul>
<li>isit-code-calvert</li>
</ul>
<p>If you get the casing, the separator (a hypen), or anything else wrong, you will get the assignment kicked back at you. The names need to be exactly right.</p>
<a class="anchor" id="the-login"></a>
<h2>The Login</h2>
<p>When <strong>IsitWebCrafts</strong> is first launched, the user is asked to log in. You can log in with the username and password <strong>foo</strong>. The login works, but at first, we will simply want to disable the login so we don&#39;t have to both with it during development.</p>
<p>To know how to disable the login, you need to know something about <a href="http://expressjs.com/">Express</a> Middleware. This is one of the most important parts of the Express package. Please read at least some of this <a href="http://expressjs.com/en/guide/using-middleware.html">discussion of middleware</a>.</p>
<p>When an HTTP request comes to an Express server, the Express library parses it. It then passes the request to whatever middleware you create. This middleware is typically found in a single method, but you can chain several methods together by calling the <strong>next()</strong> method passed as a parameter parameter to your middleware. In particular, see the last parameter in this code:_</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response, next)</span> </span>{})
</code></pre>
<p>Here is the code from <strong>routes/index.js</strong> that is called when the user asks for the home page:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> isAuthenticated = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response, next</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    <span class="hljs-comment">// Passport added the this method to the request object.</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'isAuthenticated called'</span>);
    <span class="hljs-keyword">if</span> (request.isAuthenticated()) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'successfully authenticated'</span>);
        <span class="hljs-keyword">return</span> next();
    }

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'in isAuthenticated, user not authenticate, send to login'</span>);
    response.redirect(<span class="hljs-string">'/login'</span>);
};

router.get(<span class="hljs-string">'/'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response, next</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    response.render(<span class="hljs-string">'index'</span>, {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'Elven Site Options'</span>,
        <span class="hljs-attr">author</span>: <span class="hljs-string">'Charlie Calvert'</span>
    });
});
</code></pre>
<p>The <strong>isAuthenticated()</strong> method is middleware that is called before the user can access the home page. If the user is logged in, then <strong>isAuthenticated</strong> calls <strong>next()</strong>, and the home page loads. Otherwise, the login page is called.</p>
<p>Without removing the <strong>isAuthenticated</strong> method, rewrite it so that the user is automatically taken to the home page whether they are logged in or not. You can make whatever changes you want to <strong>isAuthenticated</strong>, but it must continue to be called from the home page route. I would either comment out or otherwise preserve the code in the current working code from the method so that you can replace it later on, when we want to add login again.</p>
<p>After completing the <strong>isAuthenticated</strong> code correctly, you will still get a series of benign database errors when you start <strong>WebCrafts</strong>. The errors don&#39;t break the app, but they are ugly to look at. To clean up that annoyance, for now you should comment the references to <strong>connect</strong> from the copy of <strong>app.js</strong> that appears in the root of your repository:</p>
<pre><code class="lang-javascript"><span class="hljs-regexp">//</span> Connect to DB
<span class="hljs-regexp">//</span>var connect = require(<span class="hljs-string">'./routes/connect'</span>);
<span class="hljs-regexp">//</span>connect.doConnection(false);
</code></pre>
<p>The second and third lines above were the ones that I commented out.</p>
<a class="anchor" id="fork-repos"></a>
<h2>Fork Repos</h2>
<p>Fork the following repositories:</p>
<ul>
<li>charliecalvert/isit-code</li>
<li>charliecalvert/isit-site-tools</li>
<li>charliecalvert/isit-web-crafts</li>
</ul>
<p>Your version of these repositories will be public. As a result, you should be sure that they contain a license. Common choices are the <a href="https://opensource.org/licenses/MIT">MIT</a> or <a href="https://opensource.org/licenses/ISC">ISC</a> license.</p>
<p>On GitHub, use the Settings (gear) icon and rename your fork of my repository to include your last name:</p>
<ul>
<li>isit-code-lastname</li>
<li>isit-site-tools-lastname</li>
<li>isit-web-crafts-lastname</li>
</ul>
<a class="anchor" id="get-repos"></a>
<h2>Get Repos</h2>
<p>Create a folder in your <strong>~/Git</strong> directory called <strong>webcrafts</strong> or something similar. Clone your new repositories into your new folder.</p>
<pre><code>mkdir webcrafts
cd webcrafts
git <span class="hljs-keyword">clone</span> <span class="hljs-title">&lt;git</span>@github.com:username/isit-code-lastname.git&gt;
git <span class="hljs-keyword">clone</span> <span class="hljs-title">&lt;git</span>@github.com:username/isit-site-tools-lastname&gt;
git <span class="hljs-keyword">clone</span> <span class="hljs-title">&lt;git</span>@github.com:username/isit-web-crafts-lastname&gt;
</code></pre><a class="anchor" id="customize-your-new-repo"></a>
<h2>Customize your New Repo</h2>
<p>Open up the <strong>package.json</strong> file for each project and change the name to include your last name.</p>
<p>If you don&#39;t have one already, create an account on <strong>NPM</strong>. Log into it. Then read through this guide and apply the lessons found there to this task.</p>
<ul>
<li><a href="https://www.ccalvert.net/books/CloudNotes/Assignments/NpmPublishing.html">NPM Publishing</a></li>
</ul>
<p>In <strong>isit-site-tools-lastname</strong>, run the following command:</p>
<pre><code>npm install --<span class="hljs-keyword">save</span> isit-<span class="hljs-built_in">code</span>-lastname
</code></pre><p>In <strong>isit-web-crafts-lastname</strong>, run the following commands:</p>
<pre><code>npm install --<span class="hljs-keyword">save</span> isit-<span class="hljs-built_in">code</span>-lastname isit-site-tools-lastname
</code></pre><p>Change all references to my repos to your repos. You will have to replace the string <strong>lastname</strong> with your last name:</p>
<pre><code><span class="hljs-built_in">find</span> . -iname <span class="hljs-string">"*.js"</span> -<span class="hljs-built_in">not</span> -path <span class="hljs-string">"**/node_modules/**"</span> | xargs sed -i 's/isit-<span class="hljs-built_in">code</span>-calvert/isit-<span class="hljs-built_in">code</span>-lastname/g' *.js
</code></pre><p>In the WebCrafts project, you are going to have to change references to <strong>isit-code-calvert</strong> and <strong>isit-site-tools-calvert</strong>.</p>
<p><strong>NOTE</strong>: <em>Please don&#39;t turn in your <strong>isit-web-crafts-lastname</strong> project with links to my repos in your source files.</em></p>
<a class="anchor" id="pull-changes-from-the-original-repository"></a>
<h2>Pull Changes from the Original Repository</h2>
<p>Suppose I have made an update to the repository from which you forked your code. In particular, suppose I have updated this repository:</p>
<ul>
<li><a href="https://github.com/charliecalvert/isit-site-tools">isit-site-tools</a></li>
</ul>
<p>Assuming your code has not diverged too wildly from my original code, you can get my changes like this:</p>
<pre><code>git pull git<span class="hljs-meta">@github</span>.<span class="hljs-string">com:</span>charliecalvert/isit-site-tools.git
</code></pre><p>You should issue the command from within your repository. It&#39;s probably best to be at the root of your repository.</p>
<pre><code>charlie<span class="hljs-meta">@rohan</span>-<span class="hljs-string">elf:</span><span class="hljs-regexp">~/Git/</span>isit-calvert<span class="hljs-number">-2017</span>/isit-site-tools-calvertbc (master)
$ git pull git<span class="hljs-meta">@github</span>.<span class="hljs-string">com:</span>charliecalvert/isit-site-tools.git
<span class="hljs-string">remote:</span> Counting <span class="hljs-string">objects:</span> <span class="hljs-number">3</span>, done.
<span class="hljs-string">remote:</span> Total <span class="hljs-number">3</span> (delta <span class="hljs-number">2</span>), reused <span class="hljs-number">3</span> (delta <span class="hljs-number">2</span>), pack-reused <span class="hljs-number">0</span>
Unpacking <span class="hljs-string">objects:</span> <span class="hljs-number">100</span>% (<span class="hljs-number">3</span>/<span class="hljs-number">3</span>), done.
From github.<span class="hljs-string">com:</span>charliecalvert/isit-site-tools
 * branch            HEAD       -&gt; FETCH_HEAD
Updating <span class="hljs-number">970</span>b5ef.<span class="hljs-number">.0</span>f2a0a4
Fast-forward
 <span class="hljs-keyword">package</span>.json | <span class="hljs-number">2</span> +-
 <span class="hljs-number">1</span> file changed, <span class="hljs-number">1</span> insertion(+), <span class="hljs-number">1</span> deletion(-)
</code></pre><a class="anchor" id="the-config-file"></a>
<h2>The Config File</h2>
<p>Here is the configuration file for the project. It is found in <strong>config/ElvenConfig.json</strong></p>
<pre><code>{
    <span class="hljs-attr">"calvert"</span>: {
        <span class="hljs-attr">"base-dir"</span>: <span class="hljs-string">"/home/charlie/"</span>,
        <span class="hljs-attr">"bootswatch"</span>: <span class="hljs-string">"cosmo"</span>,
        <span class="hljs-attr">"most-recent-date"</span>: <span class="hljs-string">"2017-08-14"</span>,
        <span class="hljs-attr">"site-dirs"</span>: [
            <span class="hljs-string">"Documents/AllSite"</span>,
            <span class="hljs-string">"Git/CloudNotes/Isit320"</span>
        ],
        <span class="hljs-attr">"destination-dirs"</span>: [
            <span class="hljs-string">"/var/www/html/AllSite/"</span>,
            <span class="hljs-string">"/home/charlie/Git/charliecalvert.github.io/books/CloudNotes/Isit320/"</span>            
        ],
        <span class="hljs-attr">"destination-dirs-extra"</span>: [{
            <span class="hljs-attr">"base"</span>: <span class="hljs-string">"/var/www/html/"</span>,
            <span class="hljs-attr">"extra"</span>: <span class="hljs-string">""</span>
        }, {
            <span class="hljs-attr">"base"</span>: <span class="hljs-string">"/var/www/html/Assignments/"</span>,
            <span class="hljs-attr">"extra"</span>: <span class="hljs-string">"Assignments"</span>
        }]
    },
    <span class="hljs-attr">"selectedElvenImages"</span>: [
        <span class="hljs-string">"california1"</span>,
        <span class="hljs-string">"california2"</span>
    ],
    <span class="hljs-attr">"elvenImages"</span>: [
        {
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"doc"</span>,
            <span class="hljs-attr">"baseDir"</span>: <span class="hljs-string">"The base directory where the images to be processed are found"</span>,
            <span class="hljs-attr">"cloudPath"</span>: <span class="hljs-string">"Base string found in markdown files"</span>,
            <span class="hljs-attr">"createSmallImages"</span>: <span class="hljs-literal">true</span>
        },
        {
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"california"</span>,
            <span class="hljs-attr">"baseDir"</span>: <span class="hljs-string">"/var/www/html/images"</span>,
            <span class="hljs-attr">"cloudPath"</span>: <span class="hljs-string">"/images"</span>,
            <span class="hljs-attr">"createSmallImages"</span>: <span class="hljs-literal">true</span>
        },
        {
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"california1"</span>,
            <span class="hljs-attr">"baseDir"</span>: <span class="hljs-string">"/var/www/html/images"</span>,
            <span class="hljs-attr">"cloudPath"</span>: <span class="hljs-string">"https://s3.amazonaws.com/s3bucket01.elvenware.com"</span>,
            <span class="hljs-attr">"createSmallImages"</span>: <span class="hljs-literal">true</span>
        },
        {
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"california2"</span>,
            <span class="hljs-attr">"baseDir"</span>: <span class="hljs-string">"/var/www/html/images"</span>,
            <span class="hljs-attr">"cloudPath"</span>: <span class="hljs-string">"/images"</span>,
            <span class="hljs-attr">"createSmallImages"</span>: <span class="hljs-literal">true</span>
        }
    ]
}
</code></pre><p>Put a symbolic link to this file in your ~/.config directory:</p>
<pre><code><span class="hljs-built_in">cd</span> ~/.config
ln -s &lt;<span class="hljs-built_in">PATH</span> TO ElvenConfig.json&gt; .
</code></pre><p>The config file has three primary sections:</p>
<ul>
<li>calvert:<ul>
<li>Configure the code the creates HTML from Markdown</li>
</ul>
</li>
<li>elvenImages:<ul>
<li>Configure the code that creates Markdown from a set of Images</li>
</ul>
</li>
<li>Selected Elven Images<ul>
<li>The sections of elvenImages that the program should process when creating Markdown that displays a set of images.</li>
</ul>
</li>
</ul>
<p>Given a set of Markdown files in a directory, the program can convert them to HTML</p>
<p>Given a set of images in a directory, the program can create a markdown page that is able to display them all. For instance, if <strong>foo.png</strong> is in a directory, the program will generate Markdown similar to this:</p>
<pre><code>![<span class="hljs-string">Foo</span>](<span class="hljs-link">foo.png</span>)
</code></pre><a class="anchor" id="run"></a>
<h2>Run</h2>
<p>Make sure you have some markdown files in a directory called <strong>Documents/AllSite</strong>. These are the markdown files that the program will transform into HTML. Here is a few lines of code that would create the directory and three simple markdown files:</p>
<pre><code>mkdir -p <span class="hljs-regexp">/home/</span>bcuser<span class="hljs-regexp">/Documents/</span>AllSite
echo <span class="hljs-string">'# One'</span> &gt; <span class="hljs-regexp">/home/</span>bcuser<span class="hljs-regexp">/Documents/</span>AllSite/One.md
echo <span class="hljs-string">'# Two'</span> &gt; <span class="hljs-regexp">/home/</span>bcuser<span class="hljs-regexp">/Documents/</span>AllSite/Two.md
echo <span class="hljs-string">'# Three'</span> &gt; <span class="hljs-regexp">/home/</span>bcuser<span class="hljs-regexp">/Documents/</span>AllSite/Three.md
</code></pre><a class="anchor" id="the-packages-hint"></a>
<h2>The Packages Hint</h2>
<p>We will be modifying our <strong>isit-code</strong> and <strong>isit-site-tools</strong> packages as we work. If we are working on main <strong>WebCrafts</strong> web application, and want to make changes to -- for instance -- our <strong>isit-code</strong> package, we have three choices:</p>
<ul>
<li>Do the fix in the <strong>isit-code</strong>, publish it, run <strong>npm install</strong> to get the updates in <strong>WebCrafts</strong>.</li>
<li>Put our fix in our copy of <strong>node_modules/isit-code</strong>.<ul>
<li>If we do this then we need to meld (merge) it back to the repository that holds our real copy.</li>
</ul>
</li>
<li>Create a symbolic link from our <strong>WebCraft</strong> application&#39;s <strong>node_modules</strong> directory to our <strong>isit_code</strong> directory.<ul>
<li>If we choose this option, we should temporarily remove our references to <strong>isit-code</strong> from <strong>packages.json</strong>.</li>
<li>Before you turn in your work, restore the references.</li>
</ul>
</li>
</ul>
<p>Of these three options, the first is the easiest to understand, but the hardest to do in practice. The second option is pretty good, but can cause problems if we forget to the merge. As a result, the third is probably the most useful option, if you know what you are doing.</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<ul>
<li><a href="https://youtu.be/cZ3DrcBS7cI">Watch the Video</a></li>
</ul>
<p>Turn in links to your three repository. Line them all up (probably in the comments area) so I can just block copy them:</p>
<ul>
<li>git clone git@github.com:<name><isit-code></li>
<li>git clone git@github.com:<name><isit-site-tools></li>
<li>git clone git@github.com:<name><web-crafts></li>
</ul>
<p><strong>NOTE</strong>: <em>You can also provide links to your code on github, but the primary things I want to see are <strong>git clone</strong> statements that I can simply block copy and run. Test them on your end in a temp directory to be sure they work.</em></p>
<p>I should then be able to enter your web-crafts folder, type the following and be up and running:</p>
<ul>
<li><strong>npm install &amp;&amp; bower install &amp;&amp; npm start</strong></li>
</ul>
<p>Attach a screenshot of the program running successfully and producing the three HTML files from the markdown. What you see in the next to last &quot;scene&quot; in my video. The one where I run the app, but before I display the results in a browser.</p>
</div></body></html>
