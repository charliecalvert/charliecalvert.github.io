<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>GistLister</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>GistLister</h1><p>Welcome to GistLister</p><ul><!--TOC_Start--><li><a href="#gist-lister">Gist Lister</a></li>
<li><a href="#gistlister-test-start">GistLister Test Start</a></li>
<li><a href="#title">Title</a></li>
<li><a href="#writing-gist-lister">Writing Gist Lister</a></li>
<li><a href="#test-for-a-ul">Test for a UL</a></li>
<li><a href="#query-the-list">Query the List</a></li>
<li><a href="#jasmine">Jasmine</a></li>
<li><a href="#loggers">Loggers</a></li>
<li><a href="#server-side-tests">Server Side Tests</a></li>
<li><a href="#client-side-test">Client Side Test</a></li>
<li><a href="#client-side-implementation">Client Side Implementation</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#hint">Hint</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="gist-lister"></a>
<h1>Gist Lister</h1>
<p>Create a Component that can list gists.</p>
<p>This component might also be used to delete and display the content of gists.</p>
<a class="anchor" id="gistlister-test-start"></a>
<h2>GistLister Test Start</h2>
<p>We test first. So create an initial test:</p>
<pre>import React from 'react';
import ReactDOM from 'react-dom';

import {shallow} from 'enzyme';

describe('ElfHeader Suite', function () {

    it('renders the GistLister component without crashing', () => {
        const div = document.createElement('div');
        ReactDOM.render(<GistLister />, div);
    });

});
</pre>
<p>Get it to pass</p>
<a class="anchor" id="title"></a>
<h2>Title</h2>
<p>Write a test to check for a title.</p>
<pre>it('renders and reads GistLister H2 text', () => {
    const wrapper = shallow(<GistLister />);
    elfDebugEnzyme.getAll(wrapper);
    const welcome = <h2>Gist Lister</h2>;
    expect(wrapper.contains(welcome)).toEqual(true);
});
</pre>
<p>Prove to your self that you have <strong>elfDebugEnzyme</strong> set up correctly. Before you add the header, it should produce something like this:</p>
<pre><div className="App" />
</pre>
<p>Get it to pass.</p>
<a class="anchor" id="writing-gist-lister"></a>
<h2>Writing Gist Lister</h2>
<p>Start out with the simplest possible component. It should have an empty DIV in the render method. The constructor should use the <strong>ElfLogger</strong>. Something like this:</p>
<pre>imports here...
const logger = new ElfLogger('gist-lister');

class GistLister extends Component {
    constructor(props) {
        super(props);
        logger.log('Gist List Constructor');
    }

    render() {...}
}

export etc...
</pre>
<p>Set up the environment variable for the logger and test that ensure that your tests are working. Using &#39;p&#39; to filter so that you are seeing only this one test suite, the output from the two loggers should look something like this when both tests are passing:</p>
<pre>PASS  src/__tests__/GistLister.test.js
 ElfHeader Suite
   ✓ renders the GistLister component without crashing (5ms)
   ✓ renders and reads GistLister H2 text (3ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        0.369s, estimated 1s
Ran all test suites related to changed files.

Watch Usage
› Press a to run all tests.
› Press p to filter by a filename regex pattern.
› Press q to quit watch mode.
› Press Enter to trigger a test run.
 console.info src/elf-logger.js:49
   gist-lister Gist List Constructor  

 console.info src/elf-logger.js:49
   gist-lister Gist List Constructor  

 console.log src/ElfDebugEnzyme.js:30
   GistLister.test.js:
   <div className="App">
   <h2>
   Gist Lister
   </h2>
   </div>
</pre>
<a class="anchor" id="test-for-a-ul"></a>
<h2>Test for a UL</h2>
<pre>it('renders GistLister UL Element', () => {
    const wrapper = shallow(<GistLister />);
    elfDebugEnzyme.getElement(wrapper,'ul');
    //var a = wrapper.find('ul');
    //console.log(a.length);
    expect(wrapper.find('ul').length).toEqual(1);
});
</pre>
<a class="anchor" id="query-the-list"></a>
<h2>Query the List</h2>
<p>Lets swtich to the server side for a second.</p>
<p>Create a file called <strong>gists.js</strong>. Rename <strong>api.js</strong> to <strong>users.js</strong>.</p>
<pre>me.listGists().then(function({data}) {
       console.log('USER PROMISE', data);
       const results = data.map((item) => ( {Return Object with 4 props} );
       response.status(200).send({
           'count': results.length,
           'result': results
       });
   }).catch(function(err) {
       console.log('USER Promise Rejected', err);
       response.status(500).send({'result': err});
   })
 });
</pre>
<a class="anchor" id="jasmine"></a>
<h2>Jasmine</h2>
<pre>npm install --save-dev supertest
npm install --save-dev jasmine
npm install --save-dev jasmine-spec-reporter
</pre>
<p>Here it is:</p>
<pre>var Jasmine = require('jasmine');
var SpecReporter = require('jasmine-spec-reporter').SpecReporter;
var noop = function() {};

var jrunner = new Jasmine();
jrunner.configureDefaultReporter({
    print: noop
}); // remove default reporter logs
jasmine.getEnv().addReporter(new SpecReporter({  // add jasmine-spec-reporter
    spec: {
        displayPending: true
    }
})); // add jasmine-spec-reporter
jrunner.loadConfigFile(); // load jasmine.json configuration
jrunner.execute();
</pre>
<p>And put this in <strong>spec/support/jasmine.json</strong>:</p>
<pre>{
  "spec_dir": "spec",
  "spec_files": [
    "test-basic.js",
    "test-results.js"
  ]
}
</pre>
<p>The test:</p>
<pre>/**
 * Created by charlie on 10/7/15.
 */

var request = require('supertest');
var app = require('../app');

describe('Elvenware Simple Plain Suite', function() {

    'use strict';

    it('expects true to be true', function() {
        expect(true).toBe(true);
    });

    it('get the foo route', function(done) {
        request(app)
            .get('/foo')
            .expect(200)
            .expect('Content-Type', /json/)
            .end(function(err, res) {
                if (err) {
                    throw err;
                }
                done();
            });
    });

});
</pre>
<p>Then run it:</p>
<pre>$ node jasmine-runner.js
notoken
Spec started

  Elvenware Simple Plain Suite
    ✓ expects true to be true
GET /foo 200 7.146 ms - 52
    ✓ get the foo route

Executed 2 of 2 specs SUCCESS in 0.04 sec.
</pre>
<a class="anchor" id="loggers"></a>
<h2>Loggers</h2>
<p>Many of us have been using <strong>console.log</strong> heavily in our routes. Now that we are running tests, we need to get more control over the amount of information we are sending to the console.</p>
<p>Copy the <strong>elf-logger</strong> over from the client and put it in the <strong>routes</strong> directory. It is set up to handle ES6, switch it to use <strong>require</strong> by changing the way it exports the <strong>ElfLogger</strong>. Instead of <strong>export default</strong>, write this:</p>
<pre>module.exports=ElfLogger;
</pre>
<p>You will probably need to end up inserting the logger in all our test files, and in each of the files in the <strong>routes</strong> directory. When setting up the Environment variable to use, use the name of the file itself as well as path to it:</p>
<pre>const Logger = require('../elf-logger');
var logger = new Logger('gitapi-gists');
</pre>
<p>Then, before you run the test, set the environment variable:</p>
<pre>export REACT_APP_ELF_LOGGER='gitapi-gists'
nodemon jasmine-runner.js
</pre>
<p>In fact, we should put the test statement in our <strong>package.json</strong>:</p>
<pre>"scripts": {
  "test-karma": "karma start",
  "test": "nodemon jasmine-runner.js",
  "start": "nodemon ./bin/www"
},
</pre>
<p>I believe this also works on Linux, but not on Windows:</p>
<pre>"scripts": {
  "test-karma": "karma start",
  "test": REACT_APP_ELF_LOGGER='gitapt-gists' "nodemon jasmine-runner.js",
  "start": "nodemon ./bin/www"
},
</pre>
<a class="anchor" id="server-side-tests"></a>
<h2>Server Side Tests</h2>
<p>In <strong>test-gists.js</strong>:</p>
<pre>
it('gets the basic gists list', function(done) {
    request(app)
        .get('/gitapi/gists/get-basic-list')
        .expect(200)
        .expect('Content-Type', /json/)
        .end(function(err, res) {
            if (err) {
                throw err;
            }
            done();
        });
});

it('checks the gist response', function(done) {
    request(app)
        .get('/gitapi/gists/get-basic-list')
        .expect(200)
        .expect('Content-Type', /json/)
        .expect(function(response) {
            logger.log(response.body);
            expect(typeof response.body.count).toBe('number');
            expect(typeof response.body.result).toBe('object');
        })
        .end(function(err, res) {
            if (err) {
                throw err;
            }
            done();
        });
});

it('checks the gist response', function(done) {
    request(app)
        .get('/gitapi/gists/get-basic-list')
        .expect(200)
        .expect('Content-Type', /json/)
        .expect(function(response) {
            logger.log(response.body.result[0]);
            const gist = response.body.result[0];
            expect(gist.html_url).toBeDefined();
            expect(gist.id).toBeDefined();
            expect(gist.description).toBeDefined();
            expect(gist.git_pull_url).toBeDefined();
        })
        .end(function(err, res) {
            if (err) {
                throw err;
            }
            done();
        });
});
</pre>
<a class="anchor" id="client-side-test"></a>
<h2>Client Side Test</h2>
<p>More mock data for the <strong>mock-data.js</strong>:</p>
<pre>case '/gitapi/gists/get-basic-list':
    return {
        result: [
            {
                html_url: 'https://gist.github.com/a023c7db77926ff58d35087821e12020',
                id: 'a023c7db77926ff58d35087821e12020',
                git_pull_url: 'https://gist.github.com/a023c7db77926ff58d35087821e12020.git',
                description: 'Simple React Component'
            },
            {
                html_url: 'https://gist.github.com/17f8ec886c1ae22f66501fc3cbe760ac',
                id: '17f8ec886c1ae22f66501fc3cbe760ac',
                git_pull_url: 'https://gist.github.com/17f8ec886c1ae22f66501fc3cbe760ac.git',
                description: 'React Npm Install'
            }
        ]
    };
</pre>
<p>Write  a test.</p>
<a class="anchor" id="client-side-implementation"></a>
<h2>Client Side Implementation</h2>
<p>Add a menu item:</p>
<pre><li><Link to='/get-gist-list'>GetGist List</Link></li>
</pre>
<p>In DataMaven, set up some dummy state:</p>
<pre>this.state = {
  // Stuff here
  gistLister: 'Fill this in with an appropriate type and dummy data'
}
</pre>
<p>In DataMaven, create a method called <strong>fetchGistList</strong>. Don&#39;t forget to bind it to this!</p>
<p>Write code in render that passes the data on to the <strong>GistLister</strong>:</p>
<pre><Route path='/get-gist-list'
   render={(props) => (...)}
/>
</pre>
<p>In GistLister, display the data.</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Push, branch, tag.</p>
<a class="anchor" id="hint"></a>
<h2>Hint</h2>
<ul>
<li><a href="http://www.elvenware.com/charlie/development/cloud/Git.html#git-tag">Git Tag</a></li>
<li><a href="http://www.elvenware.com/charlie/development/cloud/Git.html#understanding-tags">Understanding Tags</a></li>
</ul>
</div></body></html>