<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>RestTests</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>RestTests</h1><p>Welcome to RestTests</p><ul><!--TOC_Start--><li><a href="#rest-tests">Rest Tests</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#render">Render</a></li>
<li><a href="#configure-enzyme">Configure Enzyme</a></li>
<li><a href="#simple-debug-class">Simple Debug Class</a></li>
<li><a href="#the-tests">The Tests</a></li>
<li><a href="#call-server">Call Server</a></li>
<li><a href="#run-your-test">Run your test</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#modern-tools">Modern Tools</a></li>
<li><a href="#polyfill-fix">PolyFill Fix</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="rest-tests"></a>
<h1>Rest Tests</h1>
<p>This assignment is built on top of the <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/React/RestBasics.html">RestBasics</a> assignments. Make your edits in the same directory you used for <strong>RestBasics</strong>, but you should be working in a new branch called <strong>Week03-RestTest</strong>. Create and switch to the branch first, and then begin your work.</p>
<p>I&#39;m assuming that you are working in a folder called <strong>week02-rest-basics</strong> and that it has both a <strong>client</strong> and <strong>server</strong> folder in it. If there is any doubt about the primary folder name, be sure to specify it when you turn in the assignment.</p>
<a class="anchor" id="install"></a>
<h2>Install</h2>
<p>Navigate to the root of the <strong>client</strong> project and install some NPM packages:</p>
<pre>npm install --save-dev enzyme enzyme-adapter-react-16
npm install --save-dev react-test-renderer
npm test
</pre>
<p>We want to ensure that we get all of these tools set to use the same version. For instance, my dependencies in <strong>package.json</strong> now look like this:</p>
<pre>"dependencies": {
    "react": "^16.0.0",
    "react-dom": "^16.0.0",
    "react-scripts": "1.0.13",
    "whatwg-fetch": "^2.0.3"
},
"devDependencies": {
    "enzyme": "^3.0.0",
    "react-test-renderer": "^16.0.0"
}
</pre>
<p>The point is not the specific versions, but that they are all the same version.</p>
<p>After editing your <strong>package.json</strong> file, run the following commands:</p>
<pre>npm install
npm outdated
</pre>
<p>If everything is up to date, <strong>npm outdated</strong> will return with no output. If it complains, you can update your <strong>package.json</strong> and run <strong>npm install</strong> again. See also <a href="https://www.npmjs.com/package/npm-check-updates">npm-check-updates</a>.</p>
<p>If you try the above, and the versions still look wrong, try something like this, where the versions are specified:</p>
<pre>npm i --save react@16 react-dom@16
npm i --save-dev react-test-renderer@16
npm i --save-dev enzyme enzyme-react-adapter-16
</pre>
<p>You can find the latest release of a package like this:</p>
<pre>$ npm show react version
16.0.0
</pre>
<p>This is not the latest release on your system, but the latest release available from NPM.</p>
<a class="anchor" id="render"></a>
<h2>Render</h2>
<p>If necessary, tweak your render method slightly as shown below. Notice that the state is set to a simpler object than in the previous version. Note that there are two paragraphs elements in the JSX. The portions of the code that changed now look like this:</p>
<pre>constructor() {
    super();
    this.state = {
        file: 'unknown',
        foo: 'waiting'
    };
}

// CODE OMITTED HERE....

render() {
    return (
        <div className="App">
            <div className="App-header">
                <img src={logo} className="App-logo" alt="logo"/>
                <h2>Welcome to React</h2>
            </div>

            <p className="App-intro">
                state: {this.state.foo}
            </p>
            <p className="App-intro">
                file: {this.state.file}
            </p>
            <button onClick={this.bar}>Bar</button>
        </div>
    );
}
</pre>
<a class="anchor" id="configure-enzyme"></a>
<h2>Configure Enzyme</h2>
<p>Place this code at the top of app.test.js:</p>
<pre>import {shallow} from 'enzyme';
import { configure } from 'enzyme';
import Adapter from 'enzyme-adapter-react-16';

configure({ adapter: new Adapter() });
</pre>
<p>The first line of code imports an object from an Airbnb library called <a href="https://github.com/airbnb/enzyme">Enzyme</a>. We will use a combination of a the unit test library called <a href="https://facebook.github.io/jest/">Jest</a> and <a href="https://github.com/airbnb/enzyme">Enzyme</a> to test our code.</p>
<p>Enzyme allows us to <strong>wrap</strong> React components in objects that we can transverse as if they were part of a DOM. This means we can test our components without having to load them into a browser.</p>
<p>The <strong>shallow</strong> object allows us to look only one level deep at the objects in our React code. For instance, if one React component contains another React component which contains yet a third, <strong>shallow</strong> will allow us to look at only the top level component. The fact that it is made of two other components is hidden from us.</p>
<p>Enzyme needs to be able to <em>adapt</em> to the version of React that you are using. Hence, we have to take the extra step to <strong>configure</strong> an <strong>Adapter</strong>. That is the last line of code quoted above.</p>
<a class="anchor" id="simple-debug-class"></a>
<h2>Simple Debug Class</h2>
<p>Enzyme has the ability to locate and display individual HTML elements. It provides various tools for navigating the Enzyme &quot;DOM&quot;. I like to wrap these tools in an object so that I don&#39;t have to remember exactly how they work.</p>
<p>Some of you know that there is a relatively complete Enzyme debug object.</p>
<ul>
<li><a href="https://gist.github.com/charliecalvert/51daef341699943b07c9570c3ad2cbab#file-elfdebugenzyme-js">The original object saved as a gist on my GitHub account</a>.</li>
<li>Or clone it like this: <a href="https://gist.github.com/51daef341699943b07c9570c3ad2cbab.git">https://gist.github.com/51daef341699943b07c9570c3ad2cbab.git</a></li>
</ul>
<p>But all that is a bit heavyweight for this exercise. Instead, we can just use this simple ES6 class:</p>
<pre>class ElfDebugEnzyme {

    display(value) {
        console.log(value);
    }

    getLast(wrapper, element, showMe) {
        if (showMe) {
            const paragraphData = wrapper.find(element).last().debug();
            this.display(paragraphData);
        }
    }
}

export default new ElfDebugEnzyme();
</pre>
<p>Place this code in a file called <strong>ElfDebugEnzyme.js</strong>. At the top of <strong>App.test.js</strong>, reference your new debug object:</p>
<pre>import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';
import {configure, shallow} from 'enzyme';
import Adapter from 'enzyme-adapter-react-16';
import elfDebugEnzyme from './ElfDebugEnzyme';
</pre>
<p><strong>NOTE</strong>: <em>Make sure you do not end up with two <strong>renders without crashing</strong> tests.</em></p>
<a class="anchor" id="the-tests"></a>
<h2>The Tests</h2>
<p>Beneath this code add a <strong>describe method</strong> and a new test:</p>
<pre>describe('rest basic tests', function() {    

    it('renders without crashing', () => {
        const div = document.createElement('div');
        ReactDOM.render(<App/>, div);
    });

    it('renders initial value of paragraph with state.nine', () => {
        const wrapper = shallow(<App/>);
        const nineSign = <p className="App-intro">file: unknown</p>;
        elfDebugEnzyme.getLast(wrapper, 'p', true);
        expect(wrapper.contains(nineSign)).toEqual(true);
    });

});
</pre>
<p>As you can see, this code looks very much like the <a href="https://jasmine.github.io/">Jasmine</a> test framework. The <strong>describe</strong> method is used to declare a suite of tests. Each individual test is defined inside an <strong>it</strong> method.</p>
<ul>
<li>The first parameter to <strong>it</strong> is a description of the test.</li>
<li>The second is callback, a test function, that defines the test.</li>
<li>There is an optional third timeout parameter that is rarely used.</li>
</ul>
<a class="anchor" id="call-server"></a>
<h2>Call Server</h2>
<p>Just as a reminder, here is the code for querying our server from our client. You should already have this code in your project in the file called <strong>src/App.js</strong>.</p>
<pre>bar = () => {
    const that = this;
    fetch('/api/foo')
        .then(function(response) {
            return response.json();
        })
        .then(function(json) {
            console.log('parsed json', json);
            that.setState(foo => (json));
        })
        .catch(function(ex) {
            console.log('parsing failed', ex);
        });
};
</pre>
<p>Note the formatting on the code shown above. Where you place your curly braces and how you indent your code are both very important.</p>
<a class="anchor" id="run-your-test"></a>
<h2>Run your test</h2>
<p>To run the tests, type the following:</p>
<pre>
npm test
</pre>

<p>The output should look something like this:</p>
<pre>  console.log src/ElfDebugEnzyme.js:4
    <p className="App-intro">
      file:
      unknown
    </p>

 PASS  src/App.test.js
  rest basic tests
    ✓ renders without crashing (3ms)
    ✓ renders initial value of paragraph with state.nine (2ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        0.266s, estimated 1s
Ran all test suites.

Watch Usage: Press w to show more.
</pre>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Put your work in a branch called <strong>Week03-RestTest</strong> and then Git <strong>tag</strong>. Then run Git <strong>add</strong>, <strong>push</strong> and <strong>commit</strong>.</p>
<p>It&#39;s simplest if you provide a link to the correct folder and branch on GitHub/BitBucket, or else detail what you are doing:</p>
<ul>
<li>Branch: <THE BRANCH WHERE YOU DID YOUR WORK></li>
<li>Directory: <THE DIRECTORY WHERE YOU DID YOUR WORK></li>
</ul>
<p>Oddly enough, the second technique where you specify the branch and folder is easiest for me, but they both are simple to use from my end.</p>
<a class="anchor" id="modern-tools"></a>
<h2>Modern Tools</h2>
<p>I stumbled across this project. Look at the tools used in building this application</p>
<ul>
<li><a href="https://github.com/clintonwoo/hackernews-react-graphql">HN Clone</a></li>
</ul>
<p>This is an interesting example of someone using a number of the latest technologies to build an application.</p>
<a class="anchor" id="polyfill-fix"></a>
<h2>PolyFill Fix</h2>
<p>You may see this error, which is a bug on <strong>react&#39;s</strong> side that will be fixed soon.</p>
<pre>console.error node_modules/fbjs/lib/warning.js:33
  Warning: React depends on requestAnimationFrame. Make sure that you load a polyfill in older browsers. http://fb.me/react-polyfills
</pre>
<p>In the meantime, if that is bothering you, to fix the error create a file called <strong>temp-poly-fills</strong> with the following content:</p>
<pre>const raf = global.requestAnimationFrame = (cb) => {
    setTimeout(cb, 0)
};

export default raf;
</pre>
<p>Then include it in your test:</p>
<pre>import './temp-poly-fills';
</pre>
<p>That should clean up the problem. When <strong>react16.01</strong> there should be a fix and this workaround should not be needed. See here:</p>
<ul>
<li><a href="https://github.com/facebookincubator/create-react-app/issues/3199">https://github.com/facebookincubator/create-react-app/issues/3199</a></li>
</ul>
</div></body></html>