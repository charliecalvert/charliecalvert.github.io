<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ElvenSiteOptions</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><!-- script(src="/libs/scripts/Control.js")--><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>ElvenSiteOptions</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#step-one-">Step One:</a></li>
<li><a href="#step-two-">Step Two:</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#elven-site-tools">Step Four</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>In Elven Site Options we will:</p>
<ul>
<li>Skip Syntax Highlighting</li>
<li>Make Webserver Dir Configurable and name to destination dir</li>
</ul>
<h2 id="step-one-">Step One:</h2>
<p>Create a branch called ElvenSiteOptions. Check it out:</p>
<pre><code><span class="hljs-symbol">git</span> <span class="hljs-keyword">branch </span>ElvenSiteOptions
<span class="hljs-symbol">git</span> checkout ElvenSiteOptions
</code></pre><p>Now copy Site Config to SiteOptions:</p>
<pre><code><span class="hljs-keyword">cp</span> -r Week05-ElvenSiteConfig Week06-ElvenSiteOptions
</code></pre><p>Open in WebStorm and change name (refactor) to <strong>Week06-ElvenSiteOptions</strong>.</p>
<p>In <strong>routes/index.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">res</span><span class="hljs-selector-class">.render</span>(<span class="hljs-string">'index'</span>, { <span class="hljs-attribute">title</span>: <span class="hljs-string">'Elven Site Options'</span> etc... })
</code></pre>
<h2 id="step-two-">Step Two:</h2>
<p>Track Destination Dirs:</p>
<pre><code>{
  "<span class="hljs-attr">calvert</span>": {
    "<span class="hljs-attr">base-dir</span>": <span class="hljs-string">"/home/charlie/"</span>,
    "<span class="hljs-attr">site-dirs</span>": [
      <span class="hljs-string">"Documents/AllTest"</span>,
      <span class="hljs-string">"Documents/AllSite"</span>
    ],
    "<span class="hljs-attr">destination-dirs</span>": [
          <span class="hljs-string">"/var/www/html/"</span>,
          <span class="hljs-string">"/home/charlie/temp/test-site/"</span>
    ]
  }
}
</code></pre><p>Now get the code in <strong>routes/index.js</strong>:</p>
<pre><code>router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/config'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{
  <span class="hljs-keyword">var</span> baseDir = config.<span class="hljs-keyword">get</span>(<span class="hljs-string">'base-dir'</span>);
  <span class="hljs-keyword">var</span> siteDirs = config.<span class="hljs-keyword">get</span>(<span class="hljs-string">'site-dirs'</span>);
  <span class="hljs-keyword">var</span> destinationDirs = config.<span class="hljs-keyword">get</span>(<span class="hljs-string">'destination-dirs'</span>);
  <span class="hljs-keyword">var</span> configSummary = { <span class="hljs-string">"baseDir"</span>: baseDir, <span class="hljs-string">'siteDirs'</span>: siteDirs, <span class="hljs-string">"destinationDirs"</span>: destinationDirs };
  console.log(<span class="hljs-string">"Config summary:"</span>, configSummary);
  response.send(configSummary);
});
</code></pre><h2 id="step-three">Step Three</h2>
<p>Do what needs to be done to show the destinations-dirs in a select on the client side.</p>
<p>Send the users destinationDir selection back to the server when the user choses walk. In doing so, on the client side, create a variable called <strong>requestQuery</strong> that equals a JavaScript object literal with two properties:</p>
<ul>
<li>directoryToWalk</li>
<li>destinationDir</li>
</ul>
<p>Pass <strong>requestQuery</strong> to your <strong>getJSON</strong> (or equivalent) call.</p>
<p>On the server side, capture both properties sent from the client. Send them on to our updated <strong>elven-site-tools</strong>, which is now at 1.0.2. This contains a breaking change. In <strong>routes/index.js</strong>, update the <strong>/walk</strong> route to look like this:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/walk'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'In walk'</span>, request.query);
  <span class="hljs-keyword">var</span> directoryToWalk = request.query.directoryToWalk;
  <span class="hljs-keyword">var</span> destinationDir = request.query.destinationDir;

  fs.access(directoryToWalk, fs.F_OK | fs.R_OK, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Could not find'</span>, directoryToWalk);
      response.sendStatus(<span class="hljs-number">401</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'start'</span>, request.query, directoryToWalk);
      walker.buildFileReport(directoryToWalk, <span class="hljs-string">'.md'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">report</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'build'</span>);
        <span class="hljs-keyword">var</span> directories = walker.getDirectories(report);
        <span class="hljs-keyword">try</span> {
          walker.makePage(directoryToWalk, destinationDir, directories, report, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">masterListOfNames, htmlFilesWritten</span>) </span>{
            response.send({
              result: <span class="hljs-string">'success'</span>,
              destinationDir: destinationDir,
              directories: directories,
              masterListOfNames: masterListOfNames,
              htmlFilesWritten: htmlFilesWritten
            });
          });
        } <span class="hljs-keyword">catch</span>(e) {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"The error:"</span>, e);
          <span class="hljs-comment">// response.sendStatus(500);</span>
          response.status(<span class="hljs-number">500</span>).send(e.toString());
        }
      });
    }
  });
});
</code></pre>
<h2 id="elven-site-tools">Step Four</h2>
<p>Something will have to be done about about the breaking change in <strong>elven-site-tools</strong>. By the time we reached version 1.0.2 the parameters passed to <strong>makePage</strong> had changed, as shown immediately above. The function now takes <strong>destinationDir</strong>.</p>
<p>The main reason for <strong>NpmAllInclusive</strong> was to save time during class. Saving disk space is also important, but not crucial. We now have two choices:</p>
<ul>
<li>Use a local <strong>node_modules</strong> directories for older versions of our program, and save the <em>all-inclusive ~/tmp/node_modules</em> directory for the one we need in class.</li>
<li>Manually switch our version of <strong>elven-site-tools</strong> in the <strong>~/tmp</strong> directory.</li>
</ul>
<p>It actually would not be hard to switch back and forth, since we are only changing one package. To get a specific version of a package do something like this: <strong>npm install elven-site-tools@1.0.2</strong>. Here <strong>@1.0.2</strong> is the version you want. So remove the old version with <strong>rm -r node_modules/elven-site-tools</strong>, and then install the one needed for your current project. You want 0.1.0 for earlier projects in this series. You want the latest, which right now is 1.0.2, for this project. Discussion area or in class for questions...</p>
<p>Let&#39;s talk for a moment about the case where you want a local version of <strong>node_modules</strong> rather than to link to the all-inclusive one <strong>~/tmp</strong>. When we want a local version of <strong>node_modules</strong> we simply specify the version of <strong>elven-site-tools</strong> that we want in <strong>package.json</strong>. For instance, if placed in <strong>package.json</strong>, the first example below will install 0.1.0, while the second installs 1.0.2:</p>
<pre><code><span class="hljs-string">"elven-site-tools"</span>: <span class="hljs-string">"0.1.0"</span>,
<span class="hljs-string">"elven-site-tools"</span>: <span class="hljs-string">"1.0.2"</span>,
</code></pre><p>Pick one or the other for your package.json depending on your needs.</p>
<ul>
<li>ElvenSiteConfig: Use 0.1.0</li>
<li>ElvenSiteOptions: Use 1.0.2</li>
</ul>
<p>This would make it fairly easy for us to track the right version of the <strong>elven-site-tools</strong> in our project under normal circumstances. But NpmAllInclusive complicates things a bit. We should still put something like the above in the <strong>package.json</strong> file for our project. But in the <strong>~/tmp</strong> directory, we want to run one of the following commands, depending on our needs:</p>
<pre><code>npm install elven-site-tools<span class="hljs-symbol">@0</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>
npm install elven-site-tools<span class="hljs-symbol">@1</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>
</code></pre><p>The first is for <strong>ElvenSiteConfig</strong> or earlier, the second for <strong>ElvenSiteOptions</strong> or later. Check your work like this:</p>
<pre><code>cat ~<span class="hljs-regexp">/tmp/</span>node_modules<span class="hljs-regexp">/elven-site-tools/</span><span class="hljs-keyword">package</span>.json
</code></pre><p>If all else fails, delete the package manually, then reinstall it:</p>
<pre><code><span class="hljs-keyword">rm</span> -r ~/tmp/node_modules/elven-site-tools
<span class="hljs-keyword">cd</span> ~/tmp
npm install elven-site-tools@1.0.2
<span class="hljs-keyword">cd</span> -
</code></pre><p>The last command switches you back to the directory you were in before you navigated to the <strong>~/tmp</strong> directory.</p>
<h2 id="turn-it-in">Turn it in</h2>
<p>Push your repository, submit your the assignment.</p>
</div></body></html>