<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>PythonMySqlJsonMarkdown</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>PythonMySqlJsonMarkdown</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#some-notes">Some notes</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#mysql">MySQL</a></li>
<li><a href="#python-script">Python Script</a></li>
<li><a href="#show-data">Show Data</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#optional-setup-cgi-dir">Optional Setup cgi dir</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>Python MySql Json Markdown</p>
<ul>
<li>Set up Apache Python CGI scripts</li>
<li>Set up MySQL database and table</li>
<li>Use a python script to insert data in the database</li>
<li>Access the data from one of your MakeHtml markdown files</li>
</ul>
<h2 id="some-notes">Some notes</h2>
<p>CGI files are server (for now), from:</p>
<ul>
<li>/usr/lib/cgi-bin</li>
</ul>
<p>They will be owned by root, so use sudo as needed.</p>
<p>You will not need them, but the configuration files for Apache are here:</p>
<ul>
<li>/etc/apache2</li>
</ul>
<h2 id="step-one">Step One</h2>
<p>Check to ensure Lamp and MySQL are installed. You know how to do this already.</p>
<p>Check the status of Apache CGI. Specifically, you will probably need to turn on CGI in order to access python server side scripts from your HTML code:</p>
<pre><code><span class="hljs-attribute">sudo</span> a2enmod cgi
</code></pre><p>This command will return one of two values:</p>
<ol>
<li>Enabling module cgi</li>
<li>Module cgi already enabled</li>
</ol>
<p>If you get the first response, then do this:</p>
<pre><code><span class="hljs-attribute">service</span> apache2 restart
</code></pre><p>On EC2, I needed to use sudo:</p>
<pre><code><span class="hljs-attribute">sudo</span> service apache2 restart
</code></pre><p>Once CGI is enabled, then it should stay enabled. You normally don&#39;t need to repeat this operation.</p>
<p>Install pip3 and pymysql. We will want these to access MySQL from a Python script:</p>
<pre><code>sudo apt-get <span class="hljs-keyword">install</span> python3-pip
sudo pip3 <span class="hljs-keyword">install</span> pymysql
</code></pre><p>And this might be useful later:</p>
<pre><code>sudo python3 -m pip <span class="hljs-keyword">install</span> pymongo
</code></pre><p>Again, you need only pip and pymsql once. Once they are installed, they should stay installed.</p>
<h2 id="step-two">Step Two</h2>
<p>Create a simple test script to make sure Python CGI is working.</p>
<p>Create a simple python test script in <strong>/usr/lig/cgi-bin</strong>. Open a blank file called <strong>simple.py</strong> in the <strong>cgi</strong> directory with the <strong>nano</strong> editor.</p>
<pre><code>sudo nano /usr/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">cgi</span>-<span class="hljs-title">bin</span>/<span class="hljs-title">simple</span>.<span class="hljs-title">py</span></span>
</code></pre><p>Files with a <strong>.py</strong> are python scripts.</p>
<p>Paste this python script into the editor:</p>
<pre><code class="lang-python"><span class="hljs-comment">#!/usr/bin/env python3</span>

<span class="hljs-keyword">import</span> cgi
<span class="hljs-keyword">import</span> cgitb
cgitb.enable()  <span class="hljs-comment"># debug</span>

print(<span class="hljs-string">"Content-type: text/html;charset=utf-8"</span>)
print()

print(<span class="hljs-string">"""
&lt;html&gt;

&lt;head&gt;&lt;title&gt;Prog270 CGI Script&lt;/title&gt;&lt;/head&gt;

&lt;body&gt;

  &lt;h1&gt; This is the Header &lt;/h1&gt;

&lt;/body&gt;

&lt;/html&gt;
"""</span>)
</code></pre>
<p>Set executable permissions on the script:</p>
<pre><code>sudo chmod <span class="hljs-number">755</span> /usr/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">cgi</span>-<span class="hljs-title">bin</span>/<span class="hljs-title">simple</span>.<span class="hljs-title">py</span></span>
</code></pre><p>Test the script by going to this url:</p>
<ul>
<li><a href="http://localhost/cgi-bin/simple.py">http://localhost/cgi-bin/simple.py</a></li>
</ul>
<h2 id="mysql">MySQL</h2>
<p>Start my SQL. You will prompted for the password you entered when you installed lamp:</p>
<pre><code><span class="hljs-attribute">mysql</span> -u root -p
</code></pre><p>If you lost your password see the first link below. The second is an FYI:</p>
<ul>
<li><a href="https://help.ubuntu.com/community/MysqlPasswordReset">https://help.ubuntu.com/community/MysqlPasswordReset</a></li>
<li><a href="https://help.ubuntu.com/lts/serverguide/mysql.html">Server Guide</a></li>
<li><a href="http://www.elvenware.com/charlie/development/database/mysql/linux-user-password.html">Elvenware Passwords</a></li>
</ul>
<p>Once you have loaded the mysql client, create a database called <strong>prog270</strong>:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> prog270;
<span class="hljs-keyword">use</span> prog270;
</code></pre>
<p>More info is found here:</p>
<ul>
<li><a href="http://www.elvenware.com/charlie/development/database/mysql/MySql.html#createdatabase">Elvenware, Create Database</a></li>
</ul>
<p>Create a simple table:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> presidents (<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT, <span class="hljs-keyword">first</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">128</span>), <span class="hljs-keyword">last</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">128</span>), PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-keyword">id</span>));
</code></pre>
<p>Insert some data in the table:</p>
<pre><code class="lang-sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> presidents (<span class="hljs-keyword">first</span>, <span class="hljs-keyword">last</span>) <span class="hljs-keyword">values</span> (<span class="hljs-string">'George'</span>, <span class="hljs-string">'Washington'</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> presidents (<span class="hljs-keyword">first</span>, <span class="hljs-keyword">last</span>) <span class="hljs-keyword">values</span> (<span class="hljs-string">'John'</span>, <span class="hljs-string">'Adams'</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> presidents (<span class="hljs-keyword">first</span>, <span class="hljs-keyword">last</span>) <span class="hljs-keyword">values</span> (<span class="hljs-string">'Thomas'</span>, <span class="hljs-string">'Jefferson'</span>);
</code></pre>
<p>Make sure that life is good:</p>
<pre><code class="lang-sql">select * from presidents;
<span class="hljs-section">mysql&gt; select * from presidents;
+----+--------+------------+</span>
<span class="hljs-section">| id | first  | last       |
+----+--------+------------+</span>
|  1 | George | Washington |
|  2 | John   | Adams      |
<span class="hljs-section">|  3 | Thomas | Jefferson  |
+----+--------+------------+</span>
3 rows in set (0.00 sec)
</code></pre>
<p>Type the following to exit mysql:</p>
<pre><code><span class="hljs-keyword">exit</span>;
</code></pre><h2 id="python-script">Python Script</h2>
<p>Put this in &#39;/usr/lib/cgi-bin&#39; as <strong>get-presidents.py</strong>:</p>
<pre><code class="lang-python">#! /usr/bin/<span class="hljs-keyword">python3</span>

import cgitb
cgitb.enable()

import pymysql
import json

<span class="hljs-keyword">print</span>(<span class="hljs-string">"Content-Type: text/json"</span>)
<span class="hljs-keyword">print</span>()

conn = pymysql.connect(host=<span class="hljs-string">'localhost'</span>, user=<span class="hljs-string">'root'</span>, passwd=<span class="hljs-string">'foobar'</span>, db=<span class="hljs-string">'prog270'</span>)

<span class="hljs-built_in">cursor</span> = conn.<span class="hljs-built_in">cursor</span>()

<span class="hljs-built_in">cursor</span>.<span class="hljs-keyword">execute</span>(<span class="hljs-string">"SELECT * FROM presidents"</span>)

rows = <span class="hljs-built_in">cursor</span>.fetchall()

<span class="hljs-keyword">print</span>(json.dumps(rows));

<span class="hljs-built_in">cursor</span>.<span class="hljs-keyword">close</span>()
conn.<span class="hljs-keyword">close</span>()
</code></pre>
<p>You might want to use this command:</p>
<pre><code>sudo nano /usr/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">cgi</span>-<span class="hljs-title">bin</span>/<span class="hljs-title">get</span>-<span class="hljs-title">presidents</span>.<span class="hljs-title">py</span></span>
</code></pre><p>When you are done:</p>
<pre><code>sudo chmod <span class="hljs-number">755</span> /usr/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">cgi</span>-<span class="hljs-title">bin</span>/<span class="hljs-title">get</span>-<span class="hljs-title">presidents</span>.<span class="hljs-title">py</span></span>
</code></pre><h2 id="show-data">Show Data</h2>
<p>Paste some HTML into a markdown file called <strong>AllTest/presidents.md</strong>:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getPresidents"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span> Get Presidents <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'bar'</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>Open up <strong>/var/www/html/js/elven-help.js</strong> and edit it until you get something like the following:</p>
<pre><code class="lang-javascript">$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    $(<span class="hljs-string">'table'</span>).addClass(<span class="hljs-string">'table table-striped table-hover'</span>);

    $(<span class="hljs-string">'#getPresidents'</span>).click(getPresidents);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPresidents</span>(<span class="hljs-params"></span>) </span>{
        $.getJSON(<span class="hljs-string">'/cgi-bin/get-presidents.py'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">presidents</span>) </span>{
            presidents.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">president</span>) </span>{
                $(<span class="hljs-string">'#bar'</span>).append(<span class="hljs-string">'&lt;li&gt;'</span> + president[<span class="hljs-number">1</span>] + <span class="hljs-string">' '</span> + president[<span class="hljs-number">2</span>] + <span class="hljs-string">'&lt;/li&gt;'</span>);
            });
        })
    }
});
</code></pre>
<h2 id="turn-it-in">Turn it in</h2>
<p>Copy any new markdown, including <strong>presidents.md</strong> into your repository. It should end up in your <strong>prog270-lastname-2016/AllTest</strong> directory.</p>
<p>Copy the updated <strong>elven-help.js</strong> file and any other updated files into your <strong>prog270-lastname-2016/ApacheHelpers</strong> directory or subdirectories.</p>
<p><strong>NOTE</strong>: <em>You should be using the scripts from <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/ApacheHtml.html#apache-helpers">ApacheHtml</a> assignment to aid with this process.</em></p>
<p>Push your repository. Switch to EC2, pull your repository, copy the new files out to <strong>~/Documents/AllTest</strong> and <strong>/var/www/html</strong> or their subdirectories, as appropriate.</p>
<p>On EC2, complete the steps found above in the <a href="#MySQL">MYSQL</a> section.</p>
<p>Run MakeHtml. Take screenshots of your page running both on localhost and on EC2. Put them in our shared Google Drive folder in a folder called <strong>PythonMySQlJson</strong>.</p>
<p>On the text page of Canvas, include live links to your page on EC2 and to your new Google Drive folder. Don&#39;t put the links in a comment. I want to be able to click them and be taken directly to your work.</p>
<h2 id="optional-setup-cgi-dir">Optional Setup cgi dir</h2>
<p>THIS SECTION IS NOT YET COMPLETE. IGNORE IT FOR NOW.</p>
<p>Make sure CGI is turned on:</p>
<pre><code><span class="hljs-keyword">cd</span> /<span class="hljs-keyword">var</span>/www
sudo <span class="hljs-keyword">mkdir</span> cgi
sudo chown -R bcuser:bcuser cgi
</code></pre><p>Create a simple python test script in <strong>/var/www/cgi</strong>. Open a blank file called <strong>simple.py</strong> in the <strong>cgi</strong> directory. Files with a <strong>.py</strong> are python scripts.</p>
<pre><code><span class="hljs-keyword">cd</span> /<span class="hljs-keyword">var</span>/www/cgi
nano simple.py
</code></pre></div></body></html>