<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>WebCraftsMoreReact</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>WebCraftsMoreReact</h1><p>Welcome to WebCraftsMoreReact</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#git-ignore">Git Ignore</a></li>
<li><a href="#bugs">Bugs</a></li>
<li><a href="#config-wrong">Bugs: The Case of the Wrong Config File</a></li>
<li><a href="#missing-markdown">Bug: The Case of the Missing Markdown</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>Additional hints on getting WebCraft converted to React.</p>
<a class="anchor" id="git-ignore"></a>
<h2>Git Ignore</h2>
<p>If you haven&#39;t done so already, add add two items to your <strong>.gitignore file</strong>:</p>
<pre>bundle.js
bundle.js.map
</pre>
<p>These can both be big files, and care easily reproduced from existing source, so there is no need to check them in. If you are checking them in at this time, remove them with code like these:</p>
<pre>git rm public/javascripts/bundle.js
git rm public/javascripts/bundle.js.map
</pre>
<a class="anchor" id="bugs"></a>
<h2>Bugs</h2>
<p>There are two bugs in <strong>isit-site-tools</strong> that need to be fixed. The simplest way to get the fix is to merge in the code from the upstream repository that you forked earlier. I ran the following from the root of <strong>isit-site-tools</strong>:</p>
<pre><code>git pull git<span class="hljs-meta">@github</span>.<span class="hljs-string">com:</span>charliecalvert/isit-site-tools.git
</code></pre><p>To my surprise, this did not cause the require statements that we inserted with the <strong>find</strong> and <strong>sed</strong> commands to be changed back to their original values.</p>
<p>Please also see this: which would probably simplify the process, but I have not tried it yet:</p>
<ul>
<li><a href="https://gist.github.com/CristinaSolana/1885435">https://gist.github.com/CristinaSolana/1885435</a></li>
</ul>
<p>Below I describe the changes in detail, but you should not actually have to do anything, since the merge described above made the necessary changes.</p>
<a class="anchor" id="config-wrong"></a>
<h2>Bugs: The Case of the Wrong Config File</h2>
<p>Please read the section called <a href="#bugs">Bugs</a> before reading more.</p>
<p><strong>Isit-Site-Tools</strong> has a file a bug in it. It is currently found here:</p>
<p>  /markdown-to-html/runners/sample-runner.js</p>
<p>The file is meant to show how to use <strong>isit-site-tools</strong>. Unfortunately, I&#39;m currently using it as an entry point into the <strong>isit-site-tools</strong> library.</p>
<p><strong>isit-site-tools</strong> can be configured to use either the local version of the configuration file, or a remote version. By default, it uses the local version. This is not what we want in this case. So we need to explicitly ask it to use the remote version. Here is the fix, which involves passing in a variable called <strong>useLocalConfig</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runConfig</span>(<span class="hljs-params">user, siteDirsOffset, useLocalConfig</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> useLocalConfig !== <span class="hljs-string">'undefined'</span>) {
            config.useLocalConfig = useLocalConfig;
        }
        config.loadAsync()
            .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">configuration</span>) </span>{
                createMarkdown(configuration[user], siteDirsOffset)
                    .then(resolve);
            })
            .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">throw</span> err
            })
    });
}
</code></pre>
<p>In <strong>isit-web-crafts</strong> the method is called from here:</p>
<pre><code>routes/makers.js
</code></pre><p>The new call looks like this, where the important change is in the third parameter to <strong>walkRunner</strong>:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/walk'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{    
    walkRunner(<span class="hljs-string">'calvert'</span>, request.query.siteDirsIndex, <span class="hljs-keyword">false</span>)
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(report)</span> </span>{
            response.send(report);
        })
        .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
            <span class="hljs-keyword">throw</span> err;
        });
});
</code></pre>
<a class="anchor" id="missing-markdown"></a>
<h2>Bug: The Case of the Missing Markdown</h2>
<p>Please read the section called <a href="#bugs">Bugs</a> before reading more.</p>
<p>The <strong>WebCrafts</strong> program looks in the directory it is configered to look in for Markdown files. The directory is specified in the <strong>ElvenConfig.js</strong> file. If it finds Markdown files, it converts them to HTML. If it finds a directory contains no Markdown files that have changed since the <strong>most-recent-date</strong> sepecified in the config file, then it blows up.</p>
<p>The problem is in a file called:</p>
<pre><code>markdown-<span class="hljs-keyword">to</span>-html/<span class="hljs-keyword">private</span>/walker.js
</code></pre><p>Here is the fix to the <strong>walker.makePage</strong> from that file:</p>
<pre><code class="lang-javascript">walker.makePage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">details, callback</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    details.callback = callback;
    makePage.init();

    <span class="hljs-comment">// if we found nothing then return nothing</span>
    <span class="hljs-keyword">if</span> (details.directories.length === <span class="hljs-number">0</span>) {
        callback([],[])
    } <span class="hljs-keyword">else</span> {
        details.directories.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">directory, index</span>) </span>{
            makePage.run(directory, index, details);
        });
    }
};
</code></pre>
<p>The key change is the line that looks for an empty directories property and return to emtpy arrays if it is found. Otherwise, the <strong>details.directories</strong> object is iterated with <strong>forEach</strong> and the markdown found in the directories is converted to HTML. The code called by <strong>makePage.run</strong> note only performs the conversion, but also returns an object with detailed information about which files were converted. That object is then passed to our client so that the user can see what the the program did.</p>
</div></body></html>