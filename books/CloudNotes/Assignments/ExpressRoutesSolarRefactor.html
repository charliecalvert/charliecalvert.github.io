<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ExpressRoutesSolarRefactor</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><!-- script(src="/libs/scripts/Control.js")--><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>ExpressRoutesSolarRefactor</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#renewables-rename">Rename Renewables</a></li>
<li><a href="#client-side-renewables">Move Client Side Rewewables</a></li>
<li><a href="#home">Create Home</a></li><!--TOC_End--></ul><h2 id="renewables-rename">Rename Renewables</h2>
<p>We have created a lot of files, and it is time to start organizing them. Let&#39;s create some subfolders and move our work into them.</p>
<p>Create a <strong>views/renewables/</strong> folder and move (<strong>git mv</strong>) our renewable files into it:</p>
<pre>
$ ls -la
total 20
drwxrwxr-x 2 charlie charlie 4096 May 22 09:41 .
drwxrwxr-x 3 charlie charlie 4096 May 22 09:41 ..
-rw-rw-r-- 1 charlie charlie  256 May 19 19:33 renewable-by-index.jade
-rw-rw-r-- 1 charlie charlie  257 May 19 19:39 renewable-by-year.jade
-rw-rw-r-- 1 charlie charlie 2217 May 21 10:35 renewable-page.jade
charlie@rohan-elf:~/Git/prog272-calvert-2016/SolarVoyager/views/renewables
</pre>

<p>In <strong>routes/index.js</strong> create a new route for handling renewable calls in their own folder:</p>
<pre><code class="lang-javascript">router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/renewables/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{
    console.log(<span class="hljs-string">'renewables page called'</span>);
    response.render(<span class="hljs-string">'renewables/'</span> + request.params.id, { title: <span class="hljs-string">'ElfComponent'</span> });
});
</code></pre>
<p>This code says that instead of looking for <strong>renewable-page.jade</strong> or <strong>renewable-by-index.jade</strong> in the <strong>views</strong> folder, we should look for them in the <strong>views/renewables folder</strong>.</p>
<p>Finally, we have to change our requests on the client side so they look for files in the right place:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> renewablesByYear = {
    color: <span class="hljs-string">"red"</span>,
    size: <span class="hljs-string">"big"</span>,
    init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(renewablesByYear.color);
        $(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'/renewables/renewable-by-year'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</code></pre>
<p>This code says that the <strong>init</strong> method should load the jade file called <strong>renewables/renewable-by-year.jade</strong>. Before we make the change the last line looked like this:</p>
<pre><code class="lang-javascript">$(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'renewable-by-year'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ ... })
</code></pre>
<p>This old, obsolete, code loaded <strong>renewable-by-year.jade</strong> from the <strong>views folder</strong>. We don&#39;t want to do that anymore. Now we want to load it from the <strong>views/renewables/renewable-by-year.jade</strong> folder.</p>
<p><strong>NOTE</strong>: <em>Express doesn&#39;t ask us to specify the <strong>views</strong> folder in the above code because of this statement found around line 14 in <strong>app.js</strong>: </em></p>
<pre><code class="lang-javascript">app.<span class="hljs-keyword">set</span>(<span class="hljs-string">'views'</span>, path.<span class="hljs-keyword">join</span>(__dirname, <span class="hljs-string">'views'</span>));
</code></pre>
<p><em>That code tells express where to look for our jade files. Specifically, it says look in the <strong>views</strong> folder. Hence we can <strong>response.render(&#39;renewables/&#39; + request.params.id, { title: &#39;ElfComponent&#39; });</strong> rather than <strong>response.render(&#39;views/renewables/&#39; + request.params.id, { title: &#39;ElfComponent&#39; });</strong>. The views folder is searched by default, so we don&#39;t need to specify it.</em></p>
<h2 id="client-side-renewables">Move Client Side Rewewables</h2>
<p>I did it with these commands, starting from the root of my project:</p>
<pre>
cd public/javascripts
mkdir renewables
git mv renewables.js renewables/.
git mv renewables-* renewables/.
</pre>

<p>I spell this out because having a file called <strong>renewables.js</strong> that you want to move into a folder called <strong>renewables</strong> can be a bit tricky when using wildcards. Specifically, this call did not work because I was, unintentionally, asking git to move a folder into itself:</p>
<pre>
git mv renewables* renewables/.
</pre>

<p>So I moved the files in two steps, as shown in the third and fourth lines above.</p>
<p>The result looks like this when I ask for a listing of <strong>public/javascripts/renewables</strong>:</p>
<pre>
$ ls -la
total 20
drwxrwxr-x 2 charlie charlie 4096 May 22 10:04 .
drwxrwxr-x 3 charlie charlie 4096 May 22 10:04 ..
-rw-rw-r-- 1 charlie charlie 1328 May 22 09:43 renewables-index.js
-rw-rw-r-- 1 charlie charlie 2923 May 22 09:42 renewables.js
-rw-rw-r-- 1 charlie charlie 1311 May 22 09:43 renewables-year.js
</pre>

<p>You will now also have to make some changes in <strong>main.js</strong>, around lines 12 through 14. You need, of course, to set up the new paths, which I leave as an exercise for the reader.</p>
<p><strong>NOTE</strong>: <em>Hopefully you have been doing so all along, but if you have not, stop now and test your work. Make sure all is well before you move on. If you are following along in class, and don&#39;t have time to test everything, then do so when you get home. If necessary comment out code, or turn to the bash shell and developer tools <strong>network</strong> page and make sure everything is acting you expect. Clearly these changes to the location of the renewables files must be working before you can debug related portions of your code.</em></p>
<h2 id="home">Create Home</h2>
<p>Rename work.js to home.js. Rename all associated buttons, menus, variables and files. To help you find all instances of these variables, try these command from the root of the project folder:</p>
<pre>
elfgrepcomps work
grep -r --include=\*.jade work
</pre>

<p><strong>NOTE</strong>: <em>The <strong>elfgrepcomps</strong> command is from JsObjects, but should be symbolically linked from your <strong>bin</strong> folder, and hence on your path.</em></p>
<p>If you trust them, there are also often search and replace across a project options in developer IDEs.</p>
</div></body></html>