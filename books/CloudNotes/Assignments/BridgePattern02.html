<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>BridgePattern02</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>BridgePattern02</h1><p>Welcome to BridgePattern02</p><ul><!--TOC_Start--><li><a href="#links">Links</a></li><!--TOC_End--></ul></div><div class="container"><p>#BridgePattern Part 02</p>
<p>We are pushing toward the midterm now. This is not the midterm, but
the code you are building now will be part of the midterm.</p>
<p>You should begin by building on top of your previous assignment. To
distinguish between the work you did on BridgePattern01 assignment
and the work you do in this assignment, you should create a git 
tag:</p>
<ul>
<li>Details later, but it is something like</li>
<li>git tag v.0.0.1 -m &quot;BridgeReader Version 01&quot;</li>
<li>git push v.0.0.1</li>
</ul>
<p>That will tag your current version of BridgeReader as version 1. You and
I can both go back to this version when we want.</p>
<p>You will again use three patterns in this assignment:</p>
<ul>
<li>Factory</li>
<li>Bridge</li>
<li>Decorator</li>
</ul>
<p>We also use require and jasmine to test everything.</p>
<p>Base your code on on two or more of the following programs:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/Design/BridgeSailor">JsObjects/JavaScript/Design/BridgeSailor</a></li>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/Design/FactorySimple01">JsObjects/JavaScript/Design/FactorySimple01</a></li>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/Design/FactoryInterface">JsObjects/JavaScript/Design/FactoryInterface</a></li>
</ul>
<p>Create a <strong>DataReader</strong> object that can:</p>
<ul>
<li>Read real JSON bjects and display them properly</li>
<li>Reading Markdown files and mock displaying them properly in a markdown editor such as <a href="https://code.google.com/p/pagedown/">pagedown</a>.</li>
<li>Both should be able to tell the type of document it handles: JSON or Markdown.</li>
</ul>
<p>Continue using the Factory and Bridge patterns as before. For now, you
can mock up displaying the markdown files, or actually display them
in pagedown, depending on your preference. For the midterm, you will
need to display it in a markdown editor called pagedown.</p>
<p>This time, I want everything but Factory in a pattern of some kind. In
Main.js, just read in Factory, and then use the Factory to &quot;create&quot; (or
pass on) all the other objects. Everything is a pattern. We are working
only with abstractions for our major classes. </p>
<p>##Clickable List</p>
<p>Read in a list of filenames stored in JSON format from a file called
<strong>FileList.json</strong>. It should look something like this, but the 
details are up to you:</p>
<pre><code>{
    <span class="hljs-attr">"Foo.json"</span>: <span class="hljs-string">"/home/bcuser/files/Foo.json"</span>,
    <span class="hljs-attr">"Bar.json"</span>: <span class="hljs-string">"/home/bcuser/files/Bar.json"</span>,
    <span class="hljs-attr">"Goober.json"</span>: <span class="hljs-string">"/home/bcuser/files/Goober.json"</span>,
    <span class="hljs-attr">"Baz.json"</span>: <span class="hljs-string">"/home/bcuser/files/Baz.json"</span>
}
</code></pre><p>Or what have you. Display the items in an unordered list and/or a
series of radiobuttons. See Presidents.json for additional information
on how to handle the auto generation of radiobuttons.</p>
<p>If you want, you can gussy up an unordered list with a few lines of CSS:</p>
<pre><code><span class="hljs-selector-tag">li</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#00BBFF</span>;
  <span class="hljs-attribute">border</span>: black solid <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">3px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">250px</span>;  
}

<span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#00FFBB</span>;
}
</code></pre><p>The CSS shown above puts each item in a list in its own block, and it highlights each item in turn as the user moves the mouse over it.</p>
<p>When the user clicks on a particular file name, read it in and display 
its contents to the user. You can use the Presidents.json file from
BridgeReader01 as the basis for your Foo.json and Bar.json files, but
each file must have unique content.</p>
<p>You cam read FileList.json in directly, but for the other files, you
must send the file name and path, have the server get it from request.query 
or request.body, then read it in with fs.readFile (asynch version) and
send it back via response.send.</p>
<p>##Property Names</p>
<p>Just a reminder. There are no rules about the names for properties in JavaScript. Thus we can create properties shaped like this:</p>
<pre><code><span class="hljs-string">"Foo.json"</span>: <span class="hljs-string">"/home/bcuser/files/Foo.json"</span>,
</code></pre><p>Note, however, that you can&#39;t write this to access the value for the property shown above: </p>
<pre><code>myJsonObject<span class="hljs-selector-class">.Foo</span><span class="hljs-selector-class">.json</span> 
</code></pre><p>Think about it for a second, and you can see why. (The second period is going to cause problems!)</p>
<p>You can, however, do this:</p>
<pre><code>myJsonObject[<span class="hljs-string">'Foo.json'</span>]; <span class="hljs-regexp">//</span> Yields home<span class="hljs-regexp">/bcuser/</span>files<span class="hljs-regexp">/Foo.json</span>
</code></pre><p>##User Choice</p>
<p>When the user clicks on an item in our unordered list, we want to send a request back to the server based on the selection the user made. In particular, they click on a file name, and then send a request back to the server for the contents of the file the user selected.</p>
<p>Ideally, it is safest to keep all the information about filepaths on the server side, and never send it to the client. However, at this stage, it is probably okay for us to cheat. Here is a hurried explanation of how to keep track of two bits of information in a single list item.</p>
<p>The file list that we read in has two bits of information per line:</p>
<pre><code><span class="hljs-string">"Foo.json"</span>: <span class="hljs-string">"/home/bcuser/files/Foo.json"</span>,
</code></pre><p>There is a file name: <strong>Foo.json</strong>. There is also the path to the file: <strong>/home/bcuser/files/Foo.json</strong>. Here is how to encode both pieces of information in a list item:</p>
<pre><code>$.getJSON(<span class="hljs-string">'/read'</span>, fileObject, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileList</span>) </span>{
    <span class="hljs-keyword">var</span> serverData = fileList;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> file <span class="hljs-keyword">in</span> serverData) {
        $(<span class="hljs-string">'#displayList'</span>).append(<span class="hljs-string">'&lt;li data='</span> + serverData[file] + <span class="hljs-string">'&gt;'</span> + file + <span class="hljs-string">'&lt;/li&gt;'</span>);
    }
}).error(<span class="hljs-function"><span class="hljs-keyword">function</span>....</span>
</code></pre><p>Now the list items in your unordered list look like this:</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">data</span>=<span class="hljs-string">"/home/charlie/Documents/Data/Presidents01.json"</span>&gt;</span>President01.json<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</code></pre><p>When the user clicks on the items, you can retrieve the data like this:</p>
<pre><code><span class="hljs-function">function <span class="hljs-title">pickFile</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>) </span>{
    <span class="hljs-keyword">var</span> fileName = <span class="hljs-keyword">event</span>.target.innerHTML;  <span class="hljs-comment">// Was innerText</span>
    <span class="hljs-keyword">var</span> filePathName = <span class="hljs-keyword">event</span>.target.attributes.data.<span class="hljs-keyword">value</span>;
}

$(<span class="hljs-string">"#displayList"</span>).click(pickFile);
</code></pre><p>##Handling User Input</p>
<p>It is perhaps saying a word about what to do when the user clicks on a <strong>listitem</strong> to make a file selection. The best example of what you want to do is in <a href="https://github.com/charliecalvert/JsObjects/tree/master/HtmlCssJavascript/ClickEvents">ClickEvents</a>.</p>
<p>When you respond to a click on a <strong>listItem</strong>, you want to call <strong>\$.getJSON.</strong></p>
<pre><code>$(listItem).click(listClick);

... <span class="hljs-comment">// Code omitted here</span>

<span class="hljs-keyword">var</span> listClick = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{ 
   <span class="hljs-comment">// Your getJSON code here.</span>
};
</code></pre><p>The user clicks on a <strong>listItem</strong> and invokes the click handler shown above. Use .getJSON to invoke a route on the server and to send a simple JavaScript object to the server specifying the user&#39;s choice. Assuming you saved the path to the file in an attribute called data, as recommended above, you can get the user&#39;s choice like this:</p>
<pre><code>$(<span class="hljs-string">'#debug01'</span>).html(<span class="hljs-string">"You picked: "</span> + <span class="hljs-keyword">event</span>.target.innerHTML) <span class="hljs-comment">// innerText</span>
$(<span class="hljs-string">'#debug02'</span>).html(<span class="hljs-string">"Value: "</span> + <span class="hljs-keyword">event</span>.target.attributes.data.value);
</code></pre><p>The server gets the call and uses <strong>request.query</strong> to discover the file the user requested. Use <strong>fs.readFile</strong> to read the file from disk. Use response.send to send the contents of the file back to the client. There are many examples of how to do this sort of thing in JsObjects, including <a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/UnitTests/AsyncJsonReader">AsyncJsonReader</a>.</p>
<p>Parse the content of the file sent from the server. It is sent as a parameter to your \$.getJSON callback. The callback is an anonymous function passed as the second parameter to \$.getJSON.
Display the parsed content to the user</p>
<p>##Test and run</p>
<p>To start the app I should be able to run:</p>
<pre><code><span class="hljs-built_in">npm</span> start
</code></pre><p>To start the tests, I should be able to run:</p>
<pre><code><span class="hljs-keyword">node</span> <span class="hljs-title">TestRunner</span>.js
</code></pre><p>You must have at least 25 tests, no matter how trivial. For instance write tests that prove you can:</p>
<ol>
<li>Use require to reach your ReaderFactory</li>
<li>Use require to reach your BridgeFactory</li>
<li>Use require to reach your BridgeReader</li>
<li>Use require to reach your FancyBridgeReader</li>
<li>Use require to reach your JsonReader</li>
<li>Use require to reach your MarkdownReader</li>
<li>Use require to reach your DefaultReader</li>
<li>Create a ReaderFactory</li>
<li>Create a BridgeFactory</li>
<li>Create a BridgeReader</li>
<li>Create a FancyBridgeReader</li>
<li>Create a JsonReader </li>
<li>create a MarkdownReader</li>
<li>create a DefaultReader</li>
<li>Use a factory to create a JsonReader and prove it is a JsonReader: <ol>
<li>expect(jsonReader instanceof JsonReader).toBe(true);</li>
</ol>
</li>
<li>Create a MarkdownReader with a factory and prove it is a MarkdownReader</li>
<li>Prove the DefaultReader with a factory and prove it is a DefaultReader</li>
<li>Use hasOwnProperty to prove a jsonReader has a <strong>readFile</strong> method</li>
<li>Use hasOwnProperty to prove a markdownReader has a <strong>readFile</strong> method</li>
<li>Use hasOwnProperty to prove a defaultReader has a <strong>readFile</strong> method</li>
</ol>
<p>If you can, when you type <strong>grunt jshint</strong>, I want it to come back clean.</p>
<p>##Markdown</p>
<p>You can place a markdown file such as this one in your public directory. Call it <strong>MarkdownSample.md</strong>:</p>
<pre><code><span class="hljs-section"># Markdown Sample Header</span>

This is a sample markdown file. You can make lists like this:

<span class="hljs-bullet">- </span>One
<span class="hljs-bullet">- </span>Two
<span class="hljs-bullet">- </span>Three

<span class="hljs-section">## Details</span>

Try pasting the contents of this file into this editor:

<span class="hljs-bullet">- </span>[<span class="hljs-string">StackEditIO</span>](<span class="hljs-link">https://stackedit.io/</span>)

That's the editor found at <span class="hljs-strong">**https://Stackedit.io**</span>
</code></pre><p>Then use Jade to create a <strong>pre</strong> in which you can display it:</p>
<pre><code><span class="hljs-keyword">div</span>
    pre<span class="hljs-comment">#markdown</span>
</code></pre><p>And display it like this:</p>
<pre><code><span class="hljs-meta">$</span><span class="bash">(<span class="hljs-string">"#markdown"</span>).load(<span class="hljs-string">"MarkdownSample.md"</span>);</span>
</code></pre><p>\$.load is a wrapper around \$.Ajax for use when you just want to load a file from the file system.</p>
<p>We will get a real markdown editor and display tool going next week.</p>
<p>For a working example, see the <a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/NodeCode/NodeRoutes03">NodesRoutes03</a> example.</p>
<p>##Turn it in</p>
<p>Place your work in a folder called <strong>Week05BridgeReader02</strong> and check it in to your repository. Submit a link to your repository.</p>
<a class="anchor" id="links"></a>
<h2>Links</h2>
<ul>
<li><a href="http://www.dofactory.com/javascript-patterns.aspx">DoFactory</a></li>
</ul>
</div></body></html>