<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AwsRunSshScript</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>AwsRunSshScript</h1><p>Welcome to AwsRunSshScript</p><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#get-started">Get Started</a></li>
<li><a href="#get-live-templates">Get Live Templates</a></li>
<li><a href="#header-in-render-method">Header in render Method</a></li>
<li><a href="#button">Button</a></li>
<li><a href="#call-fetch">Call Fetch</a></li>
<li><a href="#server-side">Server Side</a></li>
<li><a href="#create-sshrunner-module">Create sshRunner Module</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="overview"></a>
<h2>Overview</h2>
<p>Run an SSH script remotely. In particular we will:</p>
<ul>
<li>Create a program on Pristine Lubuntu</li>
<li>From that program we will run the CpuInfo script on our EC2 instance and display the output in our client.<ul>
<li>Recall that we copied that file to our Ec2 instance in the assignment called <strong>EC2 Copy File.</strong></li>
</ul>
</li>
</ul>
<a class="anchor" id="get-started"></a>
<h2>Get Started</h2>
<p>Make sure you have pulled the most recent version of JsObjects.</p>
<pre><code><span class="hljs-attribute">jo
git pull</span>
</code></pre><p>Remember that you can get back to the directory you were in before typing <strong>jo</strong> by typing <strong>cd -</strong>.</p>
<p>In the root of your repository, create a directory called <strong>week05-run-ssh</strong> and navigate into it.</p>
<p>From the root of your new directory, run the <strong>get-gist</strong> program by typing its name at the command prompt and hitting the <strong>enter</strong> key. Select <strong>Elven Create Concurrently</strong> which is probably option <strong>l</strong>.</p>
<p>Run the <strong>elf-concur</strong> script. When prompted, choose the <strong>server</strong> option on 30026 from the menu. It should create the <strong>client</strong> and <strong>server</strong> directories, configure them, and set up <a href="https://www.npmjs.com/package/concurrently">concurrently</a> in the <strong>week05-run-ssh</strong> directory.</p>
<p>The <strong>elf-concur</strong> script should have set your programs up so that HTTP commands issued by the <strong>client</strong> will be proxied to the <strong>server</strong>. It did this by placing a <strong>proxy</strong> property in <strong>package.json</strong>. In short, the programs were set up for you automatically.</p>
<p>Navigate to the <strong>client</strong> directory. Run <strong>get-gist</strong> a second time. Select:</p>
<pre><code>a) <span class="hljs-builtin-name">Run</span> ESLintRc <span class="hljs-keyword">and</span> Prettier (cdef)
</code></pre><p>Exit <strong>get-gist</strong>. Run the program again in the <strong>server</strong> directory, again selecting the ESLintRc option from the <strong>get-gist</strong> menu.</p>
<p>Navigate back to the root of the <strong>week05-run-ssh</strong> directory. Run <strong>npm start</strong>. The <strong>client</strong> and <strong>server</strong> should now be running on the appropriate ports.</p>
<ul>
<li>See <strong>/server/bin/www</strong> for the set up of the port for the server.</li>
<li>See <strong>/client/package.json</strong> for the proxy, which is at the bottom of the file.</li>
<li>See <strong>week05-run-ssh</strong> for the set up of <strong>concurrently</strong><ul>
<li><strong>package.json</strong></li>
<li><strong>start-client.js</strong></li>
</ul>
</li>
</ul>
<a class="anchor" id="get-live-templates"></a>
<h2>Get Live Templates</h2>
<p>Open the project in WebStorm.</p>
<p>At the bash shell, issue this command to download the latest Elven WebStorm <a href="https://www.jetbrains.com/help/webstorm/using-live-templates.html">Live Templates</a>:</p>
<pre><code>wget http<span class="hljs-variable">s:</span>//s3.amazonaws.<span class="hljs-keyword">com</span>/bucket01.elvenware.<span class="hljs-keyword">com</span>/images/elf-webstorm-settings.jar
</code></pre><p>Choose <strong>File | Import Settings</strong> from the WebStorm menu. Select the <strong>jar</strong> file you just downloaded.</p>
<a class="anchor" id="header-in-render-method"></a>
<h2>Header in render Method</h2>
<p>We can view the templates by selecting <strong>File | Settings | Editor | Live Templates | user</strong>. Note that some of the templates only work in certain places. For instance, the JSX related templates will only run if your cursor is in the appropriate part of, for instance, a react <strong>render</strong> method.</p>
<p>Let&#39;s test our new Live Template. Open up <strong>src/App.js</strong>. In the render method, remove the JSX HTML <strong>header</strong>. Type <strong>elf-jsx-start</strong> to set up one of our live templates. Press tab or enter to invoke it. The following code should be inserted automatically into your code:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"byline"</span>&gt;</span>by <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&amp;copy; 2018 <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<p>Fill in the missing pieces. For instance, insert your name in the appropriate places, and add some text for the H1 element. Suggested text might <strong>Run SSH</strong>.</p>
<a class="anchor" id="button"></a>
<h2>Button</h2>
<p>In the <strong>main</strong> element run the <strong>elf-react-button</strong> live-template:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>Fill in the missing pieces.</p>
<a class="anchor" id="call-fetch"></a>
<h2>Call Fetch</h2>
<p>Above the <strong>render</strong> method but inside the <strong>App</strong> class declaration, run the <strong>elf-call-fetch</strong> live-template:</p>
<pre><code class="lang-javascript">= <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
   fetch(<span class="hljs-string">'/'</span>)
       .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) </span>{
           <span class="hljs-keyword">return</span> response.json();
       })
       .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">json</span>) </span>{
           <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'JSON from server:'</span>, json);

       })
       .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ex</span>) </span>{
           <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'parsing failed, error on server, URL bad, network down, or similar'</span>);
           <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(ex, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
       });
};
</code></pre>
<p>Fill the missing pieces. The method should be called <strong>callCpuInfo</strong>. The endpoint URL for our route should be:</p>
<ul>
<li>call-cpu-info</li>
</ul>
<a class="anchor" id="server-side"></a>
<h2>Server Side</h2>
<p>We will need the <strong>ssh2</strong> NPM package.</p>
<pre><code>npm <span class="hljs-keyword">install</span> ssh2 <span class="hljs-comment">--save</span>
</code></pre><p>At the top of <strong>routes/index.js</strong> require the package:</p>
<pre><code class="lang-JavaScript">var <span class="hljs-built_in">Client</span> = require(<span class="hljs-string">'ssh2'</span>).<span class="hljs-built_in">Client</span>;
</code></pre>
<p>Near the top of <strong>routes index.js</strong> put these declarations and method:</p>
<pre><code class="lang-javascript">
<span class="hljs-keyword">const</span> hostAddress = <span class="hljs-string">'&lt;YOUR ELASTIC_IP_HERE&gt;'</span>;

<span class="hljs-keyword">let</span> allData = <span class="hljs-string">''</span>;

<span class="hljs-keyword">const</span> runCpuInfo = <span class="hljs-function">(<span class="hljs-params">hostAddress, response</span>) =&gt;</span> {
    <span class="hljs-keyword">var</span> conn = <span class="hljs-keyword">new</span> Client();
    conn.on(<span class="hljs-string">'ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Client :: ready'</span>);
        conn.exec(<span class="hljs-string">'~/CpuInfo'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, stream</span>) </span>{
            <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
            stream
                .on(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">code, signal</span>) </span>{
                    <span class="hljs-built_in">console</span>.log(
                        <span class="hljs-string">'Stream :: close :: code: '</span> +
                            code +
                            <span class="hljs-string">', signal: '</span> +
                            signal
                    );
                    conn.end();
                    response.send({ <span class="hljs-attr">result</span>: <span class="hljs-string">'success'</span>, <span class="hljs-attr">allData</span>: allData });
                })
                .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'STDOUT: '</span> + data);
                    allData += data;
                })
                .stderr.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'STDERR: '</span> + data);
                    allData += data;
                });
        });
    }).connect({
        <span class="hljs-attr">host</span>: hostAddress,
        <span class="hljs-attr">port</span>: <span class="hljs-number">22</span>,
        <span class="hljs-attr">username</span>: <span class="hljs-string">'ubuntu'</span>,
        <span class="hljs-attr">privateKey</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).readFileSync(
            process.env.HOME + <span class="hljs-string">'/.ssh/&lt;YOUR_PRIVATE_KEY_HERE&gt;'</span>
        )
    });
};
</code></pre>
<p>Put your elastic IP in the hostAddress variable. Put the name of your private key in the appropriate place near the bottom of the <strong>callCpuInfo</strong> method.</p>
<p>In <strong>routes/index.js</strong> also put an endpoint for <strong>call-cpu-info</strong>. The <strong>elf-router-get</strong> live-template should help you handle this. from that endpoint, call the method we declared above like this:</p>
<pre><code class="lang-javascript">runCpuInfo(<span class="hljs-name">hostAddress</span>, response)<span class="hljs-comment">;</span>
</code></pre>
<p>Test your code and make sure it works. You should see the output from running the CpuInfo script on your EC2 server.</p>
<a class="anchor" id="create-sshrunner-module"></a>
<h2>Create sshRunner Module</h2>
<p>Create a file called <strong>routes/ssh-runner.js</strong>. Move the</p>
</div></body></html>