<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>TwitterInteractive</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>TwitterInteractive</h1><p>Welcome to TwitterInteractive</p><ul><!--TOC_Start--><li><a href="#twitter-query">Twitter Query</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#step-five">Step Five</a></li>
<li><a href="#step-5-5-startup">Step 5.5 Startup</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="twitter-query"></a>
<h1>Twitter Query</h1>
<p>The goal of this project is to query Twitter. We will ask for details about our account, but also about things that are happening on Twitter.</p>
<p>While working on this project, use your Delcious and Bitly projects as references. There is lots of code from those programs that will also be used in this project.</p>
<a class="anchor" id="step-one"></a>
<h2>Step One</h2>
<p>Make sure you have the most recent scripts:</p>
<pre>cd $JSOBJECTS
git pull
cp $JSOBJECTS/Utilities/NodeInstall/CreateExpressProject ~/bin/.
cp $JSOBJECTS/Utilities/NodeInstall/TestReady ~/bin/.
cp $JSOBJECTS/Utilities/SetupLinuxBox/strip-triple-spaces ~/bin/.
</pre>
<p>If you don&#39;t have js-beautify installed globally, which you well might not, then run this command:</p>
<pre>npm install -g js-beautify
</pre>
<p>Or use a different name for my scripts if you have custom versions with the same name.</p>
<p>I think most of you can then type <strong>i3</strong> to get back to your repositories.</p>
<pre>export TWITTER_PROJECT=Week07-Twitter
CreateExpressProject $TWITTER_PROJECT
cd $TWITTER_PROJECT
TestReady
</pre>
<p>Now run the following commands, one at a time, to confirm that all is well:</p>
<pre>grunt check
grunt test
</pre>
<a class="anchor" id="step-two"></a>
<h2>Step Two</h2>
<p>To get started we need to get a <strong>consumer_key</strong> and <strong>access_token_key</strong> from Twitter:</p>
<ol>
<li>Go to: <a href="https://apps.twitter.com/">https://apps.twitter.com/</a></li>
<li>Sign in. </li>
<li>Make sure you have a mobile phone number set up on your account</li>
<li><a href="https://dev.twitter.com/oauth/overview/application-owner-access-tokens">Generate an application</a></li>
<li>On the application management page, choose <strong>Create New App</strong><ol>
<li>name: bc-tweeter-lastname</li>
<li>description: learning the twitter api</li>
<li>website: <a href="http://www.example.com">http://www.example.com</a> (or what pleases you)</li>
<li>callback <a href="http://www.example.com/bc-tweeter-lastname">http://www.example.com/bc-tweeter-lastname</a></li>
</ol>
</li>
<li>Generate the consumer key  (Button one of two)</li>
<li>Then generate the access token. (Button two of two)</li>
</ol>
<a class="anchor" id="step-three"></a>
<h2>Step Three</h2>
<p>Querying Twitter is perhaps unnecessarily complex. Fortunately, there is a <a href="https://www.npmjs.com/package/twitter">node package</a> that handles the details for us. To get twitter support, start by adding the package:</p>
<pre>npm install twitter --save
</pre>
<p>This is node package, so it works on the server side. This is as it should be, since it keeps your keys hidden from users. </p>
<p>Our server side code can go in <strong>routes/index.js</strong>. First we want to include (<strong>require</strong>) the twitter package we downloaded. Then we create an <strong>elfTwitterClient</strong> from our Twitter package and use it when we query Twitter:</p>
<pre>var Twitter = require('twitter');
var elfTwitterClient;

function getClient() {
    if (!elfTwitterClient) {
        elfTwitterClient = new Twitter({
            consumer_key: 'YOUR CONSUMER KEY HERE',
            consumer_secret: 'YOUR CONSUMER SECRET HERE',
            access_token_key: 'YOUR TOKEN KEY HERE',
            access_token_secret: 'YOUR TOKEN SECRET HERE'
        });
    }
    return elfTwitterClient;
}
</pre>
<p>Here is a request for information about <strong>#node.js</strong>:</p>
<pre>router.get('/search', function (req, res, next) {
    var client = getClient();

    var params = {q: '#node.js'};
    client.get('search/tweets', params, function (error, tweets, response) {
        if (!error) {
            console.log(tweets);
            res.send(tweets);
        } else {
            console.log(error);
            res.send({fail: error});
        }
    });
});
</pre>
<p>We use <strong>client.get</strong> to retrieve information from Twitter, and we use <strong>res.send</strong> to send that information from the server to the browser.</p>
<p>We&#39;ll work on getting random searches a bit later.</p>
<a class="anchor" id="step-three"></a>
<h2>Step Three</h2>
<p>Get our mixins:</p>
<pre>cp ~/Git/JsObjects/Utilities/Templates/JadeMixins/* views/.
</pre>
<a class="anchor" id="step-four"></a>
<h2>Step Four</h2>
<p>Notice that our search function calls <strong>router.get</strong>. The <strong>router</strong> object is built into express. The <strong>get</strong> function is a bit of middleware that is called when the browser sends a request to the server. In particular, it responds to URLs that contain the paramter <strong>search</strong>:</p>
<pre>http://localhost:30025/search
</pre>
<p>Go ahead and paste that URL into your browser&#39;s address bar. Your server side method should get called and a lot of JSON should get send back and displayed in a big blob in your browser. To sort out that data, paste it into <a href="http://jsonlint.com/">http://jsonlint.com/</a>.</p>
<p>Of course, we want something a bit more fancy. But by now, you know how to transform data big blobs of JSON into code that someone can use.</p>
<p>The first step might be to declare a little jade:</p>
<pre>+elfPanel("Bitly Links Table").elfDiv
    div.scroller
        table.table#tableLinks

+elfPanel("Debug", "panel-default").elfDiv
    button.btn.btn-default#getTweets(type='button') Get Tweets
    button.btn.btn-default#search(type='button') Search

    div
        ul#tweetList

    div
        pre#tweetData
</pre>
<p>The second step might be a call to <strong>getJSON</strong>:</p>
<pre>function search() {
    $.getJSON('/search', function(result) {

        // STEP ONE:
        //    STRINGIFY THE RESULT AND DISPLAY IT IN THE PRE
        //    TAG WITH THE ID OF: #tweetData

        // STEP TWO:
        //   ITERATE OVER EACH ITEM IN THE RESULT'S STATUSES ARRAY
        //   AND DISPLY THE text PROPERTY IN THE #tweetList

    });
}

$(document).ready(function() {
    'use strict';

    $('#search').click(search)
});
</pre>
<p>At first, just display the <strong>text</strong> property from <strong>statuses</strong> array. Once that is working, you might want to get the first url from the <strong>urls</strong> array in the <strong>entities</strong> property and turn the text field into a hyperlink. More specifically:</p>
<p>Our code should add the tweet text:</p>
<ul>
<li>to the list as a hyperlink if it has a Url</li>
</ul>
<p>If it does not have a url, it should add it:</p>
<ul>
<li>to the list but without a hyperlink</li>
<li>To the table</li>
</ul>
<p>It is <strong>very important</strong> that you test to make sure there are actually are URLs in the <strong>entities.urls</strong> array. If there are none, and you try to access one, then your code will throw a variable <strong>undefined</strong> error.</p>
<p>The data you get back is shaped a bit like this:</p>
<pre>{
  "statuses": [
        {
            "metadata": {
                "iso_language_code": "en",
                "result_type": "recent"
            },
            "created_at": "Tue Nov 03 19:25:02 +0000 2015",
            "id": 661625149184213000,
            "id_str": "661625149184212992",
            "text": "Understanding Components in Ember 2 https://t.co/iaKG6y6wIt #dev #node #js",
            // CODE OMITTED HERE
            "user": {
                "id": 3011007497,
                "id_str": "3011007497",
                "name": "Codi",
                "screen_name": "codi_ar",
                "location": "",
                "description": "",
                "url": null,
                "entities": {
                    "description": {
                        "urls": []
                    }
                },
                "protected": false,
                "followers_count": 11,
                // CODE OMITTED HERE
            },
            "geo": null,
            // CODE OMITTED HERE
            "entities": {
                "hashtags": [
                    { "text": "dev", "indices": [60, 64] },
                    { "text": "node", "indices": [65,70] },
                    { "text": "js", "indices": [71,74] }
                ],
                "symbols": [],
                "user_mentions": [],
                "urls": [
                    {
                        "url": "https://t.co/iaKG6y6wIt",
                        "expanded_url": "http://buff.ly/1Q3yPje",
                        "display_url": "buff.ly/1Q3yPje",
                        "indices": [36,59]
                    }
                ]
            },
            // CODE OMITTED HERE
        },
        // MANY SIMILAR OBJECTS
   ],
   search_metadata: {
        completed_in: 0.026,
        max_id: 661625223423385600,
        max_id_str: '661625223423385602',
        next_results: '?max_id=661623659165937663&q=%23node.js&include_entities=1',
        query: '%23node.js',
        refresh_url: '?since_id=661625223423385602&q=%23node.js&include_entities=1',
        count: 15,
        since_id: 0,
        since_id_str: '0'
     }
 }
</pre>
<p>Here&#39;s a couple utility methods you can use if you don&#39;t want to write it yourself:</p>
<pre>function appendUrl(selector, index, text, url) {
    var anchor = '<a href="' + url + '" target="_blank">' + text + '</a>';
    var details = '<a onclick="detailDelicious(' + index + ')">Details</a>';
    $(selector).append('<li>' + anchor + ' - ' + details + '</li>');
}
</pre>
<a class="anchor" id="step-five"></a>
<h2>Step Five</h2>
<p>The final step will be to use our scrolling table for items without links, and our list for any items that have links. Our vice-versa if you prefer. I&#39;m not sure which is best. The point for now is just to get practice with both ways of displaying data.</p>
<p>Here is a method that you might find useful:</p>
<pre>var renderTable = function (text, user) {
    'use strict';
    var title = '<td>' + text + '</td>';
    var keyword = '<td>' + user + '</td>';
    var tableRowStart = '<tr>';
    $('#tableLinks').append(tableRowStart + title + keyword + '<tr>');
};
</pre>
<p>You would want to call this from your loop in the success callback for <strong>getJSON</strong>. The user should be the user name: <strong>result.user.name</strong> (or something like that).</p>
<a class="anchor" id="step-5-5-startup"></a>
<h2>Step 5.5 Startup</h2>
<p><strong>NOTE</strong>: <em>No one has to follow the structure defined in this section. But if you need help building the application, this section might help.</em></p>
<p>Normally, we would create a method like this that would initilize our buttons:</p>
<pre>$(document).ready(function() {
    $('#search').click(twitterRefine.search);
});
</pre>
<p>Let&#39;s move it into its own method:</p>
<pre>var init: function() {
    $('#search').click(twitterRefine.search);
}

$(document).ready(function() {
    'use strict';
    init();
});
</pre>
<p>Then, as we refine the code further, let&#39;s move it into an object that holds all the main methods for the program:</p>
<pre>var twitterInteractive = {

    init: function() {
        $('#search').click(twitterRefine.search);
    },

    appendUrl: function (selector, index, text, url) {
        // CODE OMITTED HERE
    },

    // LOTS OF CODE OMITTED HERE

};

$(document).ready(function() {
    'use strict';
    twitterInteractive.init();
});
</pre>
<p>There is a unit test called <strong>test-twitter-core.js</strong> and a file called <strong>tweets.js</strong> in <strong>$ELF_TEMPLATES/UnitTest/TwitterInteractive</strong> that can help you define this object. Just copy the test into your spec folder. Don&#39;t forget to load <strong>tweets.js</strong> in <strong>karma.conf.js</strong></p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Per usual.</p>
</div></body></html>