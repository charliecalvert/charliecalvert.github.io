<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ExpressRoutesSolarDeeper</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><!-- script(src="/libs/scripts/Control.js")--><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>ExpressRoutesSolarDeeper</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#more-tests">More Tests</a></li>
<li><a href="#sorted-index">Sorted Index</a></li>
<li><a href="#spec-routes">Spec Routes</a></li>
<li><a href="#spec-routes-students">Spec Routes Students</a></li>
<li><a href="#components">Components</a></li>
<li><a href="#require">Require</a></li>
<li><a href="#require-js-modules">Require JS Modules</a></li>
<li><a href="#create-html">Create HTML</a></li><!--TOC_End--></ul><h2 id="more-tests">More Tests</h2>
<p>Consider using <strong>nodemon</strong> instead of <strong>node</strong> for <strong>test-server</strong> in <strong>package.json</strong>.</p>
<p>Create an <strong>objectToArray</strong> method in <strong>routes/energy-utils.js</strong>. Require this file in <strong>index.js</strong>.</p>
<p>In <strong>index.js</strong> add routes:</p>
<ul>
<li>renewableByIndex</li>
<li>renewableByYear</li>
<li>renewablesSorted (renewableByIndexSorted)</li>
</ul>
<h2 id="sorted-index">Sorted Index</h2>
<p>The <strong>renewablesByIndexSorted</strong> method takes a single parameter as an id, just like renewablesByIndex:</p>
<pre><code class="lang-javascript">router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/renewablesByIndexSorted/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{
   YOU FILL IN THE IMPLEMENTATION
})
</code></pre>
<p>The implmentation is very similar to <strong>renewablesByIndex</strong>, but instead of returning a single object, return an array of arrays. The array of arrays is created by a single call to <strong>energyUtils.objectToArray</strong>. The <strong>renewablesByIndexSorted</strong> route should then return the array built in the call to <strong>objectToArray</strong>.</p>
<h2 id="spec-routes">Spec Routes</h2>
<p>Let&#39;s add one more test to our routes. Your code should pass the following tests in <strong>spec/spec-routes.js</strong>:</p>
<pre><code class="lang-javascript">var request = require('supertest')<span class="hljs-comment">;</span>
var app = require('../app')<span class="hljs-comment">;</span>
var energyUtils = require('../routes/energy-utils')<span class="hljs-comment">;</span>

describe('Elvenware Routes Suite', function() {
    'use strict'<span class="hljs-comment">;</span>

    it('shows we can test', function() {
        expect(<span class="hljs-name">true</span>).toBe(<span class="hljs-name">true</span>)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('shows we can call renewables route without error and get a <span class="hljs-number">200</span> back', function(<span class="hljs-name">done</span>) {
        request(<span class="hljs-name">app</span>)
            .get('/renewables')
            .expect(<span class="hljs-number">200</span>)
            .expect('Content-Type', /json/)
            .end(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>, res) {
                if (<span class="hljs-name">err</span>) { throw err<span class="hljs-comment">; }</span>
                done()<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('call renewables routes and see that first object body has Year set to <span class="hljs-number">2017</span>', function(<span class="hljs-name">done</span>) {
        request(<span class="hljs-name">app</span>)
            .get('/renewables')
            .expect(<span class="hljs-number">200</span>)
            .expect('Content-Type', /json/)
            .expect(<span class="hljs-name">function</span>(<span class="hljs-name">response</span>) {
                expect(<span class="hljs-name">response</span>.body.result).toBe('Success')<span class="hljs-comment">;</span>
                //console.log(<span class="hljs-name">response</span>.body.renewables)<span class="hljs-comment">;</span>
                expect(<span class="hljs-name">response</span>.body.renewables[<span class="hljs-number">0</span>].Year).toBe('<span class="hljs-number">2017</span>')<span class="hljs-comment">;</span>
            })
            .end(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>, res) {
                if (<span class="hljs-name">err</span>) { throw err<span class="hljs-comment">; }</span>
                done()<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('shows we can call renewableByIndex route and can get a single renewable object by Index', function(<span class="hljs-name">done</span>) {
        request(<span class="hljs-name">app</span>)
            .get('/renewableByIndex/1')
            .expect(<span class="hljs-number">200</span>)
            .expect('Content-Type', /json/)
            .expect(<span class="hljs-name">function</span>(<span class="hljs-name">response</span>) {
                expect(<span class="hljs-name">response</span>.body.result).toBe('Success')<span class="hljs-comment">;</span>
                //console.log(<span class="hljs-name">response</span>.body.renewables)<span class="hljs-comment">;</span>
                expect(<span class="hljs-name">response</span>.body.renewables.Year).toBe('<span class="hljs-number">2016</span>')<span class="hljs-comment">;</span>
            })
            .end(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>, res) {
                if (<span class="hljs-name">err</span>) { throw err<span class="hljs-comment">; }</span>
                done()<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('can call renewablesByIndexSorted route with an index and gets energy object as sorted array', function(<span class="hljs-name">done</span>) {
        request(<span class="hljs-name">app</span>)
            .get('/renewablesByIndexSorted/1')
            .expect(<span class="hljs-number">200</span>)
            .expect('Content-Type', /json/)
            .expect(<span class="hljs-name">function</span>(<span class="hljs-name">response</span>) {
                expect(<span class="hljs-name">response</span>.body.result).toBe('Success')<span class="hljs-comment">;</span>
                var powers = response.body.sortedEnergy<span class="hljs-comment">;</span>
                for (<span class="hljs-name">var</span> i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; powers.length - 1; i++) {</span>
                    expect(<span class="hljs-name">powers</span>[i][<span class="hljs-number">1</span>]).toBeLessThan(<span class="hljs-name">powers</span>[i + <span class="hljs-number">1</span>][<span class="hljs-number">1</span>])<span class="hljs-comment">;</span>
                }
            })
            .end(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>, res) {
                if (<span class="hljs-name">err</span>) { throw err<span class="hljs-comment">; }</span>
                done()<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('call renewableByYear and get renewable object with specific year', function(<span class="hljs-name">done</span>) {
        request(<span class="hljs-name">app</span>)
            .get('/renewableByYear/2016')
            .expect(<span class="hljs-number">200</span>)
            .expect('Content-Type', /json/)
            .expect(<span class="hljs-name">function</span>(<span class="hljs-name">response</span>) {
                // console.log('expect called')<span class="hljs-comment">;</span>
                expect(<span class="hljs-name">response</span>.body.result).toBe('Success')<span class="hljs-comment">;</span>
                //console.log(<span class="hljs-name">response</span>.body.renewables)<span class="hljs-comment">;</span>
                var renewable = response.body.renewable<span class="hljs-comment">;</span>
                expect(<span class="hljs-name">renewable</span>.Year).toBe('<span class="hljs-number">2016</span>')<span class="hljs-comment">;</span>
            })
            .end(<span class="hljs-name">function</span>(<span class="hljs-name">err</span>, res) {
                if (<span class="hljs-name">err</span>) { throw err<span class="hljs-comment">; }</span>
                done()<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h2 id="spec-routes-students">Spec Routes Students</h2>
<p>Students should write these two tests in <strong>spec/spec-routes-student.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 5/11/16.
 */</span>

<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'supertest'</span>);
<span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../app'</span>);

describe(<span class="hljs-string">"Spec Routes Student Suite"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    it(<span class="hljs-string">'shows renewables route returns an object array with length set to 12'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>) </span>{
      <span class="hljs-comment">// FILL IN THE CODE FOR THE TEST HERE. THEN REMOVE THE BOOLEAN TEST SHOWN BELOW THIS LINE</span>
        expect(<span class="hljs-literal">true</span>).toBe(<span class="hljs-literal">false</span>);
    });

    it(<span class="hljs-string">'shows the renewables route, parse text property of response object and show first object contains 2017'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">done</span>) </span>{
        <span class="hljs-comment">// FILL IN THE CODE FOR THE TEST HERE. THEN REMOVE THE BOOLEAN TEST SHOWN BELOW THIS LINE</span>
        expect(<span class="hljs-literal">true</span>).toBe(<span class="hljs-literal">false</span>);
    });

});
</code></pre>
<h2 id="components">Components</h2>
<p>Our next goal is to create client side components. We will learn about:</p>
<ul>
<li>Require</li>
<li>Loading HTML with the jQUery <a href="http://api.jquery.com/load/">load</a> method.</li>
</ul>
<h2 id="require">Require</h2>
<p>RequireJs provides:</p>
<ul>
<li>More control over the loading of JavaScript files. Load scripts on demand</li>
<li>Support for JavaScript modules that stand alone and do not pollute the global name space</li>
<li>An asynchronous alternative to the synchronous commonjs require calls used on the server</li>
<li>A form of code injection similar to what we have in angular</li>
</ul>
<p>To install <strong>requirejs</strong>:</p>
<pre>
bower install requirejs --save
</pre>

<p>In <strong>layout.jade</strong> we load <strong>requirejs</strong> and specify a file, usually called <strong>main.js</strong>, where we configure <strong>require</strong> and load the core files for our application:</p>
<pre>
doctype html
html
  head
    title= title
    link(rel='stylesheet', href='/stylesheets/style.css')
    link(rel='stylesheet', href='/components/bootstrap/dist/css/bootstrap.css')
    script(data-main="javascripts/main.js" src="components/requirejs/require.js")
  body
    block content
</pre>

<p>In <strong>public/javascripts/main.js</strong> we configure require and bootstrap our application:</p>
<p><strong>NOTE</strong>: <em>By bootstrap I mean &quot;load the core files of our application&quot;. I&#39;m not referring to the CSS library.</em></p>
<pre><code class="lang-javascript">requirejs.config({
    baseUrl: <span class="hljs-string">'.'</span>,
    paths: {
        jquery: <span class="hljs-string">'components/jquery/dist/jquery'</span>,
        bootstrap: <span class="hljs-string">'components/bootstrap/dist/js/bootstrap'</span>,
        control: <span class="hljs-string">'javascripts/control'</span>
    }
});

requirejs([<span class="hljs-string">'jquery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> </span>{

    requirejs([<span class="hljs-string">'bootstrap'</span>, <span class="hljs-string">'control'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(bootstrap, control)</span> </span>{
        control.init();
    });
});
</code></pre>
<p>We configure requirejs in a call to <strong>requirejs.config</strong>. The key tasks are:</p>
<ul>
<li>State the <a href="http://requirejs.org/docs/api.html#config-baseUrl">baseUrl</a>, which in this case is the <strong>public</strong> folder of our application.</li>
<li>We then define maps that tell require JS how to find modules that not stored directly in the baseUrl. After making defining these paths, we can refer to individual moduels by these names, rather than having to spell out the whole path. For instance, we can write <strong>control</strong> rather than <strong>javascripts/control</strong>.</li>
</ul>
<h2 id="require-js-modules">Require JS Modules</h2>
<p>Require JS modules are defined in specific way, usually through calls to function named <strong>define</strong>. For instance, in <strong>public/javascripts/control.js</strong> we define our first require js module:</p>
<pre><code class="lang-javascript">define([<span class="hljs-string">'jquery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
    <span class="hljs-comment">//Do setup work here</span>

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showBar</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">//console.log('Show Bar Clicks called now');</span>
        $(<span class="hljs-string">'#display2'</span>).html(<span class="hljs-string">'bar'</span>);
    }

    <span class="hljs-keyword">var</span> control = {
        color: <span class="hljs-string">"black"</span>,
        size: <span class="hljs-string">"unisize"</span>,
        setup: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'#showClick'</span>, showBar);
            $(<span class="hljs-string">'#display2'</span>).html(control.color + <span class="hljs-string">' - '</span> + control.size);
        },
        init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">//console.log(this.color);</span>
            that = <span class="hljs-keyword">this</span>;
            $(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'/main'</span>, <span class="hljs-keyword">this</span>.setup);
        }
    };

    <span class="hljs-keyword">return</span> control;
});
</code></pre>
<p>We begin by calling the require js <strong>define</strong> function:</p>
<pre><code class="lang-javascript">define([<span class="hljs-string">'jquery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span> </span>{
  <span class="hljs-comment">// DEFINE THE OBJECT STORED IN THIS MODULE AND RETURN IT</span>
});
</code></pre>
<p>Inside the define function we define the object stored in our module, and return it. You need do nothing special when writing your object. Just define it using standard JavaScript code and it is ready to use. It automatically inherits the features of a require module because it is declared this way. It is as if you declared it using the module pattern, but it is perhaps simpler to understand, and easier to use as part of a larger application architecture.</p>
<p>Many of the major libraries that are commonly used automatically implement the requirejs define function or do something similar. In other words, jQuery, and many other libraries, are requirejs modules. Or maybe it would be more correct to say that the meet the requirements of a requirejs module. This is the case because requirejs is so popular, and so commonly used. Some libraries do not support requirejs, and we will have to take special steps to load them.</p>
<h2 id="create-html">Create HTML</h2>
<p>You might have noticed that we make this call in our module:</p>
<pre><code class="lang-javascript">$(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'/main'</span>, <span class="hljs-keyword">this</span>.setup);
</code></pre>
<p>In <strong>work.jade</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">h1</span> Main

p<span class="hljs-selector-id">#display</span>

p#display2
</code></pre>
<p>In <strong>public/javascripts/work.js</strong>:</p>
<pre><code class="lang-javascript">define([<span class="hljs-string">'funcObj'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">funcObj</span>) </span>{
    <span class="hljs-comment">//Do setup work here</span>

    <span class="hljs-keyword">var</span> work = {
        color: <span class="hljs-string">"red"</span>,
        size: <span class="hljs-string">"big"</span>,
        init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">console</span>.log(work.color);            
            $(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'/work'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $(<span class="hljs-string">'#display'</span>).html(work.color + <span class="hljs-string">' '</span> + work.size);
            });
        }
    };
    <span class="hljs-keyword">return</span> work;

});
</code></pre>
<p>In <strong>about.jade</strong>:</p>
<pre>
h1 About

p#display

p#display2
</pre>

<p>In <strong>public/javascripts/about.js</strong>:</p>
<pre><code class="lang-javascript">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">//Do setup work here</span>

    <span class="hljs-keyword">var</span> about = {
        color: <span class="hljs-string">"Green"</span>,
        size: <span class="hljs-string">"LittleGreen"</span>,
        init: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">console</span>.log(about.color);
            <span class="hljs-comment">//var that = this;</span>
            $(<span class="hljs-string">'#elf-view'</span>).load(<span class="hljs-string">'/about'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                $(<span class="hljs-string">'#display'</span>).html(about.color + <span class="hljs-string">' '</span> + about.size);
            });
        }
    };
    <span class="hljs-keyword">return</span> about;

});
</code></pre>
</div></body></html>