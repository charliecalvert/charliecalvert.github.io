<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>ReactMongooseBasics</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div id="navbar" class="navbar-collapse collapse">       <ul class="nav navbar-nav"><li ng-class="{ active: isActive('/')}" class="trigger-collapse"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img alt="Elvenware" src="/images/elvenwarelogo.png" class="elf-normal"/></figure><h1>ReactMongooseBasics</h1><p>Welcome to ReactMongooseBasics</p><ul><!--TOC_Start--><li><a href="#description">Description</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#ignore-politicians">Ignore Politicians</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#the-mongoose-schema">The Mongoose Schema</a></li>
<li><a href="#connecting">Connecting</a></li>
<li><a href="#step-5">Step 5</a></li>
<li><a href="#step-six">Step Six</a></li>
<li><a href="#step-seven">Step Seven</a></li>
<li><a href="#all-mongo">All Mongo</a></li>
<li><a href="#another-query">Another query</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#additional-notes">Additional Notes</a></li>
<li><a href="#mongoose-basics-connect">Mongoose Basics Connect</a></li>
<li><a href="#mongoose-basics-empty-collection">Mongoose Basics Empty Collection</a></li>
<li><a href="#match-get-and-post">Match get and post</a></li>
<li><a href="#some-more-code">Some More Code</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="description"></a>
<h2>Description</h2>
<p>Mongoose Basics is an ORM for MongoDB.</p>
<ul>
<li>MongoDb Slides: <a href="http://bit.ly/elf-mongo">http://bit.ly/elf-mongo</a></li>
<li>Mongoose Slides: <a href="http://bit.ly/elf-mongoose">http://bit.ly/elf-mongoose</a></li>
</ul>
<p><strong>NOTE</strong>: <em>There is an <strong>Angular</strong>, <strong>React</strong> and <strong>jquery</strong> version of this assignment. Make sure you are looking at the right one. This is the <strong>React</strong> assignment, the others are called <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/AngularMongooseBasics.html">AngularMongooseBasics</a> and
<a href="http://www.ccalvert.net/books/CloudNotes/Assignments/MongooseBasics.html">MongooseBasics</a>.</em></p>
<p>Before proceeding, be sure you have an account on  <a href="https://mlab.com/">https://mlab.com/</a>.</p>
<p>Put your <strong>address-list.json</strong> in the public directory.</p>
<a class="anchor" id="step-one"></a>
<h2>Step One</h2>
<p>Go to JsObjects:</p>
<pre><code><span class="hljs-attribute">jo</span>
</code></pre><p>Pull the latest from the repository: <strong>git pull</strong>.</p>
<p>Navigate back to your repository. From the root of your repository:</p>
<pre><code>CreateAllExpress CongressServer
<span class="hljs-built_in">cd</span> CongressServer
npm install
</code></pre><p>Open the project in WebStorm.</p>
<a class="anchor" id="step-two"></a>
<h2>Step Two</h2>
<p>Set up bower. Your <strong>bower.json</strong> probably already contains Bootstrap, and hence jQuery. But just in case:</p>
<ul>
<li>bower install bootstrap --save</li>
</ul>
<p>Just to be save. Though the above call install bootstrap, lets just be certain all is well:</p>
<pre><code><span class="hljs-keyword">bower </span>install
</code></pre><p>Now might be a good time to start the project: <strong>npm start</strong></p>
<a class="anchor" id="ignore-politicians"></a>
<h2>Ignore Politicians</h2>
<p>Add a file called <strong>nodemon.json</strong> in the root of your project. Place the following content in it:</p>
<pre><code class="lang-javascript">{
  <span class="hljs-attr">"verbose"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"ignore"</span>: [<span class="hljs-string">"politicians.json"</span>, <span class="hljs-string">"**/bower-components/**"</span>]
}
</code></pre>
<p>This project may create a file called <strong>politicians.json</strong> each time you insert data into the database. By default, this will cause <strong>nodemon</strong> to restart the project each time we write data to <strong>politicians.json</strong>. This can cause miscellaneous errors on the on the client side, such as a false report for failure for the <strong>insertValidCollection</strong>. The fix is to ask nodemon to ignore <strong>politicians.json</strong>. We should also ask it to ignore our components folder.</p>
<p>For more on nodemon configuration, see here:</p>
<ul>
<li><a href="https://github.com/remy/nodemon">https://github.com/remy/nodemon</a></li>
<li><a href="https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md">https://github.com/remy/nodemon/blob/master/doc/sample-nodemon.md</a></li>
</ul>
<p>You should also create a <strong>.gitignore</strong> file for this project and put the single line <strong>politicians.json</strong> in it. While you are at it, check your .bowerrc and make sure it has <strong>bower-components</strong> rather than <strong>components</strong> in it:</p>
<pre><code class="lang-javascript">$ cat <span class="hljs-selector-class">.bowerrc</span>
{
  <span class="hljs-string">"directory"</span>: <span class="hljs-string">"public/bower-components"</span>
}
</code></pre>
<a class="anchor" id="step-three"></a>
<h2>Step Three</h2>
<p>Let&#39;s practice setting up the <strong>favicon</strong>. Because you used <strong>CreateAllExpress</strong>, you should already have a <strong>favicon.png</strong> file in <strong>public.</strong> But in case you have some reason to do it manually, here is how to get a default favicon on Linux (first example) or on Windows:</p>
<pre><code>cp <span class="hljs-formula">$JSOBJECTS/Data/MongoBootstrap/favicon.png public/.
copy %USERPROFILE%<span class="hljs-tag">\<span class="hljs-name">Git</span></span><span class="hljs-tag">\<span class="hljs-name">JsObjects</span></span><span class="hljs-tag">\<span class="hljs-name">Data</span></span><span class="hljs-tag">\<span class="hljs-name">MongoBootstrap</span></span><span class="hljs-tag">\<span class="hljs-name">favicon</span></span>.png public<span class="hljs-tag">\<span class="hljs-name">.</span></span></span>
</code></pre><p>The next step is not done for you automatically by <strong>CreateAllExpress</strong>, so do this by hand:</p>
<ul>
<li>In an editor, open up <strong>app.js</strong> from the root of your project. (Server side)</li>
<li>On line 18 uncomment: <strong>app.use(favicon(__dirname + &#39;/public/favicon.ico&#39;));</strong></li>
<li>Change <strong>favicon.ico</strong> to <strong>favicon.png</strong>.</li>
</ul>
<a class="anchor" id="step-four"></a>
<h2>Step Four</h2>
<p>Download empty lubuntu:</p>
<ul>
<li><a href="http://bit.ly/empty-lubuntu-17">http://bit.ly/empty-lubuntu-17</a></li>
</ul>
<a class="anchor" id="step-four"></a>
<h2>Step Four</h2>
<p>Set up and learn a little about <a href="http://mongoosejs.com/">Mongoose</a>. Mongoose is probably the most popular way to access MongoDb from Node Js applications. Other popular options include <strong>Monk</strong> and the native drivers, which are called <strong>MongoDb</strong>. Mongoose relies on <strong>MongoDb</strong>.</p>
<p>First install <strong>mongoose</strong>:</p>
<pre><code>npm <span class="hljs-keyword">install</span> mongoose <span class="hljs-comment">--save</span>
</code></pre><p>In the past, you might have seen messages about mongoose, C++ and bson. They should no longer occur, but if you are encountering them, see the Elvenware notes on <a href="http://elvenware.com/charlie/development/database/NoSql/MongoDb.html#mongoose-gyp-bson">this subject</a>.</p>
<p><strong>NOTE</strong>: <em>On Linux, you may need to install libkrb5-dev before you can install the Mongoose NPM package. This should not be an issue on Cloud 9.</em></p>
<pre><code>sudo apt-<span class="hljs-built_in">get</span> install libkrb5-<span class="hljs-built_in">dev</span>
</code></pre><a class="anchor" id="the-mongoose-schema"></a>
<h3>The Mongoose Schema</h3>
<p>Once Mongoose is installed, you should set up a schema:</p>
<ul>
<li>Create a folder called models at the root of your project</li>
<li>Put this code in a file called <strong>models/politicians.js</strong>:</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">var</span> politicianSchema = mongoose.Schema({
    <span class="hljs-string">'firstName'</span>: <span class="hljs-built_in">String</span>,
    <span class="hljs-string">'lastName'</span>: <span class="hljs-built_in">String</span>,
});

<span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">'politician'</span>, politicianSchema);
</code></pre>
<p>Go ahead and fill in the rest of the fields according to the structure for your data. The fields will probably all be of type <strong>String</strong>.</p>
<p>In <strong>routes/index.js</strong> add these two things to the existing code:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> allMongo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./all-mongo'</span>);
<span class="hljs-keyword">var</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);

router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    res.render(<span class="hljs-string">'index'</span>, {<span class="hljs-attr">title</span>: <span class="hljs-string">'CongressServer'</span>});
});

router.get(<span class="hljs-string">'/bar'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
    response.status(<span class="hljs-number">200</span>).send({<span class="hljs-attr">result</span>: <span class="hljs-string">'bar'</span>});
});

router.get(<span class="hljs-string">'/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    response.status(<span class="hljs-number">200</span>).send({ <span class="hljs-attr">result</span>: request.params.id });
});
</code></pre>
<p>Later we will add methods methods to open your collection.</p>
<p>In <strong>index.js</strong>, make sure that this is the last line in the file:</p>
<pre><code><span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = router;
</code></pre><a class="anchor" id="connecting"></a>
<h2>Connecting</h2>
<p>Here is a tool for connecting to the database. It belongs in its own file called <strong>routes/connect.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 6/6/16.
 */</span>

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">const</span> connect = {

    <span class="hljs-attr">connected</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-attr">simpleConnect</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting with simple.'</span>);
        <span class="hljs-keyword">const</span> url = <span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>;
        <span class="hljs-built_in">console</span>.log(url);
        connect.connected = <span class="hljs-literal">true</span>;
        mongoose.connect(url);
        <span class="hljs-keyword">const</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-attr">custom</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting with simple.'</span>);
        <span class="hljs-comment">//const url = 'mongodb://127.0.0.1:27017/test';</span>
        <span class="hljs-keyword">const</span> userName = <span class="hljs-string">'charlie'</span>;
        <span class="hljs-keyword">const</span> password = <span class="hljs-string">'foobar'</span>;
        <span class="hljs-keyword">const</span> siteAndPort = <span class="hljs-string">'192.168.2.18:27017'</span>;
        <span class="hljs-keyword">const</span> databaseName = <span class="hljs-string">'test'</span>;
        <span class="hljs-keyword">const</span> url = <span class="hljs-string">'mongodb://'</span> + userName + <span class="hljs-string">':'</span> + password + <span class="hljs-string">'@'</span> + siteAndPort + <span class="hljs-string">'/'</span> + databaseName;
        <span class="hljs-built_in">console</span>.log(url);
        connect.connected = <span class="hljs-literal">true</span>;
        mongoose.connect(url);
        <span class="hljs-keyword">const</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-comment">// mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds049848.mlab.com:49848/elvenlab01</span>
    mlabConnect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting with mlab.'</span>);
        connect.connected = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> userName = <span class="hljs-string">'pol'</span>;
        <span class="hljs-keyword">var</span> password = <span class="hljs-string">'polFooBarQux'</span>;
        <span class="hljs-keyword">var</span> siteAndPort = <span class="hljs-string">'ds049848.mlab.com:49848'</span>;
        <span class="hljs-keyword">var</span> databaseName = <span class="hljs-string">'elvenlab01'</span>;
        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'mongodb://'</span> + userName + <span class="hljs-string">':'</span> + password + <span class="hljs-string">'@'</span> + siteAndPort + <span class="hljs-string">'/'</span> + databaseName;

        mongoose.connect(url);

        <span class="hljs-comment">// This part is optional</span>
        <span class="hljs-keyword">var</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-attr">doConnection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">option</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> option === <span class="hljs-string">'undefined'</span>) {
            option = <span class="hljs-string">'simple'</span>;
        }

        <span class="hljs-keyword">switch</span> (option) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'simple'</span>:
                connect.simpleConnect();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'custom'</span>:
                connect.custom();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'mlab'</span>:
                connect.mlabConnect();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                connect.simpleConnect();
        }
    }
};

<span class="hljs-built_in">module</span>.exports = connect;
</code></pre>
<a class="anchor" id="step-5"></a>
<h2>Step 5</h2>
<p>Here is index.pug:</p>
<pre><code>extends layout

block <span class="hljs-attribute">content</span>
  h1= title
  <span class="hljs-selector-tag">p</span> Welcome to #{title}

    button<span class="hljs-selector-id">#insertValidData</span> Insert Valid Data
    button<span class="hljs-selector-id">#getAll</span> Get All
    button<span class="hljs-selector-id">#emptyCollection</span> Empty Collection

  pre#<span class="hljs-attribute">display</span>
</code></pre><p>and layout.pug</p>
<pre><code>doctype html
html
  head
    title= title
    link(<span class="hljs-name">rel=</span>'stylesheet', href='/stylesheets/style.css')
    link(<span class="hljs-name">rel=</span>'stylesheet', href='/components/bootstrap/dist/css/bootstrap.css')
    script(<span class="hljs-name">src=</span><span class="hljs-string">"components/jquery/dist/jquery.js"</span>)
    script(<span class="hljs-name">src=</span><span class="hljs-string">"components/bootstrap/dist/js/bootstrap.js"</span>)
    script(<span class="hljs-name">src=</span><span class="hljs-string">"javascripts/control.js"</span>)
  body
    block content
</code></pre><a class="anchor" id="step-six"></a>
<h2>Step Six</h2>
<p>Here is <strong>public/javascripts/control.js</strong>:</p>
<pre><code class="lang-javascript">$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-string">'use strict'</span>;
    <span class="hljs-keyword">const</span> insertUrl = <span class="hljs-string">'/insertValidCollection'</span>;
        <span class="hljs-keyword">let</span> collection;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertCollection</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> jqxhr = $.get(insertUrl, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            alert( <span class="hljs-string">"success"</span> );
            <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
        })
            .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log( <span class="hljs-string">"second success"</span> );
            })
            .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                alert( <span class="hljs-string">"error"</span> );
            })
            .always(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log( <span class="hljs-string">"finished"</span> );
            });
    }    

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAll</span>(<span class="hljs-params"></span>) </span>{
        $.getJSON(<span class="hljs-string">'/all-data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            collection = result.allData;
            $(<span class="hljs-string">'#display'</span>).html(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
        })
            .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'second success'</span>);
            })
            .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                alert(<span class="hljs-built_in">JSON</span>.stringify(error.responseJSON, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
            })
            .always(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'finished'</span>);
            });
    }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">emptyCollection</span>(<span class="hljs-params"></span>) </span>{
        $.getJSON(<span class="hljs-string">'/emptyCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            $(<span class="hljs-string">'#display'</span>).html(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
        })
            .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'second success'</span>);
            })
            .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                alert(<span class="hljs-built_in">JSON</span>.stringify(a.responseJSON, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
            })
            .always(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'finished'</span>);
            });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"></span>) </span>{
            collection[<span class="hljs-number">0</span>].firstName = <span class="hljs-string">'foo'</span>;
            <span class="hljs-keyword">const</span> newData = {
                    <span class="hljs-attr">id</span>: collection[<span class="hljs-number">0</span>]._id,
                    <span class="hljs-attr">firstName</span>: collection[<span class="hljs-number">0</span>].firstName
            };
            $.getJSON(<span class="hljs-string">'/update'</span>, newData, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
            $(<span class="hljs-string">'#display'</span>).html(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
        })
            .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'second success'</span>);
            })
            .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                alert(<span class="hljs-built_in">JSON</span>.stringify(a.responseJSON, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
            })
            .always(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'finished'</span>);
            });
    }

        $(<span class="hljs-string">'#insertValidData'</span>).click(insertCollection);
        $(<span class="hljs-string">'#getAll'</span>).click(getAll);
        $(<span class="hljs-string">'#emptyCollection'</span>).click(emptyCollection);
        $(<span class="hljs-string">'#update'</span>).click(update);
});
</code></pre>
<a class="anchor" id="step-seven"></a>
<h2>Step Seven</h2>
<p>In <strong>routes/index.js</strong> append all of the following before the module statement:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> router = express.Router();
<span class="hljs-keyword">var</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);
<span class="hljs-comment">//var politicians = require('../models/politicians');</span>
<span class="hljs-keyword">var</span> allMongo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./all-mongo'</span>);

<span class="hljs-comment">/* GET home page. */</span>
router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res, next</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    res.render(<span class="hljs-string">'index'</span>, {<span class="hljs-attr">title</span>: <span class="hljs-string">'CongressServer'</span>});
});

<span class="hljs-comment">// here</span>
router.get(<span class="hljs-string">'/bar'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
    response.status(<span class="hljs-number">200</span>).send({<span class="hljs-attr">result</span>: <span class="hljs-string">'bar'</span>});
});

router.get(<span class="hljs-string">'/bar/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    response.status(<span class="hljs-number">200</span>).send({<span class="hljs-attr">param</span>: request.params.id});
});

<span class="hljs-built_in">module</span>.exports = router;
</code></pre>
<a class="anchor" id="all-mongo"></a>
<h2>All Mongo</h2>
<p>In <strong>routes\/all-mongo.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 6/5/16.
 */</span>

<span class="hljs-keyword">const</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);
<span class="hljs-keyword">const</span> Politicians = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../models/politicians'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">let</span> totalPoliticiansSaved = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">allMongo</span>(<span class="hljs-params"></span>) </span>{
    use strict;
}

allMongo.numberOfPoliticians = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertPolitician</span>(<span class="hljs-params">politician, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">if</span> (!connect.connected) {
        connect.doConnection();
    }
    <span class="hljs-keyword">const</span> newPolitician = <span class="hljs-keyword">new</span> Politicians({
        <span class="hljs-string">'firstName'</span>: politician.firstName,
        <span class="hljs-string">'lastName'</span>: politician.lastName,
        <span class="hljs-string">'city'</span>: politician.city,
        <span class="hljs-string">'state'</span>: politician.state,
        <span class="hljs-string">'zip'</span>: politician.zip,
        <span class="hljs-string">'phone'</span>: politician.phone,
        <span class="hljs-string">'website'</span>: politician.website,
        <span class="hljs-string">'email'</span>: politician.email,
        <span class="hljs-string">'contact'</span>: politician.contact
    });

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'inserting'</span>, newPolitician.lastName);

    newPolitician.save(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err);
        }
        totalPoliticiansSaved++;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'saved: '</span>, newPolitician.lastName, allMongo.numberOfPoliticians, totalPoliticiansSaved);

        <span class="hljs-keyword">if</span> (totalPoliticiansSaved === allMongo.numberOfPoliticians) {
            response.status(<span class="hljs-number">200</span>).send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'Success Saving Politicians'</span>,
                <span class="hljs-attr">totalSaved</span>: totalPoliticiansSaved
            });
        }
    });
}

allMongo.getAllData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'About to find politicians.'</span>);
    Politicians.find({}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, allData</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err);
        }
        <span class="hljs-built_in">console</span>.log(allData.length);
        <span class="hljs-built_in">console</span>.log(allData[<span class="hljs-number">0</span>]);

        allMongo.writeData(<span class="hljs-string">'politicians.json'</span>, allData);

        response.status(<span class="hljs-number">200</span>).send({
            <span class="hljs-attr">result</span>: <span class="hljs-string">'Success'</span>,
            <span class="hljs-attr">allData</span>: allData
        });
    });
};

allMongo.writeData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileName, data</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">const</span> dataAsString = <span class="hljs-built_in">JSON</span>.stringify(data, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>);
    fs.writeFile(fileName, dataAsString, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, result</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">throw</span> (err);
        }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'success writing file'</span>);
    });
};

allMongo.readDataAndInsert = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    fs.readFile(<span class="hljs-string">'public/address-list.json'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, politiciansText</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-comment">//throw (err);</span>
            response.status(<span class="hljs-number">404</span>).send({<span class="hljs-string">'result'</span>: err});
            <span class="hljs-keyword">return</span>;
        }
        politiciansText = <span class="hljs-built_in">JSON</span>.parse(politiciansText);
        totalPoliticiansSaved = <span class="hljs-number">0</span>;
        allMongo.numberOfPoliticians = politiciansText.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; politiciansText.length; i++) {
            insertPolitician(politiciansText[i], response);
        }
    });
};

allMongo.empty = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
    Politicians.remove({}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
            response.status(<span class="hljs-number">500</span>).send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'err'</span>,
                <span class="hljs-attr">err</span>: err
            });
        } <span class="hljs-keyword">else</span> {
            response.status(<span class="hljs-number">200</span>).send({
                <span class="hljs-attr">result</span>: <span class="hljs-string">'collection removed'</span>
            });
        }
    });
};

allMongo.update = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">requestQuery, response</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'All Mongo'</span>, requestQuery._id);
    Politicians.findOne({
        <span class="hljs-attr">_id</span>: requestQuery.id
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, doc</span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'findone'</span>, err, doc);
        <span class="hljs-keyword">if</span> (err) {
            response.status(<span class="hljs-number">404</span>).send({
                <span class="hljs-attr">result</span>: err
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (doc === <span class="hljs-literal">null</span>) {
                insertPolitician(requestQuery, response);
            } <span class="hljs-keyword">else</span> {
                doc.firstName = requestQuery.firstName;
                doc.save();
                response.status(<span class="hljs-number">200</span>).send({
                    <span class="hljs-attr">result</span>: <span class="hljs-string">'success'</span>,
                    <span class="hljs-attr">query</span>: requestQuery.body
                });
            }
        }
    });
};

<span class="hljs-built_in">module</span>.exports = allMongo;
</code></pre>
<a class="anchor" id="another-query"></a>
<h2>Another query</h2>
<p>This section is optional. Don&#39;t do it unless you are comfortable with it.</p>
<p>There is a utility called mongo. You can use it to connect to your database, even the database on <strong>mlab</strong>. At least I think you can.</p>
<p>Install the mongo client only. Then use the string found near the top of mlab database page to connect:</p>
<pre><code>mongo ds049848<span class="hljs-selector-class">.mlab</span><span class="hljs-selector-class">.com</span>:<span class="hljs-number">49848</span>/elvenlab01 -u &lt;dbuser&gt; -<span class="hljs-selector-tag">p</span> &lt;dbpassword&gt;
</code></pre><p>Don&#39;t forget to open a terminal and type <strong>mongo</strong> to start the mongo shell. Then do something like this:</p>
<pre>
show dbs
use test
show collections
db.politicians.find()
db.politicians.find({} , {_id: 0, firstName: 1, lastName: 1})
</pre>


<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Push you code to your repository, and when you turn it in tell me the tag, branch and folder where it resides. For instance:</p>
<ul>
<li>Folder: XXX</li>
<li>Branch: YYY</li>
<li>TAG: ZZZ</li>
</ul>
<p>Please try to keep it simple. I shouldn&#39;t have to wade through several pages of text just to find where you pushed your code.</p>
<a class="anchor" id="additional-notes"></a>
<h2>Additional Notes</h2>
<p>Things to remember. Ignore comments about grunt check for now.</p>
<a class="anchor" id="mongoose-basics-connect"></a>
<h3>Mongoose Basics Connect</h3>
<p>After you run <em>grunt check</em>, run your tests and your program again to make sure everything still works!</p>
<a class="anchor" id="mongoose-basics-empty-collection"></a>
<h3>Mongoose Basics Empty Collection</h3>
<p>Notice that <strong>emptyCollection</strong> has now changed and contains a check to make sure you are connected. The assignment now has the <a href="#step-seven">right code</a>.</p>
<a class="anchor" id="match-get-and-post"></a>
<h3>Match get and post</h3>
<p>Here we do a <strong>get</strong> on the client:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> jqxhr = $.get(insertUrl, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{ ... })
</code></pre>
<p>Here is the server side, which is also a <strong>get</strong>:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/insertValidCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response)</span> </span>{ ... })
</code></pre>
<p>If you do a <strong>get</strong> on the client, do a <strong>get</strong> on the server. Don&#39;t do a get in one place and post in the other. (I had this mixed up in one version of the assignment. You need to get this cleaned up if you followed my example and made a mistake.)</p>
<a class="anchor" id="some-more-code"></a>
<h2>Some More Code</h2>
<p>In index.js:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> router = express.Router();
<span class="hljs-keyword">var</span> allMongo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./all-mongo'</span>);
<span class="hljs-keyword">var</span> connect = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./connect'</span>);

<span class="hljs-comment">/* GET home page. */</span>
router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    res.render(<span class="hljs-string">'index'</span>, {<span class="hljs-attr">title</span>: <span class="hljs-string">'CongressServer'</span>});
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkConnection</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!connect.connected) {
        connect.doConnection(<span class="hljs-string">'mlab'</span>);
    }
}

router.get(<span class="hljs-string">'/all-data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'AllData route invoked.'</span>);
    checkConnection();
    allMongo.getAllData(response);
});

router.get(<span class="hljs-string">'/emptyCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    checkConnection();
    allMongo.empty(response);
});

router.get(<span class="hljs-string">'/insertValidCollection'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Insert Valid Collection Called.'</span>);
    response.status(<span class="hljs-number">200</span>).send({<span class="hljs-attr">result</span>: <span class="hljs-string">'Insert valid Collection'</span>});
    <span class="hljs-comment">//checkConnection();</span>
    <span class="hljs-comment">//allMongo.readDataAndInsert(response);</span>
});

router.get(<span class="hljs-string">'/update'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    checkConnection();
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request query'</span>, request.query);
    allMongo.update(request.query, response);
});

<span class="hljs-comment">// Additional Code here.</span>
</code></pre>
</div></body></html>