<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>NodeRouteBasics</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>NodeRouteBasics</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#elven-assignments">Step One: Pull Elven Assignments</a></li>
<li><a href="#step-two-copy-project">Step Two: Copy Project</a></li>
<li><a href="#interface">Step Three: Client Interface</a></li>
<li><a href="#server">Step Four: Server</a></li>
<li><a href="#step-five">Step Five</a></li>
<li><a href="#turn-it-in">Turn It In</a></li>
<li><a href="#pass-data">Hint: Passing Data</a></li>
<li><a href="#interact">Client Server Interactions</a></li>
<li><a href="#update-out-of-date-packages">Update Out of Date Packages</a></li>
<li><a href="#temp-directory">Temp directory</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>The Node Route Basics assignment gives you practice create NodeJs Express routes and calling them with <strong>$.getJSON</strong> or <strong>$.ajax</strong>.</p>
<p>If you need help with this this assignment, study the NodeRoutes
examples in JsObjects.</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/NodeCode/NodeRoutes01">NodeRoutes01</a></li>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/NodeCode/NodeRoutes02">NodeRoutes02</a></li>
</ul>
<p>We are sending a message from the client to the server, and then getting a response:</p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/http.png" alt="http"></p>
<p>The client (web browser) uses HTTP to make a request for HTML, CSS, JavaScript or an image. The request might be triggered when we click on a link, type in the address bar or call an <strong>ajax</strong> function such as <strong>getJSON</strong>.</p>
<p>TCP/IP is used to send the request via the network to the server. The server, which in our case is a NodeJs express web server, reads the HTTP request and we create a custom route in <strong>routes/index.js</strong> that sends a response back. The response is typically an HTML file, some JSON, or some other artifact sent via the HTTP protocol.</p>
<p>On the client, the browser unpacks the request. If it an HTML file the user requested, it parses the HTML, and displays the results to the user. If it is an ajax request, then we typically parse the JSON and display the result to the user in some HTML element.</p>
<h2 id="elven-assignments">Step One: Pull Elven Assignments</h2>
<p>I have renamed the <strong>Prog270-Assignments</strong> repository to <strong>elven-assignments</strong>. If you don&#39;t have the repo, then do this:</p>
<pre><code>git <span class="hljs-keyword">clone</span> <span class="hljs-title">http</span>://github.com/charliecalvert/elven-assignments.git
</code></pre><p>If you already have the repo, then:</p>
<pre><code><span class="hljs-built_in">cd</span> ~/Git/Prog270-Assignments
nano .git/config
</code></pre><ul>
<li>Change the <strong>Remote Origin | Url</strong> to from <strong>Prog270-Assignments</strong> to <strong>elven-assignments</strong>.</li>
<li>Save (Ctrl-O) and exit (Ctrl-X) nano</li>
<li><strong>git pull</strong></li>
</ul>
<p>Now go back to <strong>~/Git</strong>. If necessary, rename the folder from <strong>Prog270-Assignments</strong> to <strong>elven-assignments</strong>.</p>
<h2 id="step-two-copy-project">Step Two: Copy Project</h2>
<p>Copy the node express program called <strong>NodeRouteBasics</strong> from my repo to yours:</p>
<pre><code>cp ~<span class="hljs-regexp">/Git/</span>elven-assignments<span class="hljs-regexp">/NodeRouteBasics ~/Gi</span>t<span class="hljs-regexp">/isit322-lastname-2016/</span>Week04-NodeRouteBasics
</code></pre><h2 id="interface">Step Three: Client Interface</h2>
<p>It should include the following:</p>
<ul>
<li>Various buttons and input controls.</li>
<li>When the user clicks on one button, return the number of feet in a mile.</li>
<li>When the user clicks on another button, calculate the number of feet
in X miles, where X is supplied by the user in an HTML <strong>input</strong> element.</li>
<li>Also provide the circumference of a circle given a radius supplied
by the user.</li>
</ul>
<p>You interface will probably consist of three buttons:</p>
<ul>
<li>Get Feet in Mile</li>
<li>Calculate Feet from Miles</li>
<li>Calculate Circumference</li>
<li>One input control for entering number used by the last two butttons  </li>
</ul>
<h2 id="server">Step Four: Server</h2>
<p>All the calculations should be performed on the server side, in a
module, per the <a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/NodeCode/NodeRoutes02/Library">NodeRoutes02</a>
example in JsObjects.</p>
<p>The return values should be a simple JavaScript literal (JSON) that contains at minimum, a property called <strong>result</strong> that contains the result of the calculation. For instance, our <strong>getNine</strong> method would set result to the number 9.</p>
<p>For three points extra credit, implement <strong>getFeetInMile</strong> and <strong>calculateFeetFromMiles</strong> using HTTP GET calls, and use POST for <strong>calculateCircumference</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-built_in">var</span> router = express.Router();

router.get(<span class="hljs-attr">...</span>)
router.post(<span class="hljs-attr">...</span>)
</code></pre>
<p>If you are going for extra-credit, please add a note to that effect when you submit the assignment. </p>
<p>The formula for calculating the circumference of a circle given its radius looks like this:</p>
<pre><code>Circumference = 2 <span class="hljs-keyword">*</span> radius <span class="hljs-keyword">*</span> Math.PI;
</code></pre><p>The parameter for calculateFeetFromMiles: miles</p>
<p>The parameter for calculateCircumference: radius</p>
<p>Recall that with <strong>GET</strong> methods we use frequently use <strong>request.query</strong> to find parameters, but with <strong>POST</strong> methods we use <strong>request.body</strong>.</p>
<ul>
<li><a href="http://expressjs.com/en/4x/api.html#req.body">Docs on req.body</a></li>
<li><a href="http://expressjs.com/en/4x/api.html#req.query">Docs on req.query</a></li>
<li><a href="http://stackoverflow.com/a/12008719">Interesting Discussion</a></li>
</ul>
<h2 id="step-five">Step Five</h2>
<p>Put a <strong>calculateCircumference</strong> method in a file called <strong>routes/utils.js</strong>. In that file create a simple object literal:</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">module</span>.<span class="hljs-title">exports</span> =</span> {
    <span class="hljs-comment">// YOUR METHOD HERE</span>
}
</code></pre>
<p>Now <strong>require</strong> your <strong>utils.js</strong> file in <strong>routes/index.js</strong> and use it in the appropriate route on your server. The method should take one parameter
called <strong>radius</strong> and it should return the calculated circumference.</p>
<p><strong>NOTE</strong>: <em>If we are building our own NPM packages, then put this object and method in the package instead. Otherwise just use the technique outlined above. In either case, our goal is to learn how to create reusable code that we can plug into an project on the server side.</em></p>
<h2 id="turn-it-in">Turn It In</h2>
<p>Check your code into your Git repository and submit the URL of your
repository or of the project you submitted.</p>
<h2 id="pass-data">Hint: Passing Data</h2>
<p>First, an example showing how to call a route without parameters:</p>
<pre><code class="lang-javascript">function callServerWithoutParms() {

    $.getJSON('/walk', function (<span class="hljs-literal">result</span>) {
        elf.display.showApacheFiles(<span class="hljs-literal">result</span>.htmlFilesWritten, <span class="hljs-literal">result</span>.destinationDir);
        elf.display.fillDisplayArea(<span class="hljs-type">JSON</span>.stringify(<span class="hljs-literal">result</span>, null, <span class="hljs-number">4</span>));
    }).done(function () {
            elf.display.showDebug('<span class="hljs-type">Walk</span> loaded second success');
        })
        .fail(function (jqxhr, textStatus, error) {
            elf.display.showDebug('<span class="hljs-type">Walk</span> loaded error: ' + jqxhr.status + ' ' + textStatus + ' ' + error);
        })
        .always(function () {
            elf.display.showDebug('<span class="hljs-type">Walk</span> loaded complete');
        });

}
</code></pre>
<p>Now an example showing how to call a route with parameters:</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callServerWithParms</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// Get Data We Want to Pass to the Server</span>
    <span class="hljs-keyword">var</span> dirsToWalk = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'dirsToWalk'</span>);
    <span class="hljs-keyword">var</span> directory = dirsToWalk.options[sourceIndex].value;
    <span class="hljs-keyword">var</span> destinationDirs = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'destinationDirs'</span>);
    <span class="hljs-keyword">var</span> destinationDir = destinationDirs.options[destinationIndex].value;

    <span class="hljs-keyword">var</span> highlight = $(<span class="hljs-string">'#highlight'</span>).prop(<span class="hljs-string">'checked'</span>);

    <span class="hljs-comment">// Put that data in JavaScript Object</span>
    <span class="hljs-keyword">var</span> requestQuery = {
        directoryToWalk: directory,
        destinationDir: destinationDir,
        highlight: highlight,
    };

    <span class="hljs-comment">// Call the server and pass the data as a parameter.</span>
    $.getJSON(<span class="hljs-string">'/walk'</span>, requestQuery, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>{
        elf.display.showApacheFiles(result.htmlFilesWritten, result.destinationDir);
        elf.display.fillDisplayArea(<span class="hljs-built_in">JSON</span>.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
    }).done(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            elf.display.showDebug(<span class="hljs-string">'Walk loaded second success'</span>);
        })
        .fail(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">jqxhr, textStatus, error</span>) </span>{
            elf.display.showDebug(<span class="hljs-string">'Walk loaded error: '</span> + jqxhr.status + <span class="hljs-string">' '</span> + textStatus + <span class="hljs-string">' '</span> + error);
        })
        .always(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            elf.display.showDebug(<span class="hljs-string">'Walk loaded complete'</span>);
        });

}
</code></pre>
<p>Below, in the next section, we look more closely at passing parameters.</p>
<h3 id="interact">Client Server Interactions</h3>
<p>Look at these code excerpts from the code shown above. We look specifically at the call to the server:</p>
<pre><code class="lang-javascript">
    // <span class="hljs-type">Put</span> that data <span class="hljs-keyword">in</span> <span class="hljs-type">JavaScript</span> <span class="hljs-type">Object</span>
    <span class="hljs-keyword">var</span> requestQuery = {
        directoryToWalk: directory,
        destinationDir: destinationDir,
        highlight: highlight,
    };

    // <span class="hljs-type">Call</span> the server <span class="hljs-keyword">and</span> pass the data <span class="hljs-keyword">as</span> a parameter.
    $.getJSON('/walk', requestQuery, function (<span class="hljs-literal">result</span>) { ... });
</code></pre>
<p>And here is what it looks like on the server. Notice how we
use the request object to discover the parameters passed
by the client:</p>
<pre><code class="lang-javascript">
router.get(<span class="hljs-string">'/walk'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request, response</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'In walk'</span>, request.query);
    <span class="hljs-keyword">var</span> directoryToWalk = request.query.directoryToWalk;
    <span class="hljs-keyword">var</span> destinationDir = request.query.destinationDir;
    <span class="hljs-keyword">var</span> highlight = request.query.highlight;
    etc
});
</code></pre>
<h2 id="update-out-of-date-packages">Update Out of Date Packages</h2>
<pre><code>$ npm <span class="hljs-keyword">install</span> -<span class="hljs-keyword">g</span> npm-<span class="hljs-keyword">check</span>-updates
$ npm-<span class="hljs-keyword">check</span>-updates -u
$ npm <span class="hljs-keyword">install</span>
</code></pre><p>If it is still not up to date, do: <strong>ncu -a</strong></p>
<p>Also, be sure to remove <strong>phantomjs</strong> from <strong>packages.json</strong>.</p>
<p>See here:</p>
<ul>
<li><a href="http://stackoverflow.com/a/22849716">http://stackoverflow.com/a/22849716</a></li>
</ul>
<h2 id="temp-directory">Temp directory</h2>
<p>This is optional. Skip if you are not interested.</p>
<p>Instead of running <strong>npm install</strong> and <strong>bower install</strong>, do this:</p>
<ul>
<li>Copy a reasonably up to date version of <strong>node_modules</strong> from one of your projects to <strong>~/tmp</strong>.</li>
<li>Copy a reasonably up to date version of <strong>public/components</strong> from one of your projects to <strong>~/tmp</strong>.</li>
</ul>
<p>For instance</p>
<pre><code>mkdir ~/tmp
cp <span class="hljs-regexp">~/Git/</span>isit322-lastname<span class="hljs-number">-2016</span><span class="hljs-regexp">/Week04-Middleware/</span>node_modules ~/tmp
cp <span class="hljs-regexp">~/Git/</span>isit322-lastname<span class="hljs-number">-2016</span><span class="hljs-regexp">/Week04-Middleware/</span><span class="hljs-keyword">public</span><span class="hljs-regexp">/components ~/</span>tmp
</code></pre><p>You might want to also copy the <strong>package.json</strong> and <strong>bower.json</strong> files to tmp. As needed, update your files to the latest:</p>
<pre><code>cd ~/tmp
npm outdated <span class="hljs-comment">--depth=0</span>
</code></pre><p>And then get the latest of everything as needed.</p>
<p>Now go back to your project and create symbolic links to these packages. The best way to do this is to use</p>
<ul>
<li>the run alias from <strong>~/.bash_aliases</strong></li>
<li>or the <strong>nm</strong> and <strong>component</strong> aliases from <strong>~/.bash_aliases</strong>.</li>
</ul>
<p>Just as an <strong>fyi</strong>, here they are:</p>
<pre><code><span class="hljs-keyword">alias</span> <span class="hljs-title">run</span>=<span class="hljs-string">"nm &amp;&amp; components &amp;&amp; npm start"</span>
<span class="hljs-keyword">alias</span> <span class="hljs-title">nm</span>=<span class="hljs-string">"ln -s ~/tmp/node_modules/"</span>
<span class="hljs-keyword">alias</span> <span class="hljs-title">components</span>=<span class="hljs-string">"ln -s ~/tmp/components/ public/components"</span>
</code></pre><p>For this project, do the following in <strong>~/tmp</strong>, or, if you have completed the above, in your project:</p>
<pre><code>npm <span class="hljs-keyword">install</span> supertest <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> jasmine <span class="hljs-comment">--save-dev</span>
npm <span class="hljs-keyword">install</span> -<span class="hljs-keyword">g</span> jasmine
</code></pre><p><strong>NOTE</strong>: <em>The point of setting up this ~/tmp directory is to put an end to long <strong>npm installs</strong> during class. Talk to Adam, he knows all about this.</em></p>
</div></body></html>