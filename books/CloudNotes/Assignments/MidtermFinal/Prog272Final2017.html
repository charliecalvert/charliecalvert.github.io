<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>Prog272Final2017</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div id="navbar" class="navbar-collapse collapse">       <ul class="nav navbar-nav"><li ng-class="{ active: isActive('/')}" class="trigger-collapse"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img alt="Elvenware" src="/images/elvenwarelogo.png" class="elf-normal"/></figure><h1>Prog272Final2017</h1><p>Welcome to Prog272Final2017</p><ul><!--TOC_Start--><li><a href="#prog-272-final-spring-2017">Prog 272 Final Spring 2017</a></li>
<li><a href="#core-programs">Core Programs</a></li>
<li><a href="#core-features">Core Features</a></li>
<li><a href="#database-features">DataBase Features</a></li>
<li><a href="#platforms">Platforms</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#concurrently">Concurrently</a></li>
<li><a href="#build-and-deploy">Build and Deploy</a></li>
<li><a href="#build">Build</a></li>
<li><a href="#load-from-database">Load from database</a></li>
<li><a href="#start-from-scratch">Start from Scratch</a></li>
<li><a href="#better-fetch">Better Fetch</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="prog-272-final-spring-2017"></a>
<h1>Prog 272 Final Spring 2017</h1>
<p>I will try to fill in more details later, but this should help you get started.</p>
<p>This is a take home exam. It will be graded fairly liberally. Not everyone is expected to finish everything. Simply complete as much as you can in a reasonable period of time.</p>
<a class="anchor" id="core-programs"></a>
<h2>Core Programs</h2>
<p>There should be at least the following three programs.</p>
<ul>
<li>Congress<ul>
<li>CongressAddress</li>
<li>CongressServer</li>
</ul>
</li>
<li>CongressNative</li>
<li>Congress Address on Heroku</li>
</ul>
<p>You should have at least 30 unit tests passing. You can pick which ones. But have some working.</p>
<a class="anchor" id="core-features"></a>
<h2>Core Features</h2>
<ul>
<li>I should be able to run CongressServer on port 30025 and be able to access your data on <strong>mlab</strong>.</li>
<li>CongressAddress should be able to talk to the server and concurrency should be in your <strong>package.json</strong> file for CongressAddress.</li>
<li>CongressNative should be able to talk to CongressServer. Provide source and a screenshot of it running on your phone.</li>
<li>The URL of your CongressServer/CongressAddress app running on Heroku</li>
</ul>
<p>I just want the URL of your Heroku project. I want the Heroku HTTP address, not the source. If you do want to give me the source, be sure to remove the .git folder from your Heroku project&#39;s directory. You don&#39;t want to nest git folders. Heroku, by default, has a .git repository. Don&#39;t put that repository in your repository. Instead, first remove the .git folder from the heroku directory.</p>
<p>Better yet, just send me the URL of your app on Heroku, don&#39;t try to turn in the source form the heroku directory. I do want the source for CongressAddress and CongressServer and CongressNative, but not the source to the heroku project.</p>
<a class="anchor" id="database-features"></a>
<h2>DataBase Features</h2>
<ul>
<li>Take your address-list and put it in the database.</li>
<li>Display data from the database in CongressAddress.</li>
<li>Iterate over records.</li>
<li>Work disconnected via <strong>localstorage</strong></li>
<li>Refresh data from database.<ul>
<li>My button clears localStorage and then pulls again from the MongoDb</li>
<li>When you get the data from DB, have it repopulate localStorage</li>
</ul>
</li>
<li>Update records in <strong>localStorage</strong></li>
<li>Extra Credit&quot; Delete a record in <strong>localStorage</strong>.<ul>
<li>This is now optional.</li>
<li>A simpler option might be to delete from the server and refersh everything.</li>
</ul>
</li>
<li>Extra Credit: Update a record in the database.</li>
<li>Extra Credit: Delete a record</li>
<li>Extra Credit: Refresh database from CongressAddress with new data from your address-list.json.</li>
</ul>
<a class="anchor" id="platforms"></a>
<h2>Platforms</h2>
<ul>
<li>CongressAddress and CongressServer on Linux<ul>
<li>You can develop on Mac or Windows, but I will run them on Linux</li>
<li>This should just work. But you might want to try it to be sure.</li>
<li>Windows users watch for casing issues. On Linux, <strong>MyFile.js</strong> is not the same as <strong>myFile.js</strong>. It will be the same on Windows, but not on Linux.</li>
</ul>
</li>
<li>Have a final build of CongressAddress talking to mlab on Heroku</li>
<li>Have something that talks to mlab on CongressNative running on Expo.<ul>
<li>If it shows even two fields from the database on a single component, then that is fine.</li>
<li>You don&#39;t need to duplicate all of CongressAddress</li>
</ul>
</li>
</ul>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>In your repository, in <strong>master</strong>, in a branch called <strong>final</strong>, or in both.</p>
<p>Add, commit, push. Branch and/or tag. Push your branch and/or tag.</p>
<p>Specify, in the following format, at the top of your comments, on the text page of the Canvas submission process, the following:</p>
<ul>
<li>Branch and/or tag</li>
<li>CongressAddress folder</li>
<li>CongressServer folder</li>
<li>CongressNative folder or (expo_lastname)<ul>
<li>Just make it clear which folder I should look in. Tell me explicitly.</li>
</ul>
</li>
<li>A link to your program running on Heroku.</li>
</ul>
<p>Optional, include a commit number.</p>
<p>In your repository, in a folder off the root called images, Include these screenshots:</p>
<ul>
<li>CongressAddress running on your development machine and displaying a record from the database.</li>
<li>The bash command line where your server is running as it looks right after you ask for <strong>all-data</strong>.</li>
<li>Your program on Heroku.</li>
<li>Your program on your phone.</li>
</ul>
<a class="anchor" id="concurrently"></a>
<h2>Concurrently</h2>
<pre><code>npm <span class="hljs-keyword">install</span> <span class="hljs-comment">--save concurrently</span>
</code></pre><p>And add these lines to the scripts section of <strong>package.json</strong>:</p>
<pre><code><span class="hljs-string">"go"</span>: <span class="hljs-string">"concurrently '</span>npm run server' <span class="hljs-string">'npm start'</span><span class="hljs-string">",
"</span>server<span class="hljs-string">": "</span>nodemon ../CongressServer/bin/www<span class="hljs-string">"</span>
</code></pre><p>And also, still in CongressAddress, in its <strong>package.json</strong>, add this line near the top:</p>
<pre><code><span class="hljs-string">"proxy"</span>: <span class="hljs-string">"http://localhost:30025"</span>,
</code></pre><p>So the first few lines look like this:</p>
<pre><code>{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"congress-address"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.1.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"proxy"</span>: <span class="hljs-string">"http://localhost:30025"</span>,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"bootstrap"</span>: <span class="hljs-string">"^3.3.7"</span>,
    etc...
  }
  etc...
}
</code></pre><p>To use the <strong>go</strong> option, type <strong>npm run go</strong>.</p>
<a class="anchor" id="build-and-deploy"></a>
<h2>Build and Deploy</h2>
<p>When you feel you are ready to take your app to Heroku, go to the root of your CongressAddress project and type <strong>npm run build</strong>. This will create a folder called <strong>build</strong>, and in it will be a complete copy of your CongressAddress program.</p>
<p>Now you want to go to CongressServer, or to your existing Heroku app, or even to a new application you built with <strong>create-react-app</strong>. If you choose this last option, remember that you will need to copy some files from <strong>CongressServer/routes</strong> folder.</p>
<a class="anchor" id="build"></a>
<h2>Build</h2>
<p>In CongressAddress:</p>
<pre><code>npm <span class="hljs-keyword">run</span><span class="bash"> build</span>
</code></pre><p>This creates a production version of our code in a folder called <strong>build</strong>.</p>
<p>Copy the contents of the <strong>build</strong> folder to <strong>CongressServer</strong> or the equivalent. You could do that by issuing this command from the root of the CongressServer:</p>
<pre><code>cp -rv ..<span class="hljs-regexp">/CongressAddress/</span>build<span class="hljs-regexp">/* public/</span>.
</code></pre><p>Then go into <strong>routes/index.js</strong> and make this change to use <strong>loadFile</strong> to load the <strong>index.html</strong> from your build:</p>
<pre><code>router.get(<span class="hljs-string">'/'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-comment">//res.render('index', {title: 'CongressServer'});</span>
    res.loadFile(<span class="hljs-string">'index.html'</span>);
});
</code></pre><p>And then if you want to be able to see the old interface, add this method:</p>
<pre><code class="lang-javascript">router.get(<span class="hljs-string">'/admin'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    res.render(<span class="hljs-string">'index'</span>, {<span class="hljs-attr">title</span>: <span class="hljs-string">'CongressServer'</span>});
});
</code></pre>
<a class="anchor" id="load-from-database"></a>
<h2>Load from database</h2>
<pre><code>componentDidMount() {
    logger.log(<span class="hljs-string">'DID MOUNT'</span>);
    <span class="hljs-keyword">this</span>.loadFromDatabase();
}

loadFromDatabase() {
    <span class="hljs-keyword">const</span> <span class="hljs-literal">that</span> = <span class="hljs-keyword">this</span>;
    dataLoader.loadAddresses(<span class="hljs-keyword">function</span>(addressCount) {
        <span class="hljs-keyword">if</span> (!addressCount) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'Cannot get address count in address.js'</span>);
        }
        <span class="hljs-literal">that</span>.addressCount = addressCount;
        logger.log(<span class="hljs-string">'LOADED ADDRESS'</span>);
        <span class="hljs-keyword">const</span> address = getByIndex(<span class="hljs-literal">that</span>.addressIndex);
        <span class="hljs-literal">that</span>.setState({
            address: address
        });
    });
}
</code></pre><a class="anchor" id="start-from-scratch"></a>
<h2>Start from Scratch</h2>
<p>Go to the ~/Source folder:</p>
<pre><code>CreateExpressProject lastname07
cd lastname07
cp -r ~<span class="hljs-regexp">/Git/</span>prog272-calvert-<span class="hljs-number">2017</span><span class="hljs-regexp">/CongressServer/</span>* .
npm start
</code></pre><p>Now go to localhost:30025</p>
<p>Once you see it works. Let&#39;s herokuize it:</p>
<pre><code>heroku <span class="hljs-keyword">create</span> calvert07
</code></pre><a class="anchor" id="better-fetch"></a>
<h2>Better Fetch</h2>
<p>It is not necessary to add this, but it might be informative to some to see this alternate handling of the first .then in a fetch promise:</p>
<pre><code class="lang-javascript">fetch(<span class="hljs-string">'/all-data'</span>)
    .then(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response.ok) {
            <span class="hljs-keyword">return</span> response.json();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(response.statusText + <span class="hljs-string">'\n'</span> +
                response.url + <span class="hljs-string">'\n'</span> +
                <span class="hljs-string">'status: '</span> + response.status);
        }
    })
    .then(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (data.error) {
            alert(<span class="hljs-built_in">JSON</span>.stringify(data.error, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
            callback(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span>;
        }
        logger.log(<span class="hljs-string">'ALL-DATA: '</span> + <span class="hljs-built_in">JSON</span>.stringify(data.allData, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>));
        that.setLocalStorage(data.allData);
        callback(data.allData.length);
    }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err.message) {
            alert(err.message);
        } <span class="hljs-keyword">else</span> {
            alert(<span class="hljs-string">'error'</span> + err);
        }
        logger.log(err);
    });
</code></pre>
<p>Note the check for <strong>response.ok</strong>            </p>
</div></body></html>