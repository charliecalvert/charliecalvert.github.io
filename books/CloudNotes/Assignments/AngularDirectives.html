<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularDirectives</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>AngularDirectives</h1><p>Welcome to AngularDirectives</p><ul><!--TOC_Start--><li><a href="#angular-directives">Angular Directives</a></li>
<li><a href="#step-01">Step 01</a></li>
<li><a href="#step-02">Step 02</a></li>
<li><a href="#step-02a">Step 02a</a></li>
<li><a href="#step-02b">Step 02b</a></li>
<li><a href="#the-marie-code">The Marie Code</a></li>
<li><a href="#template-vs-templateurl">Template vs TemplateUrl</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#fixtures">Fixtures</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="angular-directives"></a>
<h1>Angular Directives</h1>
<p>This is a very sketchy outline of an in-class assignment. Details to follow. Don&#39;t forget to refresh this page when looking for updates.</p>
<a class="anchor" id="step-01"></a>
<h2>Step 01</h2>
<p>Create with <strong>CreateAllExpress</strong> which automates much of our setup. This includes creating <strong>conrol.js</strong>, <strong>Gruntfile.js</strong> and <strong>karma.conf.js</strong>. It also adds in most of the <strong>&#39;use strict&#39;</strong> statements and sets up your tests.</p>
<p>The <strong>CreateAllExpress</strong> file should be in your <strong>bin</strong> directory. If it is not there, then run this:</p>
<pre>
cd $ELF_UTILS/SetupLinuxBox
./CreateSymbolicLinks
</pre>

<p>Go to your repository.</p>
<pre>CreateAllExpress Week04-AngularDirectiveTesting
cd Week04-AngularDirectiveTesting
npm install
</pre>
<p>Add support for angular:</p>
<pre> bower install bootstrap angular angular-mocks --save
</pre>
<p>Then:</p>
<pre>grunt check
grunt test
</pre>
<p>Also do this:</p>
<pre>npm install -g phantomjs-prebuilt
</pre>
<a class="anchor" id="step-02"></a>
<h2>Step 02</h2>
<p>Let&#39;s add into <strong>index.jade</strong> some HTML5 directives. First, very simple:</p>
<pre>
hr
bar
</pre>

<p>This creates the following HTML:</p>
<pre><hr>
<bar></bar>
</pre>
<a class="anchor" id="step-02a"></a>
<h2>Step 02a</h2>
<p>Add support for angular:</p>
<pre> bower install angular angular-mocks --save
</pre>
<p>In <strong>layout.jade</strong>, load angular and declare an Angular <strong>ng-app</strong> directive:</p>
<pre>script(src="components/angular/angular.js")
body(data-ng-app="elfApp")
</pre>
<p>In <strong>control.js</strong> create a controller code:</p>
<pre>var elfApp = angular.module('elfApp', []);

elfApp.controller('MainController', function($scope) {
    'use strict';
});
</pre>
<p>And a simple directive:</p>
<pre>elfApp.directive('bar', function() {
    'use strict';
    return {
        link: function() {
            console.log('bar');
        },
        template: '<p>bar</p>'
    };
});
</pre>
<p>Run the app and see the results, which should be the word <strong>bar</strong> in an HTML paragraph element.</p>
<a class="anchor" id="step-02b"></a>
<h2>Step 02b</h2>
<p>Now something a bit more interesting. Start with the jade in <strong>index.jade</strong>:</p>
<pre>
hr
div(elf-marie='')
hr
div
    elf-marie
hr
elf-marie
</pre>

<p>This Jade template produces the following HTML:</p>
<pre><hr>
<div elf-marie></div>
<hr>
<div>
   <elf-marie></elf-marie>
</div>
<hr>
<elf-marie></elf-marie>
</pre>
<p>All three are legitimate ways to use an angular directive.</p>
<p>The third example above is our preferred technique, or perhaps the first, where we use the directive as an attribute of an HTML element. However, as the second example shows, there are many variations. There are additional ways to use the directive not covered in this example, but mentioned earlier in this slide deck.</p>
<a class="anchor" id="the-marie-code"></a>
<h2>The Marie Code</h2>
<p>In the controller itself, we can put our model:</p>
<pre>$scope.marie = {
    firstName: 'Marie',
    lastName: 'Curie',
    city: 'Paris',
    country: 'France'
};
</pre>
<p>Also in the <strong>control.js</strong> file, near the bottom, after the controller, add in another directive:</p>
<pre>elfApp.directive('elfMarie', function() {
      'use strict';
    return {
              controller: 'MainController',
        template: 'First: {{marie.firstName}} ' +
            '<br>Last: {{marie.lastName}}' +
            '<br>City: {{marie.city}}'
    };
});
</pre>
<a class="anchor" id="template-vs-templateurl"></a>
<h2>Template vs TemplateUrl</h2>
<p>The <strong>elfMarie</strong> directive above is relatively easy to read. It is not, however, typical of the kind of HTML we need to write. Consider this somewhat more realistic code:</p>
<pre>elfApp.directive('elfMarie', function() {
    'use strict';
  return {
    controller: 'MainController',
    template: '<p><span class="caption">First</span>: {{marie.firstName}}</p>' +
    '<p><span class="caption">Last</span>: {{marie.lastName}}</p>' +
    '<p><span class="caption">City</span>: {{marie.city}}</p>'
  };
});
</pre>
<p>We have added only a bit more complexity, and suddenly we are looking at chaos. For me, at least, inserting HTML into the midst of a JavaScript file creates cognitive dissonance. It makes my brain fog over.</p>
<p>The solution, of course, is to switch to a <strong>templateUrl</strong>, and load the template from our <strong>views</strong> folder. Here is <strong>marie.jade</strong>:</p>
<pre>
div#marie
    p
        span.caption First
        | : {{marie.firstName}}
    p
        span.caption Last
        | : {{marie.lastName}}
    p
        span.caption City
        | : {{marie.city}}
</pre>

<p>This Jade is none so lovely either, but it keeps our JavaScript clean:</p>
<pre>elfApp.directive('elfMarie', function() {
      'use strict';
    return {
        controller: 'MainController',
        templateUrl: 'marie'
    };
});
</pre>
<p>Be sure to modify your <strong>elfMarie</strong> directive to match the code shown above.</p>
<p>Finally, insert code into <strong>routes/index.js</strong> that will allow us to response to requests for <strong>marie</strong> by converting <strong>marie.jade</strong> to <strong>marie.html</strong> and sending back the HTML via HTTP.</p>
<pre>router.get('/:id', function(req, res, nest) {
    'use strict';
    res.render(req.params.id, {
        title: ' Angular Directive Calvert'
    });
});
</pre>
<a class="anchor" id="testing"></a>
<h2>Testing</h2>
<p>In the <strong>files</strong> section of <strong>karma.conf.js</strong>, above <strong>public/javascripts</strong> and below <strong>jasmine-jquery</strong>:</p>
<pre>'public/components/angular/angular.js',
'public/components/angular-mocks/angular-mocks.js',
</pre>
<p>And install phantomjs globally:</p>
<pre>npm install -g phantomjs-prebuilt
</pre>
<p>Make sure these are in <strong>karma.conf.js</strong>:</p>
<pre>        preprocessors: {
                '**/*.html': []
        },
</pre>
<p>Now add code to <strong>spec/test-basic.js</strong> that will set things up so we can:</p>
<ul>
<li>Load the <strong>elfApp</strong> module from <strong>control.js</strong></li>
<li>Load the <strong>MainController</strong> from <strong>control.js</strong></li>
<li>Initialize <strong>$compile</strong> and <strong>$templateCache</strong> so we can convert angular templates into valid HTML</li>
</ul>
<p>Here is the code for <strong>test-basic</strong>:</p>
<pre>describe('Elvenware Simple Plain Suite', function() {

    'use strict';

    var scope;
    var mainController;
    var $templateCache;
    var $compile;

    // Load the elfApp module from control.js with reference in layout.jade
    beforeEach(module('elfApp'));

    /*
     * instantiate the controller stand-alone, without the directive
     * We also get the Angular compiler and templateCache so we can process angular templates
     */
    beforeEach(inject(function(_$compile_, _$rootScope_, _$templateCache_, _$controller_) {
        scope = _$rootScope_.$new();
        $compile = _$compile_;
        $templateCache = _$templateCache_;
        mainController = _$controller_('MainController', {
            $scope: scope
        });
    }));

    it('expects true to be true', function() {
        expect(true).toBe(true);
    });
});
</pre>
<p>Now lets see if we can get our template to compile:</p>
<pre>it('tests scope variable access in template loaded through raw text', function() {
        $templateCache.put('marie',
                '<div id="marie">' +
                '   <p><span class="caption">First</span>: {{marie.firstName}}</p>' +
                '   <p><span class="caption">Last</span>: {{marie.lastName}}</p>' +
                '   <p><span class="caption">City</span>: {{marie.city}}</p>' +
                '</div>');

        var element = $compile('<elf-marie></elf-marie>')(scope);
        scope.$digest();

        // Check that the compiled element contains the templated content
        expect(element.text()).toContain('Paris');
});
</pre>
<p>The goal here is to get the expressions that reference marie.firstName, etc, to resolve the strings from our model in <strong>control.js</strong>. In other words, when we call <strong>scope.$digest</strong>, is <strong>{{marie.firstName}}</strong> replaced with <strong>marie</strong> and <strong>{{marie.city}}</strong> replaced with <strong>Paris</strong>. Our test checks for the latter case.</p>
<a class="anchor" id="fixtures"></a>
<h2>Fixtures</h2>
<p>Create the HTML for our test by running jade manually:</p>
<pre>jade views/marie.jade --out spec/fixtures/
</pre>
<p><strong>NOTE</strong>: <em>If this call fails, try <strong>npm install -g jade</strong>. As you will see later, we can automate this process through grunt.</em></p>
<p>Then rendered HTML looks like this:</p>
<pre><div id="marie">
    <p><span class="caption">First</span>: {{marie.firstName}}</p>
    <p><span class="caption">Last</span>: {{marie.lastName}}</p>
    <p><span class="caption">City</span>: {{marie.city}}</p>
</div>
</pre>
<p>Add the library that enables us to load HTML into our tests. This is called loading a fixture.</p>
<pre>npm uninstall grunt-exec --save-dev
npm install jasmine-jquery --save-dev
</pre>
<p>Here is how to load the <strong>marie.html</strong> fixture in our test and check that it works:</p>
<pre>// Load marie.html so we can test against it
beforeEach(function() {
        jasmine.getFixtures().fixturesPath = 'base/spec/fixtures/';
        loadFixtures('marie.html');
});

it('should be possible to access the marie fixture', function() {
        var spanElement = document.getElementById('marie');
        expect(spanElement).toBeDefined();
        expect(spanElement.innerHTML).toContain('First');
});
</pre>
<p>And then, finally, let&#39;s put it all together, loading our fixture and compiling the template:</p>
<pre>it('tests scope variable access in template loaded through fixture', function() {
        // Get element from fixture
        var el = document.getElementById('marie');
        $templateCache.put('marie', el);
        var element = $compile('<elf-marie></elf-marie>')(scope);
        scope.$digest();
        // Check that the compiled element contains the templated content
        expect(element.text()).toContain('Paris');
});
</pre>
<p>Note how these directive can be attached to our HTML as shown in the previous section.</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Push your work to your repository and submit the assignment. Leave a comment, particular if there is anything you think I should know.</p>
</div></body></html>