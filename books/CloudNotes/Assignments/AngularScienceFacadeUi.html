<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularScienceFacadeUi</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>AngularScienceFacadeUi</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#description">Description</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#step-five">Step Five</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#discussion">Discussion</a></li><!--TOC_End--></ul><h2 id="description">Description</h2>
<p>Our goals are two fold:</p>
<ul>
<li>Create an application that can either use:<ul>
<li>a mock <strong>SimpleScienceData</strong> object </li>
<li>the Mongo based  <strong>ScienceResource</strong> object.</li>
</ul>
</li>
<li>Show how to use ExpressRoutes to retrieve HTML<ul>
<li>And dynamically insert the results into our documents</li>
</ul>
</li>
<li>Appending methods dynamically to an existing object.<ul>
<li>We add new methods to the objects in our array of data</li>
</ul>
</li>
<li>Show how to use ControllerAs in a <strong>directive</strong></li>
<li>Learn more about querying with the <strong>$resource</strong> object and its custom URLs.</li>
<li>Mostly for fun, but also because it can be useful during development, lets have some of our tests be part of the our running program.</li>
</ul>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/AngularScienceFacadeUi01.png" alt="Sample output for tests"></p>
<h2 id="step-one">Step One</h2>
<p>Download the <a href="https://drive.google.com/file/d/0B25UTAlOfPRGSTNRRk5qVkF1eTg/view?usp=sharing">starter project</a>.</p>
<p>Note that it is similar to the project we used on Monday but we have renamed some methods in ScienceFacade to bring them in line with the Angular $resource object that uses MongoDb. In the list below, the original method name is on the left and the new name on the right: </p>
<ul>
<li>getAll -&gt; query</li>
<li>delete -&gt; remove</li>
<li>update -&gt; updateDocument</li>
</ul>
<p>We have also added a method called <strong>assignMethods</strong>. Its purpose is to ensure that each list we create has certain methods available on it. Again, we do this to maintain compatibility with Angular resource. </p>
<p>A few additional changes were made.</p>
<h2 id="step-two">Step Two</h2>
<p>Routing</p>
<p>When we send a request from the client back to the server, it is routed to the appropriate method using the <strong>express Router</strong>. See, for instance, <strong>routes/index.js</strong>. Place the following in <strong>index.js</strong>:</p>
<pre><code>router.get(<span class="hljs-string">'/:id'</span>, function(req, res, <span class="hljs-keyword">next</span>) {
  console.log(req.params.id)<span class="hljs-comment">;</span>
  res.render(<span class="hljs-string">'ScienceInfo/'</span> + req.params.id, { <span class="hljs-keyword">title</span>: req.params.id })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre><p>Create a new folder called: <strong>views/ScienceInfo</strong>. Place three files in it:</p>
<p>astronomy.jade:</p>
<pre><code><span class="hljs-selector-tag">h1</span> Astronomy

<span class="hljs-selector-tag">p</span> Astronomy is <span class="hljs-selector-tag">a</span> subject
</code></pre><p>physics.jade:</p>
<pre><code><span class="hljs-selector-tag">h1</span> Physics

<span class="hljs-selector-tag">p</span> Physics is <span class="hljs-selector-tag">a</span> subject
</code></pre><p>radioactivity.jade:</p>
<pre><code><span class="hljs-selector-tag">h1</span> Radioactivity

<span class="hljs-selector-tag">p</span> Radioactivity is <span class="hljs-selector-tag">a</span> subject
</code></pre><p>We can see the result of our new route by entering the following URL in our browser:</p>
<pre><code><span class="hljs-symbol">localhost:</span><span class="hljs-number">30025</span>/astronomy
<span class="hljs-symbol">localhost:</span><span class="hljs-number">30025</span>/physics
<span class="hljs-symbol">localhost:</span><span class="hljs-number">30025</span>/radioactivity 
</code></pre><p>In order to invoke those routes from our program, we place the following method in our controller:</p>
<pre><code>        myController.loadDocument = <span class="hljs-keyword">function</span>() {
            $http.get(<span class="hljs-string">'/'</span> + myController.subject.toLowerCase())
                .success(function(document, status, headers, config) {
                    myController.document = $sce.trustAsHtml(document);
                })
                .error(function(data, status, headers, config) {
                    alert(<span class="hljs-string">"Somethings wrong"</span>)
                });
        }
</code></pre><p>The above code uses the angular <strong>$http.get</strong> method to send the request to the server. This is known as <strong>ajax</strong>. The method has parallel in <strong>jquery</strong> called <strong>$.ajax</strong>.</p>
<p>In our controller, you should call <strong>loadDocument</strong> at the end of the callback found in <strong>loadScientists</strong> and at the end of <strong>indexChange</strong>. In other words, when those two functions are called, they should ensure that loadDocument is called. This way we can see the document associate with each of our scientists.</p>
<h2 id="step-three">Step Three</h2>
<p>The <strong>directive</strong>.</p>
<p>Appended at the bottom of <strong>Control.js</strong>: </p>
<pre><code>    app.directive(<span class="hljs-string">'elfMarie'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scientists)</span> </span>{
        <span class="hljs-keyword">return</span> {
            controller: <span class="hljs-string">'MyController'</span>,
            controllerAs: <span class="hljs-string">'myController'</span>,
            template:
            <span class="hljs-string">'First: {{myController.marie.firstName}} '</span> +
            <span class="hljs-string">'&lt;br&gt;Last: {{myController.marie.lastName}}'</span> +
            <span class="hljs-string">'&lt;br&gt;City: {{myController.marie.subject}}'</span>
        };
    });
</code></pre><h2 id="step-four">Step Four</h2>
<p>The latest version of MongoDb Angular Resource. Put it in the <strong>public/javascripts</strong> folder and name it <strong>ScienceResource.js</strong>. (In MongoCrud, we called it <strong>resource.js</strong>. We have refactored the name, and modified it slightly. In particular we added the <strong>getTopic</strong> method.)</p>
<pre><code>angular.module(<span class="hljs-string">'Science'</span>, [<span class="hljs-string">'ngResource'</span>])

    .constant(<span class="hljs-string">'CONFIG'</span>, {
        DB_NAME: <span class="hljs-string">'elvenlab01'</span>,
        COLLECTION: <span class="hljs-string">'scientists'</span>,
        API_KEY: <span class="hljs-string">'qfSxFoUGHBA1EuUlqhux_op2fy6oF_wy'</span>
    })

    .factory(<span class="hljs-string">'scientists'</span>, <span class="hljs-keyword">function</span> ($resource, CONFIG) {
        console.log(<span class="hljs-string">'Scientists factory called'</span>);

        var scientists = $resource(
            <span class="hljs-string">'https://api.mongolab.com/api/1/databases/'</span> + CONFIG.DB_NAME +
            <span class="hljs-string">'/collections/'</span> + CONFIG.COLLECTION + <span class="hljs-string">'/:id'</span>, {
                apiKey: CONFIG.API_KEY
            },
            {
                update: {method: <span class="hljs-string">'PUT'</span>}
            });

        scientists.prototype.getTopic = function(firstNameToFind, callback) {
            bar = $resource(
                <span class="hljs-string">'https://api.mongolab.com/api/1/databases/'</span> + CONFIG.DB_NAME +
                <span class="hljs-string">'/collections/'</span> + CONFIG.COLLECTION, {
                    apiKey: CONFIG.API_KEY,
                    q: {<span class="hljs-string">"firstName"</span>: firstNameToFind }
                });
            return bar.query({}, callback);
        };

        scientists.prototype.getFirstName = function () {
            return this.firstName;
        };

        scientists.prototype.getLastName = function () {
            return this.lastName;
        };

        scientists.prototype.getSubject = function () {
            return this.subject;
        };


        scientists.prototype.add = function(newData, callback) {
            var scientistResource = new scientists(newData);
            scientistResource.$save(callback);
        };

        scientists.prototype.updateDocument = function (successCallback, errorCallback) {
            console.log(<span class="hljs-string">"update called"</span>);
            var idObject = {id: this._id.$oid};
            var updateData = angular.extend({}, this, {_id:undefined});
            scientists.update(
                idObject,
                updateData,
                successCallback,
                errorCallback);
        };

        scientists.prototype.remove = function (successCallback, errorCallback) {
            scientists.remove({id:this._id.$oid}, successCallback, errorCallback);
        };

        return scientists;
    });
</code></pre><h2 id="step-five">Step Five</h2>
<p>Now lets test dependency injection. In <strong>layout.js</strong>, swap out</p>
<h2 id="turn-it-in">Turn it in</h2>
<p>Check your final working program into your repository in a folder called <strong>Week06-TestLive02</strong>. Press the submit button for the assignment and add a comment or two as appropriate.</p>
<p>Make sure your requests go against your database, not against my database.</p>
<p>There is no need to match the sample output shown below exactly. It is meant only as a general guideline.</p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/AngularScienceFacadeUi02.png" alt="Sample output for main page"></p>
<h2 id="discussion">Discussion</h2>
<p>Notice the call to getTopic:</p>
<pre><code>   scientists.prototype.getTopic = <span class="hljs-keyword">function</span>(firstNameToFind, callback) {
       bar = $resource(
            <span class="hljs-string">'https://api.mongolab.com/api/1/databases/'</span> + CONFIG.DB_NAME +
            <span class="hljs-string">'/collections/'</span> + CONFIG.COLLECTION, {
                 apiKey: CONFIG.API_KEY,
                 q: {<span class="hljs-string">"firstName"</span>: firstNameToFind }
             }
     );
     return bar.query({}, callback);
</code></pre><p>Go to the Network page in the Chrome Developer tools and see the URL this creates. Run the URL in the address bar of your browser.  </p>
</div></body></html>