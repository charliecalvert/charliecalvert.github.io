<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularScienceFacadeUi</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>AngularScienceFacadeUi</h1><p>Welcome to AngularScienceFacadeUi</p><ul><!--TOC_Start--><li><a href="#description">Description</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#step-five">Step Five</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#discussion">Discussion</a></li><!--TOC_End--></ul></div><div class="container"><a class="anchor" id="description"></a>
<h2>Description</h2>
<p>Our goals are two fold:</p>
<ul>
<li>Create an application that can either use:<ul>
<li>a mock <strong>SimpleScienceData</strong> object </li>
<li>the Mongo based  <strong>ScienceResource</strong> object.</li>
</ul>
</li>
<li>Show how to use ExpressRoutes to retrieve HTML<ul>
<li>And dynamically insert the results into our documents</li>
</ul>
</li>
<li>Appending methods dynamically to an existing object.<ul>
<li>We add new methods to the objects in our array of data</li>
</ul>
</li>
<li>Show how to use ControllerAs in a <strong>directive</strong></li>
<li>Learn more about querying with the <strong>$resource</strong> object and its custom URLs.</li>
<li>Mostly for fun, but also because it can be useful during development, lets have some of our tests be part of the our running program.</li>
</ul>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/AngularScienceFacadeUi01.png" alt="Sample output for tests"></p>
<a class="anchor" id="step-one"></a>
<h2>Step One</h2>
<p>Download the <a href="https://drive.google.com/file/d/0B25UTAlOfPRGSTNRRk5qVkF1eTg/view?usp=sharing">starter project</a>.</p>
<p>Note that it is similar to the project we used on Monday but we have renamed some methods in ScienceFacade to bring them in line with the Angular $resource object that uses MongoDb. In the list below, the original method name is on the left and the new name on the right: </p>
<ul>
<li>getAll -&gt; query</li>
<li>delete -&gt; remove</li>
<li>update -&gt; updateDocument</li>
</ul>
<p>We have also added a method called <strong>assignMethods</strong>. Its purpose is to ensure that each list we create has certain methods available on it. Again, we do this to maintain compatibility with Angular resource. </p>
<p>A few additional changes were made.</p>
<a class="anchor" id="step-two"></a>
<h2>Step Two</h2>
<p>Routing</p>
<p>When we send a request from the client back to the server, it is routed to the appropriate method using the <strong>express Router</strong>. See, for instance, <strong>routes/index.js</strong>. Place the following in <strong>index.js</strong>:</p>
<pre>router.get('/:id', function(req, res, next) {
  console.log(req.params.id);
  res.render('ScienceInfo/' + req.params.id, { title: req.params.id });
});
</pre>
<p>Create a new folder called: <strong>views/ScienceInfo</strong>. Place three files in it:</p>
<p>astronomy.jade:</p>
<pre>h1 Astronomy

p Astronomy is a subject
</pre>
<p>physics.jade:</p>
<pre>h1 Physics

p Physics is a subject
</pre>
<p>radioactivity.jade:</p>
<pre>h1 Radioactivity

p Radioactivity is a subject
</pre>
<p>We can see the result of our new route by entering the following URL in our browser:</p>
<pre>localhost:30025/astronomy
localhost:30025/physics
localhost:30025/radioactivity 
</pre>
<p>In order to invoke those routes from our program, we place the following method in our controller:</p>
<pre>        myController.loadDocument = function() {
            $http.get('/' + myController.subject.toLowerCase())
                .success(function(document, status, headers, config) {
                    myController.document = $sce.trustAsHtml(document);
                })
                .error(function(data, status, headers, config) {
                    alert("Somethings wrong")
                });
        }
</pre>
<p>The above code uses the angular <strong>$http.get</strong> method to send the request to the server. This is known as <strong>ajax</strong>. The method has parallel in <strong>jquery</strong> called <strong>$.ajax</strong>.</p>
<p>In our controller, you should call <strong>loadDocument</strong> at the end of the callback found in <strong>loadScientists</strong> and at the end of <strong>indexChange</strong>. In other words, when those two functions are called, they should ensure that loadDocument is called. This way we can see the document associate with each of our scientists.</p>
<a class="anchor" id="step-three"></a>
<h2>Step Three</h2>
<p>The <strong>directive</strong>.</p>
<p>Appended at the bottom of <strong>Control.js</strong>: </p>
<pre>    app.directive('elfMarie', function(scientists) {
        return {
            controller: 'MyController',
            controllerAs: 'myController',
            template:
            'First: {{myController.marie.firstName}} ' +
            '<br>Last: {{myController.marie.lastName}}' +
            '<br>City: {{myController.marie.subject}}'
        };
    });
</pre>
<a class="anchor" id="step-four"></a>
<h2>Step Four</h2>
<p>The latest version of MongoDb Angular Resource. Put it in the <strong>public/javascripts</strong> folder and name it <strong>ScienceResource.js</strong>. (In MongoCrud, we called it <strong>resource.js</strong>. We have refactored the name, and modified it slightly. In particular we added the <strong>getTopic</strong> method.)</p>
<pre>angular.module('Science', ['ngResource'])

    .constant('CONFIG', {
        DB_NAME: 'elvenlab01',
        COLLECTION: 'scientists',
        API_KEY: 'qfSxFoUGHBA1EuUlqhux_op2fy6oF_wy'
    })

    .factory('scientists', function ($resource, CONFIG) {
        console.log('Scientists factory called');

        var scientists = $resource(
            'https://api.mongolab.com/api/1/databases/' + CONFIG.DB_NAME +
            '/collections/' + CONFIG.COLLECTION + '/:id', {
                apiKey: CONFIG.API_KEY
            },
            {
                update: {method: 'PUT'}
            });

        scientists.prototype.getTopic = function(firstNameToFind, callback) {
            bar = $resource(
                'https://api.mongolab.com/api/1/databases/' + CONFIG.DB_NAME +
                '/collections/' + CONFIG.COLLECTION, {
                    apiKey: CONFIG.API_KEY,
                    q: {"firstName": firstNameToFind }
                });
            return bar.query({}, callback);
        };

        scientists.prototype.getFirstName = function () {
            return this.firstName;
        };

        scientists.prototype.getLastName = function () {
            return this.lastName;
        };

        scientists.prototype.getSubject = function () {
            return this.subject;
        };


        scientists.prototype.add = function(newData, callback) {
            var scientistResource = new scientists(newData);
            scientistResource.$save(callback);
        };

        scientists.prototype.updateDocument = function (successCallback, errorCallback) {
            console.log("update called");
            var idObject = {id: this._id.$oid};
            var updateData = angular.extend({}, this, {_id:undefined});
            scientists.update(
                idObject,
                updateData,
                successCallback,
                errorCallback);
        };

        scientists.prototype.remove = function (successCallback, errorCallback) {
            scientists.remove({id:this._id.$oid}, successCallback, errorCallback);
        };

        return scientists;
    });
</pre>
<a class="anchor" id="step-five"></a>
<h2>Step Five</h2>
<p>Now lets test dependency injection. In <strong>layout.js</strong>, swap out</p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Check your final working program into your repository in a folder called <strong>Week06-TestLive02</strong>. Press the submit button for the assignment and add a comment or two as appropriate.</p>
<p>Make sure your requests go against your database, not against my database.</p>
<p>There is no need to match the sample output shown below exactly. It is meant only as a general guideline.</p>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/AngularScienceFacadeUi02.png" alt="Sample output for main page"></p>
<a class="anchor" id="discussion"></a>
<h2>Discussion</h2>
<p>Notice the call to getTopic:</p>
<pre>   scientists.prototype.getTopic = function(firstNameToFind, callback) {
       bar = $resource(
            'https://api.mongolab.com/api/1/databases/' + CONFIG.DB_NAME +
            '/collections/' + CONFIG.COLLECTION, {
                 apiKey: CONFIG.API_KEY,
                 q: {"firstName": firstNameToFind }
             }
     );
     return bar.query({}, callback);
</pre>
<p>Go to the Network page in the Chrome Developer tools and see the URL this creates. Run the URL in the address bar of your browser.  </p>
</div></body></html>