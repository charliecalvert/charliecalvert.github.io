<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>AngularScienceFacadeUi</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/components/jquery/"></script><script src="components/angular/angular.js"></script><script src="components/angular-route/angular-route.js"></script><script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>AngularScienceFacadeUi</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#description">Description</a></li>
<li><a href="#step-one">Step One</a></li>
<li><a href="#step-two">Step Two</a></li>
<li><a href="#step-three">Step Three</a></li>
<li><a href="#step-four">Step Four</a></li>
<li><a href="#step-five">Step Five</a></li>
<li><a href="#turn-it-in">Turn it in</a></li>
<li><a href="#discussion">Discussion</a></li><!--TOC_End--></ul><h2 id="description">Description</h2>
<p>Our goals are two fold:</p>
<ul>
<li>Create an application that can either use:<ul>
<li>a mock <strong>SimpleScienceData</strong> object </li>
<li>the Mongo based  <strong>ScienceResource</strong> object.</li>
</ul>
</li>
<li>Show how to use ExpressRoutes to retrieve HTML<ul>
<li>And dynamically insert the results into our documents</li>
</ul>
</li>
<li>Appending methods dynamically to an existing object.<ul>
<li>We add new methods to the objects in our array of data</li>
</ul>
</li>
<li>Show how to use ControllerAs in a <strong>directive</strong></li>
<li>Learn more about querying with the <strong>$resource</strong> object and its custom URLs.</li>
<li>Mostly for fun, but also because it can be useful during development, lets have some of our tests be part of the our running program.</li>
</ul>
<h2 id="step-one">Step One</h2>
<p>Download the <a href="https://drive.google.com/file/d/0B25UTAlOfPRGSTNRRk5qVkF1eTg/view?usp=sharing">starter project</a>.</p>
<p>Note that it is similar to the project we used on Monday but we have renamed some methods in ScienceFacade to bring them in line with the Angular $resource object that uses MongoDb. In the list below, the original method name is on the left and the new name on the right: </p>
<ul>
<li>getAll -&gt; query</li>
<li>delete -&gt; remove</li>
<li>update -&gt; updateDocument</li>
</ul>
<p>We have also added a method called <strong>assignMethods</strong>. Its purpose is to ensure that each list we create has certain methods available on it. Again, we do this to maintain compatibility with Angular resource. </p>
<p>A few additional changes were made.</p>
<h2 id="step-two">Step Two</h2>
<p>Routing</p>
<p>When we send a request from the client back to the server, it is routed to the appropriate method using the <strong>express Router</strong>. See, for instance, <strong>routes/index.js</strong>. Place the following in <strong>index.js</strong>:</p>
<pre><code>router.get(&#39;/:id&#39;, function(req, res, next) {
  console.log(req.params.id);
  res.render(&#39;ScienceInfo/&#39; + req.params.id, { title: req.params.id });
});
</code></pre><p>Create a new folder called: <strong>views/ScienceInfo</strong>. Place three files in it:</p>
<p>astronomy.jade:</p>
<pre><code>h1 Astronomy

p Astronomy is a subject
</code></pre><p>physics.jade:</p>
<pre><code>h1 Physics

p Physics is a subject
</code></pre><p>radioactivity.jade:</p>
<pre><code>h1 Radioactivity

p Radioactivity is a subject
</code></pre><p>We can see the result of our new route by entering the following URL in our browser:</p>
<pre><code>localhost:30025/astronomy
localhost:30025/physics
localhost:30025/radioactivity 
</code></pre><p>In order to invoke those routes from our program, we place the following method in our controller:</p>
<pre><code>        myController.loadDocument = function() {
            $http.get(&#39;/&#39; + myController.subject.toLowerCase())
                .success(function(document, status, headers, config) {
                    myController.document = $sce.trustAsHtml(document);
                })
                .error(function(data, status, headers, config) {
                    alert(&quot;Somethings wrong&quot;)
                });
        }
</code></pre><p>The above code uses the angular <strong>$http.get</strong> method to send the request to the server. This is known as <strong>ajax</strong>. The method has parallel in <strong>jquery</strong> called <strong>$.ajax</strong>.</p>
<p>In our controller, you should call <strong>loadDocument</strong> at the end of the callback found in <strong>loadScientists</strong> and at the end of <strong>indexChange</strong>. In other words, when those two functions are called, they should ensure that loadDocument is called. This way we can see the document associate with each of our scientists.</p>
<h2 id="step-three">Step Three</h2>
<p>The <strong>directive</strong>.</p>
<p>Appended at the bottom of <strong>Control.js</strong>: </p>
<pre><code>    app.directive(&#39;elfMarie&#39;, function(scientists) {
        return {
            controller: &#39;MyController&#39;,
            controllerAs: &#39;myController&#39;,
            template:
            &#39;First: {{myController.marie.firstName}} &#39; +
            &#39;&lt;br&gt;Last: {{myController.marie.lastName}}&#39; +
            &#39;&lt;br&gt;City: {{myController.marie.subject}}&#39;
        };
    });
</code></pre><h2 id="step-four">Step Four</h2>
<p>The latest version of MongoDb Angular Resource. Put it in the <strong>public/javascripts</strong> folder and name it <strong>ScienceResource.js</strong>. (In MongoCrud, we called it <strong>resource.js</strong>. We have refactored the name, and modified it slightly. In particular we added the <strong>getTopic</strong> method.)</p>
<pre><code>angular.module(&#39;Science&#39;, [&#39;ngResource&#39;])

    .constant(&#39;CONFIG&#39;, {
        DB_NAME: &#39;elvenlab01&#39;,
        COLLECTION: &#39;scientists&#39;,
        API_KEY: &#39;qfSxFoUGHBA1EuUlqhux_op2fy6oF_wy&#39;
    })

    .factory(&#39;scientists&#39;, function ($resource, CONFIG) {
        console.log(&#39;Scientists factory called&#39;);

        var scientists = $resource(
            &#39;https://api.mongolab.com/api/1/databases/&#39; + CONFIG.DB_NAME +
            &#39;/collections/&#39; + CONFIG.COLLECTION + &#39;/:id&#39;, {
                apiKey: CONFIG.API_KEY
            },
            {
                update: {method: &#39;PUT&#39;}
            });

        scientists.prototype.getTopic = function(firstNameToFind, callback) {
            bar = $resource(
                &#39;https://api.mongolab.com/api/1/databases/&#39; + CONFIG.DB_NAME +
                &#39;/collections/&#39; + CONFIG.COLLECTION, {
                    apiKey: CONFIG.API_KEY,
                    q: {&quot;firstName&quot;: firstNameToFind }
                });
            return bar.query({}, callback);
        };

        scientists.prototype.getFirstName = function () {
            return this.firstName;
        };

        scientists.prototype.getLastName = function () {
            return this.lastName;
        };

        scientists.prototype.getSubject = function () {
            return this.subject;
        };


        scientists.prototype.add = function(newData, callback) {
            var scientistResource = new scientists(newData);
            scientistResource.$save(callback);
        };

        scientists.prototype.updateDocument = function (successCallback, errorCallback) {
            console.log(&quot;update called&quot;);
            var idObject = {id: this._id.$oid};
            var updateData = angular.extend({}, this, {_id:undefined});
            scientists.update(
                idObject,
                updateData,
                successCallback,
                errorCallback);
        };

        scientists.prototype.remove = function (successCallback, errorCallback) {
            scientists.remove({id:this._id.$oid}, successCallback, errorCallback);
        };

        return scientists;
    });
</code></pre><h2 id="step-five">Step Five</h2>
<p>Now lets test dependency injection. In <strong>layout.js</strong>, swap out</p>
<h2 id="turn-it-in">Turn it in</h2>
<p>Check your final working program into your repository in a folder called <strong>Week06-TestLive02</strong>. Press the submit button for the assignment and add a comment or two as appropriate.</p>
<p>Make sure your requests go against your database, not against my database.</p>
<h2 id="discussion">Discussion</h2>
<p>Notice the call to getTopic:</p>
<pre><code>   scientists.prototype.getTopic = function(firstNameToFind, callback) {
       bar = $resource(
            &#39;https://api.mongolab.com/api/1/databases/&#39; + CONFIG.DB_NAME +
            &#39;/collections/&#39; + CONFIG.COLLECTION, {
                 apiKey: CONFIG.API_KEY,
                 q: {&quot;firstName&quot;: firstNameToFind }
             }
     );
     return bar.query({}, callback);
</code></pre><p>Go to the Network page in the Chrome Developer tools and see the URL this creates. Run the URL in the address bar of your browser.  </p>
</div></body></html>