<!DOCTYPE html>
<html dir="ltr">

<head>
	<meta charset="utf-8" />
	<title>Prog282Midterm2014</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/charlie/images/favicon.png">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<!-- Optional theme -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">
	<link href="/charlie/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css" />
	<!-- Latest compiled and minified JavaScript - Move to bottom of body element -->
	<script src="//code.jquery.com/jquery.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<script src="/charlie/libs/scripts/elvenware.js" type="text/javascript"></script>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-2806409-2']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
</head>

<body>



	<!-- removed  navbar-fixed-top -->
	<div class="navbar navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"> </span>
					<span class="icon-bar"> </span>
					<span class="icon-bar"> </span>
				</button>
				<a class="navbar-brand" href="/charlie/index.html">Elvenware</a>
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="/charlie/index.html">Home</a></li>
					<li><a href="/charlie/contents.html">About</a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li class="dropdown-header">Core Code</li>
							<li><a href="/charlie/development/index.html">Strongly Typed</a></li>
							<li><a href="/charlie/development/web/index.html">Web &amp; Scripts</a></li>
							<li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">OS and Tools</li>
							<li><a href="/charlie/os/index.html">OS</a></li>
							<li><a href="/charlie/development/database/index.html">Database</a></li>
							<li><a href="/charlie/books/index.html">My Writing</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Art</li>
							<li><a href="/charlie/Art/index.html">Poems &amp; Photos</a></li>
							<li><a href="/charlie/books/reading/index.html">Book Reviews</a></li>
							<li><a href="/charlie/spirit/index.html">Spiritual</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Links</li>
							<li><a href="/charlie/links.html">My Links</a></li>
							<li><a href="http://www.github.com/charliecalvert">GitHub</a></li>
							<li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li>
						</ul>
					</li>
				</ul>
			</div><!--/.nav-collapse -->
		</div>
	</div>

	<div class="container">

		<div class="starter-template">
			<figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png" /></figure>
<h2>Table of Contents</h2>
<ul class="elfTocHeading">
	<li><a href='#prog-282-midterm-spring-2014'>Prog 282 Midterm Spring 2014</a></li>
	<li><a href='#step-01-create-an-express-project.'>Step 01: Create an express project.</a></li>
	<li><a href='#step-02-project-name-and-port'>Step 02: Project Name and Port</a></li>
	<li><a href='#step04-set-up-the-client'>Step04: Set up the Client</a></li>
	<li><a href='#pass-data-to-the-server'>Pass Data to the Server</a></li>
	<li><a href='#add-a-new-page'>Add a new Page</a></li>
	<li><a href='#create-a-application-control-page'>Create a Application Control Page</a></li>
	<li><a href='#create-a-factory'>Create a Factory</a></li>
	<li><a href='#call-into-newpage'>Call into NewPage</a></li>
	<li><a href='#refactor'>Refactor</a></li>
	<li><a href='#do-it'>Do It</a></li>
	<li><a href='#the-calculatepage'>The CalculatePage</a></li>
	<li><a href='#the-convert-page'>The convert page</a></li>
	<li><a href='#position-page'>Position Page</a></li>
	<li><a href='#turn-it-in'>Turn It In</a></li>
</ul>
<h1 id="prog-282-midterm-spring-2014">Prog 282 Midterm Spring 2014</h1>
<p>The goal of this assignment is to learn more about using Ajax to pass data between a client and server. We will also learn more about Express and Jade.</p>
<p>This is the midterm. A variant on the old midterm will probably become the final.</p>
<h2 id="step-01-create-an-express-project.">Step 01: Create an express project.</h2>
<p>Go to the command line and create an express project:</p>
<pre><code>express Week07RoutingData
cd Week07RoutingData
npm install</code></pre>
<p>If you want to edit this in Eclipse:</p>
<ul>
<li><strong>File | Import | Existing <em>Folder</em> into Eclipse</strong></li>
<li>Browse to your folder on disk</li>
<li>Set the Project name to <strong>Week07RoutingData-LastName</strong> where <strong>LastName</strong> is your last name.</li>
<li>Click finish</li>
<li>Optionally set up a working set for your project</li>
</ul>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/EclipseImportProject.png" alt="Import" /><figcaption>Import</figcaption>
</figure>
<p>If the above fails. Copy the .project file from <a href="https://github.com/charliecalvert/JsObjects/blob/master/JavaScript/NodeCode/jsonRead/.project">JsonRead</a> into your project and change the name field to Week07RoutingData-LastName where LastName is your last name. Then use <strong>File | Import | General | Existing <em>Project</em> into Workspace</strong>.</p>
<h2 id="step-02-project-name-and-port">Step 02: Project Name and Port</h2>
<p>Open <strong>index.js</strong> in Eclipse or Geany.</p>
<p><strong>Note</strong>: <em>If you want to use Geany, remember to first open Geany from the desktop (GUI). Then open the file in geany from the command line like this:</em></p>
<pre><code>geany routes/index.js</code></pre>
<p><em>If you type the above without first opening Geany from the desktop, then you won't be able to use the command line until you close Geany. It may be possible to avoid this need to first open Geany in the Gui by typing something like this: <a href="http://bashitout.com/2013/05/18/Ampersands-on-the-command-line.html%20##Step%2003:%20Set%20up%20a%20route%20on%20the%20server:">geany myfile.txt &amp;</a>.</em></p>
<p>Change the title. Change <strong>req</strong> and <strong>res</strong> to <strong>request</strong> and <strong>response</strong>. Indent <strong>response.render</strong> four spaces or one tab instead of two spaces:</p>
<pre><code>/* GET home page. */
router.get(&#39;/&#39;, function(request, response) {
    response.render(&#39;index&#39;, { title: &#39;Week07 Routing Data Calvert&#39; });
});</code></pre>
<p>Can you see the white space (tabs, spaces, line endings) in your editor?</p>
<ul>
<li>In Geany: <strong>View | Editor | Show Whitespace</strong></li>
<li>In Eclipse: <strong>Window | Preferences | General | Editors | Text Editors | Show Whitespace</strong></li>
</ul>
<p>Now let's set the port. Open up www in your editor:</p>
<ul>
<li><strong>geany bin/www</strong> or just open it in Eclipse</li>
<li>change the port to 30025</li>
</ul>
<p>Here is the edit:</p>
<pre><code>app.set(&#39;port&#39;, process.env.PORT || 30025);</code></pre>
<p>Add a <strong>sayHello</strong> route to <strong>index.js</strong>:</p>
<pre><code>router.get(&#39;/sayHello&#39;, function(request, response) {
    response.send({ result: &quot;The server says Hello&quot; });
});</code></pre>
<p>Test it:</p>
<ul>
<li>npm start</li>
<li>Open your browser and browse to http://localhost:30025/sayHello</li>
<li>You should see: {&quot;result&quot;:&quot;Hello&quot;}</li>
</ul>
<p>Go to port 30025 and set the route to <strong>sayHello</strong>:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing01.png" alt="RoutingHello" /><figcaption>RoutingHello</figcaption>
</figure>
<h2 id="step04-set-up-the-client">Step04: Set up the Client</h2>
<p>First, let's create a button and paragraph element:</p>
<ul>
<li>Open views/index.jade</li>
<li>Add a button with an id of <strong>sayHello</strong>: button#sayHello Say Hello</li>
<li>Add a paragraph with an id of <strong>paragraph01</strong>: p#paragraph01</li>
</ul>
<p>The contents of <strong>index.jade</strong>:</p>
<pre><code>extends layout

block content
  h1= title
  p Welcome to #{title}

  button#buttonSayHello Say Hello
  p#paragraph01</code></pre>
<p>Open up <strong>layout.jade</strong> and set up require.</p>
<p>Get Main.js, require and jquery:</p>
<pre><code>cd public/javascripts
wget http://requirejs.org/docs/release/2.1.11/comments/require.js
wget http://code.jquery.com/jquery-2.1.1.js
wget http://elvenware.com/charlie/development/web/JavaScript/Scripts/Main.js </code></pre>
<p><strong>Note</strong>: <em>The <strong>wget</strong> program ships with Linux. For Windows it is <a href="http://wget.addictivecode.org/FrequentlyAskedQuestions?action=show&amp;redirect=Faq#download">here</a>. I store the above commands as scripts on <a href="https://github.com/charliecalvert/JsObjects/tree/master/Utilities/InstallScripts">JsObjects</a> in <strong>RequiryJQuery.bat</strong> and <strong>RequireJquery.sh</strong>. You should copy one of these scripts to some place on your path, such as your <strong>$HOME/bin</strong> directory. After copying it, you might need to set its executable permissions</em>:</p>
<pre><code>chmod +x RequireJquery.sh</code></pre>
<p><em>Alternatively, you can browse to it using the GUI file explorer, right click on it, and use the permissions to set the permissions for the file to executable. (If you skip this step, you might get a permissions error when you try to run the file.)</em></p>
<p><em>Once the script is set up, then the commands to use it are</em>:</p>
<pre><code>cd public/javascripts
RequireJQuery.sh</code></pre>
<p><em>You can simplify the above by creating a <a href="http://www.cyberciti.biz/faq/creating-soft-link-or-symbolic-link/">symbolic link</a> between bin/requirejq and the JsObjects source</em>:</p>
<pre><code>ln -s /home/bcuser/Git/JsObjects/Utilities/InstallScripts/RequireJquery.sh requirejq</code></pre>
<p><em>Now you should be able to download all three files from anywhere you have file creation rights by just typing <strong>requirejq</strong>.</em></p>
<p>The RequireJquery script will download require, jquery and <strong>Main.js</strong>. Your <strong>Main.js</strong> file should look like this:</p>
<pre><code>require.config({
    paths : {
        &quot;jquery&quot; : &quot;jquery-2.1.1&quot;
    }
});

require([&#39;jquery&#39;], 

    function(jq) {
        &#39;use strict&#39;;
        console.log(&quot;Main called&quot;);
    }

);</code></pre>
<p>Modify the callback to look like this:</p>
<pre><code>function(jq) {
    &#39;use strict&#39;;
    console.log(&quot;Main called&quot;);
    $.getJSON(&#39;/sayHello&#39;, function(helloObject) {
        $(&#39;#paragraph01&#39;).html(helloObject.result);
    });
}</code></pre>
<p>Refresh the browser. The output should look something like this:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing02.png" alt="Route02" /><figcaption>Route02</figcaption>
</figure>
<p>We can see the data from the server below the button. Now let's get it to respond to a button click:</p>
<pre><code>require.config({
    paths : {
        &quot;jquery&quot; : &quot;jquery-2.1.1&quot;
    }
});

require([&#39;jquery&#39;], 

    function(jq) {
        &#39;use strict&#39;;
        console.log(&quot;Main called&quot;);
        function getHello() {
            $.getJSON(&#39;/sayHello&#39;, function(helloObject) {
                $(&#39;#paragraph01&#39;).html(helloObject.result);
            });
        }
        
        $(&quot;#buttonSayHello&quot;).click(getHello);
    }</code></pre>
<p>);</p>
<p>Now you see the text only when you click on the button.</p>
<h2 id="pass-data-to-the-server">Pass Data to the Server</h2>
<p>Modify getHello to pass in some information about your browser:</p>
<pre><code>    function errorHandler(fx, status, error) {
        $(&#39;#debug01&#39;).html(fx.responseText);
        $(&#39;#debug02&#39;).html(&#39;error&#39; + error);
    }

    function getHello() {
        var nav = window.navigator;
        var browserInfo = {
            codeName : nav.appCodeName,
            appName : nav.appName,
            version : nav.appVersion,
            platform : nav.platform,
            vendor : nav.vendor,
            product : nav.product,
            userAgent: nav.userAgent
        };

    $.getJSON(&#39;/sayHello&#39;, browserInfo, function(helloObject) {
        $(&#39;#paragraph01&#39;).html(helloObject.result);
        $(&#39;#paragraph02&#39;).html(helloObject.codeName);
        $(&#39;#paragraph03&#39;).html(helloObject.version);
        $(&#39;#paragraph04&#39;).html(helloObject.product);
        $(&#39;#paragraph05&#39;).html(helloObject.userAgent);
    }).error = errorHandler;
}

    $(&quot;#buttonSayHello&quot;).click(getHello);</code></pre>
<p>Handle the Data on the Server something like this:</p>
<pre><code>router.get(&#39;/sayHello&#39;, function(request, response) {    
    console.log(request.query);    

     response.send({ 
        &quot;result&quot;: &quot;The server says Hello&quot;,
        &quot;codeName&quot;: request.query.codeName,
        &quot;product&quot;: request.query.product,
        &quot;version&quot;: request.query.version,
        &quot;userAgent&quot;: request.query.userAgent
     });
});</code></pre>
<p>Note that we get the data passed from the server by examining <strong>request.query</strong>. Be sure to look at the command prompt on the server side so you can see what request.query looks like when printed to the console:</p>
<pre><code>    console.log(request.query);    
    </code></pre>
<p>The result should look like this in Chrome, but it will differ depending on browser and server platform:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing03.png" alt="Route03" /><figcaption>Route03</figcaption>
</figure>
<h2 id="add-a-new-page">Add a new Page</h2>
<p>Create a copy of routes/index.js called routes/NewPage.js. Create a copy of views/index.jade called views/NewPage.jade</p>
<p>Add the following code to index.jade:</p>
<p>a(href=&quot;/NewPage&quot;) New Page</p>
<p>Modify line 6 of <strong>NewPage.js</strong> to load your new page rather than the old page:</p>
<pre><code>router.get(&#39;/&#39;, function(request, response) {
    response.render(&#39;NewPage&#39;, { title: &#39;Week07 Routing Data Calvert&#39; });
});</code></pre>
<p>Notice that we are now rendering <strong>NewPage</strong>, not <strong>index</strong>.</p>
<p>Modify two places in app.js:</p>
<pre><code>var express = require(&#39;express&#39;);
var path = require(&#39;path&#39;);
var favicon = require(&#39;static-favicon&#39;);
var logger = require(&#39;morgan&#39;);
var cookieParser = require(&#39;cookie-parser&#39;);
var bodyParser = require(&#39;body-parser&#39;);

var routes = require(&#39;./routes/index&#39;);
var users = require(&#39;./routes/users&#39;);
var newPage = require(&#39;./routes/NewPage&#39;);   // Here is edit one

var app = express();

// view engine setup
app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));
app.set(&#39;view engine&#39;, &#39;jade&#39;);

app.use(favicon());
app.use(logger(&#39;dev&#39;));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded());
app.use(cookieParser());
app.use(express.static(path.join(__dirname, &#39;public&#39;)));

app.use(&#39;/&#39;, routes);
app.use(&#39;/users&#39;, users);
app.use(&#39;/NewPage&#39;, newPage);             // Here is edit two</code></pre>
<p>These are the two new lines that appear in the above code:</p>
<pre><code>var newPage = require(&#39;./routes/NewPage&#39;);   // Here is edit one
app.use(&#39;/NewPage&#39;, newPage);       // Here is edit two</code></pre>
<p>Modify NewPage.jade so that it looks like this:</p>
<pre><code>extends layout

block content
  h1= title
  p Welcome to #{title}

  h2 This is the new page!</code></pre>
<p>Restart the server, click on your link on the main page. You should be taken to the second page:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing04.png" alt="Route04" /><figcaption>Route04</figcaption>
</figure>
<h2 id="create-a-application-control-page">Create a Application Control Page</h2>
<p>Each object that we create should do one thing, and have one reason to change. Right now, <strong>Main.js</strong> is where we set up <strong>require</strong> and where we respond to button clicks. That's two things and two reasons to change the page as we develop the app. To fix this, we need to move code from <strong>Main.js</strong> into a file called <strong>Control.js</strong>. Here is <strong>control.js</strong>:</p>
<pre><code>define([&#39;jquery&#39;], function(jq) {

    var Control = (function() {

        function Control() {
            $(&quot;#buttonSayHello&quot;).click(getHello);
        }

        function errorHandler(fx, status, error) {
            $(&#39;#debug01&#39;).html(fx.responseText);
            $(&#39;#debug02&#39;).html(&#39;error&#39; + error);
        }

        function getHello() {
            var nav = window.navigator;
            var browserInfo = {
                codeName : nav.appCodeName,
                appName : nav.appName,
                version : nav.appVersion,
                platform : nav.platform,
                vendor : nav.vendor,
                product : nav.product,
                userAgent : nav.userAgent
            };

            $.getJSON(&#39;/sayHello&#39;, browserInfo, function(helloObject) {
                $(&#39;#paragraph01&#39;).html(helloObject.result);
                $(&#39;#paragraph02&#39;).html(helloObject.codeName);
                $(&#39;#paragraph03&#39;).html(helloObject.version);
                $(&#39;#paragraph04&#39;).html(helloObject.product);
                $(&#39;#paragraph05&#39;).html(helloObject.userAgent);
            }).error = errorHandler;
        }

        return Control;

    }())

    return Control;
})</code></pre>
<p>Now we have much simplified <strong>Main.js</strong> file:</p>
<pre><code>require.config({
    paths : {
        &quot;jquery&quot; : &quot;jquery-2.1.1&quot;
    }
});

require([ &#39;jquery&#39;, &#39;Control&#39; ], function(jq, Control) {
    &#39;use strict&#39;;   
    console.log(&quot;Main called&quot;);
    
    var control = new Control();
});</code></pre>
<p>Run you code and make sure it still works. Be sure that you added Control to the list of Objects you load with require:</p>
<pre><code>require([ &#39;jquery&#39;, &#39;Control&#39; ], function(jq, Control) {</code></pre>
<h2 id="create-a-factory">Create a Factory</h2>
<p>The problem now is that the coupling between <strong>Main.js</strong> and <strong>Control.js</strong> is much too intimate. We need a Factory.</p>
<p>Create a file called <strong>Factory.js</strong> that looks like this:</p>
<pre><code>/**
 * @author Charlie Calvert
 */

define([ &#39;Control&#39; ], function(Control) {
    &#39;use strict&#39;;

    var Factory = (function() {

        function Factory() {
        }

        // Our factories product is an empty object by default
        Factory.prototype.product = { &#39;error&#39;: &#39;The factory created nothing&#39; };

        // Create a products
        Factory.prototype.create = function(options) {

            switch (options.productType) {
            case &quot;Control&quot;:
                this.product = new Control();
                break;
            default:
                console.log(&quot;Returning default object.&quot;);
            }

            return this.product;

        };

        return Factory;
    }())

    return Factory
});</code></pre>
<p>We specify that Control needs to have new called on it by using Pascal case:</p>
<pre><code>define([ &#39;Control&#39; ], function(Control) {</code></pre>
<p>The factory is completely responsible for creating the object. If the object needs to have new called on it, then the factory does that, because it is the Factory's job to create the object completely:</p>
<pre><code>case &quot;Control&quot;:
    this.product = new Control();
    break;</code></pre>
<p>By the time we get to the return statement in the factory, we just return the product. We don't need to call new on it. We decide that kind of thing in the <strong>switch</strong> statement:</p>
<pre><code>return this.product;</code></pre>
<p>This is what your factories should look like from here on out, until further notification.</p>
<p>Back in <strong>Main.js</strong> we do, however, have to call new on the Factory itself:</p>
<pre><code>require.config({
    paths : {
        &quot;jquery&quot; : &quot;jquery-2.1.1&quot;
    }
});

require([ &#39;jquery&#39;, &#39;Factory&#39; ], function(jq, Factory) {
    &#39;use strict&#39;;   
    console.log(&quot;Main called&quot;);
    
    var factory = new Factory();
    factory.create({ &#39;productType&#39;: &#39;Control&#39;})
});</code></pre>
<p>At this stage we can see that we are loading a total of seven files:</p>
<ul>
<li>Our html and css</li>
<li>require and jquery</li>
<li>Main, Factory and Control</li>
</ul>
<p>Here is what they look like in the Chrome developer tools:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing05.png" alt="Route05" /><figcaption>Route05</figcaption>
</figure>
<h2 id="call-into-newpage">Call into NewPage</h2>
<p>Let's add a button to our second page, the one called NewPage.jade:</p>
<pre><code>extends layout

block content
  h1= title
  p Welcome to #{title}

  h2 This is the new page!
  
  p#directory
  
  button#buttomDirName Get __dirname</code></pre>
<p>Define a handler for the new dirName button in Control.js:</p>
<pre><code>function Control() {
    $(&quot;#buttonSayHello&quot;).click(getHello);
    $(&quot;#buttomDirName&quot;).click(dirName);
}

function dirName() {
    alert(&quot;dirName&quot;);
}</code></pre>
<p>Now ask the server for the current directory by adding a route to <strong>NewPage.js</strong>:</p>
<pre><code>var express = require(&#39;express&#39;);
var router = express.Router();

/* GET home page. */
router.get(&#39;/&#39;, function(request, response) {
    response.render(&#39;NewPage&#39;, {
        title : &#39;Routing New Page&#39;
    });
});

router.get(&#39;/dirName&#39;, function(request, response) {
    response.send({ dirName : __dirname });
});

module.exports = router;</code></pre>
<p>The express **__dirname** property returns the current directory on the server.</p>
<p>Now call the the new route, being sure that you go through <strong>/NewPage</strong> and not <strong>/</strong>:</p>
<pre><code>    function dirName() {
        $.getJSON(&#39;/NewPage/dirName&#39;, function(serverResponse) {
            $(&#39;#directory&#39;).html(serverResponse.dirName);
        }).error = errorHandler;
    }</code></pre>
<p>The result looks like this on my Windows machine:</p>
<figure>
<img src="http://www.elvenware.com/charlie/books/CloudNotes/Images/Routing06.png" alt="Route06" /><figcaption>Route06</figcaption>
</figure>
<p>As you can see, my server is set up to run in the <strong>/Temp/Week07RoutingData</strong> folder. Note that we also see the <strong>routes</strong> folder because that is where <strong>NewPage.js</strong> lives.</p>
<h2 id="refactor">Refactor</h2>
<p>Our problem now is that Control.js does two or three things, and hence has multiple reasons to change:</p>
<ul>
<li>It calls Hello</li>
<li>It gets a directory</li>
<li>It serves as the main control page for our program.</li>
</ul>
<p>To fix this, we need to refactor our code into three objects in three files:</p>
<ul>
<li>Control.js: run the app</li>
<li>Hello.js: Handle the hello route</li>
<li>Directory: Handle the directory name call</li>
</ul>
<p>Here are the objects. First DirName:</p>
<pre><code>define([ &#39;jquery&#39; ], function(jq) {

    var DirName = (function() {

        function DirName() {
        }       

        DirName.prototype.getDirName = function() {
            $.getJSON(&#39;/NewPage/dirName&#39;, function(serverResponse) {
                $(&#39;#directory&#39;).html(serverResponse.dirName);
            }).error = errorHandler;
        }
        
        return DirName;
    }());
    
    return DirName;
});</code></pre>
<p>And then here is Hello:</p>
<pre><code>define([ &#39;jquery&#39; ], function(jq) {

    var Hello = (function() {

        function Hello() {
        }
        
        Hello.prototype.getHello = function() {
            var nav = window.navigator;
            var browserInfo = {
                codeName : nav.appCodeName,
                appName : nav.appName,
                version : nav.appVersion,
                platform : nav.platform,
                vendor : nav.vendor,
                product : nav.product,
                userAgent : nav.userAgent
            };

            $.getJSON(&#39;/sayHello&#39;, browserInfo, function(helloObject) {
                $(&#39;#paragraph01&#39;).html(helloObject.result);
                $(&#39;#paragraph02&#39;).html(helloObject.codeName);
                $(&#39;#paragraph03&#39;).html(helloObject.version);
                $(&#39;#paragraph04&#39;).html(helloObject.product);
                $(&#39;#paragraph05&#39;).html(helloObject.userAgent);
            }).error = errorHandler;
        }
        
        return Hello;
    }());
    
    return Hello;
});</code></pre>
<p>You can see that they both use <strong>errorHandler</strong>, yet neither defines it. So lets move it into its own Object:</p>
<pre><code>define(function(require) {
    
    var Utilities = {
        errorHandler: function(fx, status, error) {
            $(&#39;#debug01&#39;).html(fx.responseText);
            $(&#39;#debug02&#39;).html(&#39;error&#39; + error);
        }
    };
    
    return Utilities;
});</code></pre>
<p>Now redefine DirName and Hello to use it:</p>
<p>define([ 'jquery', 'Utilities' ], function(jq, utilities) {</p>
<pre><code>var DirName = (function() {

    function DirName() {
    }       

    DirName.prototype.getDirName = function() {
        $.getJSON(&#39;/NewPage/dirName&#39;, function(serverResponse) {
            $(&#39;#directory&#39;).html(serverResponse.dirName);
        }).error = utilities.errorHandler;
    }
    
    return DirName;
}());

return DirName;</code></pre>
<p>});</p>
<p>Notice that we are now requiring both jquery and Utilities:</p>
<pre><code>define([ &#39;jquery&#39;, &#39;Utilities&#39; ], function(jq, utilities) {</code></pre>
<p>Lets put all three of our new classes in a their own directory called Tools:</p>
<pre><code>require.config({
    paths : {
        &quot;jquery&quot; : &quot;jquery-2.1.1&quot;,
        &quot;Hello&quot;: &quot;Tools/Hello&quot;,
        &quot;DirName&quot;: &quot;Tools/DirName&quot;,
        &quot;Utilities&quot;: &quot;Tools/Utilities&quot;
    }
});

require([ &#39;jquery&#39;, &#39;Factory&#39; ], function(jq, Factory) {
    &#39;use strict&#39;;   
    console.log(&quot;Main called&quot;);
    
    var factory = new Factory();
    factory.create({ &#39;productType&#39;: &#39;Control&#39;});
});</code></pre>
<p>And let's teach the factory to load them:</p>
<pre><code>define([ &#39;Control&#39;, &quot;DirName&quot;, &quot;Hello&quot; ], function(Control, DirName, Hello) {
    &#39;use strict&#39;;

    var Factory = (function() {

        function Factory() {
        }

        // Our factories product is an empty object by default
        Factory.prototype.product = { &#39;error&#39;: &#39;The factory created nothing&#39; };

        // Create a products
        Factory.prototype.create = function(options) {

            switch (options.productType) {
            case &quot;Control&quot;:
                this.product = new Control(this);
                break;
            case &quot;Hello&quot;:
                this.product = new Hello();
                break;
            case &quot;DirName&quot;: 
                this.product = new DirName();
                break;
            default:
                console.log(&quot;Returning default object.&quot;);
            }

            return this.product;

        };

        return Factory;
    }())

    return Factory;
});</code></pre>
<p>Notice that we are now able to create <strong>Control</strong>, <strong>Hello</strong> and <strong>DirName</strong>. Notice also, that we are now passing the factory into the Control:</p>
<p>case &quot;Control&quot;: this.product = new Control(this); // Pass in the Factory (that is, pass in this) break;</p>
<p>And here is what Control looks like, now that we have our code all nicely factored into separate modules:</p>
<pre><code>define([ &#39;jquery&#39;, &quot;Factory&quot;], function(jq) {

    var Control = (function() {

        var factory;
        
        function Control(initFactory) {
            $(&quot;#buttonSayHello&quot;).click(getHello);           
            $(&quot;#buttonDirName&quot;).click(dirName);
            factory = initFactory;
        }

        function dirName() {
            var dirName = factory.create({productType: &#39;DirName&#39;});
            dirName.getDirName();
        }
        
        function getHello() {
            var hello = factory.create({productType: &#39;Hello&#39;});
            hello.getHello();
        }

        return Control;

    }())

    return Control;
});</code></pre>
<p><strong>Control</strong> now serves as the cockpit for our program. We control things from here.</p>
<p>Run your program and make sure it still works after refactoring. There is no new functionality, the HTML pages still look the same. The only change is that now the program is well organized.</p>
<p>To understand one of the benefits of our refactoring, open up each of your classes. Notice the small size and simplicity of each of our classes.</p>
<h2 id="do-it">Do It</h2>
<p>Now we have the set up done. You now get a chance to show what you have learned. Here is the assignment.</p>
<p>Create three new HTML pages with Jade using the <strong>views</strong> directory:</p>
<ul>
<li>CalculatePage</li>
<li>ConvertPage</li>
<li>PositionPage</li>
</ul>
<p>Create three new routes to go with your pages:</p>
<ul>
<li>CalculatePage</li>
<li>ConvertPage</li>
<li>Positionpage</li>
</ul>
<p>Modify <strong>app.js</strong> appropriately. Modify index.jade to provide a link to your new pages.</p>
<p>Modify the factory to create your new pages. Add links or buttons to index.jade that launch your new pages.</p>
<h2 id="the-calculatepage">The CalculatePage</h2>
<p>Put three buttons on your page called:</p>
<ul>
<li>getNine</li>
<li>add</li>
<li>multiply</li>
</ul>
<p>Place two input controls on your page:</p>
<pre><code>input#operanda(type=&#39;text&#39;, placeholder=&#39;operanda&#39;)
input#operandb(type=&#39;text&#39;, placeholder=&#39;operandb&#39;)</code></pre>
<p>You might want to make them of Type <strong>number</strong> instead. It's up to you. If you want, you can pre-initialize them to the numbers 3 and 7.</p>
<p>Don't forget how to get data from an input control:</p>
<pre><code>var a = $(&quot;#operanda&quot;).val();</code></pre>
<p>Do the following when the user clicks on the:</p>
<ul>
<li>getNine button: Call a route to /CalculatePage/getNine and return the number nine from the server</li>
<li>add button: Pass in the two numbers entered by the user to the /CalculatePage/add route on the server and return their sum. Display it to the user.</li>
<li>multiply button: Pass in two numbers entered by the user to the /CalculatePage/multiply route on the server and return their product. Display it to the user.</li>
</ul>
<p>Right now we have the pages themselves named with <strong>PascalCase</strong> and the methods are <strong>camelCase</strong>. This may change over the course of the quarter. If your case is different than mine, that is okay, but keep the names the same. And make sure it works!</p>
<h2 id="the-convert-page">The convert page</h2>
<p>Same as above, but only one input control and return from the /ConvertPage server:</p>
<ul>
<li>Feet converted to miles</li>
<li>Hours converted to seconds</li>
<li>Fahrenheit converted to Celsius</li>
</ul>
<h2 id="position-page">Position Page</h2>
<p>This one is a bit tricky, as not all browsers support getting position and you have to give permission before you can do it. Even if you can't get it to work, get your page and files set up as best you can.</p>
<ul>
<li><p>Take the following code. Put it in a class called <strong>Position.js</strong>.</p>
<pre><code>function showError(error) {
    alert(&#39;error: &#39; + error);
}
function success(position) {
    alert(&#39;success&#39; + JSON.stringify(position));
}

function position() {
    var latlng;

    var waitTime = 3000;
    try {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                    function(position) {
                        success(position);
                    }, showError);
        } else {
            showError(&quot;NOT-SUPPORTED&quot;);
        }
        var t = setTimeout(function() {
            if ($(&quot;#getZip div.loading&quot;).css(&quot;display&quot;) != &quot;none&quot;) {
                $(&quot;#getZip div.loading&quot;).hide();
                $(&quot;#errorZip&quot;).show();
            }
        }, waitTime);
    } catch (evt) {
        alert(evt);
    }
}       </code></pre></li>
</ul>
<p>When you run this code, your browser should prompt you to ask if you grant permission for Week07RoutingData to access your GPS.</p>
<h2 id="turn-it-in">Turn It In</h2>
<p>When you are done, put your code in a folder called <strong>Week08RoutingData</strong>. Make sure you create all objects with the factory. Make sure you are doing the addition, multiplication and conversion on the server. Make sure every route on the server includes a call like this as its first line:</p>
<p>console.log(&quot;Read called&quot;);</p>
<p>Or like this:</p>
<p>console.log(&quot;CalculatePage.add called&quot;);</p>
<p>Include screen shots of:</p>
<ul>
<li>You main page running in a browser</li>
<li>The Hello Page running in a browser</li>
<li>The Add page running in a browser</li>
<li>The command line of the server after you have opened all the pages and clicked all the buttons in your app.</li>
</ul>
<p>This is the midterm, and counts for 33 percent of your grade.</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>
<!-- FOOTER -->
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>        
		<p>Copyright &copy; <a href="/charlie/index.html">Charlie Calvert</a> |
		<a href="/charlie/contents.html">Site Overview</a> |
		<a href="/charlie/development/index.html">Writing Code</a> |
		<a href="/charlie/development/web/index.html">Web</a> |
		<a href="/charlie/development/web/JavaScript/index.html">JavaScript</a> |
		<a href="/charlie/books/index.html">My Books</a> </p>

      </footer>

    </div><!-- /.container -->
</body>
</html>



