<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>AngularSolarStarterTests</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><!-- script(src="/libs/scripts/Control.js")--><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>AngularSolarStarterTests</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#branching">Branching</a></li>
<li><a href="#loading-files">Loading Files</a></li>
<li><a href="#all-tests">All Tests</a></li>
<li><a href="#httpbackend">HttpBackend</a></li>
<li><a href="#get-started">Get Started</a></li>
<li><a href="#mocking-json-requests">Mocking JSON Requests</a></li>
<li><a href="#create-json-javascript">Create JSON JavaScript</a></li>
<li><a href="#testing-renewables">Testing Renewables</a></li>
<li><a href="#simple-format-directive">Simple Format Directive</a></li>
<li><a href="#testing-simple-format">Testing Simple Format</a></li>
<li><a href="#create-renewables-utils">Create renewables-utils</a></li>
<li><a href="#create-test-renewables">Create test-renewables</a></li>
<li><a href="#test-simple-format">Test Simple Format</a></li>
<li><a href="#test-simple-format-backend">Test Simple Format Backend</a></li>
<li><a href="#suite-titles">Suite Titles</a></li>
<li><a href="#hints">Hints</a></li>
<li><a href="#before-each">Before Each</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>Look at <a href="https://docs.google.com/presentation/d/1QHZunZfwAQIplala60HkLaGYaRGzJ5eO4oKIg_S1iyk/edit#slide=id.g9ad18c47f_0_91">directive template names</a> slide. This shows that we can use a template called <strong>elfRenewable</strong> in several difference ways in our angular templates. In other words there are more choices than just <elf-renewable></elf-renewable></p>
<p><strong>NOTE</strong> <em>Be sure to remove controller as from <strong>public/javascripts/app.js</strong>. In general, scour your files looking for and removing the case sensitive references to <strong>mainController</strong>. Don&#39;t remove <strong>MainController</strong>, but do remove <strong>mainController</strong>. Look at least in all your javascript jade and html files.</em></p>
<h2 id="branching">Branching</h2>
<p>The description of the branching part of this assignment can now be find here:</p>
<ul>
<li><a href="http://www.ccalvert.net/books/CloudNotes/Assignments/GitBranchWeeks.html">Git Branch Weeks</a></li>
</ul>
<h2 id="loading-files">Loading Files</h2>
<p>Before getting started, make sure you are loading <strong>angular-route.js</strong> in the files section of <strong>karma-conf.js</strong>. We load this file in <strong>layout.jade</strong>, so we should be sure to load it here.</p>
<pre><code class="lang-javascript">files: [
  <span class="hljs-symbol">'public</span>/components/jquery/dist/jquery.min.js',
  <span class="hljs-symbol">'public</span>/components/angular/angular.js',
  <span class="hljs-symbol">'public</span>/components/angular-mocks/angular-mocks.js',
  <span class="hljs-symbol">'public</span>/components/angular-route/angular-route.js',
  <span class="hljs-symbol">'node_modules</span>/jasmine-jquery/lib/*.js',
  etc...
</code></pre>
<p>We also need <strong>angular-mocks</strong> in our tests, but not in our program. That is why it is included here but not in <strong>layout.jade</strong>.</p>
<h2 id="all-tests">All Tests</h2>
<p>Now it is time to start filling out all our tests. When done, all our tests should look at least a bit like this:</p>
<pre>
$ karma start
11 05 2016 11:40:58.127:WARN [karma]: No captured browser, open http://localhost:9876/
11 05 2016 11:40:58.140:INFO [karma]: Karma v0.13.22 server started at http://localhost:9876/
11 05 2016 11:40:58.146:INFO [launcher]: Starting browser PhantomJS
11 05 2016 11:40:58.689:INFO [PhantomJS 2.1.1 (Linux 0.0.0)]: Connected on socket /#JH6RX6HZ4uCmsKBMAAAA with id 91505964

  Elvenware Fixture and Template Cache Suite
    ✓ expects true to be true
    ✓ should find the index
    ✓ should have a getRenewable method
    ✓ should be possible to access the fixture
    ✓ tests template loaded through simple raw text
    ✓ tests template loaded through more complex raw text
    ✓ tests scope variable access in template loaded through fixture

  Elvenware Simple Mocks with HttpBackend Suite
    ✓ proves we can run tests
    ✓ should find the index
    ✓ should have a getRenewable method
    ✓ proves we can detect request

  Renewables Suite
    ✓ proves we can run tests
    ✓ proves we can get renewableUtils name
    ✓ proves we can get renewableUtils method called getItemCount
    ✓ proves we can get from renewableUtils a particular renewable object by index
    ✓ proves we can transform our json into a new array consisting only of years
    ✓ proves our array of years contains the expected data
    ✓ proves we can transform our json into an array with three properties: geo, solar, and wind
    ✓ proves that getSimpleStringFormat returns the expected string data
    ✓ proves that getSimpleFormat returns the expected numeric data

  Simple Format HttpBackend Suite
    ✓ expects true to be true
    ✓ tests simple-format directive loaded through fixture with httpBackend
    ✓ tests that we can index through simple-format directive

  Simple Format Suite
    ✓ expects true to be true
    ✓ should find the index
    ✓ should be possible to access the fixture
</pre>

<p>It will take us a while to get there. But this gives you sense of where we are headed.</p>
<h2 id="httpbackend">HttpBackend</h2>
<p>Use the Angular <strong>$httpBackend</strong> object from <strong>angular-mocks</strong> to fake or &quot;mock&quot; the loading of JSON from the server.</p>
<p><strong>NOTE</strong>: <em>Angular mocks and httpBackend do much more than just allow us to mock loading JSON, but lets start there, and move on to mocking whole objects a bit later on. If you have not done so already, to install angular-mocks type this: <strong>npm install angular-mocks --save-dev</strong>.</em></p>
<p>For more on httpbackend, seeL</p>
<ul>
<li>The last few slides here: <a href="http://bit.ly/unittestasync">http://bit.ly/unittestasync</a></li>
<li><a href="http://www.elvenware.com/charlie/development/web/JavaScript/Angular.html#mocking-objects-with-httpbackend">Elvenware on httpBackend</a></li>
</ul>
<h2 id="get-started">Get Started</h2>
<p>Create a test called <strong>spec/test-mocks.js</strong>:</p>
<pre><code class="lang-javascripts">describe(<span class="hljs-string">'Elvenware Test Mocks Suite'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">
    'use strict'</span>;

    fit(<span class="hljs-string">'proves we can run tests'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
       expect(<span class="hljs-literal">true</span>).toBe(<span class="hljs-literal">true</span>);
    });
});
</code></pre>
<p>Make sure it works.</p>
<p>Now angularize it by loading the <strong>MainController</strong>, this time adding code to load $httpBackend and adding one test to be sure we can access the <strong>$scope</strong> of our <strong>MainController</strong>:</p>
<pre><code class="lang-javascripts">describe(<span class="hljs-string">'Elvenware Test Mocks Suite'</span>, <span class="hljs-keyword">function</span>() {

    <span class="hljs-string">'use strict'</span>;

    var $httpBackend;
    var scope;
    var mainController;

    // Set up the module
    beforeEach(module(<span class="hljs-string">'elfApp'</span>));

    beforeEach(inject(function(<span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$httpBackend<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>) {
        scope = <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>.$new();
        var $compile = <span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>;
        $httpBackend = <span class="hljs-number">_</span>$httpBackend<span class="hljs-number">_</span>;
        mainController = <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>(<span class="hljs-string">'MainController'</span>, {
            $scope: scope
        });
    }));

    afterEach(function() {
        $httpBackend.verifyNoOutstandingExpectation();
        $httpBackend.verifyNoOutstandingRequest();
    });

    it(<span class="hljs-string">'proves we can run tests'</span>, function() {
       expect(true).toBe(true);
    });

    it(<span class="hljs-string">'should find the index'</span>, function() {
      expect(scope.index).toBe(<span class="hljs-number">0</span>);
    });

});
</code></pre>
<p>Notice that we also have an <strong>afterEach</strong> section. This ensures that there are no pending http request after our tests. In particular, we are going to use <strong>$httpBackend</strong> to mock the act of loading JSON. When doing so, we will set up some mock $http requests. The <strong>afterEach</strong> method tests that we actually called these mocks, rather than leave them hanging. This helps us ensure that we are doing what we set out to do, and that the next test starts with a clean slate.</p>
<p>As mentioned earlier, we add a test from our <strong>test-basic</strong> file that ensures we can access the index declared out <strong>MainController&#39;s</strong> scope. It is just a sanity check to ensure we are in a stable state and can access our <strong>MainController</strong>.</p>
<h2 id="mocking-json-requests">Mocking JSON Requests</h2>
<p>Here is a test that actually mocks the <strong>$http.get</strong> call in our <strong>getRenewable</strong> method. This method, as you know, retrieves data from the server. Only this time, instead of getting data from a real server, we put in our own mock data instead:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">'proves we can mock getting JSON data'</span>, <span class="hljs-keyword">function</span>() {

  var renewable = [{
      <span class="hljs-string">"Year"</span>: <span class="hljs-string">"2017"</span>,
      <span class="hljs-string">"Solar (quadrillion Btu)"</span>: <span class="hljs-string">"0.8045307"</span>,
      <span class="hljs-string">"Geothermal (quadrillion Btu)"</span>: <span class="hljs-string">"0.2349284"</span>,
      <span class="hljs-string">"Other biomass (quadrillion Btu)"</span>: <span class="hljs-string">"0.50916"</span>,
      <span class="hljs-string">"Wind power (quadrillion Btu)"</span>: <span class="hljs-string">"2.202328"</span>,
      <span class="hljs-string">"Liquid biofuels (quadrillion Btu)"</span>: <span class="hljs-string">"1.2329197"</span>,
      <span class="hljs-string">"Wood biomass (quadrillion Btu)"</span>: <span class="hljs-string">"1.9860924"</span>,
      <span class="hljs-string">"Hydropower (quadrillion Btu)"</span>: <span class="hljs-string">"2.5859957"</span>
  }];

  // Define what happens when $http.get() is called.
  var requestHandler = $httpBackend
      .when(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'data/Renewable.json'</span>)
      .respond(renewable);

  $httpBackend.expectGET(<span class="hljs-string">'data/Renewable.json'</span>);
  scope.getRenewable();
  $httpBackend.flush();
  expect(scope.renewable[<span class="hljs-number">0</span>].Year).toEqual(<span class="hljs-string">'2017'</span>);

});
</code></pre>
<p>Put this method at the bottom of your <strong>test-mocks.js</strong> and make sure it works.</p>
<h2 id="create-json-javascript">Create JSON JavaScript</h2>
<p>Create a JavaScript file called <strong>spec/data/json-as-js-renewables.js</strong>. Inside it, put <strong>renewables.json</strong>. It should begin a bit like this:</p>
<pre><code class="lang-javascript"><span class="hljs-variable"><span class="hljs-keyword">var</span> renewables</span> = [{
    <span class="hljs-string">"Year"</span>: <span class="hljs-string">"2017"</span>,
    <span class="hljs-string">"Solar (quadrillion Btu)"</span>: <span class="hljs-string">"0.8045307"</span>,
    <span class="hljs-string">"Geothermal (quadrillion Btu)"</span>: <span class="hljs-string">"0.2349284"</span>,
    <span class="hljs-string">"Other biomass (quadrillion Btu)"</span>: <span class="hljs-string">"0.50916"</span>,
    <span class="hljs-string">"Wind power (quadrillion Btu)"</span>: <span class="hljs-string">"2.202328"</span>,
    <span class="hljs-string">"Liquid biofuels (quadrillion Btu)"</span>: <span class="hljs-string">"1.2329197"</span>,
    <span class="hljs-string">"Wood biomass (quadrillion Btu)"</span>: <span class="hljs-string">"1.9860924"</span>,
    <span class="hljs-string">"Hydropower (quadrillion Btu)"</span>: <span class="hljs-string">"2.5859957"</span>
}, {
    <span class="hljs-string">"Year"</span>: <span class="hljs-string">"2016"</span>,
    etc.
</code></pre>
<p>There is no real need to format, syntax check or run JSCS on this file. As a result, you can exclude the entire <strong>data</strong> directory from those tools. In general, whenever we create a data directory, we should tell JSCS and JsBeautify to leave it alone. It might be useful to run JsHint over that directory, but it is not strictly necessary.</p>
<h2 id="testing-renewables">Testing Renewables</h2>
<p>Add this to <strong>karma.conf.js</strong> files:</p>
<pre><code class="lang-javascript">'spec/<span class="hljs-class"><span class="hljs-keyword">data</span>/*.js',</span>
</code></pre>
<p>Put it right before or after you load the tests:</p>
<pre><code class="lang-javascript"><span class="hljs-symbol">'spec</span>/**/*.html',
<span class="hljs-symbol">'spec</span>/data/*.js',
<span class="hljs-symbol">'spec</span>/test*.js'
</code></pre>
<h2 id="simple-format-directive">Simple Format Directive</h2>
<p>Now lets create a new directive called <strong>elfSimpleFormat</strong>. Declare it just below the point in <strong>main.js</strong> where you declare the <strong>elfRenewable</strong> directive.</p>
<p>The HTML version of our new directive looks like this:</p>
<pre><code class="lang-javascript">elfApp.directive(<span class="hljs-string">'elfSimpleFormat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  'use strict'</span>;
  <span class="hljs-keyword">return</span> {
      controller: <span class="hljs-string">'MainController'</span>,
      template: <span class="hljs-string">'Solar: {{simpleFormat[index].solar}}'</span> +
          <span class="hljs-string">'&lt;br&gt;Geo: {{simpleFormat[index].geo}}'</span> +
          <span class="hljs-string">'&lt;br&gt;Wind: {{simpleFormat[index].wind}}'</span>

  };
});
</code></pre>
<p>As you can see, this declaration uses <strong>template</strong> rather than <strong>templateUrl</strong>. You should:</p>
<ul>
<li>Convert this HTML to jade</li>
<li>Save it to a file called <strong>simple-format.jade</strong></li>
<li>Convert the directive to use <strong>templateUrl</strong> rather than <strong>template</strong>.</li>
</ul>
<p>It should, of course, look like this:</p>
<pre><code class="lang-javascript">elfApp.directive(<span class="hljs-string">'elfSimpleFormat'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;
    <span class="hljs-keyword">return</span> {
        controller: <span class="hljs-string">'MainController'</span>,
        templateUrl: <span class="hljs-string">'simple-format'</span>
    };
});
</code></pre>
<h2 id="testing-simple-format">Testing Simple Format</h2>
<p>You created a <strong>simple-format.jade</strong> file. Now convert it to HTML so it can be used as a fixture in our tests:</p>
<p>  jade views/simple-format.jade --out=&#39;spec/fixtures/&#39;</p>
<p>Call the <strong>renewableUtils.simpleFormat</strong> from within <strong>$scope.getRenewable</strong>. It makes no sense to call it until you have loaded <strong>renewables.json</strong>. In particular, since it relies on <strong>renewables.json</strong> being present, it won&#39;t work properly until you have loaded that file.</p>
<p>In <strong>.jscsrc</strong> exclude the <strong>data</strong> folder. In <strong>Gruntfile.js</strong> don&#39;t try to beautify the <strong>data</strong> folder.</p>
<p>Don&#39;t forget to run <strong>grunt check</strong> and clean up all errors such as missing use strict, invalid quote marks, etc.</p>
<p><strong>NOTE</strong>: <em>With JSCS, you can use single quotes for a string, and double quotes for embedded quotes inside a string: &#39;My &quot;embedded&quot; string&#39;.</em></p>
<p>With angular, you can usually delete an <strong>$(document).ready()</strong> statements as it takes care of this for you.</p>
<h2 id="create-renewables-utils">Create renewables-utils</h2>
<p>You need to create a file called <strong>renewables-utils.js</strong>. For now, we can put it in the <strong>public/javascripts</strong> folder. Later on we can spend some time organizing our files so they are divided by category and easier to find.</p>
<p>Don&#39;t forget to add it to <strong>layout.jade</strong>!</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> elfApp = angular.module(<span class="hljs-string">'elfApp'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">RenewableUtils</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    <span class="hljs-keyword">var</span> renewables;

    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'renewableUtils'</span>;

    <span class="hljs-keyword">this</span>.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">initRenewables</span>) </span>{
        renewables = initRenewables;
    };

    <span class="hljs-keyword">this</span>.getItemCount = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// YOUR CODE HERE</span>
    };

    <span class="hljs-keyword">this</span>.getByIndex = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
        <span class="hljs-comment">// YOUR CODE HERE</span>
    };

    <span class="hljs-keyword">this</span>.getYears = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> renewables.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">renewable</span>) </span>{
            <span class="hljs-keyword">return</span> renewable.Year;
        });
    };

    <span class="hljs-comment">// YOU WRITE THE LASt TWO METHODS</span>
}

elfApp.service(<span class="hljs-string">'renewableUtils'</span>, RenewableUtils);
</code></pre>
<h2 id="create-test-renewables">Create test-renewables</h2>
<p>We need to test <strong>renewable-utils.js</strong> in <strong>spec/test-renewables.js</strong></p>
<pre><code class="lang-javascript">describe('Renewables Suite', function() {
    'use strict'<span class="hljs-comment">;</span>

    var $httpBackend<span class="hljs-comment">;</span>
    var scope<span class="hljs-comment">;</span>
    var mainController<span class="hljs-comment">;</span>

    // Set up the module
    beforeEach(<span class="hljs-name">module</span>('elfApp'))<span class="hljs-comment">;</span>

    beforeEach(<span class="hljs-name">inject</span>(<span class="hljs-name">function</span>(<span class="hljs-name">_</span>$compile_, _$rootScope_, _$httpBackend_, _$controller_) {
        scope = _$rootScope_.$new()<span class="hljs-comment">;</span>
        var $compile = _$compile_<span class="hljs-comment">;</span>
        $httpBackend = _$httpBackend_<span class="hljs-comment">;</span>
        mainController = _$controller_('MainController', {
            $scope: scope
        })<span class="hljs-comment">;</span>
    }))<span class="hljs-comment">;</span>

    beforeEach(<span class="hljs-name">function</span>() {
        //scope.renewableUtils.init(<span class="hljs-name">renewables</span>)<span class="hljs-comment">;</span>
        var requestHandler = $httpBackend
            .when('GET', 'data/Renewable.json')
            .respond(<span class="hljs-name">renewables</span>)<span class="hljs-comment">;</span>

        $httpBackend.expectGET('data/Renewable.json')<span class="hljs-comment">;</span>
        scope.getRenewable()<span class="hljs-comment">;</span>
        $httpBackend.flush()<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    afterEach(<span class="hljs-name">function</span>() {
        $httpBackend.verifyNoOutstandingExpectation()<span class="hljs-comment">;</span>
        $httpBackend.verifyNoOutstandingRequest()<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can run tests', function() {
        expect(<span class="hljs-name">true</span>).toBe(<span class="hljs-name">true</span>)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can get renewableUtils name', function() {
        expect(<span class="hljs-name">scope</span>.renewableUtils.name).toBe('renewableUtils')<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can get renewableUtils method called getItemCount', function() {
        expect(<span class="hljs-name">scope</span>.renewableUtils.getItemCount()).toBe(<span class="hljs-number">12</span>)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can get from renewableUtils a particular renewable object by index', function() {
        var renewable = scope.renewableUtils.getByIndex(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">renewable</span>.Year).toBe('<span class="hljs-number">2017</span>')<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can transform our json into a new array consisting only of years', function() {
        var years = scope.renewableUtils.getYears()<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">years</span>.length).toBe(<span class="hljs-number">12</span>)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves our array of years contains the expected data', function() {
        var years = scope.renewableUtils.getYears()<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">years</span>[<span class="hljs-number">0</span>]).toBe('<span class="hljs-number">2017</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">years</span>[<span class="hljs-number">1</span>]).toBe('<span class="hljs-number">2016</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">years</span>[<span class="hljs-number">5</span>]).toBe('<span class="hljs-number">2012</span>')<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves we can transform our json into an array with three properties: geo, solar, and wind', function() {
        var simpleFormat = scope.renewableUtils.getSimpleFormat()<span class="hljs-comment">;</span>
        var keys = Object.keys(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>])<span class="hljs-comment">;</span>
        keys.sort()<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">keys</span>).toEqual(['geo', 'solar', 'wind'])<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves that getSimpleStringFormat returns the expected string data', function() {
        var simpleFormat = scope.renewableUtils.getSimpleStringFormat()<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].geo).toBe('<span class="hljs-number">0.2349284</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].wind).toBe('<span class="hljs-number">2.202328</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].solar).toBe('<span class="hljs-number">0.8045307</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].geo).toBe('<span class="hljs-number">0.211592042</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].wind).toBe('<span class="hljs-number">1.3393646844</span>')<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].solar).toBe('<span class="hljs-number">0.227349746</span>')<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    it('proves that getSimpleFormat returns the expected numeric data', function() {
        var simpleFormat = scope.renewableUtils.getSimpleFormat()<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].geo).toBe(<span class="hljs-number">0.2349284</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].wind).toBe(<span class="hljs-number">2.202328</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">0</span>].solar).toBe(<span class="hljs-number">0.8045307</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].geo).toBe(<span class="hljs-number">0.211592042</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].wind).toBe(<span class="hljs-number">1.3393646844</span>)<span class="hljs-comment">;</span>
        expect(<span class="hljs-name">simpleFormat</span>[<span class="hljs-number">5</span>].solar).toBe(<span class="hljs-number">0.227349746</span>)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h2 id="test-simple-format">Test Simple Format</h2>
<p>We need to create <strong>spec/test-simple-format.js</strong>.</p>
<pre><code class="lang-javascript">
</code></pre>
<p>c</p>
<h2 id="test-simple-format-backend">Test Simple Format Backend</h2>
<p>We need to create <strong>spec/test-simple-format-backend.js</strong>, which is our holy grail.</p>
<h2 id="suite-titles">Suite Titles</h2>
<p>Get the suite titles right for each test.</p>
<h2 id="hints">Hints</h2>
<p>In <strong>karma.conf.js</strong> be sure you are loading <strong>angular</strong>, <strong>angular-mocks</strong> and <strong>angular-route</strong>:</p>
<pre><code class="lang-javascript">files: [
    <span class="hljs-symbol">'public</span>/components/jquery/dist/jquery.min.js',
    <span class="hljs-symbol">'public</span>/components/angular/angular.js',
    <span class="hljs-symbol">'public</span>/components/angular-mocks/angular-mocks.js',
    <span class="hljs-symbol">'public</span>/components/angular-route/angular-route.js',
    <span class="hljs-symbol">'node_modules</span>/jasmine-jquery/lib/*.js',  
    <span class="hljs-symbol">'public</span>/javascripts/app.js',
    <span class="hljs-symbol">'public</span>/javascripts/*.js',
    <span class="hljs-symbol">'spec</span>/**/*.html',
    <span class="hljs-symbol">'spec</span>/data/*.js',
    <span class="hljs-symbol">'spec</span>/test-*.js'
],
</code></pre>
<h2 id="before-each">Before Each</h2>
<p><strong>beforeEach</strong> methods load before each test is run. <strong>afterEach</strong> methods are loaded after each test is run.</p>
<p>This <strong>beforeEach</strong> statement loads your angular module:</p>
<pre><code class="lang-javascript">beforeEach(<span class="hljs-name">module</span>('elfApp'))<span class="hljs-comment">;</span>
</code></pre>
<p>Specically, it loads the module that you define like this in <strong>app.js</strong> and use in <strong>main.js</strong> and <strong>about.js</strong>:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myModule = angular.<span class="hljs-built_in">module</span>(<span class="hljs-string">'elfApp'</span>, [<span class="hljs-string">'ngRoute'</span>]);
</code></pre>
<p>This <strong>beforeEach</strong> loads you HTML fixture:</p>
<pre><code class="lang-javascript">beforeEach(<span class="hljs-name">function</span>() {
    jasmine.getFixtures().fixturesPath = 'base/spec/fixtures/'<span class="hljs-comment">;</span>
    loadFixtures('renewable.html')<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>This before each does three things:</p>
<pre><code class="lang-javascript">beforeEach(inject(<span class="hljs-keyword">function</span>(<span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$templateCache<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>) {
    scope = <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>.$new();
    $compile = <span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>;
    $templateCache = <span class="hljs-number">_</span>$templateCache<span class="hljs-number">_</span>;

    mainController = <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>(<span class="hljs-string">'MainController'</span>, {
        $scope: scope
    });
}));
</code></pre>
<p>First, it gets the scope that you are using in your application. I believe that this is a global scope object for the entire app, and this line narrows the scope down to work only with the scope of your controller:</p>
<pre><code class="lang-javascript">mainController = <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>(<span class="hljs-string">'MainController'</span>, {
    $scope: scope
});
</code></pre>
<p>The above code also loads your controller.</p>
<p>These line gets the compile and templateCache, both of which are needed to process our fixture so that it is converted from an angular template to live HTML that contains resolved references to scope variables:</p>
<pre><code class="lang-javascript">$compile = <span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>;
$templateCache = <span class="hljs-number">_</span>$templateCache<span class="hljs-number">_</span>;
</code></pre>
<p>There are also beforeEach and afterEach calls to load <strong>$httpBackend</strong>:</p>
<pre><code class="lang-javascript">beforeEach(inject(<span class="hljs-keyword">function</span>(<span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$httpBackend<span class="hljs-number">_</span>, <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>) {
    scope = <span class="hljs-number">_</span>$rootScope<span class="hljs-number">_</span>.$new();
    var $compile = <span class="hljs-number">_</span>$compile<span class="hljs-number">_</span>;
    $httpBackend = <span class="hljs-number">_</span>$httpBackend<span class="hljs-number">_</span>;
    mainController = <span class="hljs-number">_</span>$controller<span class="hljs-number">_</span>(<span class="hljs-string">'MainController'</span>, {
        $scope: scope
    });
}));

afterEach(<span class="hljs-keyword">function</span>() {
    $httpBackend.verifyNoOutstandingExpectation();
    $httpBackend.verifyNoOutstandingRequest();
});
</code></pre>
<p>The beforeEach shown above is the same as the ones we looked at before, except it does not get the compile and templateCache for handling fixtures, and instead it gets httpBackend. We use <strong>httpBackend</strong> for mocking calls to the server. Instead of aclled $http.get directly, we use httpBackend calls such as this to mock or fake the call to the server. Instead of making a real call, we just return pre-defined data:</p>
<pre><code class="lang-javascript">var requestHandler = $httpBackend
    .<span class="hljs-keyword">when</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'data/Renewable.json'</span>)
    .respond(PUT THE MOCK DATA HERE);

$httpBackend.expectGET(<span class="hljs-string">'data/Renewable.json'</span>);
scope.getRenewable();
$httpBackend.flush();
expect(scope.renewable[<span class="hljs-number">0</span>].Year).toEqual(<span class="hljs-string">'2017'</span>);
</code></pre>
<p>The <strong>afterEach</strong> code will raise an error if your set up a call to <strong>httpBackend</strong> but don&#39;t ever execute it by calling <strong>httpBackend.flush()</strong>.</p>
</div></body></html>