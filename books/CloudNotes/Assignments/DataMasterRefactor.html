<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>DataMasterRefactor</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>DataMasterRefactor</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#key-methods">Key Methods</a></li>
<li><a href="#couchview02-updates">CouchView02 Updates</a></li>
<li><a href="#create-branch">Create branch</a></li>
<li><a href="#remove-angular">Remove Angular</a></li>
<li><a href="#require-and-main">Require and Main</a></li>
<li><a href="#the-jade">The Jade</a></li>
<li><a href="#control">Control</a></li>
<li><a href="#new-routeprovider">New RouteProvider</a></li>
<li><a href="#querycontroller">QueryController</a></li>
<li><a href="#name-controller">Name Controller</a></li>
<li><a href="#run-query">Run Query</a></li>
<li><a href="#display">Display</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>We will discuss this assignment on Wednesday. I&#39;m giving it to you now in case you find it useful. It allows you to step away from Angular, and just write standard jQuery code in the DataMaster program. Do only as much as you find useful.</p>
<p>Our primary goal in the Data Master Refactor assignment will be to strip Angular out of our assignment. I will try to change the structure as little as possible, at least at first. We can make more changes later.</p>
<p>We also need to make improvements on both the server side and the client side in order to be able to see our data better.</p>
<h2 id="key-methods">Key Methods</h2>
<h2 id="couchview02-updates">CouchView02 Updates</h2>
<p>Thought CouchView02 still uses angular, I have updated it to provide better support on the server and the client for properly displaying data. Go to <strong>JsObjects</strong> and pull the most recent updates. Now run <strong>JsObjects/Data/CouchView02</strong> and take a look at the updates.</p>
<p>Let&#39;s look at some of the changes by running these commands from the routes folder:</p>
<ul>
<li>git diff bacf72d..3bcd3fb -- Couch.js</li>
<li>git diff bacf72d..3bcd3fb -- CouchInsert.js</li>
<li>git diff bacf72d..3bcd3fb -- CouchBulk.js</li>
<li>git diff bacf72d..3bcd3fb -- CouchDesignDocs.js</li>
</ul>
<p>Merge these changes into your current code.</p>
<h2 id="create-branch">Create branch</h2>
<p>In your repository, create a new branch called &quot;Week07&quot;. Switch to that branch.</p>
<p>Copy the <strong>Week0X-DataMaster</strong> program to a folder called simply <strong>DataMaster</strong>. Copy <strong>Week07-Midterm</strong> to a folder called <strong>DataHunter</strong>. For the rest of the quarter, we will do most of our work in these folders. Each week, however, we will create a new branch. The work you did on these programs during Week07 will be in the <strong>Week07</strong> branch, the work in Week08 in the <strong>Week08</strong> branch, and so on.</p>
<h2 id="remove-angular">Remove Angular</h2>
<p>Let&#39;s get to work on stripping Angular out of DataMaster. Make sure you are in the <strong>Week07</strong> branch and in the <strong>DataMaster</strong> folder.</p>
<p>The first steps are to remove angular from:</p>
<ul>
<li>layout.jade</li>
<li>package.json</li>
</ul>
<h2 id="require-and-main">Require and Main</h2>
<p>In <strong>main.js</strong>, insert this code. Note that it include code that will be called each time the user clicks on a hyperlink:</p>
<pre><code class="lang-javascript">
requirejs.config({
    baseUrl: <span class="hljs-string">'.'</span>,
    paths: {
        <span class="hljs-string">'foo'</span>: <span class="hljs-string">'javascripts/foo'</span>,
        <span class="hljs-string">'jquery'</span>: <span class="hljs-string">'components/jquery/dist/jquery'</span>,
        <span class="hljs-string">'control'</span>: <span class="hljs-string">'javascripts/control'</span>,
        <span class="hljs-string">'nameController'</span>: <span class="hljs-string">'javascripts/name-controller'</span>,
        <span class="hljs-string">'queryController'</span>: <span class="hljs-string">'javascripts/query-controller'</span>,
        <span class="hljs-string">'Route'</span>: <span class="hljs-string">'javascripts/route'</span>,
        <span class="hljs-string">'runQuery'</span>: <span class="hljs-string">'javascripts/run-query'</span>
    }
});


requirejs([<span class="hljs-string">'jquery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
<span class="hljs-meta">    'use strict'</span>;

    requirejs([<span class="hljs-string">'control'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">control</span>) </span>{
        $(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

            <span class="hljs-comment">/*
             * User clicks control
             * Create Route
             * Tell Route which route was selected
             * Call findRoutes and pass in Routes object
             *   findRoutes calls route.when for each possible path
             */</span>
            $(<span class="hljs-string">'#databaseOptions ul li a'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                event.preventDefault();
                control();
            });

        });
    });
});
</code></pre>
<h2 id="the-jade">The Jade</h2>
<p>In <strong>index.jade</strong>, wrap our hyperlinks in a DIV with an ID of databaseOptions:</p>
<pre><code class="lang-text">div<span class="hljs-selector-id">#databaseOptions</span>
    <span class="hljs-selector-tag">ul</span>
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">'databaseName'</span>) Get current Database Name
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">'createDb'</span>) CreateDb
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">'deleteDb'</span>) DeleteDb
    <span class="hljs-selector-tag">ul</span>
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">'insertNpcsBulk'</span>) Insert NPCs Bulk
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">'insertNpcsOneDoc'</span>) Insert NPCs as one document
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">"insertDesignDoc"</span>) Insert Design Doc
    <span class="hljs-selector-tag">ul</span>
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">"readOne"</span>) Read One Doc
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">"viewNpcsBulk"</span>) View NPCs Bulk documents
        <span class="hljs-selector-tag">li</span>
            a(href=<span class="hljs-string">"viewNpcsOneDoc"</span>) View NPCs One document
</code></pre>
<h2 id="control">Control</h2>
<p>Also change this code found near the top of <strong>control.js</strong>:</p>
<pre><code class="lang-javascript">myModule.config(<span class="hljs-keyword">function</span> ($routeProvider) { ... })
</code></pre>
<p>The new code for <strong>control.js</strong> should look like this:</p>
<pre><code class="lang-javascript">define(['<span class="hljs-type">Route</span>', 'nameController', 'queryController'], function (<span class="hljs-type">Route</span>, nameController, queryController) {

    <span class="hljs-keyword">var</span> findRoutes = (function ($routeProvider) {
        'use strict';
        $routeProvider.<span class="hljs-keyword">when</span>('/databaseName', {
            templateUrl: 'templates/<span class="hljs-type">DatabaseNames</span>.html',
            controller: nameController,
            resolve: {
                databaseName: nameController.databaseName,
                allDbs: nameController.allDbs
            }
        }).<span class="hljs-keyword">when</span>('/deleteDb', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.delete
            }
        }).<span class="hljs-keyword">when</span>('/createDb', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.create
            }
        }).<span class="hljs-keyword">when</span>('/insertNpcsBulk', {
            templateUrl: 'templates/<span class="hljs-type">InsertReport</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.insertNpcsBulk
            }
        }).<span class="hljs-keyword">when</span>('/insertNpcsOneDoc', {
            templateUrl: 'templates/<span class="hljs-type">InsertReport</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.insertNpcsOneDoc
            }
        }).<span class="hljs-keyword">when</span>('/insertDesignDoc', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.design
            }
        }).<span class="hljs-keyword">when</span>('/readOne', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.readOne
            }
        }).<span class="hljs-keyword">when</span>('/viewNpcsBulk', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.viewBulk
            }
        }).<span class="hljs-keyword">when</span>('/viewNpcsOneDoc', {
            templateUrl: 'templates/<span class="hljs-type">QueryView</span>.html',
            controller: queryController,
            resolve: {
                <span class="hljs-literal">result</span>: queryController.viewOneDoc
            }
        }).otherwise({
            redirectTo: '/'
        });
    });

    <span class="hljs-keyword">var</span> control = function () {
        <span class="hljs-keyword">var</span> route = new <span class="hljs-type">Route</span>();
        route.setRoute(event.target.pathname);
        findRoutes(route);
    };

    <span class="hljs-keyword">return</span> control;

});
</code></pre>
<h2 id="new-routeprovider">New RouteProvider</h2>
<p>Since we have removed Angular, we need a substitute for the Angular <strong>RouteProvider</strong> object. Place the following object in a file called <strong>Route.js</strong>. Modify <strong>layout.jade</strong> so that this file gets loaded.</p>
<pre><code class="lang-javascript">define(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Route</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.route = <span class="hljs-string">''</span>;
    }

    Route.prototype.setRoute = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(routeInit)</span> </span>{
        <span class="hljs-keyword">this</span>.route = routeInit;
    };

    Route.prototype.when = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(route, control)</span> </span>{
        <span class="hljs-keyword">if</span> (route === <span class="hljs-keyword">this</span>.route) {
            <span class="hljs-keyword">var</span> resolver = {
                getController: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">return</span> control.controller
                }
            };

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> funcName <span class="hljs-keyword">in</span> control.resolve) {
                control.resolve[funcName](resolver);
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    Route.prototype.otherwise = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// DO NOTHING FOR NOW</span>
    };

    <span class="hljs-keyword">return</span> Route;

});
</code></pre>
<p>This code is primarily about the <strong>when</strong> method. Recall that we use this method heavily in <strong>control.js</strong>:</p>
<pre><code class="lang-javascript">$routeProvider.<span class="hljs-keyword">when</span>(<span class="hljs-string">'/databaseName'</span>, {
    templateUrl: <span class="hljs-string">'templates/DatabaseNames.html'</span>,
    controller: nameController,
    resolve: {
        databaseName: nameController.databaseName,
        allDbs: nameController.allDbs
    }
}).<span class="hljs-keyword">when</span>(<span class="hljs-string">'/deleteDb'</span>, {
    templateUrl: <span class="hljs-string">'templates/QueryView.html'</span>,
    controller: queryController,
    resolve: {
        result: queryController.delete
    }
}) AND SO ON
</code></pre>
<p>Our <strong>when</strong> method takes two parameters:</p>
<ul>
<li>A route</li>
<li>An anonymous control object</li>
</ul>
<p>For instance, in the first case, the route is &#39;/databaseName&#39; and the control object looks like this:</p>
<pre><code class="lang-javascript">{
    <span class="hljs-attribute">templateUrl</span>: <span class="hljs-string">'templates/DatabaseNames.html'</span>,
    controller: nameController,
    resolve: {
        databaseName: nameController.databaseName,
        allDbs: nameController.allDbs
    }
}
</code></pre>
<p>The first point to grasp is that our code is called when the user clicks on the hyperlinks we created when writing our Jade in <strong>index.jade</strong>. Each hyperlink has a route associated with it. Consider these three hyperlinks:</p>
<pre><code class="lang-jade">li
    a(<span class="hljs-name">href=</span>'databaseName') Get current Database Name
li
    a(<span class="hljs-name">href=</span>'createDb') CreateDb
li
    a(<span class="hljs-name">href=</span>'deleteDb') DeleteDb
</code></pre>
<p>These route for the first of these items is called &#39;databaseName&#39;. The route for the third is &#39;deleteDb&#39;. When the user clicks on a link, then the route is called.</p>
<p>The code in in <strong>control.js</strong> is telling us the following: <em>When the &#39;/databaseName&#39; route is called, then we want to use the <strong>nameController</strong> to handle it, and we want to call two methods of that object called <strong>databaseName</strong> and <strong>allDbs</strong>.</em></p>
<p>In the second example I show above, <em>when the &#39;/deleteDb&#39; route is called then the controller that handles the call is the <strong>queryController</strong> and the method we want to call is <strong>queryController.delete</strong>.</em></p>
<h2 id="querycontroller">QueryController</h2>
<p>In <strong>control.js</strong> change delete the lines:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> myModule = angular.<span class="hljs-built_in">module</span>(<span class="hljs-string">'myModule'</span>, [<span class="hljs-string">'ngRoute'</span>]);

<span class="hljs-keyword">var</span> queryController = myModule.controller(<span class="hljs-string">'QueryController'</span>,
...
)
</code></pre>
<p>And let&#39;s give the queryController a new shape:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> queryController = function (<span class="hljs-literal">result</span>) {
  ...
})
</code></pre>
<p>And finally, let&#39;s move the whole object into a new file called <strong>query-conroller.js</strong>:</p>
<pre><code class="lang-javascript">define([<span class="hljs-string">'runQuery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">runQuery</span>) </span>{
    <span class="hljs-keyword">var</span> queryController = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query, result</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">var</span> $scope = $(<span class="hljs-string">'#debug'</span>);
        <span class="hljs-keyword">var</span> docs = $(<span class="hljs-string">'#docs'</span>);
        docs.empty();
        <span class="hljs-keyword">if</span> (result.ok) {
            YOUR CODE HERE PUTS INFO IN $scope AND/OR docs
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.requestFailed) {
            YOUR CODE HERE PUTS INFO IN $scope AND/OR docs
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.error) {
            YOUR CODE HERE  PUTS INFO IN $scope AND/OR docs
        } <span class="hljs-keyword">else</span> {
            YOUR CODE HERE PUTS INFO IN $scope AND/OR docs
        }

        docs.html(YOUR CODE HERE PUTS INFO IN docs);
    };

    queryController.delete = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/deleteDb'</span>, $q);
    };

    queryController.create = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/createDb'</span>, $q);
    };

    queryController.insertNpcsBulk = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/insertBulk?fileName=Npcs.json'</span>, $q);
    };

    queryController.insertNpcsOneDoc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/insertFile?fileName=Npcs.json&amp;id=oneDoc'</span>, $q);
    };

    queryController.design = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/designDoc'</span>, $q);
    };

    queryController.readOne = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/read?docName=npcsDoc'</span>, $q);
    };

    queryController.viewBulk = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/viewNpcsBulk?designDoc=game&amp;view=npcsBulk'</span>, $q);
    };

    queryController.viewOneDoc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/viewNpcsOneDoc?designDoc=game&amp;view=npcsOneDoc'</span>, $q);
    };

    <span class="hljs-keyword">return</span> queryController;
});
</code></pre>
<p>In the <strong>queryController</strong> method you can get handles to them like this:</p>
<pre><code class="lang-javascript">var $scope = $(<span class="hljs-string">'#debug'</span>);
var docs = $(<span class="hljs-string">'#docs'</span>);
docs.<span class="hljs-keyword">empty</span>();
</code></pre>
<p>Since these are both PRE elements, you can put any type of data in either one. Nevertheless, I have a convention of displaying certain types of data in each element. I use the:</p>
<ul>
<li><strong>$scope</strong> object to display simple messages like &quot;success&quot; or &quot;failure&quot;.</li>
<li><strong>docs</strong> object to display complex rows of in formation, such as the rows of game data.</li>
</ul>
<p>Now write code to handle several possible responses from the server, or do whatever you want to handle the data sent from the server:</p>
<pre><code><span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.ok) {
    <span class="hljs-type">YOUR</span> <span class="hljs-type">CODE</span> <span class="hljs-type">HERE</span> <span class="hljs-type">PUTS</span> <span class="hljs-type">INFO</span> <span class="hljs-type">IN</span> $scope <span class="hljs-type">AND</span>/<span class="hljs-type">OR</span> docs
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.requestFailed) {
    <span class="hljs-type">YOUR</span> <span class="hljs-type">CODE</span> <span class="hljs-type">HERE</span> <span class="hljs-type">PUTS</span> <span class="hljs-type">INFO</span> <span class="hljs-type">IN</span> $scope <span class="hljs-type">AND</span>/<span class="hljs-type">OR</span> docs
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.error) {
    <span class="hljs-type">YOUR</span> <span class="hljs-type">CODE</span> <span class="hljs-type">HERE</span>  <span class="hljs-type">PUTS</span> <span class="hljs-type">INFO</span> <span class="hljs-type">IN</span> $scope <span class="hljs-type">AND</span>/<span class="hljs-type">OR</span> docs
} <span class="hljs-keyword">else</span> {
    <span class="hljs-type">YOUR</span> <span class="hljs-type">CODE</span> <span class="hljs-type">HERE</span> <span class="hljs-type">PUTS</span> <span class="hljs-type">INFO</span> <span class="hljs-type">IN</span> $scope <span class="hljs-type">AND</span>/<span class="hljs-type">OR</span> docs
}
docs.html(<span class="hljs-type">YOUR</span> <span class="hljs-type">CODE</span> <span class="hljs-type">HERE</span> <span class="hljs-type">PUTS</span> <span class="hljs-type">INFO</span> <span class="hljs-type">IN</span> docs);
</code></pre><p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/data-master-scope-docs.png" alt="scope docs"></p>
<p>In the image shown above the words &quot;It worked&quot; are shown in <strong>$scope</strong> while the array that contains a single object is shown in <strong>docs</strong>.</p>
<h2 id="name-controller">Name Controller</h2>
<pre><code class="lang-javascript">
define([<span class="hljs-string">'runQuery'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">runQuery</span>) </span>{
    <span class="hljs-keyword">var</span> nameController = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query, data</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;

        <span class="hljs-keyword">var</span> $scope = $(<span class="hljs-string">'#debug'</span>);
        <span class="hljs-keyword">var</span> docs = $(<span class="hljs-string">'#docs'</span>);
        <span class="hljs-comment">// YOU WRITE THE REST OF THE CODE</span>
        <span class="hljs-comment">// YOU NEED TO HANDLE WHAT HAPPENS WHEN</span>
        <span class="hljs-comment">// EITHER THE databaseName method is called</span>
        <span class="hljs-comment">// OR WHEN THE allDbs method is called</span>
    };

    nameController.databaseName = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/databaseName'</span>, $q);
    };

    nameController.allDbs = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">return</span> runQuery(<span class="hljs-string">'/listDb'</span>, $q);
    };

    <span class="hljs-keyword">return</span> nameController;
});
</code></pre>
<h2 id="run-query">Run Query</h2>
<p>My <strong>runQuery</strong> method now looks like this:</p>
<pre><code class="lang-javascript">define(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">require</span>) </span>{

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runQuery</span>(<span class="hljs-params">query, $q</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">var</span> controller = $q.getController();
        $.getJSON(query, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">json</span>) </span>{
            controller(query, json);
        }).fail(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">jqxhr, textStatus, error</span>) </span>{
            <span class="hljs-keyword">var</span> response = {error: <span class="hljs-string">"Unknown. Is program running?"</span>};
            <span class="hljs-keyword">if</span> (jqxhr.responseText) {
                response = <span class="hljs-built_in">JSON</span>.parse(jqxhr.responseText);
                response.genericError = error;
                response.statusText = textStatus;
            }
            queryController({
                <span class="hljs-string">'requestFailed'</span>: response
            });
        });
    }

    <span class="hljs-keyword">return</span> runQuery;
});
</code></pre>
<p>Above, I&#39;ve asked you to fill in some of the code for the <strong>queryController</strong> and <strong>nameController</strong> methods. In the above code, those methods are called when this line executes:</p>
<pre><code class="lang-javascript">controller(<span class="hljs-name">query</span>, json)<span class="hljs-comment">;</span>
</code></pre>
<h2 id="display">Display</h2>
<p>In <strong>index.jade</strong> I now have two files:</p>
<pre><code class="lang-text">pre<span class="hljs-meta">#debug</span>

pre<span class="hljs-meta">#docs</span>
</code></pre>
</div></body></html>