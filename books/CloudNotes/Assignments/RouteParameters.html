<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>RouteParameters</title><link href="/css/first-style.css" rel="stylesheet"><link rel="shortcut icon" href="/images/favicon.png"><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet"><script src="https://code.jquery.com/jquery-1.12.0.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS --><script src="/js/elven-help.js"></script></head><body><nav class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/">Elvenware</a></div><div class="navbar-collapse collapse" id="navbar"><ul class="nav navbar-nav"><li class="trigger-collapse" ng-class="{ active: isActive('/')}"><a href="/">Home</a></li><li><a href="/about.html">About</a></li></ul></div></div></nav><div class="container"><figure><img class="elf-normal" alt="Elvenware" src="/images/elvenwarelogo.png"/></figure><h1>RouteParameters</h1><p>Welcome to RouteParameters</p><ul><!--TOC_Start--><li><a href="#step-one-find-route-parameters">Step One: Find Route Parameters</a></li>
<li><a href="#step-two-run-route-parameters-on-aws">Step Two: Run Route Parameters on AWS</a></li>
<li><a href="#step-three-copy-and-link">Step Three: Copy and Link</a></li>
<li><a href="#step-four-set-port">Step Four: Set Port</a></li>
<li><a href="#step-five-start-upstart">Step Five: Start Upstart</a></li>
<li><a href="#step-six-edit-elastic-ip">Step Six: Edit Elastic IP</a></li>
<li><a href="#step-seven-install">Step Seven: Install</a></li>
<li><a href="#turn-it-in">Turn it in</a></li><!--TOC_End--></ul></div><div class="container"><p>##Route Parameters</p>
<p>The goal of this assignment is to get the RouteParameters program running on:</p>
<ul>
<li>AWS</li>
<li>A mobile devices</li>
</ul>
<p>This is not a coding assignment. It is just an exercise. You will, however, 
have to demonstrate an understanding of the program we will be running.</p>
<ul>
<li><a href="http://youtu.be/ft_ih30yqIY">Video</a></li>
</ul>
<a class="anchor" id="step-one-find-route-parameters"></a>
<h2>Step One: Find Route Parameters</h2>
<p>The Route Parameters program can be found on JsObjects. Here is the web app version:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/JavaScript/NodeCode/NodeRoutesParams">Web App</a></li>
</ul>
<p>Here is the Cordova version:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/tree/master/Cordova/CordovaNodeRoutes">Cordova App</a></li>
</ul>
<p>It has a fairly simple interface. Here it is as a web app:</p>
<p><img src="https://drive.google.com/uc?id=0B25UTAlOfPRGVG02a25FZENnMk0" alt="RouteParameters on AWS"></p>
<p>And here it is as Cordova application:</p>
<p><img class="small" src="https://drive.google.com/uc?id=0B25UTAlOfPRGc1JqUWh1Tk5fZUE" alt="Isit 322 Final Home Page"></p>
<a class="anchor" id="step-two-run-route-parameters-on-aws"></a>
<h2>Step Two: Run Route Parameters on AWS</h2>
<p>First, make sure you have the most recent copy of JsObjects on your AWS instance:</p>
<pre><code>$ ssh ubuntu@&lt;SOME-ELASTIC-IP&gt;
Welcome to Ubuntu <span class="hljs-number">14.04</span><span class="hljs-number">.2</span> LTS (GNU/Linux <span class="hljs-number">3.13</span><span class="hljs-number">.0</span><span class="hljs-number">-44</span>-generic x86_64)

 * <span class="hljs-string">Documentation:</span>  <span class="hljs-string">https:</span><span class="hljs-comment">//help.ubuntu.com/</span>

  System information <span class="hljs-keyword">as</span> of Thu Mar <span class="hljs-number">19</span> <span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">36</span> UTC <span class="hljs-number">2015</span>

  System <span class="hljs-string">load:</span>  <span class="hljs-number">0.0</span>               <span class="hljs-string">Processes:</span>           <span class="hljs-number">99</span>
  Usage of /:   <span class="hljs-number">19.5</span>% of <span class="hljs-number">7.74</span>GB   Users logged <span class="hljs-string">in:</span>     <span class="hljs-number">0</span>
  Memory <span class="hljs-string">usage:</span> <span class="hljs-number">10</span>%               IP address <span class="hljs-keyword">for</span> <span class="hljs-string">eth0:</span> <span class="hljs-number">172.31</span><span class="hljs-number">.33</span><span class="hljs-number">.228</span>
  Swap <span class="hljs-string">usage:</span>   <span class="hljs-number">0</span>%

  Graph <span class="hljs-keyword">this</span> data and manage <span class="hljs-keyword">this</span> system <span class="hljs-string">at:</span>
<span class="hljs-symbol">    https:</span><span class="hljs-comment">//landscape.canonical.com/</span>

  Get cloud support with Ubuntu Advantage Cloud <span class="hljs-string">Guest:</span>
<span class="hljs-symbol">    http:</span><span class="hljs-comment">//www.ubuntu.com/business/services/cloud</span>

<span class="hljs-number">10</span> packages can be updated.
<span class="hljs-number">9</span> updates are security updates.


Last <span class="hljs-string">login:</span> Thu Mar <span class="hljs-number">19</span> <span class="hljs-number">15</span>:<span class="hljs-number">18</span>:<span class="hljs-number">36</span> <span class="hljs-number">2015</span> from c<span class="hljs-number">-24</span><span class="hljs-number">-22</span><span class="hljs-number">-247</span><span class="hljs-number">-196.</span>hsd1.wa.comcast.net
Agent pid <span class="hljs-number">15723</span>
ubuntu<span class="hljs-meta">@ip</span><span class="hljs-number">-172</span><span class="hljs-number">-31</span><span class="hljs-number">-33</span><span class="hljs-number">-228</span>:~
$ cd Git
ubuntu<span class="hljs-meta">@ip</span><span class="hljs-number">-172</span><span class="hljs-number">-31</span><span class="hljs-number">-33</span><span class="hljs-number">-228</span>:~/Git
$ git clone <span class="hljs-string">http:</span><span class="hljs-comment">//github.com/charliecalvert/JsObjects.git</span>
</code></pre><p>The key line, of course, is this one:</p>
<pre><code> git <span class="hljs-keyword">clone</span> <span class="hljs-title">http</span>://github.com/charliecalvert/JsObjects.git
</code></pre><a class="anchor" id="step-three-copy-and-link"></a>
<h2>Step Three: Copy and Link</h2>
<p>Copy the Route Params project to a folder of your choosing outside
of JsObjects:</p>
<pre><code>    cd &lt;<span class="hljs-keyword">TO</span> SOME FOLDER <span class="hljs-keyword">OF</span> YOUR CHOOSING SUCH <span class="hljs-keyword">AS</span> ~/Source&gt;
    cp -r ~/Git/JsObjects/JavaScript/NodeCode/NodeRoutesParams/ .
</code></pre><p>Now we need to create a symbolic link to our project. We want it to
appear that our project is in the <strong>~/bin directory</strong>. To do this, first
be sure that <strong>~/bin</strong> exists on your system. If it doesn&#39;t create it:</p>
<pre><code><span class="hljs-built_in">mkdir</span> ~/bin
</code></pre><p>Now create a symbolic link. The simplest way to do that is to navigate to the
folder that contains your project. For instance, if you project is in
<strong>Source</strong> directory, then navigate to the source directory. Then
create the symbolic link like this:</p>
<pre><code><span class="hljs-variable">$ </span>ln -s ~<span class="hljs-regexp">/Source/</span>NodeRoutesParams/ ~<span class="hljs-regexp">/bin/</span>NodeRoutesParams
</code></pre><p>If all works out, you can see the symbolic link in your <strong>bin</strong> directory
by issuing a command like this:</p>
<pre><code>$ <span class="hljs-keyword">ls</span> -l ~<span class="hljs-string">/bin</span>
</code></pre><p>You should see that NodeParams is a symbolic link to your Source/NodeRoutesParams
directory:</p>
<pre><code>NodeRoutesParams -&gt; <span class="hljs-regexp">/home/</span>charlie<span class="hljs-regexp">/Source/</span>NodeRoutesParams<span class="hljs-regexp">/</span>
</code></pre><p>Here is the whole process:</p>
<pre><code>cd ~/bin
ubuntu@ip<span class="hljs-string">-172</span><span class="hljs-string">-31</span><span class="hljs-string">-33</span><span class="hljs-string">-228</span>:~/bin
$ ls -l
total 0
lrwxrwxrwx 1 ubuntu ubuntu 37 Mar 19 22:58 NodeRoutesParams -&gt; /home/ubuntu/Source/NodeRoutesParams/
ubuntu@ip<span class="hljs-string">-172</span><span class="hljs-string">-31</span><span class="hljs-string">-33</span><span class="hljs-string">-228</span>:~/bin
</code></pre><a class="anchor" id="step-four-set-port"></a>
<h2>Step Four: Set Port</h2>
<p>In <strong>bin/www</strong>:</p>
<pre><code><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'expressapp'</span>);
<span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../app'</span>);

app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">30101</span>);
</code></pre><p>Go to your AWS console. Go to Security Groups, edit the rules for your security
group to open up port 30101. If there is any confusion, you can find the security
group associated with your instance on the <strong>instances</strong> page in the AWS console.
In particular, select your instance, and look down and to your right.</p>
<ul>
<li>Type: Custom TCP</li>
<li>Protocol: TCP</li>
<li>Port Range: 30101 (Can we write: 30101-30105?)</li>
<li>Source: Anywhere</li>
</ul>
<a class="anchor" id="step-five-start-upstart"></a>
<h2>Step Five: Start Upstart</h2>
<p>Upstart can be used to keep your program running after you close 
your shell and to ensure that it restarts automatically when you
reboot the system. Take a momement to learn about upstart:</p>
<ul>
<li><a href="http://www.elvenware.com/charlie/development/web/JavaScript/NodeJs.html#upstart">UpStart on Elvenware</a></li>
<li><a href="http://upstart.ubuntu.com/index.html">UpStart home page</a></li>
</ul>
<p>Our upstart script is called <strong>NodeRoutesParams</strong>. If you look inside it, you will see that
it assumes your copy of NodeRoutesParams is in <strong>~/bin</strong>:</p>
<pre><code>exec <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/nodejs $HOME/</span>bin<span class="hljs-regexp">/NodeRoutesParams/</span>bin<span class="hljs-regexp">/www &gt;&gt; /</span>var<span class="hljs-regexp">/log/</span>node.log <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>
</code></pre><p>That is why we created a symbolic link in that folder. That way, regardless of where
you keep <strong>NodeRoutesParams</strong> on your system, our script can find it.    </p>
<p>Copy the <strong>NodeRoutesParams</strong> file to the <strong>/etc/init</strong> directory:</p>
<pre><code>sudo cp NodeRoutesParams<span class="hljs-selector-class">.conf</span> /etc/init/.
</code></pre><p>Start the program</p>
<pre><code>sudo <span class="hljs-literal">start</span> NodeRoutesParams
</code></pre><p>Stop the program</p>
<pre><code>sudo <span class="hljs-built_in">stop</span> NodesRoutesParams
</code></pre><p>If you reboot the system, your program will start automatically.</p>
<p>Error messages and and other output are in: /var/log/node.log </p>
<p>Browse to your instance:</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-name">elasticIp</span>&gt;</span>:30101/
</code></pre><p>For instance, if you were testing all this out on your copy of Lubunutu,
you would do this:</p>
<pre><code><span class="hljs-number">127.0</span><span class="hljs-meta">.0</span><span class="hljs-meta">.1</span>:<span class="hljs-number">30101</span>/    
</code></pre><a class="anchor" id="step-six-edit-elastic-ip"></a>
<h2>Step Six: Edit Elastic IP</h2>
<p>Navigate into your copied version of <strong>CordovaNodeRoutes</strong> </p>
<p>Edit <strong>Control.js</strong>:</p>
<pre><code>cd <span class="hljs-regexp">~/Git/</span>JsObjects<span class="hljs-regexp">/Cordova/</span>CordovaNodeRoutes/
geany www<span class="hljs-regexp">/javascripts/</span>Control.js    
</code></pre><p>Change the IP address to your elastic IP and the port to the number
you set up in the previous step:</p>
<pre><code>var Control = (<span class="hljs-name">function</span>() {

        // Constructor
        function Control() {
        $(<span class="hljs-string">"button"</span>).click(<span class="hljs-name">function</span>(<span class="hljs-name">event</span>) {
            var id = event.target.id<span class="hljs-comment">;</span>
            var route = 'http<span class="hljs-symbol">://52</span>.<span class="hljs-number">11.190</span>.<span class="hljs-number">176</span>:<span class="hljs-number">30101</span>/routeParams/' + id<span class="hljs-comment">;</span>
            $(<span class="hljs-string">"#clientRoute"</span>).html('ClientRoute: ' + route)<span class="hljs-comment">;</span>
            $.getJSON(<span class="hljs-name">route</span>, function(<span class="hljs-name">response</span>) {
                // $('#response').html(<span class="hljs-name">JSON</span>.stringify(<span class="hljs-name">response</span>))<span class="hljs-comment">;</span>
                $('#route').html(<span class="hljs-string">"ROUTE: "</span> + response.route)<span class="hljs-comment">;</span>
                $('#result').html(<span class="hljs-string">"RESULT: "</span> + response.result)<span class="hljs-comment">;</span>
                $('#query').html(<span class="hljs-string">"QUERY: "</span> + JSON.stringify(<span class="hljs-name">response</span>.query))<span class="hljs-comment">;</span>
                $('#params').html(<span class="hljs-string">"PARAMS: "</span> + JSON.stringify(<span class="hljs-name">response</span>.params))<span class="hljs-comment">;</span>
                $('#id').html(<span class="hljs-string">"ID: "</span> + response.id)<span class="hljs-comment">;</span>

                // elf.utilities.showMessage(<span class="hljs-name">choice</span>, true)<span class="hljs-comment">;</span>
            })<span class="hljs-comment">;</span>
        })<span class="hljs-comment">;</span>
</code></pre><p>The relevant line is this one:</p>
<pre><code><span class="hljs-attribute">var route</span> = <span class="hljs-string">'http://&lt;CHANGE ME&gt;:30101/routeParams/'</span> + id;
</code></pre><p>Save your work.</p>
<a class="anchor" id="step-seven-install"></a>
<h2>Step Seven: Install</h2>
<p>Now install this cordova application on your phone or on AndroidX86
running in VirtualBox. </p>
<p>First use ADB to ensure that you are connected to your device:</p>
<pre><code>$ adb devices
<span class="hljs-built_in">List</span> <span class="hljs-keyword">of</span> devices attached 
e8e5bc06    device
</code></pre><p>If you are using your phone you don&#39;t have to 
explicitly connect adb. But if you are using VirtualBox, you
have to run <strong>adb connect <IP OF ANDROIDX86>.</strong></p>
<p>Remember these commands:</p>
<ul>
<li>cordova platform add android</li>
<li>cordova build android</li>
<li>adb install platforms/android/ant-build/CordovaApp-debug.apk</li>
</ul>
<p><strong>NOTE</strong>:<em>On some systems it may be <strong>MainActivity</strong> instead of <strong>CordovaApp</strong>.</em></p>
<p>To uninstall it:</p>
<ul>
<li>adb uninstall com.elvenware.elven_node_routes</li>
</ul>
<p>Details are here: <a href="http://bit.ly/elven-android-studio">http://bit.ly/elven-android-studio</a></p>
<a class="anchor" id="turn-it-in"></a>
<h2>Turn it in</h2>
<p>Create screen shots of your web app and cordova app running and talking
to the server. For instance, press the <strong>RouteParms/Able</strong> button and 
then take the screen shot.</p>
<p>Attach these screen shots when you submit the assignment. Also include
the address of your instance running on AWS at your Elastic IP
and assignment Port. Put your source code for both programs 
in Week12-NodeRoutes.</p>
</div></body></html>