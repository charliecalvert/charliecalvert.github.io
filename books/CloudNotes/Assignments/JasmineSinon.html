<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>JasmineSinon</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>JasmineSinon</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#jasmine-express-sinon">Jasmine Express Sinon</a></li>
<li><a href="#create-project">Step One: Create Project</a></li>
<li><a href="#unit-test-setup">Step Two: Set up Unit Testing</a></li>
<li><a href="#test-test">Step Three: Test our Test Framework</a></li>
<li><a href="#useful-test">Step Four: Create Useful Tests</a></li>
<li><a href="#step-five-write-code">Step Five: Write Code</a></li>
<li><a href="#grunt">Grunt</a></li>
<li><a href="#karma-config">Karma config</a></li>
<li><a href="#hint">Hint</a></li><!--TOC_End--></ul><h1 id="jasmine-express-sinon">Jasmine Express Sinon</h1>
<p>Learn about unit testing and mocks with Jasmine and the <a href="https://github.com/sinonjs/sinon">sinon</a> fake web server.</p>
<h2 id="create-project">Step One: Create Project</h2>
<p>Create your project using our script.</p>
<pre><code class="lang-bash">CreateExpressProject Week04-JasmineSinon
</code></pre>
<p>I maintain my copy of this script here:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/NodeInstall/CreateExpressProject">JsObjects/Utilities/NodeInstall/CreateExpressProject</a></li>
</ul>
<h2 id="unit-test-setup">Step Two: Set up Unit Testing</h2>
<p>Use our <a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/NodeInstall/TestReady">TestReady</a> script to enable unit testing in your project:</p>
<pre><code>JsObjects/Utilities/Templates/NodeInstall
</code></pre><p>The script is described in the NodeInstall <a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/NodeInstall/README.md">readme</a>.</p>
<h2 id="test-test">Step Three: Test our Test Framework</h2>
<p>The <strong>DevReady</strong> script creates a single simple test that it puts in the <strong>spec</strong> folder:</p>
<pre><code class="lang-javascript">/**
 * Created by charlie on 10/7/15.
 */

describe(&quot;Elvenware Simple Plain Suite&quot;, function() {

    &#39;use strict&#39;;

    it(&quot;expects true to be true&quot;, function() {
        expect(true).toBe(true);
    });

});
</code></pre>
<p>This test has a single purpose:</p>
<ul>
<li>It tests whether <strong>true</strong> is actually <strong>true</strong></li>
</ul>
<p>Why would one want to run such a test? Simply to find out if <strong>karma</strong> and the <strong>jasmine</strong> unit test library are set up correctly. Since we know that <strong>true</strong> is equal to true, any errors we see are almost certainly the result of problems in our configuration, not in our test. If our test succeeds, then we know we have set things up correctly. In particular, we want to see a line that looks like this:</p>
<pre><code>  Elvenware Simple Plain Suite
    âœ“ expects true to be true
</code></pre><h2 id="useful-test">Step Four: Create Useful Tests</h2>
<p>Assuming we can get our single test to pass, the next step will be copy in some tests that do a bit more:</p>
<pre><code class="lang-javascript">describe(&quot;Elvenware Object Number Suite&quot;, function () {

    &#39;use strict&#39;;

    it(&quot;Call a function in getNumber that returns 9&quot;, function () {
        expect(getNine()).toBe(9);
    });

    it(&quot;Test that we can parse the value expected to be returned from getJSON call&quot;, function() {
        var response = {nine: 10};
        queryServer.parseSimpleJson(response);
        expect(queryServer.queryResult).toBe(10);
    });

    it(&quot;tests ajax call&quot;, function() {
        spyOn($, &#39;ajax&#39;).and.callFake(function (ajaxConfig) {
            ajaxConfig.success({&quot;nine&quot;: 9});
        });
        queryServer.getAjaxServerNine();
        expect(queryServer.queryResult).toBe(9);
    });

    it(&quot;tests getJSON call&quot;, function() {
        // getJSON is wrapper around ajax, so spyOn it, as it is more flexible
        spyOn($, &#39;getJSON&#39;).and.callFake(function (url, success) {
            success({&quot;nine&quot;: 9});
        });
        queryServer.getJsonServerNine();
        expect(queryServer.queryResult).toBe(9);
    });

    it(&quot;tests getJSON call with fail 9&quot;, function () {
        spyOn($, &#39;getJSON&#39;).and.callFake(function (url, success) {
            success({
                &quot;nine&quot;: 9
            });
            return {
                fail: function() {}
            };
        });
        queryServer.getJsonServerNineWithFail();
        expect(queryServer.queryResult).toBe(9);
    });
});
</code></pre>
<p>The first method checks to see if there is a method called <strong>getNine</strong> that returns the number nine.</p>
<p>The second test checks to see if there is an object call bar, with a method called <strong>parseSimpleJson.</strong>. If that method is passed a JavaScript object with a property called <strong>nine</strong> set to the value <strong>10</strong> then it should return the value 10. Remember, we haven&#39;t written a method that does that yet, we have just stated that we want to create such a method.</p>
<p>The third test checks that a method of <strong>bar</strong> called <strong>getAjaxServerNine</strong> sets property of <strong>bar</strong> called <strong>value</strong> to the number nine. <strong>getAjaxServerNine</strong> is problematic for us because it uses the jQuery <strong>ajax</strong> method to call the server and retrieve some JSON. We don&#39;t want our test to rely on server working properly, or even to rely on the fact that it is running at all. So we use the Jasmine <strong>spyOn</strong> method to mock the call. We don&#39;t really call the server, instead the <strong>spyOn</strong> method fakes the call to the server, and then passes to the <strong>getAjaxServerNine</strong> nine <strong>success</strong> a mock up of the data it would recieve had the call to the server succeeded.</p>
<p>Take a moment to consider how the <strong>ajax</strong> method it works. It calls the server, and the server sends back some data. In this case, we know that the server shoud send back a JSON object shaped like this:</p>
<pre><code class="lang-JSON">{ 
    &quot;nine&quot;: 9
}
</code></pre>
<p>We therefore set up a <strong>callFake</strong> to the success function, passing in expect value. Our tests then confirms that the success method knows how to successfully handle the data it might receive from the server.</p>
<p>At first, this technique of mocking objects seems like it can&#39;t possibly be useful. But it is useful. Very useful. In fact, it simulates exactly what happens when a successful call to the server is made, only we don&#39;t actually have to call the server. Instead we can <strong>mock</strong> such a call. The Jasmine <strong>spyOn</strong> method is a very clever, and useful, piece of code.</p>
<p>The fourth and last test is just like the previous test, only this time we call <strong>$.getJSON</strong> instead of <strong>$.ajax</strong>.</p>
<h2 id="step-five-write-code">Step Five: Write Code</h2>
<p>Now that we have defined our tests, the next step is to write our program. If the code we write passes our tests, then can assume it is working properly.</p>
<p>Place the following code in <strong>control.js:</strong></p>
<pre><code class="lang-javascript">
function getNine() {
    &#39;use strict&#39;;
    return 9;
}

var queryServer = {

    url: &#39;./simple.json&#39;,

    queryResult: null,

    parseSimpleJson: function (simpleJson) {
        &#39;use strict&#39;;
        queryServer.queryResult = simpleJson.nine;
    },

    getAjaxServerNine: function () {
        &#39;use strict&#39;;

        $.ajax({
            url: queryServer.url,
            success: function (simpleJson) {
                queryServer.parseSimpleJson(simpleJson);
                console.log(queryServer.queryResult);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus + &quot;incoming Text &quot; + jqXHR.responseText);
            }
        });
    },

    getJsonServerNine: function () {
        &#39;use strict&#39;;

        $.getJSON(queryServer.url, function (simpleJson) {
            queryServer.parseSimpleJson(simpleJson);
            console.log(queryServer.queryResult);
            $(&#39;#serverResult&#39;).html(queryServer.queryResult);
        });
    },

    getJsonServerNineWithFail: function () {
        &#39;use strict&#39;;
        console.log(queryServer.url);
        $.getJSON(queryServer.url, function (simpleJson) {
            queryServer.parseSimpleJson(simpleJson);
            console.log(queryServer.queryResult);
            $(&#39;#serverResult&#39;).html(queryServer.queryResult);
        }).fail(function (error) {
            console.log(error);
        });

    }
};
</code></pre>
<p>The code shown above contains one standalone method called <strong>getNine</strong> and one JavaScript object called <strong>bar</strong>.</p>
<h2 id="grunt">Grunt</h2>
<p>The grunt utility is configured in a file called <strong>Gruntfile.js</strong>. You can do many, many things in this file. In our case, however, we have two relatively simple goals:</p>
<ul>
<li>Establish the config file for <strong>karma</strong></li>
<li>Configure <strong>jshint</strong></li>
</ul>
<p>It should be fairly simple for you to pick out the places where these tasks are performed:</p>
<pre><code class="lang-javascript">module.exports = function(grunt) {
    &#39;use strict&#39;;

    grunt.initConfig({

        pkg : &#39;&lt;json:package.json&gt;&#39;,

        karma : {
            karma : {
                configFile : &#39;karma.conf.js&#39;
            }
        },

        jshint : {
            files : [ &#39;**/*.js&#39; ],

            options : {
                ignores : [ 
                     &#39;**/node_modules/**&#39;, &#39;**/components/**&#39;
                ],
                reporter : &#39;checkstyle&#39;,
                reporterOutput : &#39;result.xml&#39;,
                strict : true,
                globals : {
                    describe : true,
                    afterEach : true,
                    beforeEach : true,
                    inject : true,
                    it : true,
                    jasmine : true,
                    expect : true
                }
            }
        },

    });

    grunt.loadNpmTasks(&#39;grunt-karma&#39;);
    grunt.loadNpmTasks(&#39;grunt-contrib-jshint&#39;);
    grunt.registerTask(&#39;test&#39;, [ &#39;jshint&#39;, &#39;karma&#39; ]);

};
</code></pre>
<p>The last three lines perform two tasks:</p>
<ul>
<li>The first two lines load libraries that define how grunt controls <strong>karma</strong> and <strong>jshint</strong></li>
<li>The third line defines a task called <strong>test</strong> that runs both <strong>jshint</strong> and <strong>karma</strong></li>
</ul>
<p>If the <strong>jshint</strong> task does not pass, then <strong>karma</strong> will never be run. In other words, if <strong>jshint</strong> finds that your code is not syntactically correct, then <strong>karma</strong> will never get a chance to your tests.</p>
<h2 id="karma-config">Karma config</h2>
<pre><code class="lang-javascript">/* global process: true */

module.exports = function(config) {
    &#39;use strict&#39;;

    config.set({
        // base path, that will be used to resolve files and exclude
        basePath: &#39;./&#39;,

        frameworks: [&#39;jasmine&#39;],

        files: [
            &#39;public/components/jquery/dist/jquery.min.js&#39;,
            &#39;public/javascripts/*.js&#39;,
            &#39;spec/test*.js&#39;
        ],

        // list of files to exclude
        exclude: [
        ],

        reporters: [&#39;spec&#39;],

        // web server port
        port: 9876,

        // enable / disable colors in the output (reporters and logs)
        colors: true,

        // level of logging
        logLevel: config.LOG_INFO,

        // enable / disable watching file and executing tests whenever any file changes
        // CLI --auto-watch --no-auto-watch
        autoWatch: true,

        // Start these browsers, currently available:
        browsers: [&#39;PhantomJS&#39;],

        // If browser does not capture in given timeout [ms], kill it
        captureTimeout: 20000,

        // Set to false to watch files for changes
        singleRun: true,

        plugins: [&quot;karma-jasmine&quot;,
            &quot;karma-spec-reporter&quot;,
            &#39;karma-phantomjs-launcher&#39;]

    });
};
</code></pre>
<h2 id="hint">Hint</h2>
<p>Normally, it is simplest to use the <strong>headless</strong> phantomjs browser. However, it does not contain the great debugger found in Chrome. To switch to Chrome, change the bottom of <strong>karma.conf.js</strong> to look like this:</p>
<pre><code>// Start these browsers, currently available:
// browsers: [&#39;PhantomJS&#39;],
browsers: [&#39;Chrome&#39;],

// If browser does not capture in given timeout [ms], kill it
captureTimeout: 20000,

// Set to false to watch files for changes
singleRun: false,

plugins: [&quot;karma-jasmine&quot;,
    &quot;karma-spec-reporter&quot;,
    &quot;karma-chrome-launcher&quot;,
    &quot;karma-phantomjs-launcher&quot;]
</code></pre><p>Be sure to install the chrome-launcher:</p>
<pre><code>npm install karma-chrome-launcher --save
</code></pre></div></body></html>