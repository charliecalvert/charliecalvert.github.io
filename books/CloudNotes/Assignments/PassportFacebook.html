<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>PassportFacebook</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>PassportFacebook</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#overview">Overview</a></li>
<li><a href="#setup-facebook">Setup Facebook</a></li>
<li><a href="#facebook-specific-code">Facebook Specific Code</a></li>
<li><a href="#make-public">Make Public</a></li>
<li><a href="#turn-it-in">Turn It In</a></li><!--TOC_End--></ul><h2 id="overview">Overview</h2>
<p>Passport Facebook exercise.</p>
<p>Use <a href="http://passportjs.org/">Passport</a> &quot;sign in with Facebook&quot;. This assignment builds on the <a href="http://www.ccalvert.net/books/CloudNotes/Assignments/Passport.html">Passport Assignment</a> which explained how to sign in Google.</p>
<p>Your goal is to get your passport app (and eventually your DataMaster app and DataHunter game) supporting sign in with Facebook. In fact, the user should be able to sign in with Twitter, and either Facebook or Google. But for this exercise, you only need to add support for Facebook to the Passport program.</p>
<p>Go to this page to turn on and off which apps have permission to use your information. In other words, to deactivate the app you built so that it can sign on again from the beginning, go to this page:</p>
<ul>
<li><a href="https://www.facebook.com/settings?tab=applications">https://www.facebook.com/settings?tab=applications</a></li>
<li><a href="https://www.facebook.com/help/792552774106866">https://www.facebook.com/help/792552774106866</a></li>
</ul>
<h2 id="setup-facebook">Setup Facebook</h2>
<p>Go to the Facebook developers site: <a href="https://developers.facebook.com/">https://developers.facebook.com/</a>. Note at the bottom the link to the Login API.</p>
<p>Visit the Facebook Login for Developers Page: <a href="https://developers.facebook.com/products/login/">https://developers.facebook.com/products/login/</a>. Check out the page you see from the Get Started button.</p>
<p>After getting oriented, look at the top right, and select the option to create a <strong>New App</strong>.</p>
<ul>
<li>Displan Name: Isit320-Lastname</li>
<li>Category: Education</li>
</ul>
<p>Click okay, fill in the capcha, and choose <strong>Facebook Login</strong> as Product and <strong>www</strong> as login.</p>
<ul>
<li>Site URL: <a href="http://localhost:30025">http://localhost:30025</a></li>
<li>Get your App ID and Secret</li>
<li>Client token on advanced page</li>
<li>The Valid OAuth redirect APIs: <a href="http://localhost:30025/facebook/login">http://localhost:30025/facebook/login</a></li>
</ul>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/passport-facebook-oauth.png" alt="OAuth Facebook"></p>
<h2 id="facebook-specific-code">Facebook Specific Code</h2>
<p>Save the Facebook specific code in <strong>routes/login-facebook.js</strong>:</p>
<pre><code class="lang-javascript">/<span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
 <span class="hljs-keyword">*</span> Created by charlie on 11/5/16.
 <span class="hljs-keyword">*</span>/

var express = require('express');
var router = express.Router();
var passport = require('passport');
var Strategy = require('passport-facebook').Strategy;

/<span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
 <span class="hljs-keyword">*</span>  Facebook
 <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>/

router.get('/profile', require('connect-ensure-login').ensureLoggedIn(),
    function(req, res) {
        'use strict';
        console.log(req.user);
        res.render('profile-facebook', {
            title: 'Facebook Profile',
            user: req.user
        });
    });

passport.use(new Strategy({
        clientID: process.env.CLIENT_ID,
        clientSecret: process.env.CLIENT_SECRET,
        callbackURL: 'http://localhost:30025/facebook/login/callback'
    },
    function(accessToken, refreshToken, profile, done) {
        'use strict';
        return done(null, profile);
    }));

router.get('/login',
    passport.authenticate('facebook'));

router.get('/login/callback',
    passport.authenticate('facebook', {
        failureRedirect: '/login'
    }),
    function(req, res) {
        'use strict';
        res.redirect('/');
    });

module.exports = router;
</code></pre>
<h2 id="make-public">Make Public</h2>
<p>You need to make your app public if it is going to be used by more than one person. Since both you and I need to access the app, you should make it public.</p>
<ul>
<li>Go to <a href="https://developers.facebook.com/">https://developers.facebook.com/</a> (Links to an external site.) and be sure you are signed in.</li>
<li>At the top right, you can select your app from a drop down.</li>
<li>You are taken to a page focused on your app. Select the App Review menu item on the far left.</li>
<li>Set the <strong>Make <app-name> Public</strong> toggle to yes.</li>
</ul>
<p><img src="https://s3.amazonaws.com/bucket01.elvenware.com/images/passport-facebook-public.png" alt="Make Facebook app Public"></p>
<p>I think some kinds of apps need to be reviewed, but just using the Login API does not require review. So you can simply toggle Make Public from no to yes. If we wanted to be more cautious, we probably could have added me as co-developer, or some such, which would also be a good exercise. But just toggle the Make Public option for now.</p>
<h2 id="turn-it-in">Turn It In</h2>
<p>We are working in the <strong>Week08-Passport</strong> folder in your repository. Place your work in that folder, if it is not there already. Run <strong>grunt check</strong>. Submit your assignment.</p>
</div></body></html>