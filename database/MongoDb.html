<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>MongoDb</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap-theme.min.css"><link href="/libs/css/BootstrapIndex.css" rel="stylesheet" type="text/css"><link href="/css/style.css" rel="stylesheet" type="text/css"><script src="components/jquery/dist/jquery.js"></script><script src="components/angular/angular.js"></script><script src="components/angular-route/angular-route.js"></script><script src="components/bootstrap/dist/js/bootstrap.min.js"></script><script src="/libs/scripts/elvenware.js" type="text/javascript"></script><script src="/libs/scripts/Control.js"></script></head><body ng-app="elfApp"><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/about">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/development/index.html">Strongly Typed</a></li><li><a href="/development/web/index.html">Web & Scripts</a></li><li><a href="/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>MongoDb</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#mongodb">MongoDb</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#install-the-npm-package">Install the NPM Package</a></li>
<li><a href="#stopStart">Start and Stop MongoDb</a></li>
<li><a href="#sample-session">Sample Session</a></li>
<li><a href="#mongoHelp">Mongo: Getting Help</a></li>
<li><a href="#set-up-a-mongolab-url">Set up a MongoLab URL</a></li>
<li><a href="#working-with-mongo-data">Working with Mongo Data</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#noStart">MongoDb Won&#39;t Start</a></li><!--TOC_End--></ul><h1 id="mongodb">MongoDb</h1>
<p>MongoDb is no-sql database.</p>
<ul>
<li><a href="http://www.mongodb.org/">MongoDb home page</a></li>
<li><a href="https://mongolab.com/welcome/">Free (for small deployments) online MongoDatabase</a>.</li>
</ul>
<h2 id="install">Install</h2>
<ul>
<li><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/">Linux: Follow these instructions</a></li>
<li><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-windows/?_ga=1.145962999.279933697.1429292287">Windows: Follow these instructions</a></li>
<li><a href="http://elvenware.com/charlie/development/database/NoSql/MongoDb.html">Mongo on Elvenware</a></li>
</ul>
<p>Or just run the following bash script from <a href="https://github.com/charliecalvert/JsObjects/tree/master/Utilities">/JsObjects/Utilities</a> called <a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/InstallScripts/InstallMongoDb.sh">InstallMongoDb.sh</a>:</p>
<pre><code>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10
echo &#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39; | sudo tee /etc/apt/sources.list.d/mongodb.list
sudo apt-get update
sudo apt-get install mongodb-org
</code></pre><p>The second line above should be typed as one line, so just run JsObjects script or block copy the above and paste it into the command line. Note, however, that the second line has two parts:</p>
<pre><code>PART01: &#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39;
PART02: sudo tee /etc/apt/sources.list.d/mongodb.list
</code></pre><p>When you paste in the whole line, you are, in effect, running two commands separated by the <a href="http://stackoverflow.com/questions/12400371/what-does-means-in-terminal">pipe symbol</a>. In pseudo code, it looks like this: </p>
<pre><code>echo PART01 | PART02  // Don&#39;t actually run this
</code></pre><p>But don&#39;t try to paste that in, paste in the line from the script. The above pseudo command is just an attempt to explain what the second line in the script does. It is not a valid method of running the second line. </p>
<p>There is an alternative method, but it is not recommended, as it probably won&#39;t install the latest MongoDb. Nevertheless, it could work. So if the above fails, you could try:</p>
<pre><code>sudo apt-get install mongodb  // Only do this if the above fails
</code></pre><h2 id="install-the-npm-package">Install the NPM Package</h2>
<p>If the <strong>package.json</strong> file for your project does not already include <a href="https://www.npmjs.org/package/mongodb">mongodb</a>, use <strong>npm</strong> to install the Node <strong>mongodb</strong> driver into your local project:    </p>
<pre><code>sudo npm install mongodb
</code></pre><h2 id="stopStart">Start and Stop MongoDb</h2>
<p>Use these commands to stop, start and restart MongoDb:</p>
<pre><code>sudo service mongodb start
sudo service mongodb stop
sudo service mongodb restart
</code></pre><p>To see if MongoDb is running, or to learn a bit about your instance, go
to this address:</p>
<ul>
<li><a href="http://localhost:28017/">http://localhost:28017/</a></li>
</ul>
<p>The key is that it is a port 1000 above the port you use to query 
the database. The page you find will reveal at least a few minimal 
facts about your running instance of MongoDb.</p>
<h2 id="sample-session">Sample Session</h2>
<p>You can view the content on your MongoDb server without writing any code. First you need to start the mongo client:</p>
<pre><code>$ mongo
MongoDB shell version: 2.6.1
connecting to: test
</code></pre><p>To quit the shell, you type <strong>exit</strong> and press return. But let&#39;s not do that quite yet. Instead you might want to see the databases on your instance of MongoDb:</p>
<pre><code>&gt; show dbs
admin  (empty)
bar    (empty)
local  0.078GB
test   0.078GB
</code></pre><p>Select one of the databases:</p>
<pre><code>&gt; use test
switched to db test
</code></pre><p>Instead of tables, MongoDb has collections. Show the collections in the database.</p>
<pre><code>&gt; show collections
finalWalk
system.indexes
testData
test_insert
</code></pre><p>Insert data:</p>
<pre><code>&gt; db.test_insert.insert({firstName: &quot;Susan&quot;})
WriteResult({ &quot;nInserted&quot; : 1 })
&gt;
</code></pre><p>A somewhat more complex example:</p>
<pre><code>&gt;  db.test_insert.insert({  
...   &quot;firstName&quot;: &quot;Abe10001&quot;,
...   &quot;lastName&quot;: &quot;Lincoln10001&quot;,
...   &quot;address&quot;: &quot;10001 Green Street&quot;,
...   &quot;city&quot;: &quot;Bellevue&quot;,
...   &quot;state&quot;: &quot;WA&quot;,
...   &quot;zip&quot;: 98002
... })
</code></pre><p>Use <strong>find</strong> to see the contents of <strong>test_insert</strong>:</p>
<pre><code>&gt; db.test_insert.find()
{ &quot;_id&quot; : ObjectId(&quot;537a7175a6b3c70a4adb3e88&quot;), &quot;firstName&quot; : &quot;Susan&quot; }
{
    &quot;_id&quot;: ObjectId(&quot;537a6ba7ceccfa98291d56dd&quot;),
    &quot;firstName&quot;: &quot;Abe10001&quot;,
    &quot;lastName&quot;: &quot;Lincoln10001&quot;,
    &quot;address&quot;: &quot;10001 Green Street&quot;,
    &quot;city&quot;: &quot;Bellevue&quot;,
    &quot;state&quot;: &quot;WA&quot;,
    &quot;zip&quot;: 98002
}
etc...
&gt;
</code></pre><p>You can ask to <strong>project</strong> only certain fields. The following projection asks not to see the _id field, which is displayed by default, and to see the firstName and lastName fields. (What you see here assumes that additional rows have been inserted):</p>
<pre><code>&gt; db.test_insert.find({}, {&quot;_id&quot;: 0, firstName: 1, &quot;lastName&quot;: 1});
{ &quot;firstName&quot; : &quot;Abe10000&quot;, &quot;lastName&quot; : &quot;Lincoln10000&quot; }
{ &quot;firstName&quot; : &quot;Abe10001&quot;, &quot;lastName&quot; : &quot;Lincoln10001&quot; }
{ &quot;firstName&quot; : &quot;Abe10002&quot;, &quot;lastName&quot; : &quot;Lincoln10002&quot; }
{ &quot;firstName&quot; : &quot;Abe10003&quot;, &quot;lastName&quot; : &quot;Lincoln10003&quot; }
{ &quot;firstName&quot; : &quot;Abe10004&quot;, &quot;lastName&quot; : &quot;Lincoln10004&quot; }
</code></pre><p>This query asks to only the rows where firstName is equal to Abe0001.</p>
<pre><code>&gt; db.test_insert.find({firstName: &quot;Abe10001&quot;}, {&quot;_id&quot;: 0, firstName: 1, &quot;lastName&quot;: 1});
{ &quot;firstName&quot; : &quot;Abe10001&quot;, &quot;lastName&quot; : &quot;Lincoln10001&quot; }
&gt; 
</code></pre><p>Now let&#39;s delete all the records:</p>
<pre><code>&gt; db.test_insert.remove({})
WriteResult({ &quot;nRemoved&quot; : 5 })
&gt;
</code></pre><p>You can use the similar rules to those you used for <strong>find</strong> if you want to remove only specific records.</p>
<pre><code>&gt; db.test_insert.remove({firstName: &quot;Abe10003&quot;})
WriteResult({ &quot;nRemoved&quot; : 1 })
&gt;
</code></pre><h2 id="mongoHelp">Mongo: Getting Help</h2>
<p><strong>Mongo</strong> is the command line utility you can use to query your MongoDB collections and to maintain your database. Start <strong>mongo</strong> by typing <strong>mongo</strong> at the command line.</p>
<p>When in mongo, type help to get a list of things you can do:</p>
<pre><code>db.help()                    help on db methods
db.mycoll.help()             help on collection methods
sh.help()                    sharding helpers
rs.help()                    replica set helpers
help admin                   administrative help
help connect                 connecting to a db help
help keys                    key shortcuts
help misc                    misc things to know
help mr                      mapreduce

show dbs                     show database names
show collections             show collections in current database
show users                   show users in current database
show profile                 show most recent system.profile entries with time &gt;= 1ms
show logs                    show the accessible logger names
show log [name]              prints out the last segment of log in memory, &#39;global&#39; is default
use &lt;db_name&gt;                set current database
db.foo.find()                list objects in collection foo
db.foo.find( { a : 1 } )     list objects in foo where a == 1
it                           result of the last line evaluated; use to further iterate
DBQuery.shellBatchSize = x   set default number of items to display on shell
exit                         quit the mongo shell
</code></pre><p>Try, for instance, db.help():</p>
<pre><code>DB methods:
db.addUser(userDocument)
db.adminCommand(nameOrDocument) - switches to &#39;admin&#39; db, and runs command [ just calls db.runCommand(...) ]
db.auth(username, password)
db.cloneDatabase(fromhost)
db.commandHelp(name) returns the help for the command
db.copyDatabase(fromdb, todb, fromhost)
db.createCollection(name, { size : ..., capped : ..., max : ... } )
db.currentOp() displays currently executing operations in the db
db.dropDatabase()
db.eval(func, args) run code server-side
db.fsyncLock() flush data to disk and lock server for backups
db.fsyncUnlock() unlocks server following a db.fsyncLock()
db.getCollection(cname) same as db[&#39;cname&#39;] or db.cname
db.getCollectionNames()
db.getLastError() - just returns the err msg string
db.getLastErrorObj() - return full status object
db.getMongo() get the server connection object
db.getMongo().setSlaveOk() allow queries on a replication slave server
db.getName()
db.getPrevError()
db.getProfilingLevel() - deprecated
db.getProfilingStatus() - returns if profiling is on and slow threshold
db.getReplicationInfo()
db.getSiblingDB(name) get the db at the same server as this one
db.hostInfo() get details about the server&#39;s host
db.isMaster() check replica primary status
db.killOp(opid) kills the current operation in the db
db.listCommands() lists all the db commands
db.loadServerScripts() loads all the scripts in db.system.js
db.logout()
db.printCollectionStats()
db.printReplicationInfo()
db.printShardingStatus()
db.printSlaveReplicationInfo()
db.removeUser(username)
db.repairDatabase()
db.resetError()
db.runCommand(cmdObj) run a database command.  if cmdObj is a string, turns it into { cmdObj : 1 }
db.serverStatus()
db.setProfilingLevel(level,&lt;slowms&gt;) 0=off 1=slow 2=all
db.setVerboseShell(flag) display extra information in shell output
db.shutdownServer()
db.stats()
db.version() current version of the server
</code></pre><h2 id="set-up-a-mongolab-url">Set up a MongoLab URL</h2>
<p>When you want to connect to MongoLab from your program, you need to compose the URL that let&#39;s you in. </p>
<ul>
<li>Sign in to MongoLab.</li>
<li>Go to the MongoLab home page</li>
<li>Click on your database to open it</li>
</ul>
<p>Near the top of the page, on the left, you will see something like this:</p>
<pre><code>To connect using the shell:
    mongo dsXXXXXX.mongolab.com:XXXXX/Databasename -u &lt;dbuser&gt; -p &lt;dbpassword&gt;
To connect using a driver via the standard URI (what&#39;s this?):
    mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@dsXXXXXX.mongolab.com:XXXXX/DatabaseName
</code></pre><p>It is the second URL that you need.</p>
<p><strong>NOTE</strong>: *The dbuser and dbpassword are not the user name and password that you use when you sign on to MongoLab. Instead, these are the database users and passwords for your database. It is an entirely separate user name and password that has nothing to do with your MongoLab account. It is the user for your MongoDb database, not for the site.</p>
<p>To create a database user, click on the USER tab and press <strong>Add database user</strong>.</p>
<p><img src="http://elvenware.com/charlie/books/CloudNotes/Images/MongoLabUser01.png" alt="Database User"></p>
<h2 id="working-with-mongo-data">Working with Mongo Data</h2>
<p>We need to understand updating and deleting records in the database.</p>
<p>A general review of mongo DB.</p>
<p>Look at PeopleManager in CreateCharactor02</p>
<ul>
<li>Mongo is in factory</li>
<li>People Manager is a factory</li>
<li>Can be consumed by Controller or Jasmine Test</li>
</ul>
<p>pkozlowski-opensource on github.</p>
<p>It is interesting to note that this a REST API, so you can simply 
paste URLs into the address bar of your browser, or use them as 
links on web pages:</p>
<ul>
<li><a href="https://api.mongolab.com/api/1/databases/YOUR_DATABASE/collections/YOUR_COLLECTION?apiKey=YOUR_API_KEY">https://api.mongolab.com/api/1/databases/YOUR_DATABASE/collections/YOUR_COLLECTION?apiKey=YOUR_API_KEY</a></li>
</ul>
<p>More info in the MongoDriver docs:</p>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/api-generated/db.html">http://mongodb.github.io/node-mongodb-native/api-generated/db.html</a></li>
</ul>
<p>That&#39;s not a solution for a shipping app, but it is a good tool to 
use when you are experimenting with a new technology.</p>
<p>I should add that posting your API key as a link on a public web 
page is a very bad idea, but you can use it on private sites.</p>
<p>The best way to experiement with this technology is just to take the 
URL and paste it into a the address field of the browser.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Here is a simple node program that uses the modular pattern. It will 
open up a MongoDb database and inserting a row of data into it:</p>
<pre><code>var MongoClient = require(&#39;mongodb&#39;).MongoClient;
var format = require(&#39;util&#39;).format;

var QueryMongo = (function() {

    var url01 = &#39;mongodb://127.0.0.1:27017/test&#39;;
    var url02 = &#39;mongodb://192.168.2.19:27017/test&#39;;

    function QueryMongo() {

        // Open the test database that comes with MongoDb
        MongoClient.connect(url02, function(err, database) {
            if (err) {
                throw err;
            }

            insertCollection(database, &#39;test_insert&#39;, { f : 7 });

        });
    }

    var getCollection = function(database) {

        var collection = database.collection(&#39;test_insert&#39;);

        // Count documents in the collection
        collection.count(function(err, count) {
            console.log(format(&quot;count = %s&quot;, count));
        });

        // View the collection
        collection.find().toArray(function(err, results) {
            console.dir(results);
            database.close();
        });

    };

    // Will create collection if it does not exist
    var insertIntoCollection = function(db, collectionName, objectToInsert) {

        var collection = db.collection(collectionName);
        collection.insert(objectToInsert, function(err, docs) {
            getCollection(db);
        });
    };

    return QueryMongo;

})();

var q = new QueryMongo();
</code></pre><h2 id="noStart">MongoDb Won&#39;t Start</h2>
<p>If you try to start MongoDB, and find that it won&#39;t start, or at 
least won&#39;t stay running after it starts, the problem could be that 
you are out of disk space. MongoDB wants lots of diskspace, 
something like 3.5 GB. You can, however, request that it use less 
disk space by putting <strong>smallfiles = true</strong> at the end of 
<strong>/etc/mongodb.conf</strong>. Now your database will be limited in size in 
half a gig, but that should be plenty for our needs.</p>
<ul>
<li>Remove lockfile: sudo rm /var/lib/mongodb/mongod.lock</li>
<li>Repair: sudo -u mongodb mongod -f /etc/mongod.conf --repair</li>
<li>sudo service mongod start</li>
</ul>
</div></body></html>