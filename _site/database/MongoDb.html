<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width initial-scale=1.0"><title>MongoDb</title><link rel="shortcut icon" href="/charlie/images/favicon.png"><!-- Latest compiled and minified CSS--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"><!-- Optional theme--><link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap-theme.min.css"><!-- link(href='/libs/css/BootstrapIndex.css', rel='stylesheet', type='text/css')--><link href="/css/style.css" rel="stylesheet" type="text/css"><link href="/css/highlight/googlecode.css" rel="stylesheet" type="text/css"><script src="/components/jquery/dist/jquery.js"></script><script src="/components/angular/angular.js"></script><script src="/components/angular-route/angular-route.js"></script><script src="/components/bootstrap/dist/js/bootstrap.min.js"></script><!-- script(src='/libs/scripts/elvenware.js', type='text/javascript')--><script src="/libs/scripts/Control.js"></script><!-- script(src='http://localhost:35729/livereload.js')--></head><body><div class="navbar navbar-inverse"><div class="container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Elvenware</a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li class="active"><a href="/index.html">Home</a></li><li><a href="/charlie/About.html">About</a></li><li class="dropdown"><a href="#/" data-toggle="dropdown" class="dropdown-toggle">Dropdown<b class="caret"></b></a><ul class="dropdown-menu"><li class="dropdown-header">Core Code</li><li><a href="/charlie/development/index.html">Strongly Typed</a></li><li><a href="/charlie/development/web/index.html">Web & Scripts</a></li><li><a href="/charlie/development/cloud/index.shtml">Cloud</a></li><li class="divider"></li><li class="dropdown-header">OS and Tools</li><li><a href="/os/index.html">OS</a></li><li><a href="/charlie/development/database/index.html">Database</a></li><li><a href="/books/index.html">My Writing</a></li><li class="divider"></li><li class="dropdown-header">Art</li><li><a href="/charlie/Art/index.html">Poems & Photos</a></li><li><a href="/books/reading/index.html">Book Reviews</a></li><li><a href="/spirit/index.html">Spiritual</a></li><li class="divider"></li><li class="dropdown-header">Links</li><li><a href="/charlie/links.html">My Links</a></li><li><a href="http://www.github.com/charliecalvert">GitHub</a></li><li><a href="http://sourceforge.net/projects/elvenware/">Sourceforge</a></li></ul></li></ul></div><!-- /.nav-collapse--></div></div><div class="container"><figure><img alt="Elvenware" src="/charlie/images/elvenwarelogo.png"/></figure><h1>MongoDb</h1><h3>Table of Contents</h3><ul><!--TOC_Start--><li><a href="#mongodb">MongoDb</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#authenticate">Authenticate</a></li>
<li><a href="#trouble-shoot">Trouble Shoot</a></li>
<li><a href="#uninstall">Uninstall</a></li>
<li><a href="#older-versions-of-ubuntu">Older Versions of Ubuntu</a></li>
<li><a href="#install-on-cloud-9">Install on Cloud 9</a></li>
<li><a href="#install-the-npm-package">Install the NPM Package</a></li>
<li><a href="#stopStart">Start and Stop MongoDb</a></li>
<li><a href="#sample-session">Sample Session</a></li>
<li><a href="#mongoHelp">Mongo: Getting Help</a></li>
<li><a href="#set-up-a-mongolab-url">Set up a MLab URL</a></li>
<li><a href="#how-to-connect">How to Connect to mLab or a Local Database</a></li>
<li><a href="#working-with-mongo-data">Working with Mongo Data</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#sort-order">Sort Order</a></li>
<li><a href="#backup-and-restore">Backup and Restore</a></li>
<li><a href="#noStart">MongoDb Won&#39;t Start</a></li>
<li><a href="#mongoose-subdocuments">Mongoose Subdocuments</a></li>
<li><a href="#mongoose-gyp-bson">Mongoose Gyp and Bson</a></li><!--TOC_End--></ul><h1 id="mongodb">MongoDb</h1>
<p>MongoDb is no-sql database.</p>
<ul>
<li><a href="http://www.mongodb.org/">MongoDb home page</a></li>
<li><a href="https://mongolab.com/welcome/">Free (for small deployments) online MongoDatabase</a>.</li>
</ul>
<h2 id="install">Install</h2>
<p>The simplest course is to run this script:</p>
<ul>
<li>A bash script for MongoDb from <a href="https://github.com/charliecalvert/JsObjects/tree/master/Utilities">/JsObjects/Utilities</a> called <a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/InstallScripts/InstallMongoDb">InstallMongoDb</a>:</li>
</ul>
<p>Before getting started, there are two facts you should know:</p>
<ul>
<li>Ubuntu and MongoDb only work together to update MongoDb for LTS versions of Ubuntu and Lubuntu.</li>
<li>Ubuntu and Lubuntu have built in versions of MongoDb, but they are not necessarily the latest, and they &quot;conflict with&quot; the latest vertion.</li>
<li>Below I explain how to install the latest.</li>
</ul>
<p>At this time, the latest LTS version of Ubuntu that is targeted by MongoDb is 16.04.</p>
<p>This means the official Ubuntu release of MongoDb is 2.6, which is from April 2014. Why is the Ubuntu version of MongoDb so old? Because Ubuntu releases LTS versions every two years, and at the time of this writing it has been about two years since the last LTS release for which there is a MongoDb release. (More specifically, the last LTS version was 14.04. The new 16.04 release is out, but the MongoDb apt install script has still not been updated.)</p>
<p>To get a new version of MongoDb on Ubuntu, there needs to be:</p>
<ul>
<li>A new version of Ubuntu</li>
<li>A new or recent version of MongoDb</li>
<li>An apt install script for both that is in good working order.</li>
</ul>
<p>Right now those three things have not come into alignment. Hopefully they will soon. But for now, we have to live with our current situation.</p>
<p>Despite the annoyance, if all you are trying to do is learn MongoDb, it really doesn&#39;t matter that you have an older release. The commands are identical or very similar to those on the new release. Furthermore, you don&#39;t really need the latest unless you are trying to serve data to a huge number of users on a busy site. That is unlikely to be the case if you are just learning MongoDb. As a result, I don&#39;t advise wasting time trying to install the latest. Just live with the older version until the APT script is updated. In the meantime you can simply install MongoDb with this command:</p>
<pre>
sudo apt-get install mongodb
</pre>

<p>Some additional information:</p>
<ul>
<li><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-ubuntu/">Linux: Follow these instructions</a></li>
<li><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-windows/?_ga=1.145962999.279933697.1429292287">Windows: Follow these instructions</a></li>
<li><a href="http://elvenware.com/charlie/development/database/NoSql/MongoDb.html">Mongo on Elvenware</a></li>
</ul>
<p>On Ubuntu 16.04 use these techniques</p>
<pre><code>sudo apt-key adv <span class="hljs-comment">--keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6</span>
echo <span class="hljs-string">"deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse"</span> | sudo tee /etc/apt/sources.<span class="hljs-built_in">list</span>.d/mongodb-org<span class="hljs-number">-3.4</span>.<span class="hljs-built_in">list</span>
sudo apt-<span class="hljs-keyword">get</span> update
sudo apt-<span class="hljs-keyword">get</span> install -y mongodb-org
</code></pre><p>The above is soured here:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/&quot;">MongoDb Docs</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-16-04">Digital Ocean article</a>:</li>
</ul>
<p>Then create a file called <strong>/etc/systemd/system/mongodb.service</strong>. This file will likely need to be replaced when official 16.04 MongoDb binaries are released. One way to create the file is with your favorite text editor, such as geany or nano. To create the file, you will need to be in sudo mode. You should therefore issue a command like this:</p>
<pre>
sudo nano /etc/systemd/system/mongodb.service
</pre>

<p>And here is the text that should be pasted into the file:</p>
<pre>
[Unit]
Description=High-performance, schema-free document-oriented database
After=network.target
Documentation=https://docs.mongodb.org/manual

[Service]
User=mongodb
Group=mongodb
ExecStart=/usr/bin/mongod --quiet --config /etc/mongod.conf

[Install]
WantedBy=multi-user.target
</pre>

<p>Now start the service and ensure that is restarted each time you boot up:</p>
<pre>
sudo systemctl start mongodb
sudo systemctl enable mongodb
</pre>

<p>Again, the simplest way to do all this is with the script mentioned at the start of this section. See also this script, to eliminate warnings:</p>
<ul>
<li><a href="https://github.com/charliecalvert/JsObjects/blob/master/Utilities/InstallScripts/HugePageFix">Huge Page Fix</a></li>
</ul>
<h2 id="authenticate">Authenticate</h2>
<p>When you start the <strong>mongo</strong> cli, you might get a warning about security. If you want better security, there are three steps you must take.</p>
<p>In the database, create two users. Type <strong>mongo</strong> to start the shell. Then do something like this:</p>
<pre><code class="lang-sql"><span class="hljs-selector-tag">use</span> <span class="hljs-selector-tag">admin</span>
<span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.createUser</span>(
  {
    <span class="hljs-attribute">user</span>: <span class="hljs-string">"administrator"</span>,
    pwd: <span class="hljs-string">"foobar"</span>,
    roles: [ { role: <span class="hljs-string">"userAdminAnyDatabase"</span>, db: <span class="hljs-string">"admin"</span> } ]
  }
)
<span class="hljs-selector-tag">db</span><span class="hljs-selector-class">.createUser</span>(
  {
    <span class="hljs-attribute">user</span>: <span class="hljs-string">"charlie"</span>,
    pwd: <span class="hljs-string">"foobar"</span>,
    roles: [ { role: <span class="hljs-string">"userAdminAnyDatabase"</span>, db: <span class="hljs-string">"admin"</span> } ]
  }
)
</code></pre>
<p>Type <strong>exit</strong> to quit the shell.</p>
<p>Edit <strong>/etc/mongod.conf</strong>. To do this, you probably want to use one of these commands, where the first is simplest:</p>
<pre><code>sudo nano /etc/mongod.<span class="hljs-keyword">conf</span>
sudo <span class="hljs-keyword">vim</span> /etc/mongod.<span class="hljs-keyword">conf</span>
</code></pre><p>Add <strong>authorization: enabled</strong>, by first uncommenting the security section (remove the # symbol). It looks like this:</p>
<pre><code><span class="hljs-attribute">security</span>:
  <span class="hljs-attribute">authorization</span>: enabled
</code></pre><p>Now restart and check the status:</p>
<pre><code><span class="hljs-attribute">sudo</span> service mongod restart
</code></pre><p>  sudo service mongod status</p>
<p>Example connection strings, where the second involves connecting remotely as explained further down:</p>
<pre><code>mongo -u <span class="hljs-string">"charlie"</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-string">"foobar"</span> --authenticationDatabase <span class="hljs-string">"admin"</span>
mongo <span class="hljs-number">192.168</span>.<span class="hljs-number">2.18</span>:<span class="hljs-number">27017</span> -u <span class="hljs-string">"charlie"</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-string">"foobar"</span> --authenticationDatabase <span class="hljs-string">"admin"</span>
</code></pre><p>You probably need to explicitly allow connections from machines other than local host. The syntax to add to <strong>/etc/mongod.conf</strong> for letting in one other machine:</p>
<pre><code><span class="hljs-comment"># network interfaces</span>
<span class="hljs-attr">net:</span>
<span class="hljs-attr">  port:</span> <span class="hljs-number">27017</span>
<span class="hljs-attr">  bindIp:</span> [<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>, <span class="hljs-number">192.168</span><span class="hljs-number">.2</span><span class="hljs-number">.5</span>]
</code></pre><p>Some preliminary testing shows that wildcards might work: <strong>192.168.2.*</strong></p>
<p>For letting in them all use this IP: <strong>0.0.0.0</strong>. Don&#39;t ever do that on a public server. It&#39;s a form of <strong>financial suicide</strong>.</p>
<h2 id="trouble-shoot">Trouble Shoot</h2>
<p>If you are working in Pristine Lubuntu, you may get an error starting MongoDb due to a lack of space. One possible solution would be to use the cloud 9 commands with a variation on the --bind_ip in the third line:</p>
<pre><code><span class="hljs-comment">cd</span>
<span class="hljs-comment">mkdir</span> <span class="hljs-comment">data</span>
<span class="hljs-comment">echo</span> <span class="hljs-comment">'mongod</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">bind_ip=127</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">1</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">dbpath=data</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">nojournal</span> <span class="hljs-literal">-</span><span class="hljs-literal">-</span><span class="hljs-comment">rest</span> <span class="hljs-comment">"$@"'</span> &gt; <span class="hljs-comment">~/mongod</span>
<span class="hljs-comment">chmod</span> <span class="hljs-comment">a</span><span class="hljs-literal">+</span><span class="hljs-comment">x</span> <span class="hljs-comment">~/mongod</span>
<span class="hljs-string">.</span><span class="hljs-comment">/mongod</span>
</code></pre><p>On Cloud 9, we set the bind_ip to $IP, but here we set it to local host.</p>
<h2 id="uninstall">Uninstall</h2>
<p>The following commands should remove mongodb from your system:</p>
<pre>
sudo apt-get purge mongodb-org  <= TRY THIS
sudo apt-get purge mongodb      <= OR TRY THIS
sudo apt-get autoremove
</pre>

<p>You should also remove mongodb.list if it exists:</p>
<pre>
sudo rm /etc/apt/sources.list.d/mongodb.list
</pre>

<h2 id="older-versions-of-ubuntu">Older Versions of Ubuntu</h2>
<p>Older install script for previous versions of ubuntu such as 15.04:</p>
<pre><code>sudo apt-<span class="hljs-built_in">key</span> adv --keyserver hkp:<span class="hljs-comment">//keyserver.ubuntu.com:80 --recv 7F0CEB10</span>
echo 'deb http:<span class="hljs-comment">//downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/mongodb.list</span>
sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span>
sudo apt-<span class="hljs-built_in">get</span> install mongodb-org
</code></pre><p>The second line above should be typed as one line, so just run JsObjects script or block copy the above and paste it into the command line. Note, however, that the second line has two parts:</p>
<pre><code><span class="hljs-string">PART01:</span> <span class="hljs-string">'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen'</span>
<span class="hljs-string">PART02:</span> sudo tee <span class="hljs-regexp">/etc/</span>apt<span class="hljs-regexp">/sources.list.d/</span>mongodb.list
</code></pre><p>When you paste in the whole line, you are, in effect, running two commands separated by the <a href="http://stackoverflow.com/questions/12400371/what-does-means-in-terminal">pipe symbol</a>. In pseudo code, it looks like this:</p>
<pre><code><span class="hljs-built_in">echo</span> PART01 | PART02  <span class="hljs-comment">// Don't actually run this</span>
</code></pre><p>But don&#39;t try to paste that in, paste in the line from the script. The above pseudo command is just an attempt to explain what the second line in the script does. It is not a valid method of running the second line.</p>
<p>There is an alternative method, but it is not recommended, as it probably won&#39;t install the latest MongoDb. Nevertheless, it could work. So if the above fails, you could try:</p>
<pre><code>sudo apt-get <span class="hljs-keyword">install</span> mongodb  // <span class="hljs-keyword">Only</span> <span class="hljs-keyword">do</span> this <span class="hljs-keyword">if</span> the above fails
</code></pre><h2 id="install-on-cloud-9">Install on Cloud 9</h2>
<p>MongoDb is preinstalled on Cloud 9. To set it up do this:</p>
<pre>
cd
mkdir data
echo 'mongod --bind_ip=$IP --dbpath=data --nojournal --rest "$@"' > ~/mongod
chmod a+x ~/mongod
mongod
</pre>

<p>I got the above here:</p>
<ul>
<li><a href="https://community.c9.io/t/setting-up-mongodb/1717">https://community.c9.io/t/setting-up-mongodb/1717</a></li>
</ul>
<p>Then to view the database:</p>
<pre><code>mongo
</code></pre><p>Here is a typical URL for accessing a database:</p>
<pre><code class="lang-javascript"><span class="hljs-string">"mongodb://0.0.0.0:27017/test"</span>,
</code></pre>
<p>And here is what a <strong>MongoTalk.json</strong> configuration file might look like:</p>
<pre><code class="lang-javascript">{
    "<span class="hljs-attr">urls</span>": [
        <span class="hljs-string">"mongodb://0.0.0.0:27017/test"</span>,
        <span class="hljs-string">"mongodb://127.0.0.1:27017/test"</span>,
        <span class="hljs-string">"mongodb://USERNAME:PASSWORD@dsXXX.mongolab.som:XXXX/DATABASE"</span>
    ],
    "<span class="hljs-attr">selectedUrl</span>": <span class="hljs-number">0</span>
}
</code></pre>
<h2 id="install-the-npm-package">Install the NPM Package</h2>
<p>If the <strong>package.json</strong> file for your project does not already include <a href="https://www.npmjs.org/package/mongodb">mongodb</a>, use <strong>npm</strong> to install the Node <strong>mongodb</strong> driver into your local project:</p>
<pre><code>sudo npm <span class="hljs-keyword">install</span> mongodb
</code></pre><h2 id="stopStart">Start and Stop MongoDb</h2>
<p>I believe these are the commands for the recent versions of Ubuntu:</p>
<pre>
    sudo systemctl start mongodb
    sudo systemctl stop mongodb
    sudo systemctl enable mongodb
</pre>

<p>Use these commands to stop, to start and restart MongoDb on older versions of Ubuntu:</p>
<pre>
    sudo service mongodb start
    sudo service mongodb stop
    sudo service mongodb restart
</pre>

<p>To see if MongoDb is running, or to learn a bit about your instance, go
to this address:</p>
<ul>
<li><a href="http://localhost:28017/">http://localhost:28017/</a></li>
</ul>
<p>The key is that it is a port 1000 above the port you use to query
the database. The page you find will reveal at least a few minimal
facts about your running instance of MongoDb.</p>
<p>On recent versions of MongoDb <strong><a href="http://localhost:28017/">http://localhost:28017/</a></strong> won&#39;t work unless you add this to <strong>/etc/mongod.conf</strong> and then restart mongodb:</p>
<pre><code><span class="hljs-comment"># network interfaces</span>
<span class="hljs-attr">net:</span>
<span class="hljs-attr">  port:</span> <span class="hljs-number">27017</span>
<span class="hljs-attr">  bindIp:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
  http.enabled: <span class="hljs-literal">true</span>
  http.RESTInterfaceEnabled: <span class="hljs-literal">true</span>
</code></pre><h2 id="sample-session">Sample Session</h2>
<p>You can view the content on your MongoDb server without writing any code. First you need to start the mongo client:</p>
<pre><code>$ mongo
MongoDB <span class="hljs-built_in">shell</span> <span class="hljs-built_in">version</span>: <span class="hljs-number">2.6</span><span class="hljs-number">.1</span>
connecting <span class="hljs-built_in">to</span>: test
</code></pre><p>To quit the shell, you type <strong>exit</strong> and press return. But let&#39;s not do that quite yet. Instead you might want to see the databases on your instance of MongoDb:</p>
<pre><code>&gt; show dbs
admin  (<span class="hljs-name">empty</span>)
bar    (<span class="hljs-name">empty</span>)
local  <span class="hljs-number">0.078</span>GB
test   <span class="hljs-number">0.078</span>GB
</code></pre><p>Select or create one of the databases:</p>
<pre><code>&gt; <span class="hljs-keyword">use</span> <span class="hljs-keyword">test</span>
switched to <span class="hljs-keyword">db</span> <span class="hljs-keyword">test</span>
</code></pre><p><strong>NOTE</strong>: <em>The command <strong>use foo</strong> will switch the user to the <strong>foo</strong> database. If <strong>foo</strong> does not exist, it will create it and then switch to it.</em></p>
<p>Instead of tables, MongoDb has collections. Show the collections in the database.</p>
<pre><code>&gt; show collections
finalWalk
system.indexes
<span class="hljs-built_in">test</span>Data
<span class="hljs-built_in">test</span>_insert
</code></pre><p>Insert data into a collection called <strong>test01</strong>. The collection will be created if it does not exist:</p>
<pre>
db.test01.insert({firstName: "Susan"})
WriteResult({ "nInserted" : 1 })
</pre>

<p>A somewhat more complex example is shown here:</p>
<pre>
db.test02.insert({  
   "firstName": "Abe10001",
   "lastName": "Lincoln10001",
   "address": "10001 Green Street",
   "city": "Bellevue",
   "state": "WA",
   "zip": 98002
})
</pre>

<p>Note that we are inserting into a collection called test02. When you paste in the above, the output should look like this:</p>
<pre>
    >  db.test02.insert({  
    ...   "firstName": "Abe10001",
    ...   "lastName": "Lincoln10001",
    ...   "address": "10001 Green Street",
    ...   "city": "Bellevue",
    ...   "state": "WA",
    ...   "zip": 98002
    ... })
</pre>

<p>Use <strong>find</strong> to see the contents of <strong>test02</strong>:</p>
<pre><code>    &gt; db.test02.find()    
    {
        <span class="hljs-string">"_id"</span>: ObjectId(<span class="hljs-string">"537a6ba7ceccfa98291d56dd"</span>),
        <span class="hljs-string">"firstName"</span>: <span class="hljs-string">"Abe10001"</span>,
        <span class="hljs-string">"lastName"</span>: <span class="hljs-string">"Lincoln10001"</span>,
        <span class="hljs-string">"address"</span>: <span class="hljs-string">"10001 Green Street"</span>,
        <span class="hljs-string">"city"</span>: <span class="hljs-string">"Bellevue"</span>,
        <span class="hljs-string">"state"</span>: <span class="hljs-string">"WA"</span>,
        <span class="hljs-string">"zip"</span>: 98002
    }
    etc...
    &gt;
</code></pre><p>By default, you can can insert nearly any valid JSON into your tables. This means we could insert the data we inserted into <strong>test01</strong> into <strong>test02</strong> or vice versa. Though the JSON has a different structure, it will not cause problems. For instance:</p>
<pre>
db.test02.insert({longshot: "RubyFind"})

> db.test02.find()
{ "\_id" : ObjectId("5754550586f9d37ae11eb9cd"), "firstName" : "Abe10001", "lastName" : "Lincoln10001", "address" : "10001 Green Street", "city" : "Bellevue", "state" : "WA", "zip" : 98002 }
{ "\_id" : ObjectId("5754568286f9d37ae11eb9ce"), "longshot" : "RubyFind" }
</pre>

<p>As you can see, the first and second objects have very different structures, yet they both co-exist in the collection. This behavior is, of course, very different from what we see in a SQL database.</p>
<p>You can ask to <strong>project</strong> only certain fields. The following projection asks not to see the _id field, which is displayed by default, and to see the firstName and lastName fields. (What you see here assumes that additional rows have been inserted):</p>
<pre><code>&gt; db.test02.find({}, {<span class="hljs-string">"\_id"</span>: <span class="hljs-number">0</span>, firstName: <span class="hljs-number">1</span>, <span class="hljs-string">"lastName"</span>: <span class="hljs-number">1</span>});
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10000"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10000"</span> }
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10001"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10001"</span> }
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10002"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10002"</span> }
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10003"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10003"</span> }
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10004"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10004"</span> }
</code></pre><p>This query asks to only the rows where firstName is equal to Abe0001.</p>
<pre><code>&gt; db.test02.find({firstName: <span class="hljs-string">"Abe10001"</span>}, {<span class="hljs-string">"\_id"</span>: <span class="hljs-number">0</span>, firstName: <span class="hljs-number">1</span>, <span class="hljs-string">"lastName"</span>: <span class="hljs-number">1</span>});
{ <span class="hljs-string">"firstName"</span> : <span class="hljs-string">"Abe10001"</span>, <span class="hljs-string">"lastName"</span> : <span class="hljs-string">"Lincoln10001"</span> }
&gt;
</code></pre><p>Now let&#39;s delete all the records:</p>
<pre><code>&gt; db.test02.remove({})
WriteResult({ <span class="hljs-string">"nRemoved"</span> : <span class="hljs-number">5</span> })
&gt;
</code></pre><p>You can use the similar rules to those you used for <strong>find</strong> if you want to remove only specific records.</p>
<pre><code>&gt; db.test_insert.remove({firstName: <span class="hljs-string">"Abe10003"</span>})
WriteResult({ <span class="hljs-string">"nRemoved"</span> : <span class="hljs-number">1</span> })
&gt;
</code></pre><h2 id="mongoHelp">Mongo: Getting Help</h2>
<p><strong>Mongo</strong> is the command line utility you can use to query your MongoDB collections and to maintain your database. Start <strong>mongo</strong> by typing <strong>mongo</strong> at the command line.</p>
<p>When in mongo, type help to get a list of things you can do:</p>
<pre><code>db.help()                    <span class="hljs-keyword">help</span> <span class="hljs-keyword">on</span> db methods
db.mycoll.<span class="hljs-keyword">help</span>()             <span class="hljs-keyword">help</span> <span class="hljs-keyword">on</span> collection methods
sh.<span class="hljs-keyword">help</span>()                    sharding helpers
rs.<span class="hljs-keyword">help</span>()                    replica <span class="hljs-keyword">set</span> helpers
<span class="hljs-keyword">help</span> <span class="hljs-keyword">admin</span>                   administrative <span class="hljs-keyword">help</span>
<span class="hljs-keyword">help</span> <span class="hljs-keyword">connect</span>                 connecting <span class="hljs-keyword">to</span> a db <span class="hljs-keyword">help</span>
<span class="hljs-keyword">help</span> <span class="hljs-keyword">keys</span>                    <span class="hljs-keyword">key</span> shortcuts
<span class="hljs-keyword">help</span> misc                    misc things <span class="hljs-keyword">to</span> know
<span class="hljs-keyword">help</span> mr                      mapreduce

<span class="hljs-keyword">show</span> dbs                     <span class="hljs-keyword">show</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">names</span>
<span class="hljs-keyword">show</span> collections             <span class="hljs-keyword">show</span> collections <span class="hljs-keyword">in</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">database</span>
<span class="hljs-keyword">show</span> <span class="hljs-keyword">users</span>                   <span class="hljs-keyword">show</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">database</span>
<span class="hljs-keyword">show</span> profile                 <span class="hljs-keyword">show</span> most recent <span class="hljs-keyword">system</span>.profile entries <span class="hljs-keyword">with</span> <span class="hljs-keyword">time</span> &gt;= <span class="hljs-number">1</span>ms
<span class="hljs-keyword">show</span> <span class="hljs-keyword">logs</span>                    <span class="hljs-keyword">show</span> the <span class="hljs-keyword">accessible</span> logger <span class="hljs-keyword">names</span>
<span class="hljs-keyword">show</span> <span class="hljs-keyword">log</span> [<span class="hljs-keyword">name</span>]              prints <span class="hljs-keyword">out</span> the <span class="hljs-keyword">last</span> <span class="hljs-keyword">segment</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">log</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">memory</span>, <span class="hljs-string">'global'</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">default</span>
<span class="hljs-keyword">use</span> &lt;db_name&gt;                <span class="hljs-keyword">set</span> <span class="hljs-keyword">current</span> <span class="hljs-keyword">database</span>
db.foo.find()                <span class="hljs-keyword">list</span> objects <span class="hljs-keyword">in</span> collection foo
db.foo.find( { a : <span class="hljs-number">1</span> } )     <span class="hljs-keyword">list</span> objects <span class="hljs-keyword">in</span> foo <span class="hljs-keyword">where</span> a == <span class="hljs-number">1</span>
it                           <span class="hljs-keyword">result</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">last</span> line evaluated; <span class="hljs-keyword">use</span> <span class="hljs-keyword">to</span> further <span class="hljs-keyword">iterate</span>
DBQuery.shellBatchSize = x   <span class="hljs-keyword">set</span> <span class="hljs-keyword">default</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> items <span class="hljs-keyword">to</span> display <span class="hljs-keyword">on</span> shell
<span class="hljs-keyword">exit</span>                         quit the mongo shell
</code></pre><p>Try, for instance, db.help():</p>
<pre><code><span class="hljs-keyword">DB</span> methods:
<span class="hljs-keyword">db</span>.addUser(userDocument)
<span class="hljs-keyword">db</span>.adminCommand(nameOrDocument) - switches to 'admin' <span class="hljs-keyword">db</span>, and runs command [ just calls <span class="hljs-keyword">db</span>.runCommand(...) ]
<span class="hljs-keyword">db</span>.auth(username, password)
<span class="hljs-keyword">db</span>.cloneDatabase(fromhost)
<span class="hljs-keyword">db</span>.commandHelp(name) returns the <span class="hljs-keyword">help</span> <span class="hljs-keyword">for</span> the command
<span class="hljs-keyword">db</span>.copyDatabase(fromdb, todb, fromhost)
<span class="hljs-keyword">db</span>.createCollection(name, { size : ..., capped : ..., max : ... } )
<span class="hljs-keyword">db</span>.currentOp() displays currently executing operations <span class="hljs-keyword">in</span> the <span class="hljs-keyword">db</span>
<span class="hljs-keyword">db</span>.dropDatabase()
<span class="hljs-keyword">db</span>.eval(func, <span class="hljs-keyword">args</span>) <span class="hljs-keyword">run</span> code server-side
<span class="hljs-keyword">db</span>.fsyncLock() flush data to disk and lock server <span class="hljs-keyword">for</span> backups
<span class="hljs-keyword">db</span>.fsyncUnlock() unlocks server following a <span class="hljs-keyword">db</span>.fsyncLock()
<span class="hljs-keyword">db</span>.getCollection(cname) same <span class="hljs-keyword">as</span> <span class="hljs-keyword">db</span>['cname'] or <span class="hljs-keyword">db</span>.cname
<span class="hljs-keyword">db</span>.getCollectionNames()
<span class="hljs-keyword">db</span>.getLastError() - just returns the <span class="hljs-keyword">err</span> msg <span class="hljs-built_in">string</span>
<span class="hljs-keyword">db</span>.getLastErrorObj() - <span class="hljs-keyword">return</span> full status object
<span class="hljs-keyword">db</span>.getMongo() get the server connection object
<span class="hljs-keyword">db</span>.getMongo().setSlaveOk() allow queries <span class="hljs-keyword">on</span> a replication slave server
<span class="hljs-keyword">db</span>.getName()
<span class="hljs-keyword">db</span>.getPrevError()
<span class="hljs-keyword">db</span>.getProfilingLevel() - deprecated
<span class="hljs-keyword">db</span>.getProfilingStatus() - returns <span class="hljs-keyword">if</span> profiling is <span class="hljs-keyword">on</span> and slow threshold
<span class="hljs-keyword">db</span>.getReplicationInfo()
<span class="hljs-keyword">db</span>.getSiblingDB(name) get the <span class="hljs-keyword">db</span> at the same server <span class="hljs-keyword">as</span> this <span class="hljs-keyword">one</span>
<span class="hljs-keyword">db</span>.hostInfo() get details <span class="hljs-keyword">about</span> the server's host
<span class="hljs-keyword">db</span>.isMaster() check replica primary status
<span class="hljs-keyword">db</span>.killOp(opid) kills the current operation <span class="hljs-keyword">in</span> the <span class="hljs-keyword">db</span>
<span class="hljs-keyword">db</span>.listCommands() lists all the <span class="hljs-keyword">db</span> commands
<span class="hljs-keyword">db</span>.loadServerScripts() loads all the scripts <span class="hljs-keyword">in</span> <span class="hljs-keyword">db</span>.system.js
<span class="hljs-keyword">db</span>.logout()
<span class="hljs-keyword">db</span>.printCollectionStats()
<span class="hljs-keyword">db</span>.printReplicationInfo()
<span class="hljs-keyword">db</span>.printShardingStatus()
<span class="hljs-keyword">db</span>.printSlaveReplicationInfo()
<span class="hljs-keyword">db</span>.removeUser(username)
<span class="hljs-keyword">db</span>.repairDatabase()
<span class="hljs-keyword">db</span>.resetError()
<span class="hljs-keyword">db</span>.runCommand(cmdObj) <span class="hljs-keyword">run</span> a database command.  <span class="hljs-keyword">if</span> cmdObj is a string, turns it into { cmdObj : 1 }
<span class="hljs-keyword">db</span>.serverStatus()
<span class="hljs-keyword">db</span>.setProfilingLevel(level,&lt;slowms&gt;) 0=off 1=slow 2=all
<span class="hljs-keyword">db</span>.setVerboseShell(flag) <span class="hljs-keyword">display</span> extra information <span class="hljs-keyword">in</span> <span class="hljs-keyword">shell</span> output
<span class="hljs-keyword">db</span>.shutdownServer()
<span class="hljs-keyword">db</span>.stats()
<span class="hljs-keyword">db</span>.<span class="hljs-keyword">version</span>() current <span class="hljs-keyword">version</span> of the server
</code></pre><h2 id="set-up-a-mongolab-url">Set up a MLab URL</h2>
<p>When you want to connect to MLab from your program, you need to compose the URL that let&#39;s you in.</p>
<ul>
<li>Sign in to MLab.</li>
<li>Go to the MLab home page</li>
<li>Click on your database to open it</li>
</ul>
<p>Near the top of the page, on the left, you will see something like this:</p>
<pre><code>To connect using the shell:
    mongo dsXXXXXX.mongolab.com:XXXXX/Databasename -u <span class="hljs-variable">&lt;dbuser&gt;</span> -p <span class="hljs-variable">&lt;dbpassword&gt;</span>
To connect using a driver via the standard URI (what's this?):
    mongodb://<span class="hljs-variable">&lt;dbuser&gt;</span>:<span class="hljs-variable">&lt;dbpassword&gt;</span><span class="hljs-meta">@dsXXXXXX.mongolab.com:XXXXX/DatabaseName</span>
</code></pre><p>It is the second URL that you need.</p>
<p><strong>NOTE</strong>: <em>The dbuser and dbpassword are not the user name and password that you use when you sign on to MongoLab. Instead, these are the database users and passwords for your database. It is an entirely separate user name and password that has nothing to do with your MongoLab account. It is the user for your MongoDb database, not for the site.</em></p>
<p>To create a database user, click on the USER tab and press <strong>Add database user</strong>.</p>
<p><img src="http://elvenware.com/charlie/books/CloudNotes/Images/MongoLabUser01.png" alt="Database User"></p>
<h2 id="how-to-connect">How to Connect to mLab or a Local Database</h2>
<p>Here is the <strong>connect.js</strong> file that handles the connection from mongoose to a MongoDb database. It supports both a local and remote mLab instance of MongoDb:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/**
 * Created by charlie on 6/6/16.
 */</span>

<span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);

<span class="hljs-keyword">var</span> connect = {

    connected: <span class="hljs-literal">false</span>,

    simpleConnect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting with simple.'</span>);
        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'mongodb://127.0.0.1:27017/renew'</span>;
        connect.connected = <span class="hljs-literal">true</span>;
        mongoose.connect(url);
        <span class="hljs-keyword">var</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    <span class="hljs-comment">// mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds049848.mlab.com:49848/elvenlab01</span>
    mlabConnect: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connecting with mlab.'</span>);
        connect.connected = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> userName = <span class="hljs-string">'foobar'</span>;
        <span class="hljs-keyword">var</span> password = <span class="hljs-string">'foo'</span>;
        <span class="hljs-keyword">var</span> siteAndPort = <span class="hljs-string">'ds049848.mongolab.com:49848'</span>;
        <span class="hljs-keyword">var</span> databaseName = <span class="hljs-string">'elvenlab01'</span>;
        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'mongodb://'</span> + userName + <span class="hljs-string">':'</span> + password + <span class="hljs-string">'@'</span> + siteAndPort + <span class="hljs-string">'/'</span> + databaseName;
        <span class="hljs-built_in">console</span>.log(url);
        mongoose.connect(url);

        <span class="hljs-comment">// This part is optional</span>
        <span class="hljs-keyword">var</span> db = mongoose.connection;
        db.on(<span class="hljs-string">'error'</span>, <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>, <span class="hljs-string">'connection error:'</span>));
        db.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            connect.connected = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Opened connection to mongo'</span>);
        });
    },

    doConnection: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">useSimple</span>) </span>{
<span class="hljs-meta">        'use strict'</span>;
        <span class="hljs-keyword">var</span> connectType = useSimple || <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (connectType) {
            connect.simpleConnect();
        } <span class="hljs-keyword">else</span> {
            connect.mlabConnect();
        }
    }
};

<span class="hljs-built_in">module</span>.exports = connect;
</code></pre>
<p>This code defaults to using mLab (MongoLab) unless you specify otherwise:</p>
<pre><code class="lang-javascript"><span class="hljs-variable"><span class="hljs-keyword">var</span> connectType</span> = useSimple || <span class="hljs-literal">false</span>;
</code></pre>
<p>It also breaks out the various pieces of the mLab connection string into discreet variables so that you can more easily see how to create a valid URL:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> userName = <span class="hljs-string">'foobar'</span>;
<span class="hljs-keyword">var</span> password = <span class="hljs-string">'foo'</span>;
<span class="hljs-keyword">var</span> siteAndPort = <span class="hljs-string">'ds049848.mongolab.com:49848'</span>;
<span class="hljs-keyword">var</span> databaseName = <span class="hljs-string">'elvenlab01'</span>;
</code></pre>
<p>Note that the goal is to create a URL of this type:</p>
<pre>
mongodb://<dbuser>:<dbpassword>@ds049848.mlab.com:49848/<dbname>
</pre>

<p>Ultimately, you want to change nearly the entire URL, including the number in the <strong>siteAndPort</strong> portion. The following is not a valid URL, but it should help you see what you are trying to create:</p>
<pre>
mongodb://myusername:mypassword@ds1111.mlab.com:11111/mydatabase
</pre>

<p>Remember, you can use the example on the main page for your mLab database to see what the URL you want to create should look like. <a href="#set-up-a-mongolab-url">Earlier in this text</a> I provide a <a href="http://elvenware.com/charlie/books/CloudNotes/Images/MongoLabUser01.png">sample screen shot</a> of that page.</p>
<h2 id="working-with-mongo-data">Working with Mongo Data</h2>
<p>We need to understand updating and deleting records in the database.</p>
<p>A general review of mongo DB.</p>
<p>Look at PeopleManager in CreateCharactor02</p>
<ul>
<li>Mongo is in factory</li>
<li>People Manager is a factory</li>
<li>Can be consumed by Controller or Jasmine Test</li>
</ul>
<p>pkozlowski-opensource on github.</p>
<p>It is interesting to note that this a REST API, so you can simply
paste URLs into the address bar of your browser, or use them as
links on web pages:</p>
<ul>
<li><a href="https://api.mongolab.com/api/1/databases/YOUR_DATABASE/collections/YOUR_COLLECTION?apiKey=YOUR_API_KEY">https://api.mongolab.com/api/1/databases/YOUR_DATABASE/collections/YOUR_COLLECTION?apiKey=YOUR_API_KEY</a></li>
</ul>
<p>More info in the MongoDriver docs:</p>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/api-generated/db.html">http://mongodb.github.io/node-mongodb-native/api-generated/db.html</a></li>
</ul>
<p>That&#39;s not a solution for a shipping app, but it is a good tool to
use when you are experimenting with a new technology.</p>
<p>I should add that posting your API key as a link on a public web
page is a very bad idea, but you can use it on private sites.</p>
<p>The best way to experiement with this technology is just to take the
URL and paste it into a the address field of the browser.</p>
<h2 id="getting-started">Getting Started</h2>
<p>Here is a simple node program that uses the modular pattern. It will
open up a MongoDb database and inserting a row of data into it:</p>
<pre><code><span class="hljs-keyword">var</span> MongoClient = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).MongoClient;
<span class="hljs-keyword">var</span> format = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).format;

<span class="hljs-keyword">var</span> QueryMongo = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">var</span> url01 = <span class="hljs-string">'mongodb://127.0.0.1:27017/test'</span>;
    <span class="hljs-keyword">var</span> url02 = <span class="hljs-string">'mongodb://192.168.2.19:27017/test'</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">QueryMongo</span>(<span class="hljs-params"></span>) </span>{

        <span class="hljs-comment">// Open the test database that comes with MongoDb</span>
        MongoClient.connect(url02, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, database</span>) </span>{
            <span class="hljs-keyword">if</span> (err) {
                <span class="hljs-keyword">throw</span> err;
            }

            insertCollection(database, <span class="hljs-string">'test_insert'</span>, { f : <span class="hljs-number">7</span> });

        });
    }

    <span class="hljs-keyword">var</span> getCollection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">database</span>) </span>{

        <span class="hljs-keyword">var</span> collection = database.collection(<span class="hljs-string">'test_insert'</span>);

        <span class="hljs-comment">// Count documents in the collection</span>
        collection.count(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, count</span>) </span>{
            <span class="hljs-built_in">console</span>.log(format(<span class="hljs-string">"count = %s"</span>, count));
        });

        <span class="hljs-comment">// View the collection</span>
        collection.find().toArray(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, results</span>) </span>{
            <span class="hljs-built_in">console</span>.dir(results);
            database.close();
        });

    };

    <span class="hljs-comment">// Will create collection if it does not exist</span>
    <span class="hljs-keyword">var</span> insertIntoCollection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">db, collectionName, objectToInsert</span>) </span>{

        <span class="hljs-keyword">var</span> collection = db.collection(collectionName);
        collection.insert(objectToInsert, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, docs</span>) </span>{
            getCollection(db);
        });
    };

    <span class="hljs-keyword">return</span> QueryMongo;

})();

<span class="hljs-keyword">var</span> q = <span class="hljs-keyword">new</span> QueryMongo();
</code></pre><h2 id="sort-order">Sort Order</h2>
<p>This is common in NoSQL databases. I believe that by definition, they do not guarantee order. Not all NoSQL databases, but many of them.</p>
<p>Sarcasm alert: Here is MongoDbs careful, detailed, newbie friendly explanation:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/cursor.sort/#return-natural-order">https://docs.mongodb.com/manual/reference/method/cursor.sort/#return-natural-order</a></li>
</ul>
<p>This StackOverflow answer attempts to shed some light on the subject:</p>
<ul>
<li><a href="https://stackoverflow.com/a/33018164/253576">https://stackoverflow.com/a/33018164/253576</a></li>
</ul>
<p>This search is useful:</p>
<ul>
<li><a href="https://www.google.com/search?q=Mongodb+sort+order">https://www.google.com/search?q=Mongodb+sort+order</a></li>
</ul>
<p>Here is a specific method:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/cursor.sort/">https://docs.mongodb.com/manual/reference/method/cursor.sort/</a></li>
</ul>
<p>For this assignment, I will not be focused on sort order. I just want to see records, and to introduce you to NoSQL databases.</p>
<p>To put this in context, NoSQL databases, in their pursuit of the best possible performance, frequently strip out everything except the raw act of inserting and querying. Sorting takes time, so by default, it is not implemented. There are solutions, it is just that they are not the default. As stated earlier, it is not that NoSQL is better than SQL, or vice versa, it is that each has its own special virtues.</p>
<p>If you have to decide: Should I sort in the database, on the server, or on the client, you should:</p>
<ul>
<li><p>Prefer sorting in the database. Let MongoDB handle it. It has the most powerful machine and the most highly optimized routines.</p>
</li>
<li><p>Second would be to sort in the CongressServer, which can also be quite fast since NodeJs is highly optimized code.</p>
</li>
<li><p>Third would be to sort on the client since the browser is probably running on the least powerful machine.</p>
</li>
</ul>
<p>I can think of exceptions, but these would be good general guidelines.</p>
<h2 id="backup-and-restore">Backup and Restore</h2>
<p>Some useful commands.</p>
<p>Backup, first with and then without a password:</p>
<pre>
mongodump --collection scientists --db test --username mongodevdb --password YourSecretPwd --out /dbbackup

mongodump --collection scientists --db test --out $HOME/Documents/Mongo
</pre>

<p>Restore a specific collection:</p>
<pre>
mongorestore --db elven --collection scientists /home/charlie/Documents/Mongo/test/scientists.bson
</pre>

<p>Rename a collection. First switch to the <strong>admin</strong> database:</p>
<pre>
use admin
db.runCommand( { renameCollection: "elven.scientiests", to: "elven.scientists" } )
</pre>

<h2 id="noStart">MongoDb Won&#39;t Start</h2>
<p>If you try to start MongoDB, and find that it won&#39;t start, or at
least won&#39;t stay running after it starts, the problem could be that
you are out of disk space. MongoDB wants lots of diskspace,
something like 3.5 GB. You can, however, request that it use less
disk space by putting <strong>smallfiles = true</strong> at the end of
<strong>/etc/mongodb.conf</strong>. Now your database will be limited in size in
half a gig, but that should be plenty for our needs.</p>
<ul>
<li>Remove lockfile: sudo rm /var/lib/mongodb/mongod.lock</li>
<li>Repair: sudo -u mongodb mongod -f /etc/mongod.conf --repair</li>
<li>sudo service mongod start</li>
</ul>
<h2 id="mongoose-subdocuments">Mongoose Subdocuments</h2>
<p>One of the most powerful features of Mongoose is the ability to work with sub-documents.  </p>
<h2 id="mongoose-gyp-bson">Mongoose Gyp and Bson</h2>
<p>You may get a message about C++ BSON not being installed and so the system is falling back on the &quot;pure javascript version&quot;. Please note this is not an error. There is nothing wrong with the pure javascript version other than it being perhaps a bit slower. That will not matter on a development machine in most cases. So I suggest simply living with the messages on your development machine, and fix them only on your production machine.</p>
<p>If you want to fix them, there are two issues here:</p>
<ul>
<li>Installation on Windows</li>
<li>Installation on Ubuntu Linux</li>
</ul>
<p>In this discussion, we will assume that our production environment is an EC2 Ubuntu server. In this scenario, on Windows, we will are only doing development and testing.</p>
<p>By default, our Ubuntu server does not have a C++ compiler installed. You can test if it does by typing:</p>
<pre><code><span class="hljs-attribute">gcc</span> -v
</code></pre><p>To install the gcc C++ compiler, first connect to your EC2 instance and ensure your it is up to date:</p>
<pre><code>sudo apt-<span class="hljs-built_in">get</span> <span class="hljs-keyword">update</span>
sudo apt-<span class="hljs-built_in">get</span> upgrade
</code></pre><p>Then install gcc:</p>
<pre><code>sudo apt-get <span class="hljs-keyword">install</span> <span class="hljs-keyword">build</span>-essential
</code></pre><p>More details and a reference are <a href="https://help.ubuntu.com/community/InstallingCompilers">here</a></p>
<p>Now when you type <strong>npm install</strong> or <strong>npm install mongoose --save</strong> at the linux command prompt all will go smoothly.</p>
<p>On Windows, there is nothing I can see that is wrong with using the &quot;Pure JavaScript version&quot; of bson. It&#39;s going to be slower, but this is only our development environment.  </p>
<p>So I would just live with the Bson messages, unless you have VS installed already. I don&#39;t really like to install Visual Studio except on a dedicated development machine or in a VM. If, however, you have it installed already, then you should only need to worry about your Python version. I have two versions installed, set up like this:</p>
<pre><code>C:<span class="hljs-tag">\<span class="hljs-name">Python</span></span><span class="hljs-tag">\<span class="hljs-name">Python</span></span>27
C:<span class="hljs-tag">\<span class="hljs-name">Python</span></span><span class="hljs-tag">\<span class="hljs-name">Python</span></span>33
</code></pre><p>I can just change my path to point to the one I want to use at any particular time. One way to do this would be to:</p>
<ul>
<li>Create an environment variable called <strong>PYTHON_HOME</strong>. Set it to point to your currently preferred version of Python:</li>
<li><strong>setx PYTHON_HOME C:\Python\Python27</strong></li>
<li>Append PYTHON_HOME to your path: <strong>C:\Foo;C:\Bar;%PYTHON_HOME%;</strong></li>
</ul>
<p>Now you can just use setx to change the environment variable and then restart your windows command line session:</p>
<pre><code>setx PYTHON_HOME C:<span class="hljs-tag">\<span class="hljs-name">Python</span></span><span class="hljs-tag">\<span class="hljs-name">Python</span></span>33
</code></pre><p>You can read about setx here:</p>
<ul>
<li><a href="http://www.elvenware.com/charlie/os/windows/faq.html#environment">http://www.elvenware.com/charlie/os/windows/faq.html#environment</a></li>
<li><a href="http://ss64.com/nt/setx.html">http://ss64.com/nt/setx.html</a></li>
<li><a href="https://technet.microsoft.com/en-us/library/cc755104.aspx">https://technet.microsoft.com/en-us/library/cc755104.aspx</a></li>
</ul>
</div></body></html>